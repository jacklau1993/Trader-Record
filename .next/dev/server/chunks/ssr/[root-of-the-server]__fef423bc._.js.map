{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/jacklau/Documents/GitHub/Trading-app/db/schema.ts"],"sourcesContent":["import { sqliteTable, text, integer, real } from \"drizzle-orm/sqlite-core\";\n\n// --- BETTER AUTH TABLES ---\n\nexport const user = sqliteTable(\"user\", {\n    id: text(\"id\").primaryKey(),\n    name: text(\"name\").notNull(),\n    email: text(\"email\").notNull().unique(),\n    emailVerified: integer(\"email_verified\", { mode: \"boolean\" }).notNull(),\n    image: text(\"image\"),\n    createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull(),\n    updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull()\n});\n\nexport const session = sqliteTable(\"session\", {\n    id: text(\"id\").primaryKey(),\n    expiresAt: integer(\"expires_at\", { mode: \"timestamp\" }).notNull(),\n    token: text(\"token\").notNull().unique(),\n    createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull(),\n    updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull(),\n    ipAddress: text(\"ip_address\"),\n    userAgent: text(\"user_agent\"),\n    userId: text(\"user_id\").notNull().references(() => user.id)\n});\n\nexport const account = sqliteTable(\"account\", {\n    id: text(\"id\").primaryKey(),\n    accountId: text(\"account_id\").notNull(),\n    providerId: text(\"provider_id\").notNull(),\n    userId: text(\"user_id\").notNull().references(() => user.id),\n    accessToken: text(\"access_token\"),\n    refreshToken: text(\"refresh_token\"),\n    idToken: text(\"id_token\"),\n    accessTokenExpiresAt: integer(\"access_token_expires_at\", { mode: \"timestamp\" }),\n    refreshTokenExpiresAt: integer(\"refresh_token_expires_at\", { mode: \"timestamp\" }),\n    scope: text(\"scope\"),\n    password: text(\"password\"),\n    createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull(),\n    updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull()\n});\n\nexport const verification = sqliteTable(\"verification\", {\n    id: text(\"id\").primaryKey(),\n    identifier: text(\"identifier\").notNull(),\n    value: text(\"value\").notNull(),\n    expiresAt: integer(\"expires_at\", { mode: \"timestamp\" }).notNull(),\n    createdAt: integer(\"created_at\", { mode: \"timestamp\" }),\n    updatedAt: integer(\"updated_at\", { mode: \"timestamp\" })\n});\n\n// --- TRADING APP TABLES ---\n\nexport const categories = sqliteTable(\"category\", {\n    id: text(\"id\").primaryKey(),\n    name: text(\"name\").notNull(),\n    color: text(\"color\").default(\"blue\").notNull(),\n    userId: text(\"user_id\").notNull().references(() => user.id, { onDelete: \"cascade\" }),\n    createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n    updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date())\n});\n\nexport const tags = sqliteTable(\"tag\", {\n    id: text(\"id\").primaryKey(),\n    name: text(\"name\").notNull(),\n    color: text(\"color\"),\n    categoryId: text(\"category_id\").notNull().references(() => categories.id, { onDelete: \"cascade\" }),\n    userId: text(\"user_id\").notNull().references(() => user.id, { onDelete: \"cascade\" }),\n    createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n    updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date())\n});\n\nexport const trades = sqliteTable(\"trade\", {\n    id: text(\"id\").primaryKey(),\n    date: text(\"date\").notNull(), // ISO Date String\n    ticker: text(\"ticker\").notNull(),\n    type: text(\"type\").notNull(), // \"Long\" | \"Short\"\n    entryPrice: real(\"entry_price\").notNull(),\n    exitPrice: real(\"exit_price\").notNull(),\n    quantity: real(\"quantity\").notNull(),\n    pnl: real(\"pnl\").notNull(),\n    status: text(\"status\").default(\"Closed\").notNull(),\n    notes: text(\"notes\"),\n\n    // Advanced Metrics\n    contracts: real(\"contracts\"),\n    points: real(\"points\"),\n    ticks: real(\"ticks\"),\n    rating: integer(\"rating\"),\n    profitTarget: real(\"profit_target\"),\n    stopLoss: real(\"stop_loss\"),\n    plannedRR: real(\"planned_rr\"),\n    realizedRR: real(\"realized_rr\"),\n\n    userId: text(\"user_id\").notNull().references(() => user.id, { onDelete: \"cascade\" }),\n    createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n    updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date())\n});\n\n// Join table for Trade <-> Tags if needed, but for simplicity storing tags might be easier. \n// However, proper SQL way is a join table.\nexport const tradeTags = sqliteTable(\"trade_tag\", {\n    tradeId: text(\"trade_id\").notNull().references(() => trades.id, { onDelete: \"cascade\" }),\n    tagId: text(\"tag_id\").notNull().references(() => tags.id, { onDelete: \"cascade\" }),\n});\n\nexport const sections = sqliteTable(\"section\", {\n    id: text(\"id\").primaryKey(),\n    name: text(\"name\").notNull(),\n    userId: text(\"user_id\").notNull().references(() => user.id, { onDelete: \"cascade\" }),\n    createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n    updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date())\n});\n\nexport const notes = sqliteTable(\"note\", {\n    id: text(\"id\").primaryKey(),\n    title: text(\"title\").notNull(),\n    content: text(\"content\").notNull(),\n    date: text(\"date\").notNull(), // ISO Date String\n    sectionId: text(\"section_id\").notNull().references(() => sections.id, { onDelete: \"cascade\" }),\n    userId: text(\"user_id\").notNull().references(() => user.id, { onDelete: \"cascade\" }),\n    createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n    updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date())\n});\n\nexport const noteTags = sqliteTable(\"note_tag\", {\n    noteId: text(\"note_id\").notNull().references(() => notes.id, { onDelete: \"cascade\" }),\n    tagId: text(\"tag_id\").notNull().references(() => tags.id, { onDelete: \"cascade\" }),\n});\n\nexport const templates = sqliteTable(\"template\", {\n    id: text(\"id\").primaryKey(),\n    name: text(\"name\").notNull(),\n    content: text(\"content\").notNull(),\n    userId: text(\"user_id\").notNull().references(() => user.id, { onDelete: \"cascade\" }),\n    createdAt: integer(\"created_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date()),\n    updatedAt: integer(\"updated_at\", { mode: \"timestamp\" }).notNull().$defaultFn(() => new Date())\n});\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 241, "column": 0}, "map": {"version":3,"sources":["file:///Users/jacklau/Documents/GitHub/Trading-app/lib/db.ts"],"sourcesContent":["import { drizzle } from \"drizzle-orm/d1\";\nimport { drizzle as drizzleSqlite } from \"drizzle-orm/better-sqlite3\";\nimport Database from \"better-sqlite3\";\nimport * as schema from \"../db/schema\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport const getDb = (d1?: any) => {\n    // 1. If running on Cloudflare (Production or Preview), use D1\n    if (d1) {\n        return drizzle(d1, { schema });\n    }\n\n    // 2. Fallback: If D1 is not provided (e.g. running locally 'npm run dev', 'npm run build', or 'npm start'),\n    // try to connect to the local .wrangler SQLite file.\n    const wranglerDir = path.resolve(process.cwd(), \".wrangler/state/v3/d1/miniflare-D1DatabaseObject\");\n\n    // Find the .sqlite file\n    if (fs.existsSync(wranglerDir)) {\n        const files = fs.readdirSync(wranglerDir);\n        const sqliteFile = files.find(f => f.endsWith(\".sqlite\"));\n\n        if (sqliteFile) {\n            const dbPath = path.join(wranglerDir, sqliteFile);\n            const sqlite = new Database(dbPath);\n            return drizzleSqlite(sqlite, { schema });\n        }\n    }\n\n    // 3. If we are running in a build context (Next.js build) and no DB is found, \n    // we might want to return a dummy or throw a more helpful error.\n    // For now, let's throw, but this verifies that we tried both D1 and Local.\n    throw new Error(\"Database connection failed. Ensure local dev is set up or D1 binding is provided.\");\n};\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;AAEO,MAAM,QAAQ,CAAC;IAClB,8DAA8D;IAC9D,IAAI,IAAI;QACJ,OAAO,IAAA,yJAAO,EAAC,IAAI;YAAE,QAAA;QAAO;IAChC;IAEA,4GAA4G;IAC5G,qDAAqD;IACrD,MAAM,cAAc,4GAAI,CAAC,OAAO,CAAC,QAAQ,GAAG,IAAI;IAEhD,wBAAwB;IACxB,IAAI,wGAAE,CAAC,UAAU,CAAC,cAAc;QAC5B,MAAM,QAAQ,wGAAE,CAAC,WAAW,CAAC;QAC7B,MAAM,aAAa,MAAM,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,CAAC;QAE9C,IAAI,YAAY;YACZ,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,aAAa;YACtC,MAAM,SAAS,IAAI,sIAAQ,CAAC;YAC5B,OAAO,IAAA,wKAAa,EAAC,QAAQ;gBAAE,QAAA;YAAO;QAC1C;IACJ;IAEA,+EAA+E;IAC/E,iEAAiE;IACjE,2EAA2E;IAC3E,MAAM,IAAI,MAAM;AACpB"}},
    {"offset": {"line": 288, "column": 0}, "map": {"version":3,"sources":["file:///Users/jacklau/Documents/GitHub/Trading-app/lib/auth.ts"],"sourcesContent":["import { betterAuth } from \"better-auth\";\nimport { drizzleAdapter } from \"better-auth/adapters/drizzle\";\nimport { getDb } from \"./db\";\nimport * as schema from \"../db/schema\";\n\n// In local dev `npm run dev`, getDb() will find the local file.\n// In prod (Cloudflare), this might fail if initialized globally without binding.\n// But for now, let's target local dev to get it working.\nconst db = getDb();\n\nexport const auth = betterAuth({\n    database: drizzleAdapter(db, {\n        provider: \"sqlite\",\n        schema: schema\n    }),\n    emailAndPassword: {\n        enabled: true,\n    }\n});\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AACA;AACA;;;;;AAEA,gEAAgE;AAChE,iFAAiF;AACjF,yDAAyD;AACzD,MAAM,KAAK,IAAA,kHAAK;AAET,MAAM,OAAO,IAAA,4MAAU,EAAC;IAC3B,UAAU,IAAA,oMAAc,EAAC,IAAI;QACzB,UAAU;QACV,QAAQ;IACZ;IACA,kBAAkB;QACd,SAAS;IACb;AACJ"}},
    {"offset": {"line": 318, "column": 0}, "map": {"version":3,"sources":["file:///Users/jacklau/Documents/GitHub/Trading-app/app/actions/trade-actions.ts"],"sourcesContent":["\"use server\";\n\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { getDb } from \"@/lib/db\";\nimport { trades, tradeTags } from \"@/db/schema\";\nimport { eq, desc, and, inArray } from \"drizzle-orm\";\nimport { revalidatePath } from \"next/cache\";\n\n// Helper to get authenticated user\nasync function getUser() {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session?.user) {\n        throw new Error(\"Unauthorized\");\n    }\n    return session.user;\n}\n\nexport async function getTrades() {\n    const user = await getUser();\n    const db = getDb();\n\n    // 1. Fetch trades\n    const userTrades = await db.select()\n        .from(trades)\n        .where(eq(trades.userId, user.id))\n        .orderBy(desc(trades.date));\n\n    // 2. Fetch tags for these trades\n    // We can do this efficiently by fetching all trade_tags for these trade IDs\n    const tradeIds = userTrades.map(t => t.id);\n    let tagsMap: Record<string, string[]> = {};\n\n    if (tradeIds.length > 0) {\n        const relatedTags = await db.select()\n            .from(tradeTags)\n            .where(inArray(tradeTags.tradeId, tradeIds));\n\n        relatedTags.forEach(rt => {\n            if (!tagsMap[rt.tradeId]) tagsMap[rt.tradeId] = [];\n            tagsMap[rt.tradeId].push(rt.tagId);\n        });\n    }\n\n    // 3. Merge\n    return userTrades.map(t => ({\n        ...t,\n        tags: tagsMap[t.id] || []\n    }));\n}\n\nexport async function getTrade(id: string) {\n    const user = await getUser();\n    const db = getDb();\n\n    const trade = await db.select().from(trades).where(and(eq(trades.id, id), eq(trades.userId, user.id))).get();\n\n    if (!trade) return null;\n\n    const tags = await db.select().from(tradeTags).where(eq(tradeTags.tradeId, id));\n\n    return {\n        ...trade,\n        tags: tags.map(t => t.tagId)\n    };\n}\n\n// Define Input Type\ntype CreateTradeInput = Omit<typeof trades.$inferInsert, \"userId\"> & { tags?: string[] };\n\nexport async function createTrade(data: CreateTradeInput) {\n    const user = await getUser();\n    const db = getDb();\n\n    const { tags: tagIds, ...tradeData } = data;\n\n    // Force userId to match session\n    const newTrade = {\n        ...tradeData,\n        userId: user.id,\n        createdAt: new Date(),\n        updatedAt: new Date()\n    };\n\n    await db.insert(trades).values(newTrade);\n\n    if (tagIds && tagIds.length > 0) {\n        for (const tagId of tagIds) {\n            await db.insert(tradeTags).values({\n                tradeId: newTrade.id,\n                tagId: tagId\n            });\n        }\n    }\n\n    revalidatePath(\"/trades\");\n    revalidatePath(\"/\");\n    revalidatePath(\"/reports\");\n    return { success: true };\n}\n\nexport async function updateTrade(id: string, data: Partial<CreateTradeInput>) {\n    const user = await getUser();\n    const db = getDb();\n\n    const { tags: tagIds, ...tradeData } = data;\n\n    if (Object.keys(tradeData).length > 0) {\n        await db.update(trades)\n            .set({ ...tradeData, updatedAt: new Date() })\n            .where(and(eq(trades.id, id), eq(trades.userId, user.id)));\n    }\n\n    if (tagIds !== undefined) {\n        // Replace tags\n        // 1. Delete existing for this trade\n        await db.delete(tradeTags).where(eq(tradeTags.tradeId, id));\n\n        // 2. Insert new\n        if (tagIds.length > 0) {\n            for (const tagId of tagIds) {\n                await db.insert(tradeTags).values({\n                    tradeId: id,\n                    tagId: tagId\n                });\n            }\n        }\n    }\n\n    revalidatePath(\"/trades\");\n    revalidatePath(`/trades/${id}`);\n    revalidatePath(\"/\");\n    revalidatePath(\"/reports\");\n    return { success: true };\n}\n\nexport async function deleteTrade(id: string) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.delete(trades)\n        .where(and(eq(trades.id, id), eq(trades.userId, user.id)));\n    // Cascade should handle tradeTags deletion or we can do manual if needed.\n    // Schema has onDelete: cascade, so it should be fine.\n\n    revalidatePath(\"/trades\");\n    revalidatePath(\"/\");\n    revalidatePath(\"/reports\");\n    return { success: true };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 478, "column": 0}, "map": {"version":3,"sources":["file:///Users/jacklau/Documents/GitHub/Trading-app/app/actions/note-actions.ts"],"sourcesContent":["\"use server\";\n\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { getDb } from \"@/lib/db\";\nimport { notes, sections, noteTags } from \"@/db/schema\";\nimport { eq, desc, and } from \"drizzle-orm\";\nimport { revalidatePath } from \"next/cache\";\n\nasync function getUser() {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session?.user) throw new Error(\"Unauthorized\");\n    return session.user;\n}\n\nexport async function getNotes() {\n    const user = await getUser();\n    const db = getDb();\n\n    // Fetch notes descending by date\n    return await db.select()\n        .from(notes)\n        .where(eq(notes.userId, user.id))\n        .orderBy(desc(notes.date));\n}\n\nexport async function getSections() {\n    const user = await getUser();\n    const db = getDb();\n\n    // Fetch sections or return defaults if empty?\n    // User might need to init sections.\n    const userSections = await db.select().from(sections).where(eq(sections.userId, user.id));\n\n    if (userSections.length === 0) {\n        // Init default sections\n        const defaults = [\"Trade Notes\", \"Daily Journal\", \"Strategy\", \"Backtesting\"];\n        for (const name of defaults) {\n            await db.insert(sections).values({\n                id: `sec_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n                name,\n                userId: user.id\n            });\n        }\n        return await db.select().from(sections).where(eq(sections.userId, user.id));\n    }\n\n    return userSections;\n}\n\nexport async function createNote(data: Omit<typeof notes.$inferInsert, \"userId\">) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.insert(notes).values({\n        ...data,\n        userId: user.id\n    });\n\n    revalidatePath(\"/notebook\");\n    return { success: true };\n}\n\nexport async function updateNote(id: string, data: Partial<typeof notes.$inferInsert>) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.update(notes)\n        .set({ ...data, updatedAt: new Date() })\n        .where(and(eq(notes.id, id), eq(notes.userId, user.id)));\n\n    revalidatePath(\"/notebook\");\n    return { success: true };\n}\n\nexport async function deleteNote(id: string) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.delete(notes)\n        .where(and(eq(notes.id, id), eq(notes.userId, user.id)));\n\n    revalidatePath(\"/notebook\");\n    return { success: true };\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;;;;;;;;;AAEA,eAAe;IACX,MAAM,UAAU,MAAM,mHAAI,CAAC,GAAG,CAAC,UAAU,CAAC;QACtC,SAAS,MAAM,IAAA,0IAAO;IAC1B;IACA,IAAI,CAAC,SAAS,MAAM,MAAM,IAAI,MAAM;IACpC,OAAO,QAAQ,IAAI;AACvB;AAEO,eAAe;IAClB,MAAM,OAAO,MAAM;IACnB,MAAM,KAAK,IAAA,kHAAK;IAEhB,iCAAiC;IACjC,OAAO,MAAM,GAAG,MAAM,GACjB,IAAI,CAAC,qHAAK,EACV,KAAK,CAAC,IAAA,wKAAE,EAAC,qHAAK,CAAC,MAAM,EAAE,KAAK,EAAE,GAC9B,OAAO,CAAC,IAAA,sKAAI,EAAC,qHAAK,CAAC,IAAI;AAChC;AAEO,eAAe;IAClB,MAAM,OAAO,MAAM;IACnB,MAAM,KAAK,IAAA,kHAAK;IAEhB,8CAA8C;IAC9C,oCAAoC;IACpC,MAAM,eAAe,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,wHAAQ,EAAE,KAAK,CAAC,IAAA,wKAAE,EAAC,wHAAQ,CAAC,MAAM,EAAE,KAAK,EAAE;IAEvF,IAAI,aAAa,MAAM,KAAK,GAAG;QAC3B,wBAAwB;QACxB,MAAM,WAAW;YAAC;YAAe;YAAiB;YAAY;SAAc;QAC5E,KAAK,MAAM,QAAQ,SAAU;YACzB,MAAM,GAAG,MAAM,CAAC,wHAAQ,EAAE,MAAM,CAAC;gBAC7B,IAAI,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;gBAClE;gBACA,QAAQ,KAAK,EAAE;YACnB;QACJ;QACA,OAAO,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,wHAAQ,EAAE,KAAK,CAAC,IAAA,wKAAE,EAAC,wHAAQ,CAAC,MAAM,EAAE,KAAK,EAAE;IAC7E;IAEA,OAAO;AACX;AAEO,eAAe,WAAW,IAA+C;IAC5E,MAAM,OAAO,MAAM;IACnB,MAAM,KAAK,IAAA,kHAAK;IAEhB,MAAM,GAAG,MAAM,CAAC,qHAAK,EAAE,MAAM,CAAC;QAC1B,GAAG,IAAI;QACP,QAAQ,KAAK,EAAE;IACnB;IAEA,IAAA,+IAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AAC3B;AAEO,eAAe,WAAW,EAAU,EAAE,IAAwC;IACjF,MAAM,OAAO,MAAM;IACnB,MAAM,KAAK,IAAA,kHAAK;IAEhB,MAAM,GAAG,MAAM,CAAC,qHAAK,EAChB,GAAG,CAAC;QAAE,GAAG,IAAI;QAAE,WAAW,IAAI;IAAO,GACrC,KAAK,CAAC,IAAA,yKAAG,EAAC,IAAA,wKAAE,EAAC,qHAAK,CAAC,EAAE,EAAE,KAAK,IAAA,wKAAE,EAAC,qHAAK,CAAC,MAAM,EAAE,KAAK,EAAE;IAEzD,IAAA,+IAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AAC3B;AAEO,eAAe,WAAW,EAAU;IACvC,MAAM,OAAO,MAAM;IACnB,MAAM,KAAK,IAAA,kHAAK;IAEhB,MAAM,GAAG,MAAM,CAAC,qHAAK,EAChB,KAAK,CAAC,IAAA,yKAAG,EAAC,IAAA,wKAAE,EAAC,qHAAK,CAAC,EAAE,EAAE,KAAK,IAAA,wKAAE,EAAC,qHAAK,CAAC,MAAM,EAAE,KAAK,EAAE;IAEzD,IAAA,+IAAc,EAAC;IACf,OAAO;QAAE,SAAS;IAAK;AAC3B;;;IArEsB;IAWA;IAwBA;IAaA;IAYA;;AA5DA,+OAAA;AAWA,+OAAA;AAwBA,+OAAA;AAaA,+OAAA;AAYA,+OAAA"}},
    {"offset": {"line": 594, "column": 0}, "map": {"version":3,"sources":["file:///Users/jacklau/Documents/GitHub/Trading-app/app/actions/tag-actions.ts"],"sourcesContent":["\"use server\";\n\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { getDb } from \"@/lib/db\";\nimport { categories, tags } from \"@/db/schema\";\nimport { eq, and } from \"drizzle-orm\";\nimport { revalidatePath } from \"next/cache\";\n\nasync function getUser() {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session?.user) throw new Error(\"Unauthorized\");\n    return session.user;\n}\n\n// --- Categories ---\nexport async function getCategories() {\n    const user = await getUser();\n    const db = getDb();\n\n    // Fetch categories and their tags\n    // Drizzle doesn't do deep nesting automatically easily without `with` query which requires relations defined.\n    // For simplicity, we'll fetch both and assemble in JS, or use a join.\n    // Let's fetch all categories for user\n    const userCats = await db.select().from(categories).where(eq(categories.userId, user.id));\n    const userTags = await db.select().from(tags).where(eq(tags.userId, user.id));\n\n    // Assemble\n    return userCats.map(cat => ({\n        ...cat,\n        tags: userTags.filter(t => t.categoryId === cat.id)\n    }));\n}\n\nexport async function createCategory(data: Omit<typeof categories.$inferInsert, \"userId\">) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.insert(categories).values({\n        ...data,\n        userId: user.id\n    });\n\n    revalidatePath(\"/tags\");\n    revalidatePath(\"/reports\");\n    return { success: true };\n}\n\nexport async function deleteCategory(id: string) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.delete(categories).where(and(eq(categories.id, id), eq(categories.userId, user.id)));\n    revalidatePath(\"/tags\");\n    return { success: true };\n}\n\nexport async function updateCategory(id: string, data: Partial<typeof categories.$inferInsert>) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.update(categories)\n        .set({ ...data, updatedAt: new Date() })\n        .where(and(eq(categories.id, id), eq(categories.userId, user.id)));\n\n    // If color changed, update tags? The current logic does that in UI, \n    // but in DB we might want to cascade or keep them separate.\n    // The previous app logic updated all tags.\n    if (data.color) {\n        await db.update(tags)\n            .set({ color: data.color }) // We might need to adjust formatting if color logic changes\n            .where(and(eq(tags.categoryId, id), eq(tags.userId, user.id)));\n    }\n\n    revalidatePath(\"/tags\");\n    return { success: true };\n}\n\n// --- Tags ---\nexport async function createTag(data: Omit<typeof tags.$inferInsert, \"userId\">) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.insert(tags).values({\n        ...data,\n        userId: user.id\n    });\n\n    revalidatePath(\"/tags\");\n    return { success: true };\n}\n\nexport async function deleteTag(id: string) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.delete(tags).where(and(eq(tags.id, id), eq(tags.userId, user.id)));\n    revalidatePath(\"/tags\");\n    return { success: true };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 728, "column": 0}, "map": {"version":3,"sources":["file:///Users/jacklau/Documents/GitHub/Trading-app/app/actions/template-actions.ts"],"sourcesContent":["\"use server\";\n\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { getDb } from \"@/lib/db\";\nimport { templates } from \"@/db/schema\";\nimport { eq, and } from \"drizzle-orm\";\nimport { revalidatePath } from \"next/cache\";\n\nasync function getUser() {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session?.user) throw new Error(\"Unauthorized\");\n    return session.user;\n}\n\nexport async function getTemplates() {\n    const user = await getUser();\n    const db = getDb();\n\n    const userTemplates = await db.select().from(templates).where(eq(templates.userId, user.id));\n\n    if (userTemplates.length === 0) {\n        // Init defaults\n        const defaults = [\n            { name: \"Daily Plan\", content: \"\\n# Daily Plan\\n- [ ] Review Overnight Action\\n- [ ] Check Economic Calendar\\n- [ ] Key Levels to Watch:\\n  - ES: \\n  - NQ: \\n\" },\n            { name: \"Trade Review\", content: \"\\n# Trade Review\\n- Setup:\\n- Execution:\\n- Psychology:\\n- Outcome:\\n- Improvements:\\n\" },\n            { name: \"Weekly Review\", content: \"\\n# Weekly Review\\n- P&L: \\n- Best Trade:\\n- Worst Trade:\\n- Lessons Learned:\\n\" }\n        ];\n\n        for (const t of defaults) {\n            await db.insert(templates).values({\n                id: `tmpl_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,\n                userId: user.id,\n                name: t.name,\n                content: t.content\n            });\n        }\n        return await db.select().from(templates).where(eq(templates.userId, user.id));\n    }\n\n    return userTemplates;\n}\n\nexport async function createTemplate(data: Omit<typeof templates.$inferInsert, \"userId\">) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.insert(templates).values({\n        ...data,\n        userId: user.id\n    });\n    // No specific page to revalidate for templates unless we have a manager page. \n    // But Editor uses them. \n    return { success: true };\n}\n\nexport async function updateTemplate(id: string, data: Partial<typeof templates.$inferInsert>) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.update(templates)\n        .set({ ...data, updatedAt: new Date() })\n        .where(and(eq(templates.id, id), eq(templates.userId, user.id)));\n    return { success: true };\n}\n\nexport async function deleteTemplate(id: string) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.delete(templates).where(and(eq(templates.id, id), eq(templates.userId, user.id)));\n    return { success: true };\n}\n"],"names":[],"mappings":";;;;;;;;;;;AAEA;AACA;AACA;AACA;AACA;;;;;;;;AAGA,eAAe;IACX,MAAM,UAAU,MAAM,mHAAI,CAAC,GAAG,CAAC,UAAU,CAAC;QACtC,SAAS,MAAM,IAAA,0IAAO;IAC1B;IACA,IAAI,CAAC,SAAS,MAAM,MAAM,IAAI,MAAM;IACpC,OAAO,QAAQ,IAAI;AACvB;AAEO,eAAe;IAClB,MAAM,OAAO,MAAM;IACnB,MAAM,KAAK,IAAA,kHAAK;IAEhB,MAAM,gBAAgB,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,yHAAS,EAAE,KAAK,CAAC,IAAA,wKAAE,EAAC,yHAAS,CAAC,MAAM,EAAE,KAAK,EAAE;IAE1F,IAAI,cAAc,MAAM,KAAK,GAAG;QAC5B,gBAAgB;QAChB,MAAM,WAAW;YACb;gBAAE,MAAM;gBAAc,SAAS;YAAiI;YAChK;gBAAE,MAAM;gBAAgB,SAAS;YAAyF;YAC1H;gBAAE,MAAM;gBAAiB,SAAS;YAAkF;SACvH;QAED,KAAK,MAAM,KAAK,SAAU;YACtB,MAAM,GAAG,MAAM,CAAC,yHAAS,EAAE,MAAM,CAAC;gBAC9B,IAAI,CAAC,KAAK,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;gBACnE,QAAQ,KAAK,EAAE;gBACf,MAAM,EAAE,IAAI;gBACZ,SAAS,EAAE,OAAO;YACtB;QACJ;QACA,OAAO,MAAM,GAAG,MAAM,GAAG,IAAI,CAAC,yHAAS,EAAE,KAAK,CAAC,IAAA,wKAAE,EAAC,yHAAS,CAAC,MAAM,EAAE,KAAK,EAAE;IAC/E;IAEA,OAAO;AACX;AAEO,eAAe,eAAe,IAAmD;IACpF,MAAM,OAAO,MAAM;IACnB,MAAM,KAAK,IAAA,kHAAK;IAEhB,MAAM,GAAG,MAAM,CAAC,yHAAS,EAAE,MAAM,CAAC;QAC9B,GAAG,IAAI;QACP,QAAQ,KAAK,EAAE;IACnB;IACA,+EAA+E;IAC/E,yBAAyB;IACzB,OAAO;QAAE,SAAS;IAAK;AAC3B;AAEO,eAAe,eAAe,EAAU,EAAE,IAA4C;IACzF,MAAM,OAAO,MAAM;IACnB,MAAM,KAAK,IAAA,kHAAK;IAEhB,MAAM,GAAG,MAAM,CAAC,yHAAS,EACpB,GAAG,CAAC;QAAE,GAAG,IAAI;QAAE,WAAW,IAAI;IAAO,GACrC,KAAK,CAAC,IAAA,yKAAG,EAAC,IAAA,wKAAE,EAAC,yHAAS,CAAC,EAAE,EAAE,KAAK,IAAA,wKAAE,EAAC,yHAAS,CAAC,MAAM,EAAE,KAAK,EAAE;IACjE,OAAO;QAAE,SAAS;IAAK;AAC3B;AAEO,eAAe,eAAe,EAAU;IAC3C,MAAM,OAAO,MAAM;IACnB,MAAM,KAAK,IAAA,kHAAK;IAEhB,MAAM,GAAG,MAAM,CAAC,yHAAS,EAAE,KAAK,CAAC,IAAA,yKAAG,EAAC,IAAA,wKAAE,EAAC,yHAAS,CAAC,EAAE,EAAE,KAAK,IAAA,wKAAE,EAAC,yHAAS,CAAC,MAAM,EAAE,KAAK,EAAE;IACvF,OAAO;QAAE,SAAS;IAAK;AAC3B;;;IAzDsB;IA4BA;IAaA;IAUA;;AAnDA,+OAAA;AA4BA,+OAAA;AAaA,+OAAA;AAUA,+OAAA"}},
    {"offset": {"line": 837, "column": 0}, "map": {"version":3,"sources":["file:///Users/jacklau/Documents/GitHub/Trading-app/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getTrades as '0090736f02578ca4b4c65e6dca5ee83390105d6c03'} from 'ACTIONS_MODULE0'\nexport {getTrade as '40106a6085ff6e4feab105289aa01acea1ad94d7b8'} from 'ACTIONS_MODULE0'\nexport {createTrade as '405500843b9859315359f61100b975024bf60c4f7a'} from 'ACTIONS_MODULE0'\nexport {deleteTrade as '40a3d5153dba4e5c0aec170a7205a5e78fde36deb0'} from 'ACTIONS_MODULE0'\nexport {updateTrade as '60a48f3a0630dd2fabb9d3e4cd4bf0c504966521c5'} from 'ACTIONS_MODULE0'\nexport {createTrade as '405500843b9859315359f61100b975024bf60c4f7a'} from 'ACTIONS_MODULE0'\nexport {createNote as '406debee7cf8e0814e52095644e4c8fbd292855462'} from 'ACTIONS_MODULE1'\nexport {getSections as '007b063976cca985f8945e48ef16566224a288712c'} from 'ACTIONS_MODULE1'\nexport {createCategory as '406c4bb6286029f3b391260d4174226fe58f0b55a3'} from 'ACTIONS_MODULE2'\nexport {createTag as '40f821b8bbcc291b86e1f7707cf05a76fa515e1a92'} from 'ACTIONS_MODULE2'\nexport {createTemplate as '404bf889af309280233c16c7335b847e95e56728ac'} from 'ACTIONS_MODULE3'\n"],"names":[],"mappings":";AAAA;AAMA;AAEA;AAEA"}}]
}