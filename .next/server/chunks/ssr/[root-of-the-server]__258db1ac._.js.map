{"version":3,"sources":["../../../../app/actions/note-actions.ts","../../../../app/actions/template-actions.ts","../../../../.next-internal/server/app/notebook/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\";\n\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { getDb } from \"@/lib/db\";\nimport { notes, sections, noteTags } from \"@/db/schema\";\nimport { eq, desc, and } from \"drizzle-orm\";\nimport { revalidatePath } from \"next/cache\";\n\nasync function getUser() {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session?.user) throw new Error(\"Unauthorized\");\n    return session.user;\n}\n\nexport async function getNotes() {\n    const user = await getUser();\n    const db = getDb();\n\n    // Fetch notes descending by date\n    return await db.select()\n        .from(notes)\n        .where(eq(notes.userId, user.id))\n        .orderBy(desc(notes.date));\n}\n\nexport async function getSections() {\n    const user = await getUser();\n    const db = getDb();\n\n    // Fetch sections or return defaults if empty?\n    // User might need to init sections.\n    const userSections = await db.select().from(sections).where(eq(sections.userId, user.id));\n\n    if (userSections.length === 0) {\n        // Init default sections\n        const defaults = [\"Trade Notes\", \"Daily Journal\", \"Strategy\", \"Backtesting\"];\n        for (const name of defaults) {\n            await db.insert(sections).values({\n                id: `sec_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n                name,\n                userId: user.id\n            });\n        }\n        return await db.select().from(sections).where(eq(sections.userId, user.id));\n    }\n\n    return userSections;\n}\n\nexport async function createNote(data: Omit<typeof notes.$inferInsert, \"userId\">) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.insert(notes).values({\n        ...data,\n        userId: user.id\n    });\n\n    revalidatePath(\"/notebook\");\n    return { success: true };\n}\n\nexport async function updateNote(id: string, data: Partial<typeof notes.$inferInsert>) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.update(notes)\n        .set({ ...data, updatedAt: new Date() })\n        .where(and(eq(notes.id, id), eq(notes.userId, user.id)));\n\n    revalidatePath(\"/notebook\");\n    return { success: true };\n}\n\nexport async function deleteNote(id: string) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.delete(notes)\n        .where(and(eq(notes.id, id), eq(notes.userId, user.id)));\n\n    revalidatePath(\"/notebook\");\n    return { success: true };\n}\n","\"use server\";\n\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { getDb } from \"@/lib/db\";\nimport { templates } from \"@/db/schema\";\nimport { eq, and } from \"drizzle-orm\";\nimport { revalidatePath } from \"next/cache\";\n\nasync function getUser() {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session?.user) throw new Error(\"Unauthorized\");\n    return session.user;\n}\n\nexport async function getTemplates() {\n    const user = await getUser();\n    const db = getDb();\n\n    const userTemplates = await db.select().from(templates).where(eq(templates.userId, user.id));\n\n    if (userTemplates.length === 0) {\n        // Init defaults\n        const defaults = [\n            { name: \"Daily Plan\", content: \"\\n# Daily Plan\\n- [ ] Review Overnight Action\\n- [ ] Check Economic Calendar\\n- [ ] Key Levels to Watch:\\n  - ES: \\n  - NQ: \\n\" },\n            { name: \"Trade Review\", content: \"\\n# Trade Review\\n- Setup:\\n- Execution:\\n- Psychology:\\n- Outcome:\\n- Improvements:\\n\" },\n            { name: \"Weekly Review\", content: \"\\n# Weekly Review\\n- P&L: \\n- Best Trade:\\n- Worst Trade:\\n- Lessons Learned:\\n\" }\n        ];\n\n        for (const t of defaults) {\n            await db.insert(templates).values({\n                id: `tmpl_${Date.now()}_${Math.random().toString(36).substr(2, 5)}`,\n                userId: user.id,\n                name: t.name,\n                content: t.content\n            });\n        }\n        return await db.select().from(templates).where(eq(templates.userId, user.id));\n    }\n\n    return userTemplates;\n}\n\nexport async function createTemplate(data: Omit<typeof templates.$inferInsert, \"userId\">) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.insert(templates).values({\n        ...data,\n        userId: user.id\n    });\n    // No specific page to revalidate for templates unless we have a manager page. \n    // But Editor uses them. \n    return { success: true };\n}\n\nexport async function updateTemplate(id: string, data: Partial<typeof templates.$inferInsert>) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.update(templates)\n        .set({ ...data, updatedAt: new Date() })\n        .where(and(eq(templates.id, id), eq(templates.userId, user.id)));\n    return { success: true };\n}\n\nexport async function deleteTemplate(id: string) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.delete(templates).where(and(eq(templates.id, id), eq(templates.userId, user.id)));\n    return { success: true };\n}\n","export {getNotes as '0012b0fb54d7c60fda7355e278d2c327c63a247960'} from 'ACTIONS_MODULE0'\nexport {getSections as '0083eb236ecd51927952cda1a88f01b78b44944c75'} from 'ACTIONS_MODULE0'\nexport {createNote as '4042d9d02b006aeba0d0c1abce59f22ed3757dd9f9'} from 'ACTIONS_MODULE0'\nexport {deleteNote as '40fc2a295eb212a4a8f487ac6d38f293db05c0d210'} from 'ACTIONS_MODULE0'\nexport {updateNote as '6062f86ae61a00969d4a1203d25a3ad253f9f0ac06'} from 'ACTIONS_MODULE0'\nexport {updateNote as '6062f86ae61a00969d4a1203d25a3ad253f9f0ac06'} from 'ACTIONS_MODULE0'\nexport {getTemplates as '00a5501a00bacef6ebba6b41499ec193739cbce65b'} from 'ACTIONS_MODULE1'\nexport {createTemplate as '401b3aa34ac0439e0024b2b923778bf44edb922d4d'} from 'ACTIONS_MODULE1'\nexport {updateTemplate as '60a791547e0eff38717b00b69518f77fbeb1e939c2'} from 'ACTIONS_MODULE1'\nexport {deleteTemplate as '40d18498003e55a4d84f21a5deed2dac65f4675d9d'} from 'ACTIONS_MODULE1'\nexport {createNote as '4042d9d02b006aeba0d0c1abce59f22ed3757dd9f9'} from 'ACTIONS_MODULE0'\nexport {deleteNote as '40fc2a295eb212a4a8f487ac6d38f293db05c0d210'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}