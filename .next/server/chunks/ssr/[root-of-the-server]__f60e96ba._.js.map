{"version":3,"sources":["../../../../app/actions/tag-actions.ts","../../../../.next-internal/server/app/tags/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\";\n\nimport { auth } from \"@/lib/auth\";\nimport { headers } from \"next/headers\";\nimport { getDb } from \"@/lib/db\";\nimport { categories, tags } from \"@/db/schema\";\nimport { eq, and } from \"drizzle-orm\";\nimport { revalidatePath } from \"next/cache\";\n\nasync function getUser() {\n    const session = await auth.api.getSession({\n        headers: await headers()\n    });\n    if (!session?.user) throw new Error(\"Unauthorized\");\n    return session.user;\n}\n\n// --- Categories ---\nexport async function getCategories() {\n    const user = await getUser();\n    const db = getDb();\n\n    // Fetch categories and their tags\n    // Drizzle doesn't do deep nesting automatically easily without `with` query which requires relations defined.\n    // For simplicity, we'll fetch both and assemble in JS, or use a join.\n    // Let's fetch all categories for user\n    const userCats = await db.select().from(categories).where(eq(categories.userId, user.id));\n    const userTags = await db.select().from(tags).where(eq(tags.userId, user.id));\n\n    // Assemble\n    return userCats.map(cat => ({\n        ...cat,\n        tags: userTags.filter(t => t.categoryId === cat.id)\n    }));\n}\n\nexport async function createCategory(data: Omit<typeof categories.$inferInsert, \"userId\">) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.insert(categories).values({\n        ...data,\n        userId: user.id\n    });\n\n    revalidatePath(\"/tags\");\n    revalidatePath(\"/reports\");\n    return { success: true };\n}\n\nexport async function deleteCategory(id: string) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.delete(categories).where(and(eq(categories.id, id), eq(categories.userId, user.id)));\n    revalidatePath(\"/tags\");\n    return { success: true };\n}\n\nexport async function updateCategory(id: string, data: Partial<typeof categories.$inferInsert>) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.update(categories)\n        .set({ ...data, updatedAt: new Date() })\n        .where(and(eq(categories.id, id), eq(categories.userId, user.id)));\n\n    // If color changed, update tags? The current logic does that in UI, \n    // but in DB we might want to cascade or keep them separate.\n    // The previous app logic updated all tags.\n    if (data.color) {\n        await db.update(tags)\n            .set({ color: data.color }) // We might need to adjust formatting if color logic changes\n            .where(and(eq(tags.categoryId, id), eq(tags.userId, user.id)));\n    }\n\n    revalidatePath(\"/tags\");\n    return { success: true };\n}\n\n// --- Tags ---\nexport async function createTag(data: Omit<typeof tags.$inferInsert, \"userId\">) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.insert(tags).values({\n        ...data,\n        userId: user.id\n    });\n\n    revalidatePath(\"/tags\");\n    return { success: true };\n}\n\nexport async function deleteTag(id: string) {\n    const user = await getUser();\n    const db = getDb();\n\n    await db.delete(tags).where(and(eq(tags.id, id), eq(tags.userId, user.id)));\n    revalidatePath(\"/tags\");\n    return { success: true };\n}\n","export {getCategories as '0053c2991b153a5bfd651fb43ef45a92e50dedd5aa'} from 'ACTIONS_MODULE0'\nexport {createCategory as '40265b30102208e2dbfd12633e96636836ce67eda6'} from 'ACTIONS_MODULE0'\nexport {deleteTag as '40483b3fa33e4e7224b9332c539e22dffe6158a91c'} from 'ACTIONS_MODULE0'\nexport {createTag as '406890b07abd01545dd838dd5e595466dd49672ebd'} from 'ACTIONS_MODULE0'\nexport {deleteCategory as '40a11be9358d3ebe9de33ae0c86d1ada70bf8b7562'} from 'ACTIONS_MODULE0'\nexport {updateCategory as '6027cde55327f090e4abf24830ed1af39fdc545367'} from 'ACTIONS_MODULE0'\nexport {createCategory as '40265b30102208e2dbfd12633e96636836ce67eda6'} from 'ACTIONS_MODULE0'\nexport {deleteCategory as '40a11be9358d3ebe9de33ae0c86d1ada70bf8b7562'} from 'ACTIONS_MODULE0'\nexport {updateCategory as '6027cde55327f090e4abf24830ed1af39fdc545367'} from 'ACTIONS_MODULE0'\nexport {createTag as '406890b07abd01545dd838dd5e595466dd49672ebd'} from 'ACTIONS_MODULE0'\nexport {deleteTag as '40483b3fa33e4e7224b9332c539e22dffe6158a91c'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}