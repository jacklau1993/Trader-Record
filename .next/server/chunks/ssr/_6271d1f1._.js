module.exports=[37936,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"registerServerReference",{enumerable:!0,get:function(){return d.registerServerReference}});let d=a.r(11857)},9223,93321,30385,15545,66879,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k;var l,m,n,o=a.i(17638),p=a.i(89973),q=a.i(97649),r=a.i(54900);let s=(a,b="ms")=>new Date(Date.now()+("sec"===b?1e3*a:a)),t=new WeakMap;function u(a,b){let c=b.fields,d={};for(let b in a){let e=c[b];if(!e){d[b]=a[b];continue}!1!==e.returned&&(d[b]=a[b])}return d}function v(a,b){t.has(a)||t.set(a,new Map);let c=t.get(a);if(c.has(b))return c.get(b);let d={..."user"===b?a.user?.additionalFields:{},..."session"===b?a.session?.additionalFields:{}};for(let c of a.plugins||[])c.schema&&c.schema[b]&&(d={...d,...c.schema[b].fields});return t.get(a).set(b,d),d}function w(a,b){return{...u(b,{fields:v(a,"user")}),id:b.id}}function x(a,b){return u(b,{fields:v(a,"session")})}function y(a,b){let c=b.action||"create",d=b.fields,e=Object.assign(Object.create(null),null);for(let b in d){if(b in a){if(!1===d[b].input){if(void 0!==d[b].defaultValue&&"update"!==c){e[b]=d[b].defaultValue;continue}if(a[b])throw new r.APIError("BAD_REQUEST",{message:`${b} is not allowed to be set`});continue}if(d[b].validator?.input&&void 0!==a[b]){e[b]=d[b].validator.input["~standard"].validate(a[b]);continue}if(d[b].transform?.input&&void 0!==a[b]){e[b]=d[b].transform?.input(a[b]);continue}e[b]=a[b];continue}if(void 0!==d[b].defaultValue&&"create"===c){if("function"==typeof d[b].defaultValue){e[b]=d[b].defaultValue();continue}e[b]=d[b].defaultValue;continue}if(d[b].required&&"create"===c)throw new r.APIError("BAD_REQUEST",{message:`${b} is required`})}return e}function z(a,b={},c){return y(b,{fields:v(a,"user"),action:c})}a.i(18129);var A=a.i(85808),A=A,B=A,C=a.i(94219);function D(a,b){if(b.advanced?.ipAddress?.disableIpTracking)return null;if((0,B.p)()||(0,A.d)())return"127.0.0.1";let c="headers"in a?a.headers:a;for(let a of b.advanced?.ipAddress?.ipAddressHeaders||["x-forwarded-for"]){let b="get"in c?c.get(a):c[a];if("string"==typeof b){var d;let a=b.split(",")[0].trim();if(d=a,C.ipv4().safeParse(d).success||C.ipv6().safeParse(d).success)return a}}return null}var E=a.i(83043);a.i(76472);var F=a.i(66701),F=F,G=F,H=F,I=A,J=a.i(57653);a.i(91511);var K=a.i(83150),L=a.i(19560);a.i(22157);var M=a.i(54757);async function N(b,c){let d;if(b.database)d="function"==typeof b.database?b.database(b):await c(b);else{let c=Object.keys((0,p.a)(b)).reduce((a,b)=>(a[b]=[],a),{}),{memoryAdapter:e}=await a.A(88010);d=e(c)(b)}return d.transaction||(J.logger.warn("Adapter does not correctly implement transaction function, patching it automatically. Please update your adapter implementation."),d.transaction=async a=>a(d)),d}async function O(b){return N(b,async b=>{let{createKyselyAdapter:c}=await a.A(60484),{kysely:d,databaseType:e,transaction:f}=await c(b);if(!d)throw new K.BetterAuthError("Failed to initialize database adapter");let{kyselyAdapter:g}=await a.A(60484);return g(d,{type:e||"sqlite",debugLogs:!!b.database&&"debugLogs"in b.database&&b.database.debugLogs,transaction:f})(b)})}a.s(["default",0,M],68075),a.i(68075),a.s(["$brand",()=>M.$brand,"$input",()=>M.$input,"$output",()=>M.$output,"NEVER",()=>M.NEVER,"TimePrecision",()=>M.TimePrecision,"ZodAny",()=>M.ZodAny,"ZodArray",()=>M.ZodArray,"ZodBase64",()=>M.ZodBase64,"ZodBase64URL",()=>M.ZodBase64URL,"ZodBigInt",()=>M.ZodBigInt,"ZodBigIntFormat",()=>M.ZodBigIntFormat,"ZodBoolean",()=>M.ZodBoolean,"ZodCIDRv4",()=>M.ZodCIDRv4,"ZodCIDRv6",()=>M.ZodCIDRv6,"ZodCUID",()=>M.ZodCUID,"ZodCUID2",()=>M.ZodCUID2,"ZodCatch",()=>M.ZodCatch,"ZodCodec",()=>M.ZodCodec,"ZodCustom",()=>M.ZodCustom,"ZodCustomStringFormat",()=>M.ZodCustomStringFormat,"ZodDate",()=>M.ZodDate,"ZodDefault",()=>M.ZodDefault,"ZodDiscriminatedUnion",()=>M.ZodDiscriminatedUnion,"ZodE164",()=>M.ZodE164,"ZodEmail",()=>M.ZodEmail,"ZodEmoji",()=>M.ZodEmoji,"ZodEnum",()=>M.ZodEnum,"ZodError",()=>M.ZodError,"ZodFile",()=>M.ZodFile,"ZodFirstPartyTypeKind",()=>M.ZodFirstPartyTypeKind,"ZodFunction",()=>M.ZodFunction,"ZodGUID",()=>M.ZodGUID,"ZodIPv4",()=>M.ZodIPv4,"ZodIPv6",()=>M.ZodIPv6,"ZodISODate",()=>M.ZodISODate,"ZodISODateTime",()=>M.ZodISODateTime,"ZodISODuration",()=>M.ZodISODuration,"ZodISOTime",()=>M.ZodISOTime,"ZodIntersection",()=>M.ZodIntersection,"ZodIssueCode",()=>M.ZodIssueCode,"ZodJWT",()=>M.ZodJWT,"ZodKSUID",()=>M.ZodKSUID,"ZodLazy",()=>M.ZodLazy,"ZodLiteral",()=>M.ZodLiteral,"ZodMAC",()=>M.ZodMAC,"ZodMap",()=>M.ZodMap,"ZodNaN",()=>M.ZodNaN,"ZodNanoID",()=>M.ZodNanoID,"ZodNever",()=>M.ZodNever,"ZodNonOptional",()=>M.ZodNonOptional,"ZodNull",()=>M.ZodNull,"ZodNullable",()=>M.ZodNullable,"ZodNumber",()=>M.ZodNumber,"ZodNumberFormat",()=>M.ZodNumberFormat,"ZodObject",()=>M.ZodObject,"ZodOptional",()=>M.ZodOptional,"ZodPipe",()=>M.ZodPipe,"ZodPrefault",()=>M.ZodPrefault,"ZodPromise",()=>M.ZodPromise,"ZodReadonly",()=>M.ZodReadonly,"ZodRealError",()=>M.ZodRealError,"ZodRecord",()=>M.ZodRecord,"ZodSet",()=>M.ZodSet,"ZodString",()=>M.ZodString,"ZodStringFormat",()=>M.ZodStringFormat,"ZodSuccess",()=>M.ZodSuccess,"ZodSymbol",()=>M.ZodSymbol,"ZodTemplateLiteral",()=>M.ZodTemplateLiteral,"ZodTransform",()=>M.ZodTransform,"ZodTuple",()=>M.ZodTuple,"ZodType",()=>M.ZodType,"ZodULID",()=>M.ZodULID,"ZodURL",()=>M.ZodURL,"ZodUUID",()=>M.ZodUUID,"ZodUndefined",()=>M.ZodUndefined,"ZodUnion",()=>M.ZodUnion,"ZodUnknown",()=>M.ZodUnknown,"ZodVoid",()=>M.ZodVoid,"ZodXID",()=>M.ZodXID,"_ZodString",()=>M._ZodString,"_default",()=>M._default,"_function",()=>M._function,"any",()=>M.any,"array",()=>M.array,"base64",()=>M.base64,"base64url",()=>M.base64url,"bigint",()=>M.bigint,"boolean",()=>M.boolean,"catch",()=>M.catch,"check",()=>M.check,"cidrv4",()=>M.cidrv4,"cidrv6",()=>M.cidrv6,"clone",()=>M.clone,"codec",()=>M.codec,"coerce",()=>M.coerce,"config",()=>M.config,"core",()=>M.core,"cuid",()=>M.cuid,"cuid2",()=>M.cuid2,"custom",()=>M.custom,"date",()=>M.date,"decode",()=>M.decode,"decodeAsync",()=>M.decodeAsync,"default",0,M,"describe",()=>M.describe,"discriminatedUnion",()=>M.discriminatedUnion,"e164",()=>M.e164,"email",()=>M.email,"emoji",()=>M.emoji,"encode",()=>M.encode,"encodeAsync",()=>M.encodeAsync,"endsWith",()=>M.endsWith,"enum",()=>M.enum,"file",()=>M.file,"flattenError",()=>M.flattenError,"float32",()=>M.float32,"float64",()=>M.float64,"formatError",()=>M.formatError,"function",()=>M.function,"getErrorMap",()=>M.getErrorMap,"globalRegistry",()=>M.globalRegistry,"gt",()=>M.gt,"gte",()=>M.gte,"guid",()=>M.guid,"hash",()=>M.hash,"hex",()=>M.hex,"hostname",()=>M.hostname,"httpUrl",()=>M.httpUrl,"includes",()=>M.includes,"instanceof",()=>M.instanceof,"int",()=>M.int,"int32",()=>M.int32,"int64",()=>M.int64,"intersection",()=>M.intersection,"ipv4",()=>M.ipv4,"ipv6",()=>M.ipv6,"iso",()=>M.iso,"json",()=>M.json,"jwt",()=>M.jwt,"keyof",()=>M.keyof,"ksuid",()=>M.ksuid,"lazy",()=>M.lazy,"length",()=>M.length,"literal",()=>M.literal,"locales",()=>M.locales,"looseObject",()=>M.looseObject,"lowercase",()=>M.lowercase,"lt",()=>M.lt,"lte",()=>M.lte,"mac",()=>M.mac,"map",()=>M.map,"maxLength",()=>M.maxLength,"maxSize",()=>M.maxSize,"meta",()=>M.meta,"mime",()=>M.mime,"minLength",()=>M.minLength,"minSize",()=>M.minSize,"multipleOf",()=>M.multipleOf,"nan",()=>M.nan,"nanoid",()=>M.nanoid,"nativeEnum",()=>M.nativeEnum,"negative",()=>M.negative,"never",()=>M.never,"nonnegative",()=>M.nonnegative,"nonoptional",()=>M.nonoptional,"nonpositive",()=>M.nonpositive,"normalize",()=>M.normalize,"null",()=>M.null,"nullable",()=>M.nullable,"nullish",()=>M.nullish,"number",()=>M.number,"object",()=>M.object,"optional",()=>M.optional,"overwrite",()=>M.overwrite,"parse",()=>M.parse,"parseAsync",()=>M.parseAsync,"partialRecord",()=>M.partialRecord,"pipe",()=>M.pipe,"positive",()=>M.positive,"prefault",()=>M.prefault,"preprocess",()=>M.preprocess,"prettifyError",()=>M.prettifyError,"promise",()=>M.promise,"property",()=>M.property,"readonly",()=>M.readonly,"record",()=>M.record,"refine",()=>M.refine,"regex",()=>M.regex,"regexes",()=>M.regexes,"registry",()=>M.registry,"safeDecode",()=>M.safeDecode,"safeDecodeAsync",()=>M.safeDecodeAsync,"safeEncode",()=>M.safeEncode,"safeEncodeAsync",()=>M.safeEncodeAsync,"safeParse",()=>M.safeParse,"safeParseAsync",()=>M.safeParseAsync,"set",()=>M.set,"setErrorMap",()=>M.setErrorMap,"size",()=>M.size,"slugify",()=>M.slugify,"startsWith",()=>M.startsWith,"strictObject",()=>M.strictObject,"string",()=>M.string,"stringFormat",()=>M.stringFormat,"stringbool",()=>M.stringbool,"success",()=>M.success,"superRefine",()=>M.superRefine,"symbol",()=>M.symbol,"templateLiteral",()=>M.templateLiteral,"toJSONSchema",()=>M.toJSONSchema,"toLowerCase",()=>M.toLowerCase,"toUpperCase",()=>M.toUpperCase,"transform",()=>M.transform,"treeifyError",()=>M.treeifyError,"trim",()=>M.trim,"tuple",()=>M.tuple,"uint32",()=>M.uint32,"uint64",()=>M.uint64,"ulid",()=>M.ulid,"undefined",()=>M.undefined,"union",()=>M.union,"unknown",()=>M.unknown,"uppercase",()=>M.uppercase,"url",()=>M.url,"util",()=>M.util,"uuid",()=>M.uuid,"uuidv4",()=>M.uuidv4,"uuidv6",()=>M.uuidv6,"uuidv7",()=>M.uuidv7,"void",()=>M.void,"xid",()=>M.xid,"z",0,M],44532),a.i(44532);let P=(a,b)=>{let c,d=b.logger,e=b.options,f=e.secondaryStorage,g=e.session?.expiresIn||604800,{createWithHooks:h,updateWithHooks:i,updateManyWithHooks:j,deleteWithHooks:k,deleteManyWithHooks:l}=(c=b.hooks,{createWithHooks:async function(b,d,e){let f=await (0,G.u)(),g=b;for(let a of c||[]){let b=a[d]?.create?.before;if(b){let a=await b(g,f);if(!1===a)return null;"object"==typeof a&&"data"in a&&(g={...g,...a.data})}}let h=e?await e.fn(g):null,i=!e||e.executeMainFn?await (await (0,F.t)(a)).create({model:d,data:g,forceAllowId:!0}):h;for(let a of c||[]){let b=a[d]?.create?.after;b&&await b(i,f)}return i},updateWithHooks:async function(b,d,e,f){let g=await (0,G.u)(),h=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;"object"==typeof a&&"data"in a&&(h={...h,...a.data})}}let i=f?await f.fn(h):null,j=!f||f.executeMainFn?await (await (0,F.t)(a)).update({model:e,update:h,where:d}):i;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(j,g)}return j},updateManyWithHooks:async function(b,d,e,f){let g=await (0,G.u)(),h=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;"object"==typeof a&&"data"in a&&(h={...h,...a.data})}}let i=f?await f.fn(h):null,j=!f||f.executeMainFn?await (await (0,F.t)(a)).updateMany({model:e,update:h,where:d}):i;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(j,g)}return j},deleteWithHooks:async function(b,d,e){let f=await (0,G.u)(),g=null;try{g=(await (await (0,F.t)(a)).findMany({model:d,where:b,limit:1}))[0]||null}catch(a){}if(g)for(let a of c||[]){let b=a[d]?.delete?.before;if(b&&await b(g,f)===!1)return null}let h=e?await e.fn(b):null,i=!e||e.executeMainFn?await (await (0,F.t)(a)).delete({model:d,where:b}):h;if(g)for(let a of c||[]){let b=a[d]?.delete?.after;b&&await b(g,f)}return i},deleteManyWithHooks:async function(b,d,e){let f=await (0,G.u)(),g=[];try{g=await (await (0,F.t)(a)).findMany({model:d,where:b})}catch(a){}for(let a of g)for(let b of c||[]){let c=b[d]?.delete?.before;if(c&&await c(a,f)===!1)return null}let h=e?await e.fn(b):null,i=!e||e.executeMainFn?await (await (0,F.t)(a)).deleteMany({model:d,where:b}):h;for(let a of g)for(let b of c||[]){let c=b[d]?.delete?.after;c&&await c(a,f)}return i}});async function m(a){if(!f)return;let b=await f.get(`active-sessions-${a.id}`);if(!b)return;let c=Date.now(),d=((0,E.t)(b)||[]).filter(a=>a.expiresAt>c);await Promise.all(d.map(async({token:b})=>{let d=await f.get(b);if(!d)return;let e=(0,E.t)(d);if(!e)return;let g=Math.max(Math.floor(new Date(e.session.expiresAt).getTime()-c)/1e3,0);await f.set(b,JSON.stringify({session:e.session,user:a}),Math.floor(g))}))}return{createOAuthUser:async(b,c)=>(0,H.i)(a,async()=>{let a=await h({createdAt:new Date,updatedAt:new Date,...b},"user",void 0);return{user:a,account:await h({...c,userId:a.id,createdAt:new Date,updatedAt:new Date},"account",void 0)}}),createUser:async a=>await h({createdAt:new Date,updatedAt:new Date,...a,email:a.email?.toLowerCase()},"user",void 0),createAccount:async a=>await h({createdAt:new Date,updatedAt:new Date,...a},"account",void 0),listSessions:async c=>{if(f){let a=await f.get(`active-sessions-${c}`);if(!a)return[];let d=(0,E.t)(a)||[],e=Date.now(),g=d.filter(a=>a.expiresAt>e),h=[];for(let a of g){let c=await f.get(a.token);if(c){let a=(0,E.t)(c);if(!a)return[];let d=x(b.options,{...a.session,expiresAt:new Date(a.session.expiresAt)});h.push(d)}}return h}return await (await (0,F.t)(a)).findMany({model:"session",where:[{field:"userId",value:c}]})},listUsers:async(b,c,d,e)=>await (await (0,F.t)(a)).findMany({model:"user",limit:b,offset:c,sortBy:d,where:e}),countTotalUsers:async b=>{let c=await (await (0,F.t)(a)).count({model:"user",where:b});return"string"==typeof c?parseInt(c):c},deleteUser:async a=>{f&&await f.delete(`active-sessions-${a}`),(!f||e.session?.storeSessionInDatabase)&&await l([{field:"userId",value:a}],"session",void 0),await l([{field:"userId",value:a}],"account",void 0),await k([{field:"id",value:a}],"user",void 0)},createSession:async(b,c,d,i)=>{let j=await (0,G.u)().catch(()=>null),k=j?.headers||j?.request?.headers,{id:l,...m}=d||{},n=y({},{fields:v(j?.context.options??e,"session")}),o={ipAddress:(j?.request||j?.headers)&&D(j?.request||j?.headers,j?.context.options)||"",userAgent:k?.get("user-agent")||"",...m,expiresAt:c?s(86400,"sec"):s(g,"sec"),userId:b,token:(0,q.t)(32),createdAt:new Date,updatedAt:new Date,...n,...i?m:{}};return await h(o,"session",f?{fn:async c=>{let d=await f.get(`active-sessions-${b}`),e=[],g=Date.now();d&&(e=(e=(0,E.t)(d)||[]).filter(a=>a.expiresAt>g));let h=e.sort((a,b)=>a.expiresAt-b.expiresAt),i=h.at(-1)?.expiresAt;h.push({token:o.token,expiresAt:o.expiresAt.getTime()}),(!i||i<o.expiresAt.getTime())&&(i=o.expiresAt.getTime());let j=Math.max(Math.floor((i-g)/1e3),0);j>0&&await f.set(`active-sessions-${b}`,JSON.stringify(h),j);let k=await a.findOne({model:"user",where:[{field:"id",value:b}]}),l=Math.max(Math.floor((o.expiresAt.getTime()-g)/1e3),0);return l>0&&await f.set(o.token,JSON.stringify({session:c,user:k}),l),c},executeMainFn:e.session?.storeSessionInDatabase}:void 0)},findSession:async c=>{if(f){let a=await f.get(c);if(!a&&!e.session?.storeSessionInDatabase)return null;if(a){let c=(0,E.t)(a);return c?{session:x(b.options,{...c.session,expiresAt:new Date(c.session.expiresAt),createdAt:new Date(c.session.createdAt),updatedAt:new Date(c.session.updatedAt)}),user:w(b.options,{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)})}:null}}let d=await (await (0,F.t)(a)).findOne({model:"session",where:[{value:c,field:"token"}],join:{user:!0}});if(!d)return null;let{user:g,...h}=d;return g?{session:x(b.options,h),user:w(b.options,g)}:null},findSessions:async b=>{if(f){let a=[];for(let c of b){let b=await f.get(c);if(b){let c=(0,E.t)(b);if(!c)return[];let d={session:{...c.session,expiresAt:new Date(c.session.expiresAt)},user:{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)}};a.push(d)}}return a}let c=await (await (0,F.t)(a)).findMany({model:"session",where:[{field:"token",value:b,operator:"in"}],join:{user:!0}});return!c.length||c.some(a=>!a.user)?[]:c.map(a=>{let{user:b,...c}=a;return{session:c,user:b}})},updateSession:async(a,b)=>await i(b,[{field:"token",value:a}],"session",f?{async fn(b){let c=await f.get(a);if(!c)return null;{let a=(0,E.t)(c);return a?{...a.session,...b}:null}},executeMainFn:e.session?.storeSessionInDatabase}:void 0),deleteSession:async c=>{if(f){let a=await f.get(c);if(a){let{session:b}=(0,E.t)(a)??{};if(!b)return void d.error("Session not found in secondary storage");let e=b.userId,g=await f.get(`active-sessions-${e}`);if(g){let a=(0,E.t)(g)||[],b=Date.now(),d=a.filter(a=>a.expiresAt>b&&a.token!==c),h=d.sort((a,b)=>a.expiresAt-b.expiresAt).at(-1)?.expiresAt;d.length>0&&h&&h>Date.now()?await f.set(`active-sessions-${e}`,JSON.stringify(d),Math.floor((h-b)/1e3)):await f.delete(`active-sessions-${e}`)}else d.error("Active sessions list not found in secondary storage")}if(await f.delete(c),!e.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await (await (0,F.t)(a)).delete({model:"session",where:[{field:"token",value:c}]})},deleteAccounts:async a=>{await l([{field:"userId",value:a}],"account",void 0)},deleteAccount:async a=>{await k([{field:"id",value:a}],"account",void 0)},deleteSessions:async a=>{if(f){if("string"==typeof a){let b=await f.get(`active-sessions-${a}`),c=b?(0,E.t)(b):[];if(!c)return;for(let a of c)await f.delete(a.token)}else for(let b of a)await f.get(b)&&await f.delete(b);if(!e.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await l([{field:Array.isArray(a)?"token":"userId",value:a,operator:Array.isArray(a)?"in":void 0}],"session",void 0)},findOAuthUser:async(b,c,d)=>{let e=await (await (0,F.t)(a)).findMany({model:"account",where:[{value:c,field:"accountId"}],join:{user:!0}}).then(a=>a.find(a=>a.providerId===d));if(e)if(e.user)return{user:e.user,accounts:[e]};else{let c=await (await (0,F.t)(a)).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});return c?{user:c,accounts:[e]}:null}{let c=await (await (0,F.t)(a)).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});return c?{user:c,accounts:await (await (0,F.t)(a)).findMany({model:"account",where:[{value:c.id,field:"userId"}]})||[]}:null}},findUserByEmail:async(b,c)=>{let d=await (await (0,F.t)(a)).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}],join:{...c?.includeAccounts?{account:!0}:{}}});if(!d)return null;let{account:e,...f}=d;return{user:f,accounts:e??[]}},findUserById:async b=>b?await (await (0,F.t)(a)).findOne({model:"user",where:[{field:"id",value:b}]}):null,linkAccount:async a=>await h({createdAt:new Date,updatedAt:new Date,...a},"account",void 0),updateUser:async(a,b)=>{let c=await i(b,[{field:"id",value:a}],"user",void 0);return await m(c),await m(c),c},updateUserByEmail:async(a,b)=>{let c=await i(b,[{field:"email",value:a.toLowerCase()}],"user",void 0);return await m(c),await m(c),c},updatePassword:async(a,b)=>{await j({password:b},[{field:"userId",value:a},{field:"providerId",value:"credential"}],"account",void 0)},findAccounts:async b=>await (await (0,F.t)(a)).findMany({model:"account",where:[{field:"userId",value:b}]}),findAccount:async b=>await (await (0,F.t)(a)).findOne({model:"account",where:[{field:"accountId",value:b}]}),findAccountByProviderId:async(b,c)=>await (await (0,F.t)(a)).findOne({model:"account",where:[{field:"accountId",value:b},{field:"providerId",value:c}]}),findAccountByUserId:async b=>await (await (0,F.t)(a)).findMany({model:"account",where:[{field:"userId",value:b}]}),updateAccount:async(a,b)=>await i(b,[{field:"id",value:a}],"account",void 0),createVerificationValue:async a=>await h({createdAt:new Date,updatedAt:new Date,...a},"verification",void 0),findVerificationValue:async b=>{let c=await (await (0,F.t)(a)).findMany({model:"verification",where:[{field:"identifier",value:b}],sortBy:{field:"createdAt",direction:"desc"},limit:1});return e.verification?.disableCleanup||await (await (0,F.t)(a)).deleteMany({model:"verification",where:[{field:"expiresAt",value:new Date,operator:"lt"}]}),c[0]},deleteVerificationValue:async b=>{await (await (0,F.t)(a)).delete({model:"verification",where:[{field:"id",value:b}]})},deleteVerificationByIdentifier:async b=>{await (await (0,F.t)(a)).delete({model:"verification",where:[{field:"identifier",value:b}]})},updateVerificationValue:async(a,b)=>await i(b,[{field:"id",value:a}],"verification",void 0)}},Q={postgres:{string:["character varying","varchar","text","uuid"],number:["int4","integer","bigint","smallint","numeric","real","double precision"],boolean:["bool","boolean"],date:["timestamptz","timestamp","date"],json:["json","jsonb"]},mysql:{string:["varchar","text","uuid"],number:["integer","int","bigint","smallint","decimal","float","double"],boolean:["boolean","tinyint"],date:["timestamp","datetime","date"],json:["json"]},sqlite:{string:["TEXT"],number:["INTEGER","REAL"],boolean:["INTEGER","BOOLEAN"],date:["DATE","INTEGER"],json:["TEXT"]},mssql:{string:["varchar","nvarchar","uniqueidentifier"],number:["int","bigint","smallint","decimal","float","double"],boolean:["bit","smallint"],date:["datetime2","date","datetime"],json:["varchar","nvarchar"]}};async function R(a){try{let b=await L.sql`SHOW search_path`.execute(a);if(b.rows[0]?.search_path)return b.rows[0].search_path.split(",").map(a=>a.trim()).map(a=>a.replace(/^["']|["']$/g,"")).filter(a=>!a.startsWith("$"))[0]||"public"}catch(a){}return"public"}async function S(a){let b=function(a){let b=(0,p.a)(a),c={};for(let a in b){let d=b[a],e=d.fields,f={};if(Object.entries(e).forEach(([a,c])=>{if(f[c.fieldName||a]=c,c.references){let d=b[c.references.model];d&&(f[c.fieldName||a].references={...c.references,model:d.modelName,field:c.references.field})}}),c[d.modelName]){c[d.modelName].fields={...c[d.modelName].fields,...f};continue}c[d.modelName]={fields:f,order:d.order||1/0}}return c}(a),c=(0,I.n)(a.logger),{kysely:d,databaseType:e}=await (0,o.t)(a);e||(c.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this."),e="sqlite"),d||(c.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter."),process.exit(1));let f="public";if("postgres"===e){f=await R(d),c.debug(`PostgreSQL migration: Using schema '${f}' (from search_path)`);try{(await L.sql`
				SELECT schema_name 
				FROM information_schema.schemata 
				WHERE schema_name = ${f}
			`.execute(d)).rows[0]||c.warn(`Schema '${f}' does not exist. Tables will be inspected from available schemas. Consider creating the schema first or checking your database configuration.`)}catch(a){c.debug(`Could not verify schema existence: ${a instanceof Error?a.message:String(a)}`)}}let g=await d.introspection.getTables(),h=g;if("postgres"===e)try{let a=await L.sql`
				SELECT table_name 
				FROM information_schema.tables 
				WHERE table_schema = ${f}
				AND table_type = 'BASE TABLE'
			`.execute(d),b=new Set(a.rows.map(a=>a.table_name));h=g.filter(a=>a.schema===f&&b.has(a.name)),c.debug(`Found ${h.length} table(s) in schema '${f}': ${h.map(a=>a.name).join(", ")||"(none)"}`)}catch(a){c.warn(`Could not filter tables by schema. Using all discovered tables. Error: ${a instanceof Error?a.message:String(a)}`)}let i=[],j=[];for(let[a,d]of Object.entries(b)){let b=h.find(b=>b.name===a);if(!b){let b=i.findIndex(b=>b.table===a),c={table:a,fields:d.fields,order:d.order||1/0},e=i.findIndex(a=>(a.order||1/0)>c.order);-1===e?-1===b?i.push(c):i[b].fields={...i[b].fields,...d.fields}:i.splice(e,0,c);continue}let f={};for(let[g,h]of Object.entries(d.fields)){let d=b.columns.find(a=>a.name===g);if(!d){f[g]=h;continue}!function(a,b,c){if("string[]"===b||"number[]"===b)return a.toLowerCase().includes("json");let d=Q[c];return(Array.isArray(b)?d.string.map(a=>a.toLowerCase()):d[b].map(a=>a.toLowerCase())).includes(a.toLowerCase().split("(")[0].trim())}(d.dataType,h.type,e)&&c.warn(`Field ${g} in table ${a} has a different type in the database. Expected ${h.type} but got ${d.dataType}.`)}Object.keys(f).length>0&&j.push({table:a,fields:f,order:d.order||1/0})}let k=[],l=a.advanced?.database?.generateId==="uuid",m=a.advanced?.database?.useNumberId||a.advanced?.database?.generateId==="serial";function n(a,b){let c=a.type,d={string:{sqlite:"text",postgres:"text",mysql:a.unique?"varchar(255)":a.references?"varchar(36)":a.sortable||a.index?"varchar(255)":"text",mssql:a.unique||a.sortable?"varchar(255)":a.references?"varchar(36)":"varchar(8000)"},boolean:{sqlite:"integer",postgres:"boolean",mysql:"boolean",mssql:"smallint"},number:{sqlite:a.bigint?"bigint":"integer",postgres:a.bigint?"bigint":"integer",mysql:a.bigint?"bigint":"integer",mssql:a.bigint?"bigint":"integer"},date:{sqlite:"date",postgres:"timestamptz",mysql:"timestamp(3)",mssql:L.sql`datetime2(3)`},json:{sqlite:"text",postgres:"jsonb",mysql:"json",mssql:"varchar(8000)"},id:{postgres:m?L.sql`integer GENERATED BY DEFAULT AS IDENTITY`:l?"uuid":"text",mysql:m?"integer":"varchar(36)",mssql:m?"integer":"varchar(36)",sqlite:m?"integer":"text"},foreignKeyId:{postgres:m?"integer":l?"uuid":"text",mysql:m?"integer":"varchar(36)",mssql:m?"integer":"varchar(36)",sqlite:m?"integer":"text"}};if("id"===b||a.references?.field==="id")return"id"===b?d.id[e]:d.foreignKeyId[e];if("sqlite"===e&&("string[]"===c||"number[]"===c))return"text";if("string[]"===c||"number[]"===c)return"jsonb";if(Array.isArray(c))return"text";if(!(c in d))throw Error(`Unsupported field type '${String(c)}' for field '${b}'. Allowed types are: string, number, boolean, date, string[], number[]. If you need to store structured data, store it as a JSON string (type: "string") or split it into primitive fields. See https://better-auth.com/docs/advanced/schema#additional-fields`);return d[c][e||"sqlite"]}let q=(0,p.t)({schema:(0,p.a)(a),usePlural:!1}),r=(0,p.n)({schema:(0,p.a)(a),usePlural:!1});function s(a,b){try{return`${q(a)}.${r({model:a,field:b})}`}catch{return`${a}.${b}`}}if(j.length)for(let a of j)for(let[b,c]of Object.entries(a.fields)){let f=n(c,b),g=d.schema.alterTable(a.table);if(c.index){let c=d.schema.alterTable(a.table).addIndex(`${a.table}_${b}_idx`);k.push(c)}let h=g.addColumn(b,f,a=>(a=!1!==c.required?a.notNull():a,c.references&&(a=a.references(s(c.references.model,c.references.field)).onDelete(c.references.onDelete||"cascade")),c.unique&&(a=a.unique()),"date"===c.type&&"function"==typeof c.defaultValue&&("postgres"===e||"mysql"===e||"mssql"===e)&&(a="mysql"===e?a.defaultTo(L.sql`CURRENT_TIMESTAMP(3)`):a.defaultTo(L.sql`CURRENT_TIMESTAMP`)),a));k.push(h)}let t=[];if(a.advanced?.database?.useNumberId&&c.warn("`useNumberId` is deprecated. Please use `generateId` with `serial` instead."),i.length)for(let a of i){let b=n({type:m?"number":"string"},"id"),c=d.schema.createTable(a.table).addColumn("id",b,a=>{if(m)return"postgres"===e?a.primaryKey().notNull():"sqlite"===e?a.primaryKey().notNull():"mssql"===e?a.identity().primaryKey().notNull():a.autoIncrement().primaryKey().notNull();return l&&"postgres"===e?a.primaryKey().defaultTo(L.sql`pg_catalog.gen_random_uuid()`).notNull():a.primaryKey().notNull()});for(let[b,f]of Object.entries(a.fields)){let g=n(f,b);if(c=c.addColumn(b,g,a=>(a=!1!==f.required?a.notNull():a,f.references&&(a=a.references(s(f.references.model,f.references.field)).onDelete(f.references.onDelete||"cascade")),f.unique&&(a=a.unique()),"date"===f.type&&"function"==typeof f.defaultValue&&("postgres"===e||"mysql"===e||"mssql"===e)&&(a="mysql"===e?a.defaultTo(L.sql`CURRENT_TIMESTAMP(3)`):a.defaultTo(L.sql`CURRENT_TIMESTAMP`)),a)),f.index){let c=d.schema.createIndex(`${a.table}_${b}_${f.unique?"uidx":"idx"}`).on(a.table).columns([b]);t.push(f.unique?c.unique():c)}}k.push(c)}if(t.length)for(let a of t)k.push(a);return{toBeCreated:i,toBeAdded:j,runMigrations:async function(){for(let a of k)await a.execute()},compileMigrations:async function(){return k.map(a=>a.compile().sql).join(";\n\n")+";"}}}var T=a.i(54003);function U(a,b="/api/auth"){try{let b=new URL(a);if("http:"!==b.protocol&&"https:"!==b.protocol)throw new K.BetterAuthError(`Invalid base URL: ${a}. URL must include 'http://' or 'https://'`)}catch(b){if(b instanceof K.BetterAuthError)throw b;throw new K.BetterAuthError(`Invalid base URL: ${a}. Please provide a valid base URL.`,String(b))}if(function(a){try{return"/"!==(new URL(a).pathname.replace(/\/+$/,"")||"/")}catch(b){throw new K.BetterAuthError(`Invalid base URL: ${a}. Please provide a valid base URL.`)}}(a))return a;let c=a.replace(/\/+$/,"");return b&&"/"!==b?(b=b.startsWith("/")?b:`/${b}`,`${c}${b}`):c}function V(a,b,c,d,e){if(a)return U(a,b);if(!1!==d){let a=Z.c.BETTER_AUTH_URL||Z.c.NEXT_PUBLIC_BETTER_AUTH_URL||Z.c.PUBLIC_BETTER_AUTH_URL||Z.c.NUXT_PUBLIC_BETTER_AUTH_URL||Z.c.NUXT_PUBLIC_AUTH_URL||("/"!==Z.c.BASE_URL?Z.c.BASE_URL:void 0);if(a)return U(a,b)}let f=c?.headers.get("x-forwarded-host"),g=c?.headers.get("x-forwarded-proto");if(f&&g&&e)return U(`${g}://${f}`,b);if(c){let a=W(c.url);if(!a)throw new K.BetterAuthError("Could not get origin from request. Please provide a valid base URL.");return U(a,b)}}function W(a){try{let b=new URL(a);return"null"===b.origin?null:b.origin}catch(a){return null}}function X(a){try{return new URL(a).protocol}catch(a){return null}}function Y(a){try{return new URL(a).host}catch(a){return null}}a.i(15192);var Z=A,$=A,_=a.i(694);let aa=new Map,ab={decode:(a,b="utf-8")=>(aa.has(b)||aa.set(b,new TextDecoder(b)),aa.get(b).decode(a)),encode:new TextEncoder().encode};var ac=a.i(92702),ad=a.i(98109);let ae=(a="SHA-256",b="none")=>{let c={importKey:async(b,c)=>(0,ad.getWebcryptoSubtle)().importKey("raw","string"==typeof b?new TextEncoder().encode(b):b,{name:"HMAC",hash:{name:a}},!1,[c]),sign:async(a,d)=>{"string"==typeof a&&(a=await c.importKey(a,"sign"));let e=await (0,ad.getWebcryptoSubtle)().sign("HMAC",a,"string"==typeof d?new TextEncoder().encode(d):d);return"hex"===b?ac.hex.encode(e):"base64"===b||"base64url"===b||"base64urlnopad"===b?_.base64Url.encode(e,{padding:"base64urlnopad"!==b}):e},verify:async(a,d,e)=>("string"==typeof a&&(a=await c.importKey(a,"verify")),"hex"===b&&(e=ac.hex.decode(e)),("base64"===b||"base64url"===b||"base64urlnopad"===b)&&(e=await _.base64.decode(e)),(0,ad.getWebcryptoSubtle)().verify("HMAC",a,"string"==typeof e?new TextEncoder().encode(e):e,"string"==typeof d?new TextEncoder().encode(d):d))};return c};function af(a){let b=a.split("."),c=parseInt(b[b.length-1]||"0",10);return isNaN(c)?0:c}function ag(a,b){let c={};for(let d in a)c[d]={name:d,value:"",options:{...b,maxAge:0}};return c}let ah=a=>(b,c,d)=>{let e=function(a,b){let c={};for(let[d,e]of Object.entries(function(a){let b=a.headers?.get("cookie");if(!b)return{};let c={};for(let a of b.split("; ")){let[b,...d]=a.split("=");b&&d.length>0&&(c[b]=d.join("="))}return c}(b)))d.startsWith(a)&&(c[d]=e);return c}(b,d),f=d.context.logger;return{getValue:()=>Object.keys(e).sort((a,b)=>af(a)-af(b)).map(a=>e[a]).join(""),hasChunks:()=>Object.keys(e).length>0,chunk(d,g){let h=ag(e,c);for(let a in e)delete e[a];for(let i of function(a,b,c,d){let e=Math.ceil(b.value.length/3896);if(1===e)return c[b.name]=b.value,[b];let f=[];for(let a=0;a<e;a++){let d=`${b.name}.${a}`,e=3896*a,g=b.value.substring(e,e+3896);f.push({...b,name:d,value:g}),c[d]=g}return d.debug(`CHUNKING_${a.toUpperCase()}_COOKIE`,{message:`${a} cookie exceeds allowed 4096 bytes.`,emptyCookieSize:200,valueSize:b.value.length,chunkCount:e,chunks:f.map(a=>a.value.length+200)}),f}(a,{name:b,value:d,options:{...c,...g}},e,f))h[i.name]=i;return Object.values(h)},clean(){let a=ag(e,c);for(let a in e)delete e[a];return Object.values(a)},setCookies(a){for(let b of a)d.setCookie(b.name,b.value,b.options)}}},ai=ah("Session"),aj=ah("Account");function ak(a,b){let c=a.getCookie(b);if(c)return c;let d=[],e=a.headers?.get("cookie");if(!e)return null;let f={};for(let a of e.split("; ")){let[b,...c]=a.split("=");b&&c.length>0&&(f[b]=c.join("="))}for(let[a,c]of Object.entries(f))if(a.startsWith(b+".")){let b=parseInt(a.split(".").at(-1)||"0",10);isNaN(b)||d.push({index:b,value:c})}return d.length>0?(d.sort((a,b)=>a.index-b.index),d.map(a=>a.value).join("")):null}async function al(a,b){let c=a.context.authCookies.accountData,d={maxAge:300,...c.options},e=await (0,T.c)(b,a.context.secret,"better-auth-account",d.maxAge);if(e.length>4096){let b=aj(c.name,d,a),f=b.chunk(e,d);b.setCookies(f)}else{let b=aj(c.name,d,a);if(b.hasChunks()){let a=b.clean();b.setCookies(a)}a.setCookie(c.name,e,d)}}async function am(a){let b=ak(a,a.context.authCookies.accountData.name);if(b){let c=(0,E.t)(await (0,T.s)(b,a.context.secret,"better-auth-account"));if(c)return c}return null}let an=C.optional(C.object({disableCookieCache:M.coerce.boolean().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:M.coerce.boolean().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()}));function ao(a){let b=(a.advanced?.useSecureCookies!==void 0?a.advanced?.useSecureCookies:void 0!==a.baseURL?!!a.baseURL.startsWith("https://"):$.f)?"__Secure-":"",c=!!a.advanced?.crossSubDomainCookies?.enabled,d=c?a.advanced?.crossSubDomainCookies?.domain||(a.baseURL?new URL(a.baseURL).hostname:void 0):void 0;if(c&&!d)throw new K.BetterAuthError("baseURL is required when crossSubdomainCookies are enabled");return function(e,f={}){let g=a.advanced?.cookiePrefix||"better-auth",h=a.advanced?.cookies?.[e]?.name||`${g}.${e}`,i=a.advanced?.cookies?.[e]?.attributes;return{name:`${b}${h}`,attributes:{secure:!!b,sameSite:"lax",path:"/",httpOnly:!0,...c?{domain:d}:{},...a.advanced?.defaultCookieAttributes,...f,...i}}}}async function ap(a,b,c){if(a.context.options.session?.cookieCache?.enabled){let d,e=Object.entries(b.session).reduce((b,[c,d])=>{let e=a.context.options.session?.additionalFields?.[c];return e&&!1===e.returned||(b[c]=d),b},{}),f=w(a.context.options,b.user),g=a.context.options.session?.cookieCache?.version,h="1";if(g){if("string"==typeof g)h=g;else if("function"==typeof g){let a=g(b.session,b.user);h=a instanceof Promise?await a:a}}let i={session:e,user:f,updatedAt:Date.now(),version:h},j={...a.context.authCookies.sessionData.options,maxAge:c?void 0:a.context.authCookies.sessionData.options.maxAge},k=s(j.maxAge||60,"sec").getTime(),l=a.context.options.session?.cookieCache?.strategy||"compact";if((d="jwe"===l?await (0,T.c)(i,a.context.secret,"better-auth-session",j.maxAge||300):"jwt"===l?await (0,T.o)(i,a.context.secret,j.maxAge||300):_.base64Url.encode(JSON.stringify({session:i,expiresAt:k,signature:await ae("SHA-256","base64urlnopad").sign(a.context.secret,JSON.stringify({...i,expiresAt:k}))}),{padding:!1})).length>4093){let b=ai(a.context.authCookies.sessionData.name,j,a),c=b.chunk(d,j);b.setCookies(c)}else{let b=ai(a.context.authCookies.sessionData.name,j,a);if(b.hasChunks()){let a=b.clean();b.setCookies(a)}a.setCookie(a.context.authCookies.sessionData.name,d,j)}}}async function aq(a,b,c,d){let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);c=void 0!==c?c:!!e;let f=a.context.authCookies.sessionToken.options,g=c?void 0:a.context.sessionConfig.expiresIn;await a.setSignedCookie(a.context.authCookies.sessionToken.name,b.session.token,a.context.secret,{...f,maxAge:g,...d}),c&&await a.setSignedCookie(a.context.authCookies.dontRememberToken.name,"true",a.context.secret,a.context.authCookies.dontRememberToken.options),await ap(a,b,c),a.context.setNewSession(b),a.context.options.secondaryStorage&&await a.context.secondaryStorage?.set(b.session.token,JSON.stringify({user:b.user,session:b.session}),Math.floor((new Date(b.session.expiresAt).getTime()-Date.now())/1e3))}function ar(a,b){a.setCookie(a.context.authCookies.sessionToken.name,"",{...a.context.authCookies.sessionToken.options,maxAge:0});let c=ai(a.context.authCookies.sessionData.name,a.context.authCookies.sessionData.options,a),d=c.clean();c.setCookies(d),b||a.setCookie(a.context.authCookies.dontRememberToken.name,"",{...a.context.authCookies.dontRememberToken.options,maxAge:0})}var as=a.i(16051),as=as;a.i(2572);var at=F;let au=(0,r.createMiddleware)(async()=>({})),av=r.createMiddleware.create({use:[au,(0,r.createMiddleware)(async()=>({}))]}),aw=[au],ax=(a,b,c)=>(0,r.createEndpoint)(a,{...b,use:[...b?.use||[],...aw]},async a=>(0,at.f)(a,()=>c(a))),ay=()=>ax("/get-session",{method:"GET",operationId:"getSession",query:an,requireHeaders:!0,metadata:{openapi:{operationId:"getSession",description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async a=>{try{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(!b)return null;let c=ak(a,a.context.authCookies.sessionData.name),d=null;if(c){let b=a.context.options.session?.cookieCache?.strategy||"compact";if("jwe"===b){let b=await (0,T.s)(c,a.context.secret,"better-auth-session");if(b&&b.session&&b.user)d={session:{session:b.session,user:b.user,updatedAt:b.updatedAt,version:b.version},expiresAt:b.exp?1e3*b.exp:Date.now()};else{let b=a.context.authCookies.sessionData.name;return a.setCookie(b,"",{maxAge:0}),a.json(null)}}else if("jwt"===b){let b=await (0,T.l)(c,a.context.secret);if(b&&b.session&&b.user)d={session:{session:b.session,user:b.user,updatedAt:b.updatedAt,version:b.version},expiresAt:b.exp?1e3*b.exp:Date.now()};else{let b=a.context.authCookies.sessionData.name;return a.setCookie(b,"",{maxAge:0}),a.json(null)}}else{let b=(0,E.t)(ab.decode(_.base64Url.decode(c)));if(b)if(await ae("SHA-256","base64urlnopad").verify(a.context.secret,JSON.stringify({...b.session,expiresAt:b.expiresAt}),b.signature))d=b;else{let b=a.context.authCookies.sessionData.name;return a.setCookie(b,"",{maxAge:0}),a.json(null)}}}let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);if(d?.session&&a.context.options.session?.cookieCache?.enabled&&!a.query?.disableCookieCache){let b=d.session,c=a.context.options.session?.cookieCache?.version,e="1";if(c){if("string"==typeof c)e=c;else if("function"==typeof c){let a=c(b.session,b.user);e=a instanceof Promise?await a:a}}if((b.version||"1")!==e){let b=a.context.authCookies.sessionData.name;a.setCookie(b,"",{maxAge:0})}else if(d.expiresAt<Date.now()||b.session.expiresAt<new Date){let b=a.context.authCookies.sessionData.name;a.setCookie(b,"",{maxAge:0})}else{let c=a.context.sessionConfig.cookieRefreshCache;if(!1===c)return a.context.session=b,a.json({session:b.session,user:b.user});if(d.expiresAt-Date.now()<1e3*c.updateAge){let c=s(a.context.options.session?.cookieCache?.maxAge||300,"sec"),d={session:{...b.session,expiresAt:c},user:b.user,updatedAt:Date.now()};await ap(a,d,!1);let e=x(a.context.options,{...d.session,expiresAt:new Date(d.session.expiresAt),createdAt:new Date(d.session.createdAt),updatedAt:new Date(d.session.updatedAt)}),f=w(a.context.options,{...d.user,createdAt:new Date(d.user.createdAt),updatedAt:new Date(d.user.updatedAt)});return a.context.session={session:e,user:f},a.json({session:e,user:f})}let e=x(a.context.options,{...b.session,expiresAt:new Date(b.session.expiresAt),createdAt:new Date(b.session.createdAt),updatedAt:new Date(b.session.updatedAt)}),f=w(a.context.options,{...b.user,createdAt:new Date(b.user.createdAt),updatedAt:new Date(b.user.updatedAt)});return a.context.session={session:e,user:f},a.json({session:e,user:f})}}let f=await a.context.internalAdapter.findSession(b);if(a.context.session=f,!f||f.session.expiresAt<new Date)return ar(a),f&&await a.context.internalAdapter.deleteSession(f.session.token),a.json(null);if(e||a.query?.disableRefresh){let b=x(a.context.options,f.session),c=w(a.context.options,f.user);return a.json({session:b,user:c})}let g=a.context.sessionConfig.expiresIn,h=a.context.sessionConfig.updateAge;if(f.session.expiresAt.valueOf()-1e3*g+1e3*h<=Date.now()&&(!a.query?.disableRefresh||!a.context.options.session?.disableSessionRefresh)){let b=await a.context.internalAdapter.updateSession(f.session.token,{expiresAt:s(a.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!b)return ar(a),a.json(null,{status:401});let c=(b.expiresAt.valueOf()-Date.now())/1e3;await aq(a,{session:b,user:f.user},!1,{maxAge:c});let d=x(a.context.options,b),e=w(a.context.options,f.user);return a.json({session:d,user:e})}return await ap(a,f,!!e),a.json(f)}catch(b){throw a.context.logger.error("INTERNAL_SERVER_ERROR",b),new r.APIError("INTERNAL_SERVER_ERROR",{message:as.n.FAILED_TO_GET_SESSION})}}),az=async(a,b)=>{if(a.context.session)return a.context.session;let c=await ay()({...a,asResponse:!1,headers:a.headers,returnHeaders:!1,returnStatus:!1,query:{...b,...a.query}}).catch(a=>null);return a.context.session=c,c},aA=av(async a=>{let b=await az(a);if(!b?.session)throw new r.APIError("UNAUTHORIZED");return{session:b}}),aB=av(async a=>{let b=await az(a,{disableCookieCache:!0});if(!b?.session)throw new r.APIError("UNAUTHORIZED");return{session:b}});av(async a=>{let b=await az(a);if(!b?.session&&(a.request||a.headers))throw new r.APIError("UNAUTHORIZED");return{session:b}});let aC=av(async a=>{let b=await az(a);if(!b?.session)throw new r.APIError("UNAUTHORIZED");if(0===a.context.sessionConfig.freshAge)return{session:b};let c=a.context.sessionConfig.freshAge,d=new Date(b.session.updatedAt||b.session.createdAt).getTime();if(!(Date.now()-d<1e3*c))throw new r.APIError("FORBIDDEN",{message:"Session is not fresh"});return{session:b}}),aD=ax("/revoke-session",{method:"POST",body:C.object({token:C.string().meta({description:"The token to revoke"})}),use:[aB],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.body.token;if((await a.context.internalAdapter.findSession(b))?.session.userId===a.context.session.user.id)try{await a.context.internalAdapter.deleteSession(b)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new r.APIError("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),aE=ax("/revoke-sessions",{method:"POST",use:[aB],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{try{await a.context.internalAdapter.deleteSessions(a.context.session.user.id)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new r.APIError("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),aF=ax("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[aB],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.context.session;if(!b.user)throw new r.APIError("UNAUTHORIZED");let c=(await a.context.internalAdapter.listSessions(b.user.id)).filter(a=>a.expiresAt>new Date).filter(b=>b.token!==a.context.session.session.token);return await Promise.all(c.map(b=>a.context.internalAdapter.deleteSession(b.token))),a.json({status:!0})});var aG=F,aH=F,aI=F,H=F,A=A,$=A,aJ=A,as=as,aK=a.i(9633),aL=A,aM=Object.defineProperty,aN=Object.defineProperties,aO=Object.getOwnPropertyDescriptors,aP=Object.getOwnPropertySymbols,aQ=Object.prototype.hasOwnProperty,aR=Object.prototype.propertyIsEnumerable,aS=(a,b,c)=>b in a?aM(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,aT=(a,b)=>{for(var c in b||(b={}))aQ.call(b,c)&&aS(a,c,b[c]);if(aP)for(var c of aP(b))aR.call(b,c)&&aS(a,c,b[c]);return a},aU=(a,b)=>aN(a,aO(b)),aV=class extends Error{constructor(a,b,c){super(b||a.toString(),{cause:c}),this.status=a,this.statusText=b,this.error=c}},aW=async(a,b)=>{var c,d,e,f,g,h;let i=b||{},j={onRequest:[null==b?void 0:b.onRequest],onResponse:[null==b?void 0:b.onResponse],onSuccess:[null==b?void 0:b.onSuccess],onError:[null==b?void 0:b.onError],onRetry:[null==b?void 0:b.onRetry]};if(!b||!(null==b?void 0:b.plugins))return{url:a,options:i,hooks:j};for(let k of(null==b?void 0:b.plugins)||[]){if(k.init){let d=await (null==(c=k.init)?void 0:c.call(k,a.toString(),b));i=d.options||i,a=d.url}j.onRequest.push(null==(d=k.hooks)?void 0:d.onRequest),j.onResponse.push(null==(e=k.hooks)?void 0:e.onResponse),j.onSuccess.push(null==(f=k.hooks)?void 0:f.onSuccess),j.onError.push(null==(g=k.hooks)?void 0:g.onError),j.onRetry.push(null==(h=k.hooks)?void 0:h.onRetry)}return{url:a,options:i,hooks:j}},aX=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(){return this.options.delay}},aY=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(a){return Math.min(this.options.maxDelay,this.options.baseDelay*2**a)}},aZ=async a=>{let b={},c=async a=>"function"==typeof a?await a():a;if(null==a?void 0:a.auth){if("Bearer"===a.auth.type){let d=await c(a.auth.token);if(!d)return b;b.authorization=`Bearer ${d}`}else if("Basic"===a.auth.type){let d=c(a.auth.username),e=c(a.auth.password);if(!d||!e)return b;b.authorization=`Basic ${btoa(`${d}:${e}`)}`}else if("Custom"===a.auth.type){let d=c(a.auth.value);if(!d)return b;b.authorization=`${c(a.auth.prefix)} ${d}`}}return b},a$=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function a_(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}function a0(a){try{return JSON.parse(a)}catch(b){return a}}async function a1(a){let b=new Headers(null==a?void 0:a.headers);for(let[c,d]of Object.entries(await aZ(a)||{}))b.set(c,d);if(!b.has("content-type")){let c=a_(null==a?void 0:a.body)?"application/json":null;c&&b.set("content-type",c)}return b}var a2=class a extends Error{constructor(b,c){super(c||JSON.stringify(b,null,2)),this.issues=b,Object.setPrototypeOf(this,a.prototype)}};async function a3(a,b){let c=await a["~standard"].validate(b);if(c.issues)throw new a2(c.issues);return c.value}var a4=["get","post","put","patch","delete"],a5=async(a,b)=>{var c,d,e,f,g,h,i,j;let k,{hooks:l,url:m,options:n}=await aW(a,b),o=function(a){if(null==a?void 0:a.customFetchImpl)return a.customFetchImpl;if("undefined"!=typeof globalThis&&"function"==typeof globalThis.fetch)return globalThis.fetch;throw Error("No fetch implementation found")}(n),p=new AbortController,q=null!=(c=n.signal)?c:p.signal,r=function(a,b){let{baseURL:c,params:d,query:e}=b||{query:{},params:{},baseURL:""},f=a.startsWith("http")?a.split("/").slice(0,3).join("/"):c||"";if(a.startsWith("@")){let b=a.toString().split("@")[1].split("/")[0];a4.includes(b)&&(a=a.replace(`@${b}/`,"/"))}f.endsWith("/")||(f+="/");let[g,h]=a.replace(f,"").split("?"),i=new URLSearchParams(h);for(let[a,b]of Object.entries(e||{}))null!=b&&i.set(a,String(b));if(d)if(Array.isArray(d))for(let[a,b]of g.split("/").filter(a=>a.startsWith(":")).entries()){let c=d[a];g=g.replace(b,c)}else for(let[a,b]of Object.entries(d))g=g.replace(`:${a}`,String(b));(g=g.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(g=g.slice(1));let j=i.toString();return(j=j.length>0?`?${j}`.replace(/\+/g,"%20"):"",f.startsWith("http"))?new URL(`${g}${j}`,f):`${f}${g}${j}`}(m,n),s=function(a){if(!(null==a?void 0:a.body))return null;let b=new Headers(null==a?void 0:a.headers);if(a_(a.body)&&!b.has("content-type")){for(let[b,c]of Object.entries(null==a?void 0:a.body))c instanceof Date&&(a.body[b]=c.toISOString());return JSON.stringify(a.body)}return a.body}(n),t=await a1(n),u=function(a,b){var c;if(null==b?void 0:b.method)return b.method.toUpperCase();if(a.startsWith("@")){let d=null==(c=a.split("@")[1])?void 0:c.split("/")[0];return a4.includes(d)?d.toUpperCase():(null==b?void 0:b.body)?"POST":"GET"}return(null==b?void 0:b.body)?"POST":"GET"}(m,n),v=aU(aT({},n),{url:r,headers:t,body:s,method:u,signal:q});for(let a of l.onRequest)if(a){let b=await a(v);b instanceof Object&&(v=b)}("pipeTo"in v&&"function"==typeof v.pipeTo||"function"==typeof(null==(d=null==b?void 0:b.body)?void 0:d.pipe))&&!("duplex"in v)&&(v.duplex="half");let{clearTimeout:w}=(!(null==n?void 0:n.signal)&&(null==n?void 0:n.timeout)&&(k=setTimeout(()=>null==p?void 0:p.abort(),null==n?void 0:n.timeout)),{abortTimeout:k,clearTimeout:()=>{k&&clearTimeout(k)}}),x=await o(v.url,v);w();let y={response:x,request:v};for(let a of l.onResponse)if(a){let c=await a(aU(aT({},y),{response:(null==(e=null==b?void 0:b.hookOptions)?void 0:e.cloneResponse)?x.clone():x}));c instanceof Response?x=c:c instanceof Object&&(x=c.response)}if(x.ok){if("HEAD"===v.method)return{data:"",error:null};let a=function(a){let b=a.headers.get("content-type"),c=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!b)return"json";let d=b.split(";").shift()||"";return a$.test(d)?"json":c.has(d)||d.startsWith("text/")?"text":"blob"}(x),c={data:"",response:x,request:v};if("json"===a||"text"===a){let a=await x.text(),b=null!=(f=v.jsonParser)?f:a0;c.data=await b(a)}else c.data=await x[a]();for(let a of((null==v?void 0:v.output)&&v.output&&!v.disableValidation&&(c.data=await a3(v.output,c.data)),l.onSuccess))a&&await a(aU(aT({},c),{response:(null==(g=null==b?void 0:b.hookOptions)?void 0:g.cloneResponse)?x.clone():x}));return(null==b?void 0:b.throw)?c.data:{data:c.data,error:null}}let z=null!=(h=null==b?void 0:b.jsonParser)?h:a0,A=await x.text(),B=function(a){try{return JSON.parse(a),!0}catch(a){return!1}}(A),C=B?await z(A):null,D={response:x,responseText:A,request:v,error:aU(aT({},C),{status:x.status,statusText:x.statusText})};for(let a of l.onError)a&&await a(aU(aT({},D),{response:(null==(i=null==b?void 0:b.hookOptions)?void 0:i.cloneResponse)?x.clone():x}));if(null==b?void 0:b.retry){let c=function(a){if("number"==typeof a)return new aX({type:"linear",attempts:a,delay:1e3});switch(a.type){case"linear":return new aX(a);case"exponential":return new aY(a);default:throw Error("Invalid retry strategy")}}(b.retry),d=null!=(j=b.retryAttempt)?j:0;if(await c.shouldAttemptRetry(d,x)){for(let a of l.onRetry)a&&await a(y);let e=c.getDelay(d);return await new Promise(a=>setTimeout(a,e)),await a5(a,aU(aT({},b),{retryAttempt:d+1}))}}if(null==b?void 0:b.throw)throw new aV(x.status,x.statusText,B?C:A);return{data:null,error:aU(aT({},C),{status:x.status,statusText:x.statusText})}};function a6(a){let b=a=>new Date(new Date().getTime()+1e3*a);return{tokenType:a.token_type,accessToken:a.access_token,refreshToken:a.refresh_token,accessTokenExpiresAt:a.expires_in?b(a.expires_in):void 0,refreshTokenExpiresAt:a.refresh_token_expires_in?b(a.refresh_token_expires_in):void 0,scopes:a?.scope?"string"==typeof a.scope?a.scope.split(" "):a.scope:[],idToken:a.id_token,raw:a}}async function a7(a){let b=new TextEncoder().encode(a),c=await crypto.subtle.digest("SHA-256",b);return _.base64Url.encode(new Uint8Array(c),{padding:!1})}async function a8({id:a,options:b,authorizationEndpoint:c,state:d,codeVerifier:e,scopes:f,claims:g,redirectURI:h,duration:i,prompt:j,accessType:k,responseType:l,display:m,loginHint:n,hd:o,responseMode:p,additionalParams:q,scopeJoiner:r}){let s=new URL(c);s.searchParams.set("response_type",l||"code");let t=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;if(s.searchParams.set("client_id",t),s.searchParams.set("state",d),f&&s.searchParams.set("scope",f.join(r||" ")),s.searchParams.set("redirect_uri",b.redirectURI||h),i&&s.searchParams.set("duration",i),m&&s.searchParams.set("display",m),n&&s.searchParams.set("login_hint",n),j&&s.searchParams.set("prompt",j),o&&s.searchParams.set("hd",o),k&&s.searchParams.set("access_type",k),p&&s.searchParams.set("response_mode",p),e){let a=await a7(e);s.searchParams.set("code_challenge_method","S256"),s.searchParams.set("code_challenge",a)}if(g){let a=g.reduce((a,b)=>(a[b]=null,a),{});s.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...a}}))}return q&&Object.entries(q).forEach(([a,b])=>{s.searchParams.set(a,b)}),s}async function a9({refreshToken:a,options:b,tokenEndpoint:c,authentication:d,extraParams:e}){let{body:f,headers:g}=function({refreshToken:a,options:b,authentication:c,extraParams:d,resource:e}){let f=new URLSearchParams,g={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(f.set("grant_type","refresh_token"),f.set("refresh_token",a),"basic"===c){let a=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;a?g.authorization="Basic "+_.base64.encode(`${a}:${b.clientSecret??""}`):g.authorization="Basic "+_.base64.encode(`:${b.clientSecret??""}`)}else{let a=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;f.set("client_id",a),b.clientSecret&&f.set("client_secret",b.clientSecret)}if(e)if("string"==typeof e)f.append("resource",e);else for(let a of e)f.append("resource",a);if(d)for(let[a,b]of Object.entries(d))f.set(a,b);return{body:f,headers:g}}({refreshToken:a,options:b,authentication:d,extraParams:e}),{data:h,error:i}=await a5(c,{method:"POST",body:f,headers:g});if(i)throw i;let j={accessToken:h.access_token,refreshToken:h.refresh_token,tokenType:h.token_type,scopes:h.scope?.split(" "),idToken:h.id_token};return h.expires_in&&(j.accessTokenExpiresAt=new Date(new Date().getTime()+1e3*h.expires_in)),j}async function ba({code:a,codeVerifier:b,redirectURI:c,options:d,tokenEndpoint:e,authentication:f,deviceId:g,headers:h,additionalParams:i={},resource:j}){let{body:k,headers:l}=function({code:a,codeVerifier:b,redirectURI:c,options:d,authentication:e,deviceId:f,headers:g,additionalParams:h={},resource:i}){let j=new URLSearchParams,k={"content-type":"application/x-www-form-urlencoded",accept:"application/json",...g};if(j.set("grant_type","authorization_code"),j.set("code",a),b&&j.set("code_verifier",b),d.clientKey&&j.set("client_key",d.clientKey),f&&j.set("device_id",f),j.set("redirect_uri",d.redirectURI||c),i)if("string"==typeof i)j.append("resource",i);else for(let a of i)j.append("resource",a);if("basic"===e){let a=Array.isArray(d.clientId)?d.clientId[0]:d.clientId;k.authorization=`Basic ${_.base64.encode(`${a}:${d.clientSecret??""}`)}`}else{let a=Array.isArray(d.clientId)?d.clientId[0]:d.clientId;j.set("client_id",a),d.clientSecret&&j.set("client_secret",d.clientSecret)}for(let[a,b]of Object.entries(h))j.has(a)||j.append(a,b);return{body:j,headers:k}}({code:a,codeVerifier:b,redirectURI:c,options:d,authentication:f,deviceId:g,headers:h,additionalParams:i,resource:j}),{data:m,error:n}=await a5(e,{method:"POST",body:k,headers:l});if(n)throw n;return a6(m)}a.i(37592);var bb=as,bc=a.i(72328),bd=a.i(83607),be=a.i(13730);function bf(a){return(0,be.isObject)(a)}class bg{#a;#b=new WeakMap;constructor(a){if(!function(a){return a&&"object"==typeof a&&Array.isArray(a.keys)&&a.keys.every(bf)}(a))throw new bc.JWKSInvalid("JSON Web Key Set malformed");this.#a=structuredClone(a)}jwks(){return this.#a}async getKey(a,b){let{alg:c,kid:d}={...a,...b?.header},e=function(a){switch("string"==typeof a&&a.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new bc.JOSENotSupported('Unsupported "alg" value for a JSON Web Key Set')}}(c),f=this.#a.keys.filter(a=>{let b=e===a.kty;if(b&&"string"==typeof d&&(b=d===a.kid),b&&("string"==typeof a.alg||"AKP"===e)&&(b=c===a.alg),b&&"string"==typeof a.use&&(b="sig"===a.use),b&&Array.isArray(a.key_ops)&&(b=a.key_ops.includes("verify")),b)switch(c){case"ES256":b="P-256"===a.crv;break;case"ES384":b="P-384"===a.crv;break;case"ES512":b="P-521"===a.crv;break;case"Ed25519":case"EdDSA":b="Ed25519"===a.crv}return b}),{0:g,length:h}=f;if(0===h)throw new bc.JWKSNoMatchingKey;if(1!==h){let a=new bc.JWKSMultipleMatchingKeys,b=this.#b;throw a[Symbol.asyncIterator]=async function*(){for(let a of f)try{yield await bh(b,a,c)}catch{}},a}return bh(this.#b,g,c)}}async function bh(a,b,c){let d=a.get(b)||a.set(b,{}).get(b);if(void 0===d[c]){let a=await (0,bd.importJWK)({...b,ext:!0},c);if(a instanceof Uint8Array||"public"!==a.type)throw new bc.JWKSInvalid("JSON Web Key Set members must be public keys");d[c]=a}return d[c]}function bi(a){let b=new bg(a),c=async(a,c)=>b.getKey(a,c);return Object.defineProperties(c,{jwks:{value:()=>structuredClone(b.jwks()),enumerable:!1,configurable:!1,writable:!1}}),c}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(b="jose/v6.1.3");let bj=Symbol();async function bk(a,b,c,d=fetch){let e=await d(a,{method:"GET",signal:c,redirect:"manual",headers:b}).catch(a=>{if("TimeoutError"===a.name)throw new bc.JWKSTimeout;throw a});if(200!==e.status)throw new bc.JOSEError("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await e.json()}catch{throw new bc.JOSEError("Failed to parse the JSON Web Key Set HTTP response as JSON")}}let bl=Symbol();class bm{#c;#d;#e;#f;#g;#h;#i;#j;#k;#l;constructor(a,c){if(!(a instanceof URL))throw TypeError("url must be an instance of URL");this.#c=new URL(a.href),this.#d="number"==typeof c?.timeoutDuration?c?.timeoutDuration:5e3,this.#e="number"==typeof c?.cooldownDuration?c?.cooldownDuration:3e4,this.#f="number"==typeof c?.cacheMaxAge?c?.cacheMaxAge:6e5,this.#i=new Headers(c?.headers),b&&!this.#i.has("User-Agent")&&this.#i.set("User-Agent",b),this.#i.has("accept")||(this.#i.set("accept","application/json"),this.#i.append("accept","application/jwk-set+json")),this.#j=c?.[bj],c?.[bl]!==void 0&&(this.#l=c?.[bl],function(a,b){return!("object"!=typeof a||null===a||!("uat"in a)||"number"!=typeof a.uat||Date.now()-a.uat>=b)&&"jwks"in a&&!!(0,be.isObject)(a.jwks)&&!!Array.isArray(a.jwks.keys)&&!!Array.prototype.every.call(a.jwks.keys,be.isObject)}(c?.[bl],this.#f)&&(this.#g=this.#l.uat,this.#k=bi(this.#l.jwks)))}pendingFetch(){return!!this.#h}coolingDown(){return"number"==typeof this.#g&&Date.now()<this.#g+this.#e}fresh(){return"number"==typeof this.#g&&Date.now()<this.#g+this.#f}jwks(){return this.#k?.jwks()}async getKey(a,b){this.#k&&this.fresh()||await this.reload();try{return await this.#k(a,b)}catch(c){if(c instanceof bc.JWKSNoMatchingKey&&!1===this.coolingDown())return await this.reload(),this.#k(a,b);throw c}}async reload(){this.#h&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this.#h=void 0),this.#h||=bk(this.#c.href,this.#i,AbortSignal.timeout(this.#d),this.#j).then(a=>{this.#k=bi(a),this.#l&&(this.#l.uat=Date.now(),this.#l.jwks=a),this.#g=Date.now(),this.#h=void 0}).catch(a=>{throw this.#h=void 0,a}),await this.#h}}var bn=a.i(9634),bo=a.i(89822);function bp(a){let b,c;if("string"!=typeof a)throw new bc.JWTInvalid("JWTs must use Compact JWS serialization, JWT must be a string");let{1:d,length:e}=a.split(".");if(5===e)throw new bc.JWTInvalid("Only JWTs using Compact JWS serialization can be decoded");if(3!==e)throw new bc.JWTInvalid("Invalid JWT");if(!d)throw new bc.JWTInvalid("JWTs must contain a payload");try{b=(0,bn.decode)(d)}catch{throw new bc.JWTInvalid("Failed to base64url decode the payload")}try{c=JSON.parse(bo.decoder.decode(b))}catch{throw new bc.JWTInvalid("Failed to parse the decoded payload as JSON")}if(!(0,be.isObject)(c))throw new bc.JWTInvalid("Invalid JWT Claims Set");return c}function bq(a){let b;if("string"==typeof a){let c=a.split(".");(3===c.length||5===c.length)&&([b]=c)}else if("object"==typeof a&&a)if("protected"in a)b=a.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof b||!b)throw Error();let a=JSON.parse(bo.decoder.decode((0,bn.decode)(b)));if(!(0,be.isObject)(a))throw Error();return a}catch{throw TypeError("Invalid Token or Protected Header formatting")}}let br=async a=>{let{data:b}=await a5("https://appleid.apple.com/auth/keys");if(!b?.keys)throw new r.APIError("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await (0,bd.importJWK)(c,c.alg)},bs=async(a,b,c)=>{let d=`https://cognito-idp.${b}.amazonaws.com/${c}/.well-known/jwks.json`;try{let{data:b}=await a5(d);if(!b?.keys)throw new r.APIError("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await (0,bd.importJWK)(c,c.alg)}catch(a){throw aL.i.error("Failed to fetch Cognito public key:",a),a}},bt=(a="")=>a.split("://").map(a=>a.replace(/\/{2,}/g,"/")).join("://"),bu={apple:a=>({id:"apple",name:"Apple",async createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["email","name"];return a.scope&&e.push(...a.scope),c&&e.push(...c),await a8({id:"apple",options:a,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:e,state:b,redirectURI:d,responseMode:"form_post",responseType:"code id_token"})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>ba({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://appleid.apple.com/auth/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let{kid:d,alg:e}=bq(b);if(!d||!e)return!1;let{payload:f}=await (0,aK.jwtVerify)(b,await br(d),{algorithms:[e],issuer:"https://appleid.apple.com",audience:a.audience&&a.audience.length?a.audience:a.appBundleIdentifier?a.appBundleIdentifier:a.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(a=>{void 0!==f[a]&&(f[a]=!!f[a])}),(!c||f.nonce===c)&&!!f},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=bp(b.idToken);if(!c)return null;let d=b.user?`${b.user.name?.firstName} ${b.user.name?.lastName}`:c.name||c.email,e="boolean"==typeof c.email_verified?c.email_verified:"true"===c.email_verified,f={...c,name:d},g=await a.mapProfileToUser?.(f);return{user:{id:c.sub,name:f.name,emailVerified:e,email:c.email,...g},data:f}},options:a}),atlassian:a=>({id:"atlassian",name:"Atlassian",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw aL.i.error("Client Id and Secret are required for Atlassian"),new bb.t("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new bb.t("codeVerifier is required for Atlassian");let f=a.disableDefaultScope?[]:["read:jira-user","offline_access"];return a.scope&&f.push(...a.scope),c&&f.push(...c),a8({id:"atlassian",options:a,authorizationEndpoint:"https://auth.atlassian.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e,additionalParams:{audience:"api.atlassian.com"},prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>ba({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;try{let{data:c}=await a5("https://api.atlassian.com/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name,email:c.email,image:c.picture,emailVerified:!1,...d},data:c}}catch(a){return aL.i.error("Failed to fetch user info from Figma:",a),null}},options:a}),cognito:a=>{if(!a.domain||!a.region||!a.userPoolId)throw aL.i.error("Domain, region and userPoolId are required for Amazon Cognito. Make sure to provide them in the options."),new bb.t("DOMAIN_AND_REGION_REQUIRED");let b=a.domain.replace(/^https?:\/\//,""),c=`https://${b}/oauth2/authorize`,d=`https://${b}/oauth2/token`,e=`https://${b}/oauth2/userinfo`;return{id:"cognito",name:"Cognito",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f}){if(!a.clientId)throw aL.i.error("ClientId is required for Amazon Cognito. Make sure to provide them in the options."),new bb.t("CLIENT_ID_AND_SECRET_REQUIRED");if(a.requireClientSecret&&!a.clientSecret)throw aL.i.error("Client Secret is required when requireClientSecret is true. Make sure to provide it in the options."),new bb.t("CLIENT_SECRET_REQUIRED");let g=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&g.push(...a.scope),d&&g.push(...d),await a8({id:"cognito",options:{...a},authorizationEndpoint:c,scopes:g,state:b,codeVerifier:e,redirectURI:f,prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>ba({code:b,codeVerifier:c,redirectURI:e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{let{kid:d,alg:e}=bq(b);if(!d||!e)return!1;let f=await bs(d,a.region,a.userPoolId),g=`https://cognito-idp.${a.region}.amazonaws.com/${a.userPoolId}`,{payload:h}=await (0,aK.jwtVerify)(b,f,{algorithms:[e],issuer:g,audience:a.clientId,maxTokenAge:"1h"});if(c&&h.nonce!==c)return!1;return!0}catch(a){return aL.i.error("Failed to verify ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken)try{let c=bp(b.idToken);if(!c)return null;let d=c.name||c.given_name||c.username||c.email,e={...c,name:d},f=await a.mapProfileToUser?.(e);return{user:{id:c.sub,name:e.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...f},data:e}}catch(a){aL.i.error("Failed to decode ID token:",a)}if(b.accessToken)try{let{data:c}=await a5(e,{headers:{Authorization:`Bearer ${b.accessToken}`}});if(c){let b=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.given_name||c.username,email:c.email,image:c.picture,emailVerified:c.email_verified,...b},data:c}}}catch(a){aL.i.error("Failed to fetch user info from Cognito:",a)}return null},options:a}},discord:a=>({id:"discord",name:"Discord",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identify","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=e.includes("bot")&&void 0!==a.permissions?`&permissions=${a.permissions}`:"";return new URL(`https://discord.com/api/oauth2/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"none"}${f}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>ba({code:b,redirectURI:c,options:a,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;if(null===c.avatar)c.image_url=`https://cdn.discordapp.com/embed/avatars/${"0"===c.discriminator?Number(BigInt(c.id)>>BigInt(22))%6:parseInt(c.discriminator)%5}.png`;else{let a=c.avatar.startsWith("a_")?"gif":"png";c.image_url=`https://cdn.discordapp.com/avatars/${c.id}/${c.avatar}.${a}`}let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.global_name||c.username||"",email:c.email,emailVerified:c.verified,image:c.image_url,...e},data:c}},options:a}),facebook:a=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:b,scopes:c,redirectURI:d,loginHint:e}){let f=a.disableDefaultScope?[]:["email","public_profile"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await a8({id:"facebook",options:a,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:f,state:b,redirectURI:d,loginHint:e,additionalParams:a.configId?{config_id:a.configId}:{}})},validateAuthorizationCode:async({code:b,redirectURI:c})=>ba({code:b,redirectURI:c,options:a,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);if(3===b.split(".").length)try{var d;let e,f,{payload:g}=await (0,aK.jwtVerify)(b,(d=new URL("https://limited.facebook.com/.well-known/oauth/openid/jwks/"),e=new bm(d,void 0),f=async(a,b)=>e.getKey(a,b),Object.defineProperties(f,{coolingDown:{get:()=>e.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>e.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>e.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>e.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>e.jwks(),enumerable:!0,configurable:!1,writable:!1}}),f),{algorithms:["RS256"],audience:a.clientId,issuer:"https://www.facebook.com"});if(c&&g.nonce!==c)return!1;return!!g}catch(a){return!1}return!0},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken&&3===b.idToken.split(".").length){let c=bp(b.idToken),d={id:c.sub,name:c.name,email:c.email,picture:{data:{url:c.picture,height:100,width:100,is_silhouette:!1}}},e=await a.mapProfileToUser?.({...d,email_verified:!1});return{user:{...d,emailVerified:!1,...e},data:c}}let{data:c,error:d}=await a5("https://graph.facebook.com/me?fields="+["id","name","email","picture",...a?.fields||[]].join(","),{auth:{type:"Bearer",token:b.accessToken}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name,email:c.email,image:c.picture.data.url,emailVerified:c.email_verified,...e},data:c}},options:a}),figma:a=>({id:"figma",name:"Figma",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw aL.i.error("Client Id and Client Secret are required for Figma. Make sure to provide them in the options."),new bb.t("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new bb.t("codeVerifier is required for Figma");let f=a.disableDefaultScope?[]:["file_read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await a8({id:"figma",options:a,authorizationEndpoint:"https://www.figma.com/oauth",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>ba({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://www.figma.com/api/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://www.figma.com/api/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);try{let{data:c}=await a5("https://api.figma.com/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return aL.i.error("Failed to fetch user from Figma"),null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.handle,email:c.email,image:c.img_url,emailVerified:!!c.email,...d},data:c}}catch(a){return aL.i.error("Failed to fetch user info from Figma:",a),null}},options:a}),github:a=>({id:"github",name:"GitHub",createAuthorizationURL({state:b,scopes:c,loginHint:d,codeVerifier:e,redirectURI:f}){let g=a.disableDefaultScope?[]:["read:user","user:email"];return a.scope&&g.push(...a.scope),c&&g.push(...c),a8({id:"github",options:a,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:g,state:b,codeVerifier:e,redirectURI:f,loginHint:d,prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>ba({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://github.com/login/oauth/access_token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://github.com/login/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e}=await a5("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});!c.email&&e&&(c.email=(e.find(a=>a.primary)??e[0])?.email);let f=e?.find(a=>a.email===c.email)?.verified??!1,g=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name||c.login,email:c.email,image:c.avatar_url,emailVerified:f,...g},data:c}},options:a}),microsoft:a=>{let b=a.tenantId||"common",c=a.authority||"https://login.microsoftonline.com",d=`${c}/${b}/oauth2/v2.0/authorize`,e=`${c}/${b}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),a8({id:"microsoft",options:a,authorizationEndpoint:d,state:b.state,codeVerifier:b.codeVerifier,scopes:c,redirectURI:b.redirectURI,prompt:a.prompt,loginHint:b.loginHint})},validateAuthorizationCode:({code:b,codeVerifier:c,redirectURI:d})=>ba({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:e}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=bp(b.idToken),d=a.profilePhotoSize||48;await a5(`https://graph.microsoft.com/v1.0/me/photos/${d}x${d}/$value`,{headers:{Authorization:`Bearer ${b.accessToken}`},async onResponse(b){if(!a.disableProfilePhoto&&b.response.ok)try{let a=await b.response.clone().arrayBuffer();c.picture=`data:image/jpeg;base64, ${_.base64.encode(a)}`}catch(a){aL.i.error(a&&"object"==typeof a&&"name"in a?a.name:"",a)}}});let e=await a.mapProfileToUser?.(c),f=void 0!==c.email_verified?c.email_verified:!!(c.email&&(c.verified_primary_email?.includes(c.email)||c.verified_secondary_email?.includes(c.email)));return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:f,...e},data:c}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),a9({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},extraParams:{scope:c.join(" ")},tokenEndpoint:e})},options:a}},google:a=>({id:"google",name:"Google",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f,display:g}){if(!a.clientId||!a.clientSecret)throw aL.i.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new bb.t("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new bb.t("codeVerifier is required for Google");let h=a.disableDefaultScope?[]:["email","profile","openid"];return a.scope&&h.push(...a.scope),c&&h.push(...c),await a8({id:"google",options:a,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:h,state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt,accessType:a.accessType,display:g||a.display,loginHint:f,hd:a.hd,additionalParams:{include_granted_scopes:"true"}})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>ba({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let{data:d}=await a5(`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${b}`);return!!d&&d.aud===a.clientId&&("https://accounts.google.com"===d.iss||"accounts.google.com"===d.iss)},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=bp(b.idToken),d=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...d},data:c}},options:a}),huggingface:a=>({id:"huggingface",name:"Hugging Face",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),a8({id:"huggingface",options:a,authorizationEndpoint:"https://huggingface.co/oauth/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>ba({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://huggingface.co/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://huggingface.co/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://huggingface.co/oauth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.preferred_username,email:c.email,image:c.picture,emailVerified:c.email_verified??!1,...e},data:c}},options:a}),slack:a=>({id:"slack",name:"Slack",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=new URL("https://slack.com/openid/connect/authorize");return f.searchParams.set("scope",e.join(" ")),f.searchParams.set("response_type","code"),f.searchParams.set("client_id",a.clientId),f.searchParams.set("redirect_uri",a.redirectURI||d),f.searchParams.set("state",b),f},validateAuthorizationCode:async({code:b,redirectURI:c})=>ba({code:b,redirectURI:c,options:a,tokenEndpoint:"https://slack.com/api/openid.connect.token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://slack.com/api/openid.connect.token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://slack.com/api/openid.connect.userInfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c["https://slack.com/user_id"],name:c.name||"",email:c.email,emailVerified:c.email_verified,image:c.picture||c["https://slack.com/user_image_512"],...e},data:c}},options:a}),spotify:a=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["user-read-email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),a8({id:"spotify",options:a,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>ba({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,email:c.email,image:c.images[0]?.url,emailVerified:!1,...e},data:c}},options:a}),twitch:a=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user:read:email","openid"];return a.scope&&e.push(...a.scope),c&&e.push(...c),a8({id:"twitch",redirectURI:d,options:a,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:e,state:b,claims:a.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:b,redirectURI:c})=>ba({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=b.idToken;if(!c)return aL.i.error("No idToken found in token"),null;let d=bp(c),e=await a.mapProfileToUser?.(d);return{user:{id:d.sub,name:d.preferred_username,email:d.email,image:d.picture,emailVerified:d.email_verified,...e},data:d}},options:a}),twitter:a=>({id:"twitter",name:"Twitter",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),a8({id:"twitter",options:a,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:c,state:b.state,codeVerifier:b.codeVerifier,redirectURI:b.redirectURI})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>ba({code:b,codeVerifier:c,authentication:"basic",redirectURI:d,options:a,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},authentication:"basic",tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e,error:f}=await a5("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}}),g=!1;!f&&e?.data?.confirmed_email&&(c.data.email=e.data.confirmed_email,g=!0);let h=await a.mapProfileToUser?.(c);return{user:{id:c.data.id,name:c.data.name,email:c.data.email||c.data.username||null,image:c.data.profile_image_url,emailVerified:g,...h},data:c}},options:a}),dropbox:a=>({id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:b,scopes:c,codeVerifier:d,redirectURI:e})=>{let f=a.disableDefaultScope?[]:["account_info.read"];a.scope&&f.push(...a.scope),c&&f.push(...c);let g={};return a.accessType&&(g.token_access_type=a.accessType),await a8({id:"dropbox",options:a,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d,additionalParams:g})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>await ba({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.dropboxapi.com/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name?.display_name,email:c.email,emailVerified:c.email_verified||!1,image:c.profile_photo_url,...e},data:c}},options:a}),kick:a=>({id:"kick",name:"Kick",createAuthorizationURL({state:b,scopes:c,redirectURI:d,codeVerifier:e}){let f=a.disableDefaultScope?[]:["user:read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),a8({id:"kick",redirectURI:d,options:a,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:f,codeVerifier:e,state:b})},validateAuthorizationCode:async({code:b,redirectURI:c,codeVerifier:d})=>ba({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=c.data[0],f=await a.mapProfileToUser?.(e);return{user:{id:e.user_id,name:e.name,email:e.email,image:e.profile_picture,emailVerified:!1,...f},data:e}},options:a}),linear:a=>{let b="https://api.linear.app/oauth/token";return{id:"linear",name:"Linear",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),a8({id:"linear",options:a,authorizationEndpoint:"https://linear.app/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>ba({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>a9({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://api.linear.app/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.accessToken}`},body:JSON.stringify({query:`
							query {
								viewer {
									id
									name
									email
									avatarUrl
									active
									createdAt
									updatedAt
								}
							}
						`})});if(d||!c?.data?.viewer)return null;let e=c.data.viewer,f=await a.mapProfileToUser?.(e);return{user:{id:c.data.viewer.id,name:c.data.viewer.name,email:c.data.viewer.email,image:c.data.viewer.avatarUrl,emailVerified:!1,...f},data:e}},options:a}},linkedin:a=>{let b="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:b,scopes:c,redirectURI:d,loginHint:e})=>{let f=a.disableDefaultScope?[]:["profile","email","openid"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await a8({id:"linkedin",options:a,authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",scopes:f,state:b,loginHint:e,redirectURI:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>await ba({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>a9({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,emailVerified:c.email_verified||!1,image:c.picture,...e},data:c}},options:a}},gitlab:a=>{let b,{authorizationEndpoint:c,tokenEndpoint:d,userinfoEndpoint:e}=(b=a.issuer||"https://gitlab.com",{authorizationEndpoint:bt(`${b}/oauth/authorize`),tokenEndpoint:bt(`${b}/oauth/token`),userinfoEndpoint:bt(`${b}/api/v4/user`)}),f="gitlab";return{id:f,name:"Gitlab",createAuthorizationURL:async({state:b,scopes:d,codeVerifier:e,loginHint:g,redirectURI:h})=>{let i=a.disableDefaultScope?[]:["read_user"];return a.scope&&i.push(...a.scope),d&&i.push(...d),await a8({id:f,options:a,authorizationEndpoint:c,scopes:i,state:b,redirectURI:h,codeVerifier:e,loginHint:g})},validateAuthorizationCode:async({code:b,redirectURI:c,codeVerifier:e})=>ba({code:b,redirectURI:c,options:a,codeVerifier:e,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5(e,{headers:{authorization:`Bearer ${b.accessToken}`}});if(d||"active"!==c.state||c.locked)return null;let f=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name??c.username,email:c.email,image:c.avatar_url,emailVerified:c.email_verified??!1,...f},data:c}},options:a}},tiktok:a=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user.info.profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${e.join(",")}&response_type=code&client_key=${a.clientKey}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>ba({code:b,redirectURI:a.redirectURI||c,options:{clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/",authentication:"post",extraParams:{client_key:a.clientKey}}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://open.tiktokapis.com/v2/user/info/?fields=open_id,avatar_large_url,display_name,username",{headers:{authorization:`Bearer ${b.accessToken}`}});return d?null:{user:{email:c.data.user.email||c.data.user.username,id:c.data.user.open_id,name:c.data.user.display_name||c.data.user.username,image:c.data.user.avatar_large_url,emailVerified:!!c.data.user.email},data:c}},options:a}),reddit:a=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identity"];return a.scope&&e.push(...a.scope),c&&e.push(...c),a8({id:"reddit",options:a,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:e,state:b,redirectURI:d,duration:a.duration})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let d=new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:a.redirectURI||c}),{data:e,error:f}=await a5("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${_.base64.encode(`${a.clientId}:${a.clientSecret}`)}`},body:d.toString()});if(f)throw f;return a6(e)},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},authentication:"basic",tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name,email:c.oauth_client_id,emailVerified:c.has_verified_email,image:c.icon_img?.split("?")[0],...e},data:c}},options:a}),roblox:a=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"select_account consent"}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>ba({code:b,redirectURI:a.redirectURI||c,options:a,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.nickname||c.preferred_username||"",image:c.picture,email:c.preferred_username||null,emailVerified:!1,...e},data:{...c}}},options:a}),salesforce:a=>{let b=(a.environment??"production")==="sandbox",c=a.loginUrl?`https://${a.loginUrl}/services/oauth2/authorize`:b?"https://test.salesforce.com/services/oauth2/authorize":"https://login.salesforce.com/services/oauth2/authorize",d=a.loginUrl?`https://${a.loginUrl}/services/oauth2/token`:b?"https://test.salesforce.com/services/oauth2/token":"https://login.salesforce.com/services/oauth2/token",e=a.loginUrl?`https://${a.loginUrl}/services/oauth2/userinfo`:b?"https://test.salesforce.com/services/oauth2/userinfo":"https://login.salesforce.com/services/oauth2/userinfo";return{id:"salesforce",name:"Salesforce",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f}){if(!a.clientId||!a.clientSecret)throw aL.i.error("Client Id and Client Secret are required for Salesforce. Make sure to provide them in the options."),new bb.t("CLIENT_ID_AND_SECRET_REQUIRED");if(!e)throw new bb.t("codeVerifier is required for Salesforce");let g=a.disableDefaultScope?[]:["openid","email","profile"];return a.scope&&g.push(...a.scope),d&&g.push(...d),a8({id:"salesforce",options:a,authorizationEndpoint:c,scopes:g,state:b,codeVerifier:e,redirectURI:a.redirectURI||f})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>ba({code:b,codeVerifier:c,redirectURI:a.redirectURI||e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);try{let{data:c}=await a5(e,{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return aL.i.error("Failed to fetch user info from Salesforce"),null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.user_id,name:c.name,email:c.email,image:c.photos?.picture||c.photos?.thumbnail,emailVerified:c.email_verified??!1,...d},data:c}}catch(a){return aL.i.error("Failed to fetch user info from Salesforce:",a),null}},options:a}},vk:a=>({id:"vk",name:"VK",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["email","phone"];return a.scope&&f.push(...a.scope),c&&f.push(...c),a8({id:"vk",options:a,authorizationEndpoint:"https://id.vk.com/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d,deviceId:e})=>ba({code:b,codeVerifier:c,redirectURI:a.redirectURI||d,options:a,deviceId:e,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;let c=new URLSearchParams({access_token:b.accessToken,client_id:a.clientId}).toString(),{data:d,error:e}=await a5("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c});if(e)return null;let f=await a.mapProfileToUser?.(d);return d.user.email||f?.email?{user:{id:d.user.user_id,first_name:d.user.first_name,last_name:d.user.last_name,email:d.user.email,image:d.user.avatar,emailVerified:!!d.user.email,birthday:d.user.birthday,sex:d.user.sex,name:`${d.user.first_name} ${d.user.last_name}`,...f},data:d}:null},options:a}),zoom:a=>{let b={pkce:!0,...a};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:a,redirectURI:c,codeVerifier:d})=>{let e=new URLSearchParams({response_type:"code",redirect_uri:b.redirectURI?b.redirectURI:c,client_id:b.clientId,state:a});if(b.pkce){let a=await a7(d);e.set("code_challenge_method","S256"),e.set("code_challenge",a)}let f=new URL("https://zoom.us/oauth/authorize");return f.search=e.toString(),f},validateAuthorizationCode:async({code:a,redirectURI:c,codeVerifier:d})=>ba({code:a,redirectURI:b.redirectURI||c,codeVerifier:d,options:b,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),refreshAccessToken:b.refreshAccessToken?b.refreshAccessToken:async a=>a9({refreshToken:a,options:{clientId:b.clientId,clientKey:b.clientKey,clientSecret:b.clientSecret},tokenEndpoint:"https://zoom.us/oauth/token"}),async getUserInfo(a){if(b.getUserInfo)return b.getUserInfo(a);let{data:c,error:d}=await a5("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${a.accessToken}`}});if(d)return null;let e=await b.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,image:c.pic_url,email:c.email,emailVerified:!!c.verified,...e},data:{...c}}}}},notion:a=>{let b="https://api.notion.com/v1/oauth/token";return{id:"notion",name:"Notion",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=(a.disableDefaultScope,[]);return a.scope&&f.push(...a.scope),c&&f.push(...c),a8({id:"notion",options:a,authorizationEndpoint:"https://api.notion.com/v1/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d,additionalParams:{owner:"user"}})},validateAuthorizationCode:async({code:c,redirectURI:d})=>ba({code:c,redirectURI:d,options:a,tokenEndpoint:b,authentication:"basic"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>a9({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://api.notion.com/v1/users/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"Notion-Version":"2022-06-28"}});if(d||!c)return null;let e=c.bot?.owner?.user;if(!e)return null;let f=await a.mapProfileToUser?.(e);return{user:{id:e.id,name:e.name||"Notion User",email:e.person?.email||null,image:e.avatar_url,emailVerified:!!e.person?.email,...f},data:e}},options:a}},kakao:a=>({id:"kakao",name:"Kakao",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["account_email","profile_image","profile_nickname"];return a.scope&&e.push(...a.scope),c&&e.push(...c),a8({id:"kakao",options:a,authorizationEndpoint:"https://kauth.kakao.com/oauth/authorize",scopes:e,state:b,redirectURI:d})},validateAuthorizationCode:async({code:b,redirectURI:c})=>ba({code:b,redirectURI:c,options:a,tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://kapi.kakao.com/v2/user/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c)return null;let e=await a.mapProfileToUser?.(c),f=c.kakao_account||{},g=f.profile||{};return{user:{id:String(c.id),name:g.nickname||f.name||void 0,email:f.email,image:g.profile_image_url||g.thumbnail_image_url,emailVerified:!!f.is_email_valid&&!!f.is_email_verified,...e},data:c}},options:a}),naver:a=>({id:"naver",name:"Naver",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["profile","email"];return a.scope&&e.push(...a.scope),c&&e.push(...c),a8({id:"naver",options:a,authorizationEndpoint:"https://nid.naver.com/oauth2.0/authorize",scopes:e,state:b,redirectURI:d})},validateAuthorizationCode:async({code:b,redirectURI:c})=>ba({code:b,redirectURI:c,options:a,tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://openapi.naver.com/v1/nid/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c||"00"!==c.resultcode)return null;let e=await a.mapProfileToUser?.(c),f=c.response||{};return{user:{id:f.id,name:f.name||f.nickname,email:f.email,image:f.profile_image,emailVerified:!1,...e},data:c}},options:a}),line:a=>{let b="https://api.line.me/oauth2/v2.1/token";return{id:"line",name:"LINE",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f}){let g=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&g.push(...a.scope),c&&g.push(...c),await a8({id:"line",options:a,authorizationEndpoint:"https://access.line.me/oauth2/v2.1/authorize",scopes:g,state:b,codeVerifier:d,redirectURI:e,loginHint:f})},validateAuthorizationCode:async({code:c,codeVerifier:d,redirectURI:e})=>ba({code:c,codeVerifier:d,redirectURI:e,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>a9({refreshToken:c,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:b}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let d=new URLSearchParams;d.set("id_token",b),d.set("client_id",a.clientId),c&&d.set("nonce",c);let{data:e,error:f}=await a5("https://api.line.me/oauth2/v2.1/verify",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:d});return!f&&!!e&&e.aud===a.clientId&&(!c||!e.nonce||e.nonce===c)},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=null;if(b.idToken)try{c=bp(b.idToken)}catch{}if(!c){let{data:a}=await a5("https://api.line.me/oauth2/v2.1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});c=a||null}if(!c)return null;let d=await a.mapProfileToUser?.(c),e=c.sub||c.userId,f=c.name||c.displayName,g=c.picture||c.pictureUrl||void 0;return{user:{id:e,name:f,email:c.email,image:g,emailVerified:!1,...d},data:c}},options:a}},paybin:a=>{let b=a.issuer||"https://idp.paybin.io",c=`${b}/oauth2/authorize`,d=`${b}/oauth2/token`;return{id:"paybin",name:"Paybin",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f,loginHint:g}){if(!a.clientId||!a.clientSecret)throw aL.i.error("Client Id and Client Secret is required for Paybin. Make sure to provide them in the options."),new bb.t("CLIENT_ID_AND_SECRET_REQUIRED");if(!e)throw new bb.t("codeVerifier is required for Paybin");let h=a.disableDefaultScope?[]:["openid","email","profile"];return a.scope&&h.push(...a.scope),d&&h.push(...d),await a8({id:"paybin",options:a,authorizationEndpoint:c,scopes:h,state:b,codeVerifier:e,redirectURI:f,prompt:a.prompt,loginHint:g})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>ba({code:b,codeVerifier:c,redirectURI:e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=bp(b.idToken),d=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.preferred_username||(c.email?c.email.split("@")[0]:"User")||"User",email:c.email,image:c.picture,emailVerified:c.email_verified||!1,...d},data:c}},options:a}},paypal:a=>{let b="sandbox"===(a.environment||"sandbox"),c=b?"https://www.sandbox.paypal.com/signin/authorize":"https://www.paypal.com/signin/authorize",d=b?"https://api-m.sandbox.paypal.com/v1/oauth2/token":"https://api-m.paypal.com/v1/oauth2/token",e=b?"https://api-m.sandbox.paypal.com/v1/identity/oauth2/userinfo":"https://api-m.paypal.com/v1/identity/oauth2/userinfo";return{id:"paypal",name:"PayPal",async createAuthorizationURL({state:b,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw aL.i.error("Client Id and Client Secret is required for PayPal. Make sure to provide them in the options."),new bb.t("CLIENT_ID_AND_SECRET_REQUIRED");return await a8({id:"paypal",options:a,authorizationEndpoint:c,scopes:[],state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let e=_.base64.encode(`${a.clientId}:${a.clientSecret}`);try{let a=await a5(d,{method:"POST",headers:{Authorization:`Basic ${e}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:c}).toString()});if(!a.data)throw new bb.t("FAILED_TO_GET_ACCESS_TOKEN");let f=a.data;return{accessToken:f.access_token,refreshToken:f.refresh_token,accessTokenExpiresAt:f.expires_in?new Date(Date.now()+1e3*f.expires_in):void 0,idToken:f.id_token}}catch(a){throw aL.i.error("PayPal token exchange failed:",a),new bb.t("FAILED_TO_GET_ACCESS_TOKEN")}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=_.base64.encode(`${a.clientId}:${a.clientSecret}`);try{let a=await a5(d,{method:"POST",headers:{Authorization:`Basic ${c}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:b}).toString()});if(!a.data)throw new bb.t("FAILED_TO_REFRESH_ACCESS_TOKEN");let e=a.data;return{accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?new Date(Date.now()+1e3*e.expires_in):void 0}}catch(a){throw aL.i.error("PayPal token refresh failed:",a),new bb.t("FAILED_TO_REFRESH_ACCESS_TOKEN")}},async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{return!!bp(b).sub}catch(a){return aL.i.error("Failed to verify PayPal ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return aL.i.error("Access token is required to fetch PayPal user info"),null;try{let c=await a5(`${e}?schema=paypalv1.1`,{headers:{Authorization:`Bearer ${b.accessToken}`,Accept:"application/json"}});if(!c.data)return aL.i.error("Failed to fetch user info from PayPal"),null;let d=c.data,f=await a.mapProfileToUser?.(d);return{user:{id:d.user_id,name:d.name,email:d.email,image:d.picture,emailVerified:d.email_verified,...f},data:d}}catch(a){return aL.i.error("Failed to fetch user info from PayPal:",a),null}},options:a}},polar:a=>({id:"polar",name:"Polar",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),a8({id:"polar",options:a,authorizationEndpoint:"https://polar.sh/oauth2/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>ba({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.polar.sh/v1/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>a9({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.polar.sh/v1/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://api.polar.sh/v1/oauth2/userinfo",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.public_name||c.username,email:c.email,image:c.avatar_url,emailVerified:c.email_verified??!1,...e},data:c}},options:a}),vercel:a=>({id:"vercel",name:"Vercel",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f;if(!d)throw new bb.t("codeVerifier is required for Vercel");return(void 0!==a.scope||void 0!==c)&&(f=[],a.scope&&f.push(...a.scope),c&&f.push(...c)),a8({id:"vercel",options:a,authorizationEndpoint:"https://vercel.com/oauth/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>ba({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.vercel.com/login/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await a5("https://api.vercel.com/login/oauth/userinfo",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name??c.preferred_username,email:c.email,image:c.picture,emailVerified:c.email_verified??!1,...e},data:c}},options:a})},bv=Object.keys(bu),bw=C.enum(bv).or(C.string());function bx(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.iterator in a)&&(!(Symbol.toStringTag in a)||"[object Module]"===Object.prototype.toString.call(a))}function by(a){return(...b)=>b.reduce((b,c)=>(function a(b,c,d=".",e){if(!bx(c))return a(b,{},d,e);let f=Object.assign({},c);for(let c in b){if("__proto__"===c||"constructor"===c)continue;let g=b[c];null!=g&&(e&&e(f,c,g,d)||(Array.isArray(g)&&Array.isArray(f[c])?f[c]=[...g,...f[c]]:bx(g)&&bx(f[c])?f[c]=a(g,f[c],(d?`${d}.`:"")+c.toString(),e):f[c]=g))}return f})(b,c,"",a),{})}let bz=by();function bA(a){return"-"===a||"^"===a||"$"===a||"+"===a||"."===a||"("===a||")"===a||"|"===a||"["===a||"]"===a||"{"===a||"}"===a||"*"===a||"?"===a||"\\"===a?`\\${a}`:a}function bB(a,b){if("string"!=typeof b)throw TypeError(`Sample must be a string, but ${typeof b} given`);return a.test(b)}function bC(a,b){if("string"!=typeof a&&!Array.isArray(a))throw TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof a} given`);if(("string"==typeof b||"boolean"==typeof b)&&(b={separator:b}),2==arguments.length&&!(void 0===b||"object"==typeof b&&null!==b&&!Array.isArray(b)))throw TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof b} given`);if("\\"===(b=b||{}).separator)throw Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let c=function a(b,c=!0){if(Array.isArray(b))return`(?:${b.map(b=>`^${a(b,c)}$`).join("|")})`;let d="",e="",f=".";!0===c?(d="/",e="[/\\\\]",f="[^/\\\\]"):c&&((e=function(a){let b="";for(let c=0;c<a.length;c++)b+=bA(a[c]);return b}(d=c)).length>1?(e=`(?:${e})`,f=`((?!${e}).)`):f=`[^${e}]`);let g=c?`${e}+?`:"",h=c?`${e}*?`:"",i=c?b.split(d):[b],j="";for(let a=0;a<i.length;a++){let b=i[a],d=i[a+1],e="";if(b||!(a>0)){if(c&&(e=a===i.length-1?h:"**"!==d?g:""),c&&"**"===b){e&&(j+=0===a?"":e,j+=`(?:${f}*?${e})*?`);continue}for(let a=0;a<b.length;a++){let c=b[a];"\\"===c?a<b.length-1&&(j+=bA(b[a+1]),a++):"?"===c?j+=f:"*"===c?j+=`${f}*?`:j+=bA(c)}j+=e}}return j}(a,b.separator),d=RegExp(`^${c}$`,b.flags),e=bB.bind(null,d);return e.options=b,e.pattern=a,e.regexp=d,e}by((a,b,c)=>{if(void 0!==a[b]&&"function"==typeof c)return a[b]=c(a[b]),!0}),by((a,b,c)=>{if(Array.isArray(a[b])&&"function"==typeof c)return a[b]=c(a[b]),!0});let bD=av(async a=>{if(a.request?.method==="GET"||a.request?.method==="OPTIONS"||a.request?.method==="HEAD"||!a.request)return;let b=a.request?.headers,c=a.request,{body:d,query:e,context:f}=a,g=b?.get("origin")||b?.get("referer")||"",h=d?.callbackURL||e?.callbackURL,i=d?.redirectTo,j=d?.errorCallbackURL,k=d?.newUserCallbackURL,l=Array.isArray(f.options.trustedOrigins)?f.trustedOrigins:[...f.trustedOrigins,...await f.options.trustedOrigins?.(c)||[]],m=b?.has("cookie"),n=(b,c)=>{if(b&&!l.some(a=>((a,b)=>{if(a.startsWith("/"))return!1;if(b.includes("*")){if(b.includes("://"))return bC(b)(W(a)||a);let c=Y(a);return!!c&&bC(b)(c)}let c=X(a);return"http:"!==c&&"https:"!==c&&c?a.startsWith(b):b===W(a)})(b,a)||b?.startsWith("/")&&"origin"!==c&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(b)))throw a.context.logger.error(`Invalid ${c}: ${b}`),a.context.logger.info(`If it's a valid URL, please add ${b} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${l}`),new r.APIError("FORBIDDEN",{message:`Invalid ${c}`})};if(m&&!a.context.skipCSRFCheck&&!a.context.skipOriginCheck){if(!g||"null"===g)throw new r.APIError("FORBIDDEN",{message:"Missing or null Origin"});n(g,"origin")}h&&n(h,"callbackURL"),i&&n(i,"redirectURL"),j&&n(j,"errorCallbackURL"),k&&n(k,"newUserCallbackURL")}),bE=a=>av(async b=>{if(!b.request)return;let{context:c}=b,d=a(b),e=Array.isArray(c.options.trustedOrigins)?c.trustedOrigins:[...c.trustedOrigins,...await c.options.trustedOrigins?.(b.request)||[]],f=(a,c)=>{if(a&&!e.some(b=>((a,b)=>{if(a.startsWith("/"))return!1;if(b.includes("*")){if(b.includes("://"))return bC(b)(W(a)||a);let c=Y(a);return!!c&&bC(b)(c)}let c=X(a);return"http:"!==c&&"https:"!==c&&c?a.startsWith(b):b===W(a)})(a,b)||a?.startsWith("/")&&"origin"!==c&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(a)))throw b.context.logger.error(`Invalid ${c}: ${a}`),b.context.logger.info(`If it's a valid URL, please add ${a} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${e}`),new r.APIError("FORBIDDEN",{message:`Invalid ${c}`})};for(let a of Array.isArray(d)?d:[d])f(a,"callbackURL")}),bF=new Map;async function bG(a,b){if(!b.rateLimit.enabled)return;let c=new URL(a.url).pathname.replace(b.options.basePath||"/api/auth",""),d=b.rateLimit.window,e=b.rateLimit.max,f=D(a,b.options);if(!f)return;let g=f+c,h=[{pathMatcher:a=>a.startsWith("/sign-in")||a.startsWith("/sign-up")||a.startsWith("/change-password")||a.startsWith("/change-email"),window:10,max:3}].find(a=>a.pathMatcher(c));for(let a of(h&&(d=h.window,e=h.max),b.options.plugins||[]))if(a.rateLimit){let b=a.rateLimit.find(a=>a.pathMatcher(c));if(b){d=b.window,e=b.max;break}}if(b.rateLimit.customRules){let f=Object.keys(b.rateLimit.customRules).find(a=>a.includes("*")?bC(a)(c):a===c);if(f){let c=b.rateLimit.customRules[f],g="function"==typeof c?await c(a):c;if(g&&(d=g.window,e=g.max),!1===g)return}}let i=function(a,b){let c,d;if(a.options.rateLimit?.customStorage)return a.options.rateLimit.customStorage;let e=a.rateLimit.storage;return"secondary-storage"===e?{get:async b=>{let c=await a.options.secondaryStorage?.get(b);return c?(0,E.t)(c):void 0},set:async(c,d,e)=>{let f=b?.window??a.options.rateLimit?.window??10;await a.options.secondaryStorage?.set?.(c,JSON.stringify(d),f)}}:"memory"===e?{get:async a=>bF.get(a),async set(a,b,c){bF.set(a,b)}}:(c="rateLimit",d=a.adapter,{get:async a=>{let b=(await d.findMany({model:c,where:[{field:"key",value:a}]}))[0];return"bigint"==typeof b?.lastRequest&&(b.lastRequest=Number(b.lastRequest)),b},set:async(b,e,f)=>{try{f?await d.updateMany({model:c,where:[{field:"key",value:b}],update:{count:e.count,lastRequest:e.lastRequest}}):await d.create({model:c,data:{key:b,count:e.count,lastRequest:e.lastRequest}})}catch(b){a.logger.error("Error setting rate limit",b)}}})}(b,{window:d}),j=await i.get(g),k=Date.now();if(j){var l,m,n;let a=k-j.lastRequest;if(l=e,m=d,Date.now()-j.lastRequest<1e3*m&&j.count>=l)return n=Math.ceil((j.lastRequest+1e3*d-Date.now())/1e3),new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":n.toString()}});a>1e3*d?await i.set(g,{...j,count:1,lastRequest:k},!0):await i.set(g,{...j,count:j.count+1,lastRequest:k},!0)}else await i.set(g,{key:g,count:1,lastRequest:k})}function bH(a,b){return a&&b.options.account?.encryptOAuthTokens?(0,T.t)({key:b.secret,data:a}):a}function bI(a,b){return b.options.account?.encryptOAuthTokens&&a?(0,T.n)({key:b.secret,data:a}):a}let bJ=ax("/list-accounts",{method:"GET",use:[aA],metadata:{openapi:{operationId:"listUserAccounts",description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},providerId:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"},accountId:{type:"string"},userId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","providerId","createdAt","updatedAt","accountId","userId","scopes"]}}}}}}}}},async a=>{let b=a.context.session,c=await a.context.internalAdapter.findAccounts(b.user.id);return a.json(c.map(a=>({id:a.id,providerId:a.providerId,createdAt:a.createdAt,updatedAt:a.updatedAt,accountId:a.accountId,userId:a.userId,scopes:a.scope?.split(",")||[]})))}),bK=ax("/link-social",{method:"POST",requireHeaders:!0,body:C.object({callbackURL:C.string().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:bw,idToken:C.object({token:C.string(),nonce:C.string().optional(),accessToken:C.string().optional(),refreshToken:C.string().optional(),scopes:C.array(C.string()).optional()}).optional(),requestSignUp:C.boolean().optional(),scopes:C.array(C.string()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:C.string().meta({description:"The URL to redirect to if there is an error during the link process"}).optional(),disableRedirect:C.boolean().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),additionalData:C.record(C.string(),C.any()).optional()}),use:[aA],metadata:{openapi:{description:"Link a social account to the user",operationId:"linkSocialAccount",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async a=>{let b=a.context.session,c=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!c)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new r.APIError("NOT_FOUND",{message:as.n.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!c.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new r.APIError("NOT_FOUND",{message:as.n.ID_TOKEN_NOT_SUPPORTED});let{token:d,nonce:e}=a.body.idToken;if(!await c.verifyIdToken(d,e))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new r.APIError("UNAUTHORIZED",{message:as.n.INVALID_TOKEN});let f=await c.getUserInfo({idToken:d,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!f||!f?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new r.APIError("UNAUTHORIZED",{message:as.n.FAILED_TO_GET_USER_INFO});let g=String(f.user.id);if(!f.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new r.APIError("UNAUTHORIZED",{message:as.n.USER_EMAIL_NOT_FOUND});if((await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>a.providerId===c.id&&a.accountId===g))return a.json({url:"",status:!0,redirect:!1});if(!a.context.options.account?.accountLinking?.trustedProviders?.includes(c.id)&&!f.user.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)throw new r.APIError("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(f.user.email!==b.user.email&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)throw new r.APIError("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await a.context.internalAdapter.createAccount({userId:b.user.id,providerId:c.id,accountId:g,accessToken:a.body.idToken.accessToken,idToken:d,refreshToken:a.body.idToken.refreshToken,scope:a.body.idToken.scopes?.join(",")})}catch(a){throw new r.APIError("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(a.context.options.account?.accountLinking?.updateUserInfoOnLink===!0)try{await a.context.internalAdapter.updateUser(b.user.id,{name:f.user?.name,image:f.user?.image})}catch(a){console.warn("Could not update user - "+a.toString())}return a.json({url:"",status:!0,redirect:!1})}let d=await (0,q.r)(a,{userId:b.user.id,email:b.user.email},a.body.additionalData),e=await c.createAuthorizationURL({state:d.state,codeVerifier:d.codeVerifier,redirectURI:`${a.context.baseURL}/callback/${c.id}`,scopes:a.body.scopes});return a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),bL=ax("/unlink-account",{method:"POST",body:C.object({providerId:C.string(),accountId:C.string().optional()}),use:[aC],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let{providerId:b,accountId:c}=a.body,d=await a.context.internalAdapter.findAccounts(a.context.session.user.id);if(1===d.length&&!a.context.options.account?.accountLinking?.allowUnlinkingAll)throw new r.APIError("BAD_REQUEST",{message:as.n.FAILED_TO_UNLINK_LAST_ACCOUNT});let e=d.find(a=>c?a.accountId===c&&a.providerId===b:a.providerId===b);if(!e)throw new r.APIError("BAD_REQUEST",{message:as.n.ACCOUNT_NOT_FOUND});return await a.context.internalAdapter.deleteAccount(e.id),a.json({status:!0})}),bM=ax("/get-access-token",{method:"POST",body:C.object({providerId:C.string().meta({description:"The provider ID for the OAuth provider"}),accountId:C.string().meta({description:"The account ID associated with the refresh token"}).optional(),userId:C.string().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let b,{providerId:c,accountId:d,userId:e}=a.body||{},f=a.request,g=await az(a);if(f&&!g)throw a.error("UNAUTHORIZED");let h=g?.user?.id||e;if(!h)throw a.error("UNAUTHORIZED");if(!a.context.socialProviders.find(a=>a.id===c))throw new r.APIError("BAD_REQUEST",{message:`Provider ${c} is not supported.`});let i=await am(a);if(!(b=i&&c===i.providerId&&(!d||i.id===d)?i:(await a.context.internalAdapter.findAccounts(h)).find(a=>d?a.id===d&&a.providerId===c:a.providerId===c)))throw new r.APIError("BAD_REQUEST",{message:"Account not found"});let j=a.context.socialProviders.find(a=>a.id===c);if(!j)throw new r.APIError("BAD_REQUEST",{message:`Provider ${c} not found.`});try{let c=null,d=b.accessTokenExpiresAt&&new Date(b.accessTokenExpiresAt).getTime()-Date.now()<5e3;if(b.refreshToken&&d&&j.refreshAccessToken){let d=await bH(b.refreshToken,a.context);c=await j.refreshAccessToken(d);let e=await a.context.internalAdapter.updateAccount(b.id,{accessToken:await bI(c.accessToken,a.context),accessTokenExpiresAt:c.accessTokenExpiresAt,refreshToken:await bI(c.refreshToken,a.context),refreshTokenExpiresAt:c.refreshTokenExpiresAt});a.context.options.account?.storeAccountCookie&&e&&await al(a,e)}let e={accessToken:c?.accessToken??await bH(b.accessToken??"",a.context),accessTokenExpiresAt:c?.accessTokenExpiresAt??b.accessTokenExpiresAt??void 0,scopes:b.scope?.split(",")??[],idToken:c?.idToken??b.idToken??void 0};return a.json(e)}catch(a){throw new r.APIError("BAD_REQUEST",{message:"Failed to get a valid access token",cause:a})}}),bN=ax("/refresh-token",{method:"POST",body:C.object({providerId:C.string().meta({description:"The provider ID for the OAuth provider"}),accountId:C.string().meta({description:"The account ID associated with the refresh token"}).optional(),userId:C.string().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let b,c,{providerId:d,accountId:e,userId:f}=a.body,g=a.request,h=await az(a);if(g&&!h)throw a.error("UNAUTHORIZED");let i=h?.user?.id||f;if(!i)throw new r.APIError("BAD_REQUEST",{message:"Either userId or session is required"});let j=a.context.socialProviders.find(a=>a.id===d);if(!j)throw new r.APIError("BAD_REQUEST",{message:`Provider ${d} not found.`});if(!j.refreshAccessToken)throw new r.APIError("BAD_REQUEST",{message:`Provider ${d} does not support token refreshing.`});let k=await am(a);if(!(b=k&&(!d||d===k?.providerId)?k:(await a.context.internalAdapter.findAccounts(i)).find(a=>e?a.id===e&&a.providerId===d:a.providerId===d)))throw new r.APIError("BAD_REQUEST",{message:"Account not found"});if(!(c=k&&d===k.providerId?k.refreshToken??void 0:b.refreshToken??void 0))throw new r.APIError("BAD_REQUEST",{message:"Refresh token not found"});try{let e=await bH(c,a.context),f=await j.refreshAccessToken(e);if(b.id){let c={...b||{},accessToken:await bI(f.accessToken,a.context),refreshToken:await bI(f.refreshToken,a.context),accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||b.scope,idToken:f.idToken||b.idToken};await a.context.internalAdapter.updateAccount(b.id,c)}return k&&d===k.providerId&&a.context.options.account?.storeAccountCookie&&await al(a,{...k,accessToken:await bI(f.accessToken,a.context),refreshToken:await bI(f.refreshToken,a.context),accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||k.scope,idToken:f.idToken||k.idToken}),a.json({accessToken:f.accessToken,refreshToken:f.refreshToken,accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||b.scope,idToken:f.idToken||b.idToken,providerId:b.providerId,accountId:b.accountId})}catch(a){throw new r.APIError("BAD_REQUEST",{message:"Failed to refresh access token",cause:a})}}),bO=ax("/account-info",{method:"GET",use:[aA],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},query:C.optional(C.object({accountId:C.string().meta({description:"The provider given account id for which to get the account info"}).optional()}))},async a=>{let b,c=a.query?.accountId;if(c){let d=await a.context.internalAdapter.findAccount(c);d&&(b=d)}else if(a.context.options.account?.storeAccountCookie){let c=await am(a);c&&(b=c)}if(!b||b.userId!==a.context.session.user.id)throw new r.APIError("BAD_REQUEST",{message:"Account not found"});let d=a.context.socialProviders.find(a=>a.id===b.providerId);if(!d)throw new r.APIError("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${b.providerId} but it is not configured`});let e=await bM({...a,method:"POST",body:{accountId:b.id,providerId:b.providerId},returnHeaders:!1,returnStatus:!1});if(!e.accessToken)throw new r.APIError("BAD_REQUEST",{message:"Access token not found"});let f=await d.getUserInfo({...e,accessToken:e.accessToken});return a.json(f)});async function bP(a,{userInfo:b,account:c,callbackURL:d,disableSignUp:e,overrideUserInfo:f}){let g=await a.context.internalAdapter.findOAuthUser(b.email.toLowerCase(),c.accountId,c.providerId).catch(b=>{J.logger.error("Better auth was unable to query your database.\nError: ",b);let c=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${c}?error=internal_server_error`)}),h=g?.user,i=!h;if(g){let d=g.accounts.find(a=>a.providerId===c.providerId&&a.accountId===c.accountId);if(d){if(a.context.options.account?.updateAccountOnSignIn!==!1){let b=Object.fromEntries(Object.entries({idToken:c.idToken,accessToken:await bI(c.accessToken,a.context),refreshToken:await bI(c.refreshToken,a.context),accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope}).filter(([a,b])=>void 0!==b));a.context.options.account?.storeAccountCookie&&await al(a,b),Object.keys(b).length>0&&await a.context.internalAdapter.updateAccount(d.id,b)}b.emailVerified&&!g.user.emailVerified&&b.email.toLowerCase()===g.user.email&&await a.context.internalAdapter.updateUser(g.user.id,{emailVerified:!0})}else{if(!a.context.options.account?.accountLinking?.trustedProviders?.includes(c.providerId)&&!b.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return(0,A.d)()&&J.logger.warn(`User already exist but account isn't linked to ${c.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await a.context.internalAdapter.linkAccount({providerId:c.providerId,accountId:b.id.toString(),userId:g.user.id,accessToken:await bI(c.accessToken,a.context),refreshToken:await bI(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope})}catch(a){return J.logger.error("Unable to link account",a),{error:"unable to link account",data:null}}b.emailVerified&&!g.user.emailVerified&&b.email.toLowerCase()===g.user.email&&await a.context.internalAdapter.updateUser(g.user.id,{emailVerified:!0})}if(f){let{id:c,...d}=b;h=await a.context.internalAdapter.updateUser(g.user.id,{...d,email:b.email.toLowerCase(),emailVerified:b.email.toLowerCase()===g.user.email&&g.user.emailVerified||b.emailVerified})}}else{if(e)return{error:"signup disabled",data:null,isRegister:!1};try{let{id:e,...f}=b,g={accessToken:await bI(c.accessToken,a.context),refreshToken:await bI(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope,providerId:c.providerId,accountId:b.id.toString()},{user:i,account:j}=await a.context.internalAdapter.createOAuthUser({...f,email:b.email.toLowerCase()},g);if(h=i,a.context.options.account?.storeAccountCookie&&await al(a,j),!b.emailVerified&&h&&a.context.options.emailVerification?.sendOnSignUp){let b=await bS(a.context.secret,h.email,void 0,a.context.options.emailVerification?.expiresIn),c=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${d}`;await a.context.options.emailVerification?.sendVerificationEmail?.({user:h,url:c,token:b},a.request)}}catch(a){if(J.logger.error(a),a instanceof r.APIError)return{error:a.message,data:null,isRegister:!1};return{error:"unable to create user",data:null,isRegister:!1}}}if(!h)return{error:"unable to create user",data:null,isRegister:!1};let j=await a.context.internalAdapter.createSession(h.id);return j?{data:{session:j,user:h},error:null,isRegister:i}:{error:"unable to create session",data:null,isRegister:!1}}let bQ=C.object({code:C.string().optional(),error:C.string().optional(),device_id:C.string().optional(),error_description:C.string().optional(),state:C.string().optional(),user:C.string().optional()}),bR=ax("/callback/:id",{method:["GET","POST"],operationId:"handleOAuthCallback",body:bQ.optional(),query:bQ.optional(),metadata:{...q.n,allowedMediaTypes:["application/x-www-form-urlencoded","application/json"]}},async a=>{let b,c,d,e=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;if("POST"===a.method){let b=a.body?bQ.parse(a.body):{},c=a.query?bQ.parse(a.query):{},d=bQ.parse({...b,...c}),e=new URLSearchParams;for(let[a,b]of Object.entries(d))null!=b&&e.set(a,String(b));let f=`${a.context.baseURL}/callback/${a.params.id}?${e.toString()}`;throw a.redirect(f)}try{if("GET"===a.method)b=bQ.parse(a.query);else if("POST"===a.method)b=bQ.parse(a.body);else throw Error("Unsupported method")}catch(b){throw a.context.logger.error("INVALID_CALLBACK_REQUEST",b),a.redirect(`${e}?error=invalid_callback_request`)}let{code:f,error:g,state:h,error_description:i,device_id:j}=b;if(!h){a.context.logger.error("State not found",g);let b=`${e}${e.includes("?")?"&":"?"}state=state_not_found`;throw a.redirect(b)}let{codeVerifier:k,callbackURL:l,link:m,errorURL:n,newUserURL:o,requestSignUp:p}=await (0,q.i)(a);function r(b,c){let d=n??e,f=new URLSearchParams({error:b});c&&f.set("error_description",c);let g=`${d}${d.includes("?")?"&":"?"}${f.toString()}`;throw a.redirect(g)}if(g&&r(g,i),!f)throw a.context.logger.error("Code not found"),r("no_code");let s=a.context.socialProviders.find(b=>b.id===a.params.id);if(!s)throw a.context.logger.error("Oauth provider with id",a.params.id,"not found"),r("oauth_provider_not_found");try{c=await s.validateAuthorizationCode({code:f,codeVerifier:k,deviceId:j,redirectURI:`${a.context.baseURL}/callback/${s.id}`})}catch(b){throw a.context.logger.error("",b),r("invalid_code")}let t=await s.getUserInfo({...c,user:a.body?.user?(0,E.t)(a.body.user):void 0}).then(a=>a?.user);if(!t)return a.context.logger.error("Unable to get user info"),r("unable_to_get_user_info");if(!l)throw a.context.logger.error("No callback URL found"),r("no_callback_url");if(m){let b;if(!a.context.options.account?.accountLinking?.trustedProviders?.includes(s.id)&&!t.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return a.context.logger.error("Unable to link account - untrusted provider"),r("unable_to_link_account");if(t.email!==m.email&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)return r("email_doesn't_match");let d=await a.context.internalAdapter.findAccount(String(t.id));if(d){if(d.userId.toString()!==m.userId.toString())return r("account_already_linked_to_different_user");let b=Object.fromEntries(Object.entries({accessToken:await bI(c.accessToken,a.context),refreshToken:await bI(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scopes?.join(",")}).filter(([a,b])=>void 0!==b));await a.context.internalAdapter.updateAccount(d.id,b)}else if(!await a.context.internalAdapter.createAccount({userId:m.userId,providerId:s.id,accountId:String(t.id),...c,accessToken:await bI(c.accessToken,a.context),refreshToken:await bI(c.refreshToken,a.context),scope:c.scopes?.join(",")}))return r("unable_to_link_account");try{b=l.toString()}catch{b=l}throw a.redirect(b)}if(!t.email)return a.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),r("email_not_found");let u={providerId:s.id,accountId:String(t.id),...c,scope:c.scopes?.join(",")},v=await bP(a,{userInfo:{...t,id:String(t.id),email:t.email,name:t.name||t.email},account:u,callbackURL:l,disableSignUp:s.disableImplicitSignUp&&!p||s.options?.disableSignUp,overrideUserInfo:s.options?.overrideUserInfoOnSignIn});if(v.error)return a.context.logger.error(v.error.split(" ").join("_")),r(v.error.split(" ").join("_"));let{session:w,user:x}=v.data;await aq(a,{session:w,user:x});try{d=(v.isRegister&&o||l).toString()}catch{d=v.isRegister&&o||l}throw a.redirect(d)});async function bS(a,b,c,d=3600,e){return await (0,T.o)({email:b.toLowerCase(),updateTo:c,...e},a,d)}async function bT(a,b){if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new r.APIError("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await bS(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),d=a.body.callbackURL?encodeURIComponent(a.body.callbackURL):encodeURIComponent("/"),e=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${d}`;await a.context.options.emailVerification.sendVerificationEmail({user:b,url:e,token:c},a.request)}let bU=ax("/send-verification-email",{method:"POST",operationId:"sendVerificationEmail",body:C.object({email:C.email().meta({description:"The email to send the verification email to"}),callbackURL:C.string().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{operationId:"sendVerificationEmail",description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async a=>{if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new r.APIError("BAD_REQUEST",{message:"Verification email isn't enabled"});let{email:b}=a.body,c=await az(a);if(!c){let c=await a.context.internalAdapter.findUserByEmail(b);return c?await bT(a,c.user):await bS(a.context.secret,b,void 0,a.context.options.emailVerification?.expiresIn),a.json({status:!0})}if(c?.user.emailVerified)throw new r.APIError("BAD_REQUEST",{message:"You can only send a verification email to an unverified email"});if(c?.user.email!==b)throw new r.APIError("BAD_REQUEST",{message:"You can only send a verification email to your own email"});return await bT(a,c.user),a.json({status:!0})}),bV=ax("/verify-email",{method:"GET",operationId:"verifyEmail",query:C.object({token:C.string().meta({description:"The token to verify the email"}),callbackURL:C.string().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[bE(a=>a.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async a=>{let b;function c(b){if(a.query.callbackURL){if(a.query.callbackURL.includes("?"))throw a.redirect(`${a.query.callbackURL}&error=${b}`);throw a.redirect(`${a.query.callbackURL}?error=${b}`)}throw new r.APIError("UNAUTHORIZED",{message:b})}let{token:d}=a.query;try{b=await (0,aK.jwtVerify)(d,new TextEncoder().encode(a.context.secret),{algorithms:["HS256"]})}catch(a){if(a instanceof bc.JWTExpired)return c("token_expired");return c("invalid_token")}let e=C.object({email:C.email(),updateTo:C.string().optional(),requestType:C.string().optional()}).parse(b.payload),f=await a.context.internalAdapter.findUserByEmail(e.email);if(!f)return c("user_not_found");if(e.updateTo){let b=await az(a);if(b&&b.user.email!==e.email)return c("unauthorized");if("change-email-confirmation"===e.requestType){let b=await bS(a.context.secret,e.email,e.updateTo,a.context.options.emailVerification?.expiresIn,{requestType:"change-email-verification"}),c=a.query.callbackURL?encodeURIComponent(a.query.callbackURL):encodeURIComponent("/"),d=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${c}`;if(await a.context.options.emailVerification?.sendVerificationEmail?.({user:{...f.user,email:e.updateTo},url:d,token:b},a.request),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0})}if(!b){let c=await a.context.internalAdapter.createSession(f.user.id);if(!c)throw new r.APIError("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});b={session:c,user:f.user}}if("change-email-verification"===e.requestType){let c=await a.context.internalAdapter.updateUserByEmail(e.email,{email:e.updateTo,emailVerified:!0});if(await aq(a,{session:b.session,user:{...b.user,email:e.updateTo,emailVerified:!0}}),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:c})}let d=await a.context.internalAdapter.updateUserByEmail(e.email,{email:e.updateTo,emailVerified:!1}),g=await bS(a.context.secret,e.updateTo),h=a.query.callbackURL?encodeURIComponent(a.query.callbackURL):encodeURIComponent("/");if(await a.context.options.emailVerification?.sendVerificationEmail?.({user:d,url:`${a.context.baseURL}/verify-email?token=${g}&callbackURL=${h}`,token:g},a.request),await aq(a,{session:b.session,user:{...b.user,email:e.updateTo,emailVerified:!1}}),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:{id:d.id,email:d.email,name:d.name,image:d.image,emailVerified:d.emailVerified,createdAt:d.createdAt,updatedAt:d.updatedAt}})}if(f.user.emailVerified){if(a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:null})}a.context.options.emailVerification?.onEmailVerification&&await a.context.options.emailVerification.onEmailVerification(f.user,a.request);let g=await a.context.internalAdapter.updateUserByEmail(e.email,{emailVerified:!0});if(a.context.options.emailVerification?.afterEmailVerification&&await a.context.options.emailVerification.afterEmailVerification(g,a.request),a.context.options.emailVerification?.autoSignInAfterVerification){let b=await az(a);if(b&&b.user.email===e.email)await aq(a,{session:b.session,user:{...b.user,emailVerified:!0}});else{let b=await a.context.internalAdapter.createSession(f.user.id);if(!b)throw new r.APIError("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await aq(a,{session:b,user:{...f.user,emailVerified:!0}})}}if(a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:null})});function bW(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/&(?!amp;|lt;|gt;|quot;|#39;|#x[0-9a-fA-F]+;|#[0-9]+;)/g,"&amp;")}let bX=ax("/error",{method:"GET",metadata:{...q.n,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async a=>{let b=new URL(a.request?.url||""),c=b.searchParams.get("error")||"UNKNOWN",d=b.searchParams.get("error_description")||null,e=/^[\'A-Za-z0-9_-]+$/.test(c||"")?c:"UNKNOWN",f=d?bW(d):null,g=new URLSearchParams;g.set("error",e),d&&g.set("error_description",d);let h=a.context.options,i=h.onAPIError?.errorURL;return i?new Response(null,{status:302,headers:{Location:`${i}${i.includes("?")?"&":"?"}${g.toString()}`}}):$.f&&!h.onAPIError?.customizeDefaultErrorPage?new Response(null,{status:302,headers:{Location:`/?${g.toString()}`}}):new Response(((a,b="Unknown",c=null)=>{let d=a.onAPIError?.customizeDefaultErrorPage;return`<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Error</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: ${d?.font?.defaultFamily||"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif"};
        background: ${d?.colors?.background||"var(--background)"};
        color: var(--foreground);
        margin: 0;
      }
      :root,
      :host {
        --spacing: 0.25rem;
        --container-md: 28rem;
        --text-sm: ${d?.size?.textSm||"0.875rem"};
        --text-sm--line-height: calc(1.25 / 0.875);
        --text-2xl: ${d?.size?.text2xl||"1.5rem"};
        --text-2xl--line-height: calc(2 / 1.5);
        --text-4xl: ${d?.size?.text4xl||"2.25rem"};
        --text-4xl--line-height: calc(2.5 / 2.25);
        --text-6xl: ${d?.size?.text6xl||"3rem"};
        --text-6xl--line-height: 1;
        --font-weight-medium: 500;
        --font-weight-semibold: 600;
        --font-weight-bold: 700;
        --default-transition-duration: 150ms;
        --default-transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        --radius: ${d?.size?.radiusSm||"0.625rem"};
        --default-mono-font-family: ${d?.font?.monoFamily||"var(--font-geist-mono)"};
        --primary: ${d?.colors?.primary||"black"};
        --primary-foreground: ${d?.colors?.primaryForeground||"white"};
        --background: ${d?.colors?.background||"white"};
        --foreground: ${d?.colors?.foreground||"oklch(0.271 0 0)"};
        --border: ${d?.colors?.border||"oklch(0.89 0 0)"};
        --destructive: ${d?.colors?.destructive||"oklch(0.55 0.15 25.723)"};
        --muted-foreground: ${d?.colors?.mutedForeground||"oklch(0.545 0 0)"};
        --corner-border: ${d?.colors?.cornerBorder||"#404040"};
      }

      button, .btn {
        cursor: pointer;
        background: none;
        border: none;
        color: inherit;
        font: inherit;
        transition: all var(--default-transition-duration)
          var(--default-transition-timing-function);
      }
      button:hover, .btn:hover {
        opacity: 0.8;
      }

      @media (prefers-color-scheme: dark) {
        :root,
        :host {
          --primary: ${d?.colors?.primary||"white"};
          --primary-foreground: ${d?.colors?.primaryForeground||"black"};
          --background: ${d?.colors?.background||"oklch(0.15 0 0)"};
          --foreground: ${d?.colors?.foreground||"oklch(0.98 0 0)"};
          --border: ${d?.colors?.border||"oklch(0.27 0 0)"};
          --destructive: ${d?.colors?.destructive||"oklch(0.65 0.15 25.723)"};
          --muted-foreground: ${d?.colors?.mutedForeground||"oklch(0.65 0 0)"};
          --corner-border: ${d?.colors?.cornerBorder||"#a0a0a0"};
        }
      }
      @media (max-width: 640px) {
        :root, :host {
          --text-6xl: 2.5rem;
          --text-2xl: 1.25rem;
          --text-sm: 0.8125rem;
        }
      }
      @media (max-width: 480px) {
        :root, :host {
          --text-6xl: 2rem;
          --text-2xl: 1.125rem;
        }
      }
    </style>
  </head>
  <body style="width: 100vw; min-height: 100vh; overflow-x: hidden; overflow-y: auto;">
    <div
        style="
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            position: relative;
            width: 100%;
            min-height: 100vh;
            padding: 1rem;
        "
        >
${d?.disableBackgroundGrid?"":`
      <div
        style="
          position: absolute;
          inset: 0;
          background-image: linear-gradient(to right, ${d?.colors?.gridColor||"var(--border)"} 1px, transparent 1px),
            linear-gradient(to bottom, ${d?.colors?.gridColor||"var(--border)"} 1px, transparent 1px);
          background-size: 40px 40px;
          opacity: 0.6;
          pointer-events: none;
          width: 100vw;
          height: 100vh;
        "
      ></div>
      <div
        style="
          position: absolute;
          inset: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          background: ${d?.colors?.background||"var(--background)"};
          mask-image: radial-gradient(ellipse at center, transparent 20%, black);
          -webkit-mask-image: radial-gradient(ellipse at center, transparent 20%, black);
          pointer-events: none;
        "
      ></div>
`}

<div
  style="
    position: relative;
    z-index: 10;
    border: 2px solid var(--border);
    background: ${d?.colors?.cardBackground||"var(--background)"};
    padding: 1.5rem;
    max-width: 42rem;
    width: 100%;
  "
>
    ${d?.disableCornerDecorations?"":`
        <!-- Corner decorations -->
        <div
          style="
            position: absolute;
            top: -2px;
            left: -2px;
            width: 2rem;
            height: 2rem;
            border-top: 4px solid var(--corner-border);
            border-left: 4px solid var(--corner-border);
          "
        ></div>
        <div
          style="
            position: absolute;
            top: -2px;
            right: -2px;
            width: 2rem;
            height: 2rem;
            border-top: 4px solid var(--corner-border);
            border-right: 4px solid var(--corner-border);
          "
        ></div>
  
        <div
          style="
            position: absolute;
            bottom: -2px;
            left: -2px;
            width: 2rem;
            height: 2rem;
            border-bottom: 4px solid var(--corner-border);
            border-left: 4px solid var(--corner-border);
          "
        ></div>
        <div
          style="
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 2rem;
            height: 2rem;
            border-bottom: 4px solid var(--corner-border);
            border-right: 4px solid var(--corner-border);
          "
        ></div>`}

        <div style="text-align: center; margin-bottom: 1.5rem;">
          <div style="margin-bottom: 1.5rem;">
            <div
              style="
                display: inline-block;
                border: 2px solid ${d?.disableTitleBorder?"transparent":d?.colors?.titleBorder||"var(--destructive)"};
                padding: 0.375rem 1rem;
              "
            >
              <h1
                style="
                  font-size: var(--text-6xl);
                  font-weight: var(--font-weight-semibold);
                  color: ${d?.colors?.titleColor||"var(--foreground)"};
                  letter-spacing: -0.02em;
                  margin: 0;
                "
              >
                ERROR
              </h1>
            </div>
            <div
              style="
                height: 2px;
                background-color: var(--border);
                width: calc(100% + 3rem);
                margin-left: -1.5rem;
                margin-top: 1.5rem;
              "
            ></div>
          </div>

          <h2
            style="
              font-size: var(--text-2xl);
              font-weight: var(--font-weight-semibold);
              color: var(--foreground);
              margin: 0 0 1rem;
            "
          >
            Something went wrong
          </h2>

          <div
            style="
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                border: 2px solid var(--border);
                background-color: var(--muted);
                padding: 0.375rem 0.75rem;
                margin: 0 0 1rem;
                flex-wrap: wrap;
                justify-content: center;
            "
            >
            <span
                style="
                font-size: 0.75rem;
                color: var(--muted-foreground);
                font-weight: var(--font-weight-semibold);
                "
            >
                CODE:
            </span>
            <span
                style="
                font-size: var(--text-sm);
                font-family: var(--default-mono-font-family, monospace);
                color: var(--foreground);
                word-break: break-all;
                "
            >
                ${bW(b)}
            </span>
            </div>

          <p
            style="
              color: var(--muted-foreground);
              max-width: 28rem;
              margin: 0 auto;
              font-size: var(--text-sm);
              line-height: 1.5;
              text-wrap: pretty;
            "
          >
            ${!c?`We encountered an unexpected error. Please try again or return to the home page. If you're a developer, you can find more information about the error <a href='https://better-auth.com/docs/errors/${encodeURIComponent(b)}' target='_blank' rel="noopener noreferrer" style='color: var(--foreground); text-decoration: underline;'>here</a>.`:c}
          </p>
        </div>

        <div
          style="
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
          "
        >
          <a
            href="/"
            style="
              text-decoration: none;
            "
          >
            <div
              style="
                border: 2px solid var(--border);
                background: var(--primary);
                color: var(--primary-foreground);
                padding: 0.5rem 1rem;
                border-radius: 0;
                white-space: nowrap;
              "
              class="btn"
            >
              Go Home
            </div>
          </a>
          <a
            href="https://better-auth.com/docs/errors/${encodeURIComponent(b)}?askai=${encodeURIComponent(`What does the error code ${b} mean?`)}"
            target="_blank"
            rel="noopener noreferrer"
            style="
              text-decoration: none;
            "
          >
            <div
              style="
                border: 2px solid var(--border);
                background: transparent;
                color: var(--foreground);
                padding: 0.5rem 1rem;
                border-radius: 0;
                white-space: nowrap;
              "
              class="btn"
            >
              Ask AI
            </div>
          </a>
        </div>
      </div>
    </div>
  </body>
</html>`})(a.context.options,e,f),{headers:{"Content-Type":"text/html"}})}),bY=ax("/ok",{method:"GET",metadata:{...q.n,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async a=>a.json({ok:!0}));function bZ(a,b,c){let d=b?new URL(b,a.baseURL):new URL(`${a.baseURL}/error`);return c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href}let b$=ax("/request-password-reset",{method:"POST",body:C.object({email:C.email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:C.string().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{operationId:"requestPasswordReset",description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.emailAndPassword?.sendResetPassword)throw a.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new r.APIError("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:b,redirectTo:c}=a.body,d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)return(0,q.t)(24),await a.context.internalAdapter.findVerificationValue("dummy-verification-token"),a.context.logger.error("Reset Password: User not found",{email:b}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let e=s(a.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),f=(0,q.t)(24);await a.context.internalAdapter.createVerificationValue({value:d.user.id,identifier:`reset-password:${f}`,expiresAt:e});let g=c?encodeURIComponent(c):"",h=`${a.context.baseURL}/reset-password/${f}?callbackURL=${g}`;return await a.context.options.emailAndPassword.sendResetPassword({user:d.user,url:h,token:f},a.request).catch(b=>{a.context.logger.error("Failed to send reset password email",b)}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"})}),b_=ax("/reset-password/:token",{method:"GET",operationId:"forgetPasswordCallback",query:C.object({callbackURL:C.string().meta({description:"The URL to redirect the user to reset their password"})}),use:[bE(a=>a.query.callbackURL)],metadata:{openapi:{operationId:"resetPasswordCallback",description:"Redirects the user to the callback URL with the token",parameters:[{name:"token",in:"path",required:!0,description:"The token to reset the password",schema:{type:"string"}},{name:"callbackURL",in:"query",required:!0,description:"The URL to redirect the user to reset their password",schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async a=>{var b,c;let d,{token:e}=a.params,{callbackURL:f}=a.query;if(!e||!f)throw a.redirect(bZ(a.context,f,{error:"INVALID_TOKEN"}));let g=await a.context.internalAdapter.findVerificationValue(`reset-password:${e}`);if(!g||g.expiresAt<new Date)throw a.redirect(bZ(a.context,f,{error:"INVALID_TOKEN"}));throw a.redirect((b=a.context,c={token:e},d=new URL(f,b.baseURL),c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href))}),b0=ax("/reset-password",{method:"POST",operationId:"resetPassword",query:C.object({token:C.string().optional()}).optional(),body:C.object({newPassword:C.string().meta({description:"The new password to set"}),token:C.string().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{operationId:"resetPassword",description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let b=a.body.token||a.query?.token;if(!b)throw new r.APIError("BAD_REQUEST",{message:as.n.INVALID_TOKEN});let{newPassword:c}=a.body,d=a.context.password?.config.minPasswordLength,e=a.context.password?.config.maxPasswordLength;if(c.length<d)throw new r.APIError("BAD_REQUEST",{message:as.n.PASSWORD_TOO_SHORT});if(c.length>e)throw new r.APIError("BAD_REQUEST",{message:as.n.PASSWORD_TOO_LONG});let f=`reset-password:${b}`,g=await a.context.internalAdapter.findVerificationValue(f);if(!g||g.expiresAt<new Date)throw new r.APIError("BAD_REQUEST",{message:as.n.INVALID_TOKEN});let h=g.value,i=await a.context.password.hash(c);if((await a.context.internalAdapter.findAccounts(h)).find(a=>"credential"===a.providerId)?await a.context.internalAdapter.updatePassword(h,i):await a.context.internalAdapter.createAccount({userId:h,providerId:"credential",password:i,accountId:h}),await a.context.internalAdapter.deleteVerificationValue(g.id),a.context.options.emailAndPassword?.onPasswordReset){let b=await a.context.internalAdapter.findUserById(h);b&&await a.context.options.emailAndPassword.onPasswordReset({user:b},a.request)}return a.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await a.context.internalAdapter.deleteSessions(h),a.json({status:!0})}),b1=C.object({callbackURL:C.string().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:C.string().optional(),errorCallbackURL:C.string().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:bw,disableRedirect:C.boolean().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:C.optional(C.object({token:C.string().meta({description:"ID token from the provider"}),nonce:C.string().meta({description:"Nonce used to generate the token"}).optional(),accessToken:C.string().meta({description:"Access token from the provider"}).optional(),refreshToken:C.string().meta({description:"Refresh token from the provider"}).optional(),expiresAt:C.number().meta({description:"Expiry date of the token"}).optional()})),scopes:C.array(C.string()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:C.boolean().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:C.string().meta({description:"The login hint to use for the authorization code request"}).optional(),additionalData:C.record(C.string(),C.any()).optional().meta({description:"Additional data to be passed through the OAuth flow"})}),b2=ax("/sign-out",{method:"POST",operationId:"signOut",requireHeaders:!0,metadata:{openapi:{operationId:"signOut",description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async a=>{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(b)try{await a.context.internalAdapter.deleteSession(b)}catch(b){a.context.logger.error("Failed to delete session from database",b)}return ar(a),a.json({success:!0})}),b3=ax("/change-password",{method:"POST",operationId:"changePassword",body:C.object({newPassword:C.string().meta({description:"The new password to set"}),currentPassword:C.string().meta({description:"The current password is required"}),revokeOtherSessions:C.boolean().meta({description:"Must be a boolean value"}).optional()}),use:[aB],metadata:{openapi:{operationId:"changePassword",description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async a=>{let{newPassword:b,currentPassword:c,revokeOtherSessions:d}=a.body,e=a.context.session,f=a.context.password.config.minPasswordLength;if(b.length<f)throw a.context.logger.error("Password is too short"),new r.APIError("BAD_REQUEST",{message:as.n.PASSWORD_TOO_SHORT});let g=a.context.password.config.maxPasswordLength;if(b.length>g)throw a.context.logger.error("Password is too long"),new r.APIError("BAD_REQUEST",{message:as.n.PASSWORD_TOO_LONG});let h=(await a.context.internalAdapter.findAccounts(e.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!h||!h.password)throw new r.APIError("BAD_REQUEST",{message:as.n.CREDENTIAL_ACCOUNT_NOT_FOUND});let i=await a.context.password.hash(b);if(!await a.context.password.verify({hash:h.password,password:c}))throw new r.APIError("BAD_REQUEST",{message:as.n.INVALID_PASSWORD});await a.context.internalAdapter.updateAccount(h.id,{password:i});let j=null;if(d){await a.context.internalAdapter.deleteSessions(e.user.id);let b=await a.context.internalAdapter.createSession(e.user.id);if(!b)throw new r.APIError("INTERNAL_SERVER_ERROR",{message:as.n.FAILED_TO_GET_SESSION});await aq(a,{session:b,user:e.user}),j=b.token}return a.json({token:j,user:{id:e.user.id,email:e.user.email,name:e.user.name,image:e.user.image,emailVerified:e.user.emailVerified,createdAt:e.user.createdAt,updatedAt:e.user.updatedAt}})}),b4=ax("/set-password",{method:"POST",body:C.object({newPassword:C.string().meta({description:"The new password to set is required"})}),metadata:{SERVER_ONLY:!0},use:[aB]},async a=>{let{newPassword:b}=a.body,c=a.context.session,d=a.context.password.config.minPasswordLength;if(b.length<d)throw a.context.logger.error("Password is too short"),new r.APIError("BAD_REQUEST",{message:as.n.PASSWORD_TOO_SHORT});let e=a.context.password.config.maxPasswordLength;if(b.length>e)throw a.context.logger.error("Password is too long"),new r.APIError("BAD_REQUEST",{message:as.n.PASSWORD_TOO_LONG});let f=(await a.context.internalAdapter.findAccounts(c.user.id)).find(a=>"credential"===a.providerId&&a.password),g=await a.context.password.hash(b);if(!f)return await a.context.internalAdapter.linkAccount({userId:c.user.id,providerId:"credential",accountId:c.user.id,password:g}),a.json({status:!0});throw new r.APIError("BAD_REQUEST",{message:"user already has a password"})}),b5=ax("/delete-user",{method:"POST",use:[aB],body:C.object({callbackURL:C.string().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:C.string().meta({description:"The password of the user is required to delete the user"}).optional(),token:C.string().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{operationId:"deleteUser",description:"Delete the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{callbackURL:{type:"string",description:"The callback URL to redirect to after the user is deleted"},password:{type:"string",description:"The user's password. Required if session is not fresh"},token:{type:"string",description:"The deletion verification token"}}}}}},responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options"),new r.APIError("NOT_FOUND");let b=a.context.session;if(a.body.password){let c=(await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!c||!c.password)throw new r.APIError("BAD_REQUEST",{message:as.n.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await a.context.password.verify({hash:c.password,password:a.body.password}))throw new r.APIError("BAD_REQUEST",{message:as.n.INVALID_PASSWORD})}if(a.body.token)return await b6({...a,query:{token:a.body.token}}),a.json({success:!0,message:"User deleted"});if(a.context.options.user.deleteUser?.sendDeleteAccountVerification){let c=(0,T.r)(32,"0-9","a-z");await a.context.internalAdapter.createVerificationValue({value:b.user.id,identifier:`delete-account-${c}`,expiresAt:new Date(Date.now()+1e3*(a.context.options.user.deleteUser?.deleteTokenExpiresIn||86400))});let d=`${a.context.baseURL}/delete-user/callback?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.options.user.deleteUser.sendDeleteAccountVerification({user:b.user,url:d,token:c},a.request),a.json({success:!0,message:"Verification email sent"})}if(!a.body.password&&0!==a.context.sessionConfig.freshAge){let c=new Date(b.session.createdAt).getTime(),d=1e3*a.context.sessionConfig.freshAge;if(Date.now()-c>1e3*d)throw new r.APIError("BAD_REQUEST",{message:as.n.SESSION_EXPIRED})}let c=a.context.options.user.deleteUser?.beforeDelete;c&&await c(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),ar(a);let d=a.context.options.user.deleteUser?.afterDelete;return d&&await d(b.user,a.request),a.json({success:!0,message:"User deleted"})}),b6=ax("/delete-user/callback",{method:"GET",query:C.object({token:C.string().meta({description:"The token to verify the deletion request"}),callbackURL:C.string().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[bE(a=>a.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options"),new r.APIError("NOT_FOUND");let b=await az(a);if(!b)throw new r.APIError("NOT_FOUND",{message:as.n.FAILED_TO_GET_USER_INFO});let c=await a.context.internalAdapter.findVerificationValue(`delete-account-${a.query.token}`);if(!c||c.expiresAt<new Date||c.value!==b.user.id)throw new r.APIError("NOT_FOUND",{message:as.n.INVALID_TOKEN});let d=a.context.options.user.deleteUser?.beforeDelete;d&&await d(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),await a.context.internalAdapter.deleteAccounts(b.user.id),await a.context.internalAdapter.deleteVerificationValue(c.id),ar(a);let e=a.context.options.user.deleteUser?.afterDelete;if(e&&await e(b.user,a.request),a.query.callbackURL)throw a.redirect(a.query.callbackURL||"/");return a.json({success:!0,message:"User deleted"})}),b7=ax("/change-email",{method:"POST",body:C.object({newEmail:C.email().meta({description:"The new email address to set must be a valid email address"}),callbackURL:C.string().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[aB],metadata:{openapi:{operationId:"changeEmail",responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"},status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}},422:{description:"Unprocessable Entity. Email already exists",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.user?.changeEmail?.enabled)throw a.context.logger.error("Change email is disabled."),new r.APIError("BAD_REQUEST",{message:"Change email is disabled"});let b=a.body.newEmail.toLowerCase();if(b===a.context.session.user.email)throw a.context.logger.error("Email is the same"),new r.APIError("BAD_REQUEST",{message:"Email is the same"});if(await a.context.internalAdapter.findUserByEmail(b))throw a.context.logger.error("Email already exists"),new r.APIError("UNPROCESSABLE_ENTITY",{message:as.n.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});if(!0!==a.context.session.user.emailVerified&&a.context.options.user.changeEmail.updateEmailWithoutVerification){if(await a.context.internalAdapter.updateUserByEmail(a.context.session.user.email,{email:b}),await aq(a,{session:a.context.session.session,user:{...a.context.session.user,email:b}}),a.context.options.emailVerification?.sendVerificationEmail){let c=await bS(a.context.secret,b,void 0,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:{...a.context.session.user,email:b},url:d,token:c},a.request)}return a.json({status:!0})}if(a.context.session.user.emailVerified&&(a.context.options.user.changeEmail.sendChangeEmailConfirmation||a.context.options.user.changeEmail.sendChangeEmailVerification)){let c=await bS(a.context.secret,a.context.session.user.email,b,a.context.options.emailVerification?.expiresIn,{requestType:"change-email-confirmation"}),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`,e=a.context.options.user.changeEmail.sendChangeEmailConfirmation||a.context.options.user.changeEmail.sendChangeEmailVerification;return e&&await e({user:a.context.session.user,newEmail:b,url:d,token:c},a.request),a.json({status:!0})}if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new r.APIError("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await bS(a.context.secret,a.context.session.user.email,b,a.context.options.emailVerification?.expiresIn,{requestType:"change-email-verification"}),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.options.emailVerification.sendVerificationEmail({user:{...a.context.session.user,email:b},url:d,token:c},a.request),a.json({status:!0})}),b8=by((a,b,c)=>{if(Array.isArray(a[b])&&Array.isArray(c))return a[b]=c,!0});async function b9(a,b){let c={};for(let d of b)if(d.matcher(a)){let b=await d.handler({...a,returnHeaders:!1}).catch(b=>{throw b instanceof r.APIError&&(0,aJ.a)(a.context.logger.level,"debug")&&(b.stack=b.errorStack),b});if(b&&"object"==typeof b){if("context"in b&&"object"==typeof b.context){let{headers:a,...d}=b.context;a instanceof Headers&&(c.headers?a.forEach((a,b)=>{c.headers?.set(b,a)}):c.headers=a),c=b8(d,c);continue}return b}}return{context:c}}async function ca(a,b){for(let c of b)if(c.matcher(a)){let b=await c.handler(a).catch(b=>{if(b instanceof r.APIError)return(0,aJ.a)(a.context.logger.level,"debug")&&(b.stack=b.errorStack),{response:b,headers:b.headers?new Headers(b.headers):null};throw b});b.headers&&b.headers.forEach((b,c)=>{a.context.responseHeaders?"set-cookie"===c.toLowerCase()?a.context.responseHeaders.append(c,b):a.context.responseHeaders.set(c,b):a.context.responseHeaders=new Headers({[c]:b})}),b.response&&(a.context.returned=b.response)}return{response:a.context.returned,headers:a.context.responseHeaders}}function cb(a,b){let c=b.plugins?.reduce((a,b)=>({...a,...b.endpoints}),{})??{},d=b.plugins?.map(b=>b.middlewares?.map(b=>{let c=async c=>{let d=await a;return b.middleware({...c,context:{...d,...c.context}})};return c.options=b.middleware.options,{path:b.path,middleware:c}})).filter(a=>void 0!==a).flat()||[];return{api:function(a,b){let c={};for(let[d,e]of Object.entries(a))c[d]=async a=>{let c=async()=>{let c=await b,d={...a,context:{...c,returned:void 0,responseHeaders:void 0,session:null},path:e.path,headers:a?.headers?new Headers(a?.headers):void 0};return(0,aH.f)(d,async()=>{let{beforeHooks:b,afterHooks:f}=function(a){let b=a.options.plugins||[],c=[],d=[];a.options.hooks?.before&&c.push({matcher:()=>!0,handler:a.options.hooks.before}),a.options.hooks?.after&&d.push({matcher:()=>!0,handler:a.options.hooks.after});let e=b.map(a=>{if(a.hooks?.before)return a.hooks.before}).filter(a=>void 0!==a).flat(),f=b.map(a=>{if(a.hooks?.after)return a.hooks.after}).filter(a=>void 0!==a).flat();return e.length&&c.push(...e),f.length&&d.push(...f),{beforeHooks:c,afterHooks:d}}(c),g=await b9(d,b);if("context"in g&&g.context&&"object"==typeof g.context){let{headers:a,...b}=g.context;a&&a.forEach((a,b)=>{d.headers.set(b,a)}),d=b8(b,d)}else if(g)return a?.asResponse?(0,r.toResponse)(g,{headers:a?.headers}):a?.returnHeaders?{headers:a?.headers,response:g}:g;d.asResponse=!1,d.returnHeaders=!0,d.returnStatus=!0;let h=await (0,aH.f)(d,()=>e(d)).catch(a=>{if(a instanceof r.APIError)return{response:a,status:a.statusCode,headers:a.headers?new Headers(a.headers):null};throw a});if(h&&h instanceof Response)return h;d.context.returned=h.response,d.context.responseHeaders=h.headers;let i=await ca(d,f);if(i.response&&(h.response=i.response),h.response instanceof r.APIError&&(0,aJ.a)(c.logger.level,"debug")&&(h.response.stack=h.response.errorStack),h.response instanceof r.APIError&&!a?.asResponse)throw h.response;return a?.asResponse?(0,r.toResponse)(h.response,{headers:h.headers,status:h.status}):a?.returnHeaders?a?.returnStatus?{headers:h.headers,response:h.response,status:h.status}:{headers:h.headers,response:h.response}:a?.returnStatus?{response:h.response,status:h.status}:h.response})};return await (0,aG.c)()?c():(0,aI.l)(new WeakMap,c)},c[d].path=e.path,c[d].options=e.options;return c}({signInSocial:ax("/sign-in/social",{method:"POST",operationId:"socialSignIn",body:b1,metadata:{$Infer:{body:{},returned:{}},openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{token:{type:"string"},user:{type:"object",$ref:"#/components/schemas/User"},url:{type:"string"},redirect:{type:"boolean",enum:[!1]}},required:["redirect","token","user"]}}}}}}}},async a=>{let b=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!b)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new r.APIError("NOT_FOUND",{message:as.n.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!b.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new r.APIError("NOT_FOUND",{message:as.n.ID_TOKEN_NOT_SUPPORTED});let{token:c,nonce:d}=a.body.idToken;if(!await b.verifyIdToken(c,d))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new r.APIError("UNAUTHORIZED",{message:as.n.INVALID_TOKEN});let e=await b.getUserInfo({idToken:c,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!e||!e?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new r.APIError("UNAUTHORIZED",{message:as.n.FAILED_TO_GET_USER_INFO});if(!e.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new r.APIError("UNAUTHORIZED",{message:as.n.USER_EMAIL_NOT_FOUND});let f=await bP(a,{userInfo:{...e.user,email:e.user.email,id:String(e.user.id),name:e.user.name||"",image:e.user.image,emailVerified:e.user.emailVerified||!1},account:{providerId:b.id,accountId:String(e.user.id),accessToken:a.body.idToken.accessToken},callbackURL:a.body.callbackURL,disableSignUp:b.disableImplicitSignUp&&!a.body.requestSignUp||b.disableSignUp});if(f.error)throw new r.APIError("UNAUTHORIZED",{message:f.error});return await aq(a,f.data),a.json({redirect:!1,token:f.data.session.token,url:void 0,user:w(a.context.options,f.data.user)})}let{codeVerifier:c,state:d}=await (0,q.r)(a,void 0,a.body.additionalData),e=await b.createAuthorizationURL({state:d,codeVerifier:c,redirectURI:`${a.context.baseURL}/callback/${b.id}`,scopes:a.body.scopes,loginHint:a.body.loginHint});return a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),callbackOAuth:bR,getSession:ay(),signOut:b2,signUpEmail:ax("/sign-up/email",{method:"POST",operationId:"signUpWithEmailAndPassword",body:C.record(C.string(),C.any()),metadata:{$Infer:{body:{},returned:{}},openapi:{operationId:"signUpWithEmailAndPassword",description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},image:{type:"string",description:"The profile image URL of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"},rememberMe:{type:"boolean",description:"If this is false, the session will not be remembered. Default is `true`."}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}},422:{description:"Unprocessable Entity. User already exists or failed to create user.",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async a=>(0,H.i)(a.context.adapter,async()=>{let b;if(!a.context.options.emailAndPassword?.enabled||a.context.options.emailAndPassword?.disableSignUp)throw new r.APIError("BAD_REQUEST",{message:"Email and password sign up is not enabled"});let c=a.body,{name:d,email:e,password:f,image:g,callbackURL:h,rememberMe:i,...j}=c;if(!C.email().safeParse(e).success)throw new r.APIError("BAD_REQUEST",{message:as.n.INVALID_EMAIL});let k=a.context.password.config.minPasswordLength;if(f.length<k)throw a.context.logger.error("Password is too short"),new r.APIError("BAD_REQUEST",{message:as.n.PASSWORD_TOO_SHORT});let l=a.context.password.config.maxPasswordLength;if(f.length>l)throw a.context.logger.error("Password is too long"),new r.APIError("BAD_REQUEST",{message:as.n.PASSWORD_TOO_LONG});if((await a.context.internalAdapter.findUserByEmail(e))?.user)throw a.context.logger.info(`Sign-up attempt for existing email: ${e}`),new r.APIError("UNPROCESSABLE_ENTITY",{message:as.n.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});let m=await a.context.password.hash(f);try{let c=z(a.context.options,j,"create");if(!(b=await a.context.internalAdapter.createUser({email:e.toLowerCase(),name:d,image:g,...c,emailVerified:!1})))throw new r.APIError("BAD_REQUEST",{message:as.n.FAILED_TO_CREATE_USER})}catch(b){if((0,A.d)()&&a.context.logger.error("Failed to create user",b),b instanceof r.APIError)throw b;throw a.context.logger?.error("Failed to create user",b),new r.APIError("UNPROCESSABLE_ENTITY",{message:as.n.FAILED_TO_CREATE_USER,details:b})}if(!b)throw new r.APIError("UNPROCESSABLE_ENTITY",{message:as.n.FAILED_TO_CREATE_USER});if(await a.context.internalAdapter.linkAccount({userId:b.id,providerId:"credential",accountId:b.id,password:m}),a.context.options.emailVerification?.sendOnSignUp||a.context.options.emailAndPassword.requireEmailVerification){let d=await bS(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),e=c.callbackURL?encodeURIComponent(c.callbackURL):encodeURIComponent("/"),f=`${a.context.baseURL}/verify-email?token=${d}&callbackURL=${e}`,g=a.request?[{user:b,url:f,token:d},a.request]:[{user:b,url:f,token:d}];await a.context.options.emailVerification?.sendVerificationEmail?.(...g)}if(!1===a.context.options.emailAndPassword.autoSignIn||a.context.options.emailAndPassword.requireEmailVerification)return a.json({token:null,user:w(a.context.options,b)});let n=await a.context.internalAdapter.createSession(b.id,!1===i);if(!n)throw new r.APIError("BAD_REQUEST",{message:as.n.FAILED_TO_CREATE_SESSION});return await aq(a,{session:n,user:b},!1===i),a.json({token:n.token,user:w(a.context.options,b)})})),signInEmail:ax("/sign-in/email",{method:"POST",operationId:"signInEmail",body:C.object({email:C.string().meta({description:"Email of the user"}),password:C.string().meta({description:"Password of the user"}),callbackURL:C.string().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:C.boolean().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{$Infer:{body:{},returned:{}},openapi:{operationId:"signInEmail",description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"string",nullable:!0},user:{type:"object",$ref:"#/components/schemas/User"}},required:["redirect","token","user"]}}}}}}}},async a=>{if(!a.context.options?.emailAndPassword?.enabled)throw a.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new r.APIError("BAD_REQUEST",{message:"Email and password is not enabled"});let{email:b,password:c}=a.body;if(!C.email().safeParse(b).success)throw new r.APIError("BAD_REQUEST",{message:as.n.INVALID_EMAIL});let d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)throw await a.context.password.hash(c),a.context.logger.error("User not found",{email:b}),new r.APIError("UNAUTHORIZED",{message:as.n.INVALID_EMAIL_OR_PASSWORD});let e=d.accounts.find(a=>"credential"===a.providerId);if(!e)throw await a.context.password.hash(c),a.context.logger.error("Credential account not found",{email:b}),new r.APIError("UNAUTHORIZED",{message:as.n.INVALID_EMAIL_OR_PASSWORD});let f=e?.password;if(!f)throw await a.context.password.hash(c),a.context.logger.error("Password not found",{email:b}),new r.APIError("UNAUTHORIZED",{message:as.n.INVALID_EMAIL_OR_PASSWORD});if(!await a.context.password.verify({hash:f,password:c}))throw a.context.logger.error("Invalid password"),new r.APIError("UNAUTHORIZED",{message:as.n.INVALID_EMAIL_OR_PASSWORD});if(a.context.options?.emailAndPassword?.requireEmailVerification&&!d.user.emailVerified){if(!a.context.options?.emailVerification?.sendVerificationEmail)throw new r.APIError("FORBIDDEN",{message:as.n.EMAIL_NOT_VERIFIED});if(a.context.options?.emailVerification?.sendOnSignIn){let b=await bS(a.context.secret,d.user.email,void 0,a.context.options.emailVerification?.expiresIn),c=a.body.callbackURL?encodeURIComponent(a.body.callbackURL):encodeURIComponent("/"),e=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${c}`;await a.context.options.emailVerification.sendVerificationEmail({user:d.user,url:e,token:b},a.request)}throw new r.APIError("FORBIDDEN",{message:as.n.EMAIL_NOT_VERIFIED})}let g=await a.context.internalAdapter.createSession(d.user.id,!1===a.body.rememberMe);if(!g)throw a.context.logger.error("Failed to create session"),new r.APIError("UNAUTHORIZED",{message:as.n.FAILED_TO_CREATE_SESSION});return await aq(a,{session:g,user:d.user},!1===a.body.rememberMe),a.json({redirect:!!a.body.callbackURL,token:g.token,url:a.body.callbackURL,user:w(a.context.options,d.user)})}),resetPassword:b0,verifyEmail:bV,sendVerificationEmail:bU,changeEmail:b7,changePassword:b3,setPassword:b4,updateUser:ax("/update-user",{method:"POST",operationId:"updateUser",body:C.record(C.string().meta({description:"Field name must be a string"}),C.any()),use:[aA],metadata:{$Infer:{body:{}},openapi:{operationId:"updateUser",description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user",nullable:!0}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"}}}}}}}}}},async a=>{let b=a.body;if(b.email)throw new r.APIError("BAD_REQUEST",{message:as.n.EMAIL_CAN_NOT_BE_UPDATED});let{name:c,image:d,...e}=b,f=a.context.session,g=z(a.context.options,e,"update");if(void 0===d&&void 0===c&&0===Object.keys(g).length)throw new r.APIError("BAD_REQUEST",{message:"No fields to update"});let h=await a.context.internalAdapter.updateUser(f.user.id,{name:c,image:d,...g});return await aq(a,{session:f.session,user:h}),a.json({status:!0})}),deleteUser:b5,requestPasswordReset:b$,requestPasswordResetCallback:b_,listSessions:ax("/list-sessions",{method:"GET",operationId:"listUserSessions",use:[aA],requireHeaders:!0,metadata:{openapi:{operationId:"listUserSessions",description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},async a=>{try{let b=(await a.context.internalAdapter.listSessions(a.context.session.user.id)).filter(a=>a.expiresAt>new Date);return a.json(b)}catch(b){throw a.context.logger.error(b),a.error("INTERNAL_SERVER_ERROR")}}),revokeSession:aD,revokeSessions:aE,revokeOtherSessions:aF,linkSocialAccount:bK,listUserAccounts:bJ,deleteUserCallback:b6,unlinkAccount:bL,refreshToken:bN,getAccessToken:bM,accountInfo:bO,...c,ok:bY,error:bX},a),middlewares:d}}async function cc(a,b){let c=(await b.context.internalAdapter.findAccounts(a))?.find(a=>"credential"===a.providerId),d=c?.password;if(!c||!d||!b.body.password)throw new r.APIError("BAD_REQUEST",{message:"No password credential found"});if(!await b.context.password.verify({hash:d,password:b.body.password}))throw new r.APIError("BAD_REQUEST",{message:"Invalid password"});return!0}var cd=F,I=A,Z=A,$=A,B=A,as=as,ce=A,Z=A,cf=A,cg=A,B=A,ch=a.i(99685),ci=a.i(85078);async function cj(){if(c)return c;try{let a="undefined"!=typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!a)return;let[{default:b},{default:d}]=await Promise.all([Function("mm","return import(mm)")("fs/promises"),Function("mm","return import(mm)")("path")]),e=await b.readFile(d.join(a,"package.json"),"utf-8");return c=JSON.parse(e)}catch{}}async function ck(a){if(c)return c.dependencies?.[a]||c.devDependencies?.[a]||c.peerDependencies?.[a];try{let b="undefined"!=typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!b)throw Error("no-cwd");let[{default:c},{default:d}]=await Promise.all([Function("mm","return import(mm)")("fs/promises"),Function("mm","return import(mm)")("path")]),e=d.join(b,"node_modules",a,"package.json"),f=await c.readFile(e,"utf-8");return JSON.parse(f).version||await cl(a)||void 0}catch{}return await cl(a)}async function cl(a){let b=await cj();if(b)return({...b.dependencies,...b.devDependencies,...b.peerDependencies})[a]}async function cm(){return(await cj())?.name}let cn={pg:"postgresql",mysql:"mysql",mariadb:"mariadb",sqlite3:"sqlite","better-sqlite3":"sqlite","@prisma/client":"prisma",mongoose:"mongodb",mongodb:"mongodb","drizzle-orm":"drizzle"};async function co(){for(let[a,b]of Object.entries(cn)){let c=await ck(a);if(c)return{name:b,version:c}}}let cp={next:"next",nuxt:"nuxt","@remix-run/server-runtime":"remix",astro:"astro","@sveltejs/kit":"sveltekit","solid-start":"solid-start","tanstack-start":"tanstack-start",hono:"hono",express:"express",elysia:"elysia",expo:"expo"};async function cq(){for(let[a,b]of Object.entries(cp)){let c=await ck(a);if(c)return{name:b,version:c}}}function cr(){let a=(...a)=>a.some(a=>!!Z.c[a]);return a("CF_PAGES","CF_PAGES_URL","CF_ACCOUNT_ID")||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent?"cloudflare":a("VERCEL","VERCEL_URL","VERCEL_ENV")?"vercel":a("NETLIFY","NETLIFY_URL")?"netlify":a("RENDER","RENDER_URL","RENDER_INTERNAL_HOSTNAME","RENDER_SERVICE_ID")?"render":a("AWS_LAMBDA_FUNCTION_NAME","AWS_EXECUTION_ENV","LAMBDA_TASK_ROOT")?"aws":a("GOOGLE_CLOUD_FUNCTION_NAME","GOOGLE_CLOUD_PROJECT","GCP_PROJECT","K_SERVICE")?"gcp":a("AZURE_FUNCTION_NAME","FUNCTIONS_WORKER_RUNTIME","WEBSITE_INSTANCE_ID","WEBSITE_SITE_NAME")?"azure":a("DENO_DEPLOYMENT_ID","DENO_REGION")?"deno-deploy":a("FLY_APP_NAME","FLY_REGION","FLY_ALLOC_ID")?"fly-io":a("RAILWAY_STATIC_URL","RAILWAY_ENVIRONMENT_NAME")?"railway":a("DYNO","HEROKU_APP_NAME")?"heroku":a("DO_DEPLOYMENT_ID","DO_APP_NAME","DIGITALOCEAN")?"digitalocean":a("KOYEB","KOYEB_DEPLOYMENT_ID","KOYEB_APP_NAME")?"koyeb":null}async function cs(){try{if("cloudflare"===cr())return"cloudflare";let a=await Function("mm","return import(mm)")("os"),b=a.cpus();return{deploymentVendor:cr(),systemPlatform:a.platform(),systemRelease:a.release(),systemArchitecture:a.arch(),cpuCount:b.length,cpuModel:b.length?b[0].model:null,cpuSpeed:b.length?b[0].speed:null,memory:a.totalmem(),isWSL:await cw(),isDocker:await cv(),isTTY:"undefined"!=typeof process&&process.stdout?process.stdout.isTTY:null}}catch(a){return{systemPlatform:null,systemRelease:null,systemArchitecture:null,cpuCount:null,cpuModel:null,cpuSpeed:null,memory:null,isWSL:null,isDocker:null,isTTY:null}}}async function ct(){if("cloudflare"===cr())return!1;try{return(await Function("mm","return import(mm)")("fs")).statSync("/.dockerenv"),!0}catch{return!1}}async function cu(){if("cloudflare"===cr())return!1;try{return(await Function("mm","return import(mm)")("fs")).readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}async function cv(){return"cloudflare"!==cr()&&(void 0===d&&(d=await ct()||await cu()),d)}async function cw(){try{if("cloudflare"===cr()||"undefined"==typeof process||process?.platform!=="linux")return!1;let a=await Function("mm","return import(mm)")("fs");if((await Function("mm","return import(mm)")("os")).release().toLowerCase().includes("microsoft")){if(await cy())return!1;return!0}return!!a.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")&&!await cy()}catch{return!1}}let cx=async()=>{if("cloudflare"===cr())return!1;try{return(await Function("mm","return import(mm)")("fs")).statSync("/run/.containerenv"),!0}catch{return!1}};async function cy(){return void 0===e&&(e=await cx()||await cv()),e}async function cz(a){let b=await (0,ch.createHash)("SHA-256").digest(a);return _.base64.encode(b)}let cA=null;async function cB(a){if(cA)return cA;let b=await cm();return b?cA=await cz(a?a+b:b):a?cA=await cz(a):cA=(0,ci.createRandomStringGenerator)("a-z","A-Z","0-9")(32)}async function cC(a,b){let c,d=a.telemetry?.debug||(0,cf.l)("BETTER_AUTH_TELEMETRY_DEBUG",!1),e=ce.s.BETTER_AUTH_TELEMETRY_ENDPOINT,f=async a=>{b?.customTrack?await b.customTrack(a).catch(J.logger.error):d?J.logger.info("telemetry event",JSON.stringify(a,null,2)):await a5(e,{method:"POST",body:a}).catch(J.logger.error)},g=async()=>{let c=a.telemetry?.enabled!==void 0&&a.telemetry.enabled;return((0,cf.l)("BETTER_AUTH_TELEMETRY",!1)||c)&&(b?.skipTestCheck||!(0,B.p)())},h=await g();h&&(c=await cB(a.baseURL),f({type:"init",payload:{config:{database:b?.database,adapter:b?.adapter,emailVerification:{sendVerificationEmail:!!a.emailVerification?.sendVerificationEmail,sendOnSignUp:!!a.emailVerification?.sendOnSignUp,sendOnSignIn:!!a.emailVerification?.sendOnSignIn,autoSignInAfterVerification:!!a.emailVerification?.autoSignInAfterVerification,expiresIn:a.emailVerification?.expiresIn,onEmailVerification:!!a.emailVerification?.onEmailVerification,afterEmailVerification:!!a.emailVerification?.afterEmailVerification},emailAndPassword:{enabled:!!a.emailAndPassword?.enabled,disableSignUp:!!a.emailAndPassword?.disableSignUp,requireEmailVerification:!!a.emailAndPassword?.requireEmailVerification,maxPasswordLength:a.emailAndPassword?.maxPasswordLength,minPasswordLength:a.emailAndPassword?.minPasswordLength,sendResetPassword:!!a.emailAndPassword?.sendResetPassword,resetPasswordTokenExpiresIn:a.emailAndPassword?.resetPasswordTokenExpiresIn,onPasswordReset:!!a.emailAndPassword?.onPasswordReset,password:{hash:!!a.emailAndPassword?.password?.hash,verify:!!a.emailAndPassword?.password?.verify},autoSignIn:!!a.emailAndPassword?.autoSignIn,revokeSessionsOnPasswordReset:!!a.emailAndPassword?.revokeSessionsOnPasswordReset},socialProviders:Object.keys(a.socialProviders||{}).map(b=>{let c=a.socialProviders?.[b];return c?{id:b,mapProfileToUser:!!c.mapProfileToUser,disableDefaultScope:!!c.disableDefaultScope,disableIdTokenSignIn:!!c.disableIdTokenSignIn,disableImplicitSignUp:c.disableImplicitSignUp,disableSignUp:c.disableSignUp,getUserInfo:!!c.getUserInfo,overrideUserInfoOnSignIn:!!c.overrideUserInfoOnSignIn,prompt:c.prompt,verifyIdToken:!!c.verifyIdToken,scope:c.scope,refreshAccessToken:!!c.refreshAccessToken}:{}}),plugins:a.plugins?.map(a=>a.id.toString()),user:{modelName:a.user?.modelName,fields:a.user?.fields,additionalFields:a.user?.additionalFields,changeEmail:{enabled:a.user?.changeEmail?.enabled,sendChangeEmailVerification:!!a.user?.changeEmail?.sendChangeEmailVerification}},verification:{modelName:a.verification?.modelName,disableCleanup:a.verification?.disableCleanup,fields:a.verification?.fields},session:{modelName:a.session?.modelName,additionalFields:a.session?.additionalFields,cookieCache:{enabled:a.session?.cookieCache?.enabled,maxAge:a.session?.cookieCache?.maxAge,strategy:a.session?.cookieCache?.strategy},disableSessionRefresh:a.session?.disableSessionRefresh,expiresIn:a.session?.expiresIn,fields:a.session?.fields,freshAge:a.session?.freshAge,preserveSessionInDatabase:a.session?.preserveSessionInDatabase,storeSessionInDatabase:a.session?.storeSessionInDatabase,updateAge:a.session?.updateAge},account:{modelName:a.account?.modelName,fields:a.account?.fields,encryptOAuthTokens:a.account?.encryptOAuthTokens,updateAccountOnSignIn:a.account?.updateAccountOnSignIn,accountLinking:{enabled:a.account?.accountLinking?.enabled,trustedProviders:a.account?.accountLinking?.trustedProviders,updateUserInfoOnLink:a.account?.accountLinking?.updateUserInfoOnLink,allowUnlinkingAll:a.account?.accountLinking?.allowUnlinkingAll}},hooks:{after:!!a.hooks?.after,before:!!a.hooks?.before},secondaryStorage:!!a.secondaryStorage,advanced:{cookiePrefix:!!a.advanced?.cookiePrefix,cookies:!!a.advanced?.cookies,crossSubDomainCookies:{domain:!!a.advanced?.crossSubDomainCookies?.domain,enabled:a.advanced?.crossSubDomainCookies?.enabled,additionalCookies:a.advanced?.crossSubDomainCookies?.additionalCookies},database:{useNumberId:!!a.advanced?.database?.useNumberId||a.advanced?.database?.generateId==="serial",generateId:a.advanced?.database?.generateId,defaultFindManyLimit:a.advanced?.database?.defaultFindManyLimit},useSecureCookies:a.advanced?.useSecureCookies,ipAddress:{disableIpTracking:a.advanced?.ipAddress?.disableIpTracking,ipAddressHeaders:a.advanced?.ipAddress?.ipAddressHeaders},disableCSRFCheck:a.advanced?.disableCSRFCheck,cookieAttributes:{expires:a.advanced?.defaultCookieAttributes?.expires,secure:a.advanced?.defaultCookieAttributes?.secure,sameSite:a.advanced?.defaultCookieAttributes?.sameSite,domain:!!a.advanced?.defaultCookieAttributes?.domain,path:a.advanced?.defaultCookieAttributes?.path,httpOnly:a.advanced?.defaultCookieAttributes?.httpOnly}},trustedOrigins:a.trustedOrigins?.length,rateLimit:{storage:a.rateLimit?.storage,modelName:a.rateLimit?.modelName,window:a.rateLimit?.window,customStorage:!!a.rateLimit?.customStorage,enabled:a.rateLimit?.enabled,max:a.rateLimit?.max},onAPIError:{errorURL:a.onAPIError?.errorURL,onError:!!a.onAPIError?.onError,throw:a.onAPIError?.throw},logger:{disabled:a.logger?.disabled,level:a.logger?.level,log:!!a.logger?.log},databaseHooks:{user:{create:{after:!!a.databaseHooks?.user?.create?.after,before:!!a.databaseHooks?.user?.create?.before},update:{after:!!a.databaseHooks?.user?.update?.after,before:!!a.databaseHooks?.user?.update?.before}},session:{create:{after:!!a.databaseHooks?.session?.create?.after,before:!!a.databaseHooks?.session?.create?.before},update:{after:!!a.databaseHooks?.session?.update?.after,before:!!a.databaseHooks?.session?.update?.before}},account:{create:{after:!!a.databaseHooks?.account?.create?.after,before:!!a.databaseHooks?.account?.create?.before},update:{after:!!a.databaseHooks?.account?.update?.after,before:!!a.databaseHooks?.account?.update?.before}},verification:{create:{after:!!a.databaseHooks?.verification?.create?.after,before:!!a.databaseHooks?.verification?.create?.before},update:{after:!!a.databaseHooks?.verification?.update?.after,before:!!a.databaseHooks?.verification?.update?.before}}}},runtime:"undefined"!=typeof Deno?{name:"deno",version:Deno?.version?.deno??null}:"undefined"!=typeof Bun?{name:"bun",version:Bun?.version??null}:"undefined"!=typeof process&&process?.versions?.node?{name:"node",version:process.versions.node??null}:{name:"edge",version:null},database:await co(),framework:await cq(),environment:"production"===(0,cg.u)("NODE_ENV")?"production":"false"!==Z.c.CI&&("BUILD_ID"in Z.c||"BUILD_NUMBER"in Z.c||"CI"in Z.c||"CI_APP_ID"in Z.c||"CI_BUILD_ID"in Z.c||"CI_BUILD_NUMBER"in Z.c||"CI_NAME"in Z.c||"CONTINUOUS_INTEGRATION"in Z.c||"RUN_ID"in Z.c)?"ci":(0,B.p)()?"test":"development",systemInfo:await cs(),packageManager:function(){let a=Z.c.npm_config_user_agent;if(!a)return;let b=a.split(" ")[0],c=b.lastIndexOf("/"),d=b.substring(0,c);return{name:"npminstall"===d?"cnpm":d,version:b.substring(c+1)}}()},anonymousId:c}));return{publish:async b=>{h&&(c||(c=await cB(a.baseURL)),await f({type:b.type,payload:b.payload,anonymousId:c}))}}}let cD="better-auth-secret-12345678901234567890";function cE(a){return!!a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof a.then}async function cF(a){let b=a.options,c=b.plugins||[],d=a,e=[];for(let a of c)if(a.init){let c,f=a.init(d);if("object"==typeof(c=cE(f)?await f:f)){if(c.options){let{databaseHooks:a,...d}=c.options;a&&e.push(a),b=bz(b,d)}c.context&&(d={...d,...c.context})}}return e.push(b.databaseHooks),d.internalAdapter=P(d.adapter,{options:b,logger:d.logger,hooks:e.filter(a=>void 0!==a),generateId:d.generateId}),d.options=b,{context:d}}async function cG(a,b,c){var d,e;let f,g,h,i,j,k,l,m;b.database||(b=bz(b,{session:{cookieCache:{enabled:!0,strategy:"jwe",refreshCache:!0}},account:{storeStateStrategy:"cookie",storeAccountCookie:!0}}));let n=b.plugins||[],o=(d=b,d.advanced?.crossSubDomainCookies?.enabled,[]),r=(0,I.n)(b.logger),s=V(b.baseURL,b.basePath),t=b.secret||Z.c.BETTER_AUTH_SECRET||Z.c.AUTH_SECRET||cD,u=t===cD;if(!(0,B.p)()){let a;if(u&&$.f)throw new K.BetterAuthError("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config.");if(!t)throw new K.BetterAuthError("BETTER_AUTH_SECRET is missing. Set it in your environment or pass `secret` to betterAuth({ secret }).");if(t.length<32)throw new K.BetterAuthError("Invalid BETTER_AUTH_SECRET: must be at least 32 characters long for adequate security. Generate one with `npx @better-auth/cli secret` or `openssl rand -base64 32`.");120>(0===(a=new Set(t).size)?0:Math.log2(Math.pow(a,t.length)))&&r.warn("[better-auth] Warning: your BETTER_AUTH_SECRET appears low-entropy. Use a randomly generated secret for production.")}!function(a,b){let c=new Map;a.plugins?.forEach(a=>{if(a.endpoints){for(let[b,d]of Object.entries(a.endpoints))if(d&&"path"in d){let e=d.path,f=[];d.options&&"method"in d.options&&(Array.isArray(d.options.method)?f=d.options.method:"string"==typeof d.options.method&&(f=[d.options.method])),0===f.length&&(f=["*"]),c.has(e)||c.set(e,[]),c.get(e).push({pluginId:a.id,endpointKey:b,methods:f})}}});let d=[];for(let[a,b]of c.entries())if(b.length>1){let c=new Map,e=!1;for(let a of b)for(let d of a.methods)c.has(d)||c.set(d,[]),c.get(d).push(a.pluginId),c.get(d).length>1&&(e=!0),"*"===d&&b.length>1?e=!0:"*"!==d&&c.has("*")&&(e=!0);if(e){let e=[...new Set(b.map(a=>a.pluginId))],f=[];for(let[a,d]of c.entries())(d.length>1||"*"===a&&b.length>1||"*"!==a&&c.has("*"))&&f.push(a);d.push({path:a,plugins:e,conflictingMethods:f})}}if(d.length>0){let a=d.map(a=>`  - "${a.path}" [${a.conflictingMethods.join(", ")}] used by plugins: ${a.plugins.join(", ")}`).join("\n");b.error(`Endpoint path conflicts detected! Multiple plugins are trying to use the same endpoint paths with conflicting HTTP methods:
${a}

To resolve this, you can:
	1. Use only one of the conflicting plugins
	2. Configure the plugins to use different paths (if supported)
	3. Ensure plugins use different HTTP methods for the same path
`)}}(b={...b,secret:t,baseURL:s?new URL(s).origin:"",basePath:b.basePath||"/api/auth",plugins:n.concat(o)},r);let v=(h=(g=ao(e=b))("session_token",{maxAge:e.session?.expiresIn||function(a){!1;let b=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec("7d");if(!b?.groups)return NaN;let{value:c,unit:d="ms"}=b.groups,e=parseFloat(c),f=d.toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*e;case"months":case"month":case"mo":return 26298e5*e;case"weeks":case"week":case"w":return 6048e5*e;case"days":case"day":case"d":return 864e5*e;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*e;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:throw Error(`Unknown unit "${f}" provided to ms.parse(). value=${JSON.stringify("7d")}`)}}("7d")/1e3}),i=g("session_data",{maxAge:e.session?.cookieCache?.maxAge||300}),j=g("account_data",{maxAge:e.session?.cookieCache?.maxAge||300}),k=g("dont_remember"),{sessionToken:{name:h.name,options:h.attributes},sessionData:{name:i.name,options:i.attributes},dontRememberToken:{name:k.name,options:k.attributes},accountData:{name:j.name,options:j.attributes}}),w=(0,p.a)(b),x=Object.entries(b.socialProviders||{}).map(([a,b])=>{if(null==b||!1===b.enabled)return null;b.clientId||r.warn(`Social provider ${a} is missing clientId or clientSecret`);let c=bu[a](b);return c.disableImplicitSignUp=b.disableImplicitSignUp,c}).filter(a=>null!==a),y=({model:a,size:c})=>"function"==typeof b.advanced?.generateId?b.advanced.generateId({model:a,size:c}):"function"==typeof b?.advanced?.database?.generateId?b.advanced.database.generateId({model:a,size:c}):(0,q.t)(c),{publish:z}=await cC(b,{adapter:a.id,database:"function"==typeof b.database?"adapter":c(b.database)}),A=cF({appName:b.appName||"Better Auth",socialProviders:x,options:b,oauthConfig:{storeStateStrategy:b.account?.storeStateStrategy||"database",skipStateCookieCheck:!!b.account?.skipStateCookieCheck},tables:w,trustedOrigins:function(a){let b=V(a.baseURL,a.basePath);if(!b)return[];let c=[new URL(b).origin];a.trustedOrigins&&Array.isArray(a.trustedOrigins)&&c.push(...a.trustedOrigins);let d=Z.c.BETTER_AUTH_TRUSTED_ORIGINS;if(d&&c.push(...d.split(",")),c.filter(a=>!a).length)throw new K.BetterAuthError("A provided trusted origin is invalid, make sure your trusted origins list is properly defined.");return c}(b),baseURL:s||"",sessionConfig:{updateAge:b.session?.updateAge!==void 0?b.session.updateAge:86400,expiresIn:b.session?.expiresIn||604800,freshAge:b.session?.freshAge===void 0?86400:b.session.freshAge,cookieRefreshCache:(l=b.session?.cookieCache?.refreshCache,m=b.session?.cookieCache?.maxAge||300,!1!==l&&void 0!==l&&(!0===l?{enabled:!0,updateAge:Math.floor(.2*m)}:{enabled:!0,updateAge:void 0!==l.updateAge?l.updateAge:Math.floor(.2*m)}))},secret:t,rateLimit:{...b.rateLimit,enabled:b.rateLimit?.enabled??$.f,window:b.rateLimit?.window||10,max:b.rateLimit?.max||100,storage:b.rateLimit?.storage||(b.secondaryStorage?"secondary-storage":"memory")},authCookies:v,logger:r,generateId:y,session:null,secondaryStorage:b.secondaryStorage,password:{hash:b.emailAndPassword?.password?.hash||T.i,verify:b.emailAndPassword?.password?.verify||T.a,config:{minPasswordLength:b.emailAndPassword?.minPasswordLength||8,maxPasswordLength:b.emailAndPassword?.maxPasswordLength||128},checkPassword:cc},setNewSession(a){this.newSession=a},newSession:null,adapter:a,internalAdapter:P(a,{options:b,logger:r,hooks:b.databaseHooks?[b.databaseHooks]:[],generateId:y}),createAuthCookie:ao(b),async runMigrations(){throw new K.BetterAuthError("runMigrations will be set by the specific init implementation")},publishTelemetry:z,skipCSRFCheck:!!b.advanced?.disableCSRFCheck,skipOriginCheck:b.advanced?.disableOriginCheck!==void 0?b.advanced.disableOriginCheck:!!(0,B.p)()});return cE(A)?{context:f}=await A:{context:f}=A,f}let cH=async a=>{let b=await O(a),c=await cG(b,a,a=>(0,o.n)(a)||"unknown");return c.runMigrations=async function(){if(!a.database||"updateMany"in a.database)throw new K.BetterAuthError("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");let{runMigrations:b}=await S(a);await b()},c};var F=F;let cI=C.object({id:C.string(),createdAt:C.date().default(()=>new Date),updatedAt:C.date().default(()=>new Date)});cI.extend({providerId:C.string(),accountId:C.string(),userId:M.coerce.string(),accessToken:C.string().nullish(),refreshToken:C.string().nullish(),idToken:C.string().nullish(),accessTokenExpiresAt:C.date().nullish(),refreshTokenExpiresAt:C.date().nullish(),scope:C.string().nullish(),password:C.string().nullish()}),C.object({key:C.string(),count:C.number(),lastRequest:C.number()}),cI.extend({userId:M.coerce.string(),expiresAt:C.date(),token:C.string(),ipAddress:C.string().nullish(),userAgent:C.string().nullish()}),cI.extend({email:C.string().transform(a=>a.toLowerCase()),emailVerified:C.boolean().default(!1),name:C.string(),image:C.string().nullish()}),cI.extend({value:C.string(),expiresAt:C.date(),identifier:C.string()});var cJ=a.i(18973);let cK=Symbol.for("drizzle:entityKind");function cL(a,b){if(!a||"object"!=typeof a)return!1;if(a instanceof b)return!0;if(!Object.prototype.hasOwnProperty.call(b,cK))throw Error(`Class "${b.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let c=Object.getPrototypeOf(a).constructor;if(c)for(;c;){if(cK in c&&c[cK]===b[cK])return!0;c=Object.getPrototypeOf(c)}return!1}Symbol.for("drizzle:hasOwnEntityKind");class cM{constructor(a,b){this.table=a,this.config=b,this.name=b.name,this.keyAsName=b.keyAsName,this.notNull=b.notNull,this.default=b.default,this.defaultFn=b.defaultFn,this.onUpdateFn=b.onUpdateFn,this.hasDefault=b.hasDefault,this.primary=b.primaryKey,this.isUnique=b.isUnique,this.uniqueName=b.uniqueName,this.uniqueType=b.uniqueType,this.dataType=b.dataType,this.columnType=b.columnType,this.generated=b.generated,this.generatedIdentity=b.generatedIdentity}static [cK]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(a){return a}mapToDriverValue(a){return a}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}let cN=Symbol.for("drizzle:Name"),cO=Symbol.for("drizzle:Schema"),cP=Symbol.for("drizzle:Columns"),cQ=Symbol.for("drizzle:ExtraConfigColumns"),cR=Symbol.for("drizzle:OriginalName"),cS=Symbol.for("drizzle:BaseName"),cT=Symbol.for("drizzle:IsAlias"),cU=Symbol.for("drizzle:ExtraConfigBuilder"),cV=Symbol.for("drizzle:IsDrizzleTable");class cW{static [cK]="Table";static Symbol={Name:cN,Schema:cO,OriginalName:cR,Columns:cP,ExtraConfigColumns:cQ,BaseName:cS,IsAlias:cT,ExtraConfigBuilder:cU};[cN];[cR];[cO];[cP];[cQ];[cS];[cT]=!1;[cV]=!0;[cU]=void 0;constructor(a,b,c){this[cN]=this[cR]=a,this[cO]=b,this[cS]=c}}function cX(a){return`${a[cO]??"public"}.${a[cN]}`}class cY{static [cK]="ColumnBuilder";config;constructor(a,b,c){this.config={name:a,keyAsName:""===a,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:b,columnType:c,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(a){return this.config.default=a,this.config.hasDefault=!0,this}$defaultFn(a){return this.config.defaultFn=a,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(a){return this.config.onUpdateFn=a,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(a){""===this.config.name&&(this.config.name=a)}}class cZ{static [cK]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=void 0===a?"no action":a,this}onDelete(a){return this._onDelete=void 0===a?"no action":a,this}build(a){return new c$(a,this)}}class c${constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [cK]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),e=c.map(a=>a.name),f=[this.table[cN],...d,c[0].table[cN],...e];return a??`${f.join("_")}_fk`}}function c_(a,...b){return a(...b)}function c0(a,b){return`${a[cN]}_${b.join("_")}_unique`}class c1{constructor(a,b){this.name=b,this.columns=a}static [cK]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(a){return new c3(a,this.columns,this.nullsNotDistinctConfig,this.name)}}class c2{static [cK]="PgUniqueOnConstraintBuilder";name;constructor(a){this.name=a}on(...a){return new c1(a,this.name)}}class c3{constructor(a,b,c,d){this.table=a,this.columns=b,this.name=d??c0(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=c}static [cK]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}}function c4(a,b,c){for(let d=b;d<a.length;d++){let e=a[d];if("\\"===e){d++;continue}if('"'===e)return[a.slice(b,d).replace(/\\/g,""),d+1];if(!c&&(","===e||"}"===e))return[a.slice(b,d).replace(/\\/g,""),d]}return[a.slice(b).replace(/\\/g,""),a.length]}class c5 extends cY{foreignKeyConfigs=[];static [cK]="PgColumnBuilder";array(a){return new c9(this.config.name,this,a)}references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a,b){return this.config.isUnique=!0,this.config.uniqueName=a,this.config.uniqueType=b?.nulls,this}generatedAlwaysAs(a){return this.config.generated={as:a,type:"always",mode:"stored"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>c_((c,d)=>{let e=new cZ(()=>({columns:[a],foreignColumns:[c()]}));return d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)},c,d))}buildExtraConfigColumn(a){return new c7(a,this.config)}}class c6 extends cM{constructor(a,b){b.uniqueName||(b.uniqueName=c0(a,[b.name])),super(a,b),this.table=a}static [cK]="PgColumn"}class c7 extends c6{static [cK]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(a){return this.indexConfig.opClass=a,this}}class c8{static [cK]="IndexedColumn";constructor(a,b,c,d){this.name=a,this.keyAsName=b,this.type=c,this.indexConfig=d}name;keyAsName;type;indexConfig}class c9 extends c5{static [cK]="PgArrayBuilder";constructor(a,b,c){super(a,"array","PgArray"),this.config.baseBuilder=b,this.config.size=c}build(a){let b=this.config.baseBuilder.build(a);return new da(a,this.config,b)}}class da extends c6{constructor(a,b,c,d){super(a,b),this.baseColumn=c,this.range=d,this.size=b.size}size;static [cK]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(a){return"string"==typeof a&&(a=function(a){let[b]=function a(b,c=0){let d=[],e=c,f=!1;for(;e<b.length;){let g=b[e];if(","===g){(f||e===c)&&d.push(""),f=!0,e++;continue}if(f=!1,"\\"===g){e+=2;continue}if('"'===g){let[a,c]=c4(b,e+1,!0);d.push(a),e=c;continue}if("}"===g)return[d,e+1];if("{"===g){let[c,f]=a(b,e+1);d.push(c),e=f;continue}let[h,i]=c4(b,e,!1);d.push(h),e=i}return[d,e]}(a,1);return b}(a)),a.map(a=>this.baseColumn.mapFromDriverValue(a))}mapToDriverValue(a,b=!1){let c=a.map(a=>null===a?null:cL(this.baseColumn,da)?this.baseColumn.mapToDriverValue(a,!0):this.baseColumn.mapToDriverValue(a));return b?c:function a(b){return`{${b.map(b=>Array.isArray(b)?a(b):"string"==typeof b?`"${b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${b}`).join(",")}}`}(c)}}class db extends c5{static [cK]="PgEnumObjectColumnBuilder";constructor(a,b){super(a,"string","PgEnumObjectColumn"),this.config.enum=b}build(a){return new dc(a,this.config)}}class dc extends c6{static [cK]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}let dd=Symbol.for("drizzle:isPgEnum");class de extends c5{static [cK]="PgEnumColumnBuilder";constructor(a,b){super(a,"string","PgEnumColumn"),this.config.enum=b}build(a){return new df(a,this.config)}}class df extends c6{static [cK]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}class dg{static [cK]="Subquery";constructor(a,b,c,d=!1,e=[]){this._={brand:"Subquery",sql:a,selectedFields:b,alias:c,isWith:d,usedTables:e}}}class dh extends dg{static [cK]="WithSubquery"}let di=(a,b)=>f?(g||(g=f.trace.getTracer("drizzle-orm","0.45.0")),c_((c,d)=>d.startActiveSpan(a,a=>{try{return b(a)}catch(b){throw a.setStatus({code:c.SpanStatusCode.ERROR,message:b instanceof Error?b.message:"Unknown error"}),b}finally{a.end()}}),f,g)):b(),dj=Symbol.for("drizzle:ViewBaseConfig");class dk{static [cK]="FakePrimitiveParam"}function dl(a){return null!=a&&"function"==typeof a.getSQL}class dm{static [cK]="StringChunk";value;constructor(a){this.value=Array.isArray(a)?a:[a]}getSQL(){return new dn([this])}}class dn{constructor(a){for(const b of(this.queryChunks=a,a))if(cL(b,cW)){const a=b[cW.Symbol.Schema];this.usedTables.push(void 0===a?b[cW.Symbol.Name]:a+"."+b[cW.Symbol.Name])}}static [cK]="SQL";decoder=dq;shouldInlineParams=!1;usedTables=[];append(a){return this.queryChunks.push(...a.queryChunks),this}toQuery(a){return di("drizzle.buildSQL",b=>{let c=this.buildQueryFromSourceParams(this.queryChunks,a);return b?.setAttributes({"drizzle.query.text":c.sql,"drizzle.query.params":JSON.stringify(c.params)}),c})}buildQueryFromSourceParams(a,b){let c=Object.assign({},b,{inlineParams:b.inlineParams||this.shouldInlineParams,paramStartIndex:b.paramStartIndex||{value:0}}),{casing:d,escapeName:e,escapeParam:f,prepareTyping:g,inlineParams:h,paramStartIndex:i}=c;var j=a.map(a=>{if(cL(a,dm))return{sql:a.value.join(""),params:[]};if(cL(a,dp))return{sql:e(a.value),params:[]};if(void 0===a)return{sql:"",params:[]};if(Array.isArray(a)){let b=[new dm("(")];for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push(new dm(", "));return b.push(new dm(")")),this.buildQueryFromSourceParams(b,c)}if(cL(a,dn))return this.buildQueryFromSourceParams(a.queryChunks,{...c,inlineParams:h||a.shouldInlineParams});if(cL(a,cW)){let b=a[cW.Symbol.Schema],c=a[cW.Symbol.Name];return{sql:void 0===b||a[cT]?e(c):e(b)+"."+e(c),params:[]}}if(cL(a,cM)){let c=d.getColumnCasing(a);if("indexes"===b.invokeSource)return{sql:e(c),params:[]};let f=a.table[cW.Symbol.Schema];return{sql:a.table[cT]||void 0===f?e(a.table[cW.Symbol.Name])+"."+e(c):e(f)+"."+e(a.table[cW.Symbol.Name])+"."+e(c),params:[]}}if(cL(a,dz)){let b=a[dj].schema,c=a[dj].name;return{sql:void 0===b||a[dj].isAlias?e(c):e(b)+"."+e(c),params:[]}}if(cL(a,ds)){if(cL(a.value,dw))return{sql:f(i.value++,a),params:[a],typings:["none"]};let b=null===a.value?null:a.encoder.mapToDriverValue(a.value);if(cL(b,dn))return this.buildQueryFromSourceParams([b],c);if(h)return{sql:this.mapInlineParam(b,c),params:[]};let d=["none"];return g&&(d=[g(a.encoder)]),{sql:f(i.value++,b),params:[b],typings:d}}return cL(a,dw)?{sql:f(i.value++,a),params:[a],typings:["none"]}:cL(a,dn.Aliased)&&void 0!==a.fieldAlias?{sql:e(a.fieldAlias),params:[]}:cL(a,dg)?a._.isWith?{sql:e(a._.alias),params:[]}:this.buildQueryFromSourceParams([new dm("("),a._.sql,new dm(") "),new dp(a._.alias)],c):a&&"function"==typeof a&&dd in a&&!0===a[dd]?a.schema?{sql:e(a.schema)+"."+e(a.enumName),params:[]}:{sql:e(a.enumName),params:[]}:dl(a)?a.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([a.getSQL()],c):this.buildQueryFromSourceParams([new dm("("),a.getSQL(),new dm(")")],c):h?{sql:this.mapInlineParam(a,c),params:[]}:{sql:f(i.value++,a),params:[a],typings:["none"]}});let k={sql:"",params:[]};for(let a of j)k.sql+=a.sql,k.params.push(...a.params),a.typings?.length&&(k.typings||(k.typings=[]),k.typings.push(...a.typings));return k}mapInlineParam(a,{escapeString:b}){if(null===a)return"null";if("number"==typeof a||"boolean"==typeof a)return a.toString();if("string"==typeof a)return b(a);if("object"==typeof a){let c=a.toString();return"[object Object]"===c?b(JSON.stringify(a)):b(c)}throw Error("Unexpected param value: "+a)}getSQL(){return this}as(a){return void 0===a?this:new dn.Aliased(this,a)}mapWith(a){return this.decoder="function"==typeof a?{mapFromDriverValue:a}:a,this}inlineParams(){return this.shouldInlineParams=!0,this}if(a){return a?this:void 0}}class dp{constructor(a){this.value=a}static [cK]="Name";brand;getSQL(){return new dn([this])}}let dq={mapFromDriverValue:a=>a},dr={mapToDriverValue:a=>a};({...dq,...dr});class ds{constructor(a,b=dr){this.value=a,this.encoder=b}static [cK]="Param";brand;getSQL(){return new dn([this])}}function dt(a,...b){let c=[];for(let[d,e]of((b.length>0||a.length>0&&""!==a[0])&&c.push(new dm(a[0])),b.entries()))c.push(e,new dm(a[d+1]));return new dn(c)}(l=dt||(dt={})).empty=function(){return new dn([])},l.fromList=function(a){return new dn(a)},l.raw=function(a){return new dn([new dm(a)])},l.join=function(a,b){let c=[];for(let[d,e]of a.entries())d>0&&void 0!==b&&c.push(b),c.push(e);return new dn(c)},l.identifier=function(a){return new dp(a)},l.placeholder=function(a){return new dw(a)},l.param=function(a,b){return new ds(a,b)};var du=dn||(dn={});class dv{constructor(a,b){this.sql=a,this.fieldAlias=b}static [cK]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new dv(this.sql,this.fieldAlias)}}du.Aliased=dv;class dw{constructor(a){this.name=a}static [cK]="Placeholder";getSQL(){return new dn([this])}}function dx(a,b){return a.map(a=>{if(cL(a,dw)){if(!(a.name in b))throw Error(`No value for placeholder "${a.name}" was provided`);return b[a.name]}if(cL(a,ds)&&cL(a.value,dw)){if(!(a.value.name in b))throw Error(`No value for placeholder "${a.value.name}" was provided`);return a.encoder.mapToDriverValue(b[a.value.name])}return a})}let dy=Symbol.for("drizzle:IsDrizzleView");class dz{static [cK]="View";[dj];[dy]=!0;constructor({name:a,schema:b,selectedFields:c,query:d}){this[dj]={name:a,originalName:a,schema:b,selectedFields:c,query:d,isExisting:!d,isAlias:!1}}getSQL(){return new dn([this])}}function dA(a,b){return"object"!=typeof b||null===b||!("mapToDriverValue"in b)||"function"!=typeof b.mapToDriverValue||dl(a)||cL(a,ds)||cL(a,dw)||cL(a,cM)||cL(a,cW)||cL(a,dz)?a:new ds(a,b)}cM.prototype.getSQL=function(){return new dn([this])},cW.prototype.getSQL=function(){return new dn([this])},dg.prototype.getSQL=function(){return new dn([this])};let dB=(a,b)=>dt`${a} = ${dA(b,a)}`,dC=(a,b)=>dt`${a} <> ${dA(b,a)}`;function dD(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new dn(1===b.length?b:[new dm("("),dt.join(b,new dm(" and ")),new dm(")")])}function dE(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new dn(1===b.length?b:[new dm("("),dt.join(b,new dm(" or ")),new dm(")")])}function dF(a){return dt`not ${a}`}let dG=(a,b)=>dt`${a} > ${dA(b,a)}`,dH=(a,b)=>dt`${a} >= ${dA(b,a)}`,dI=(a,b)=>dt`${a} < ${dA(b,a)}`,dJ=(a,b)=>dt`${a} <= ${dA(b,a)}`;function dK(a,b){return Array.isArray(b)?0===b.length?dt`false`:dt`${a} in ${b.map(b=>dA(b,a))}`:dt`${a} in ${dA(b,a)}`}function dL(a,b){return Array.isArray(b)?0===b.length?dt`true`:dt`${a} not in ${b.map(b=>dA(b,a))}`:dt`${a} not in ${dA(b,a)}`}function dM(a){return dt`${a} is null`}function dN(a){return dt`${a} is not null`}function dO(a){return dt`exists ${a}`}function dP(a){return dt`not exists ${a}`}function dQ(a,b,c){return dt`${a} between ${dA(b,a)} and ${dA(c,a)}`}function dR(a,b,c){return dt`${a} not between ${dA(b,a)} and ${dA(c,a)}`}function dS(a,b){return dt`${a} like ${b}`}function dT(a,b){return dt`${a} not like ${b}`}function dU(a,b){return dt`${a} ilike ${b}`}function dV(a,b){return dt`${a} not ilike ${b}`}function dW(a){return dt`${a} asc`}function dX(a){return dt`${a} desc`}a.s(["and",()=>dD,"between",()=>dQ,"eq",()=>dB,"exists",()=>dO,"gt",()=>dG,"gte",()=>dH,"ilike",()=>dU,"inArray",()=>dK,"isNotNull",()=>dN,"isNull",()=>dM,"like",()=>dS,"lt",()=>dI,"lte",()=>dJ,"ne",()=>dC,"not",()=>dF,"notBetween",()=>dR,"notExists",()=>dP,"notIlike",()=>dV,"notInArray",()=>dL,"notLike",()=>dT,"or",()=>dE],93321),a.s(["asc",()=>dW,"desc",()=>dX],30385);class dY{static [cK]="ConsoleLogWriter";write(a){console.log(a)}}class dZ{static [cK]="DefaultLogger";writer;constructor(a){this.writer=a?.writer??new dY}logQuery(a,b){let c=b.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),d=c.length?` -- params: [${c.join(", ")}]`:"";this.writer.write(`Query: ${a}${d}`)}}class d${static [cK]="NoopLogger";logQuery(){}}function d_(a,b,c){let d={},e=a.reduce((a,{path:e,field:f},g)=>{let h;h=cL(f,cM)?f:cL(f,dn)?f.decoder:cL(f,dg)?f._.sql.decoder:f.sql.decoder;let i=a;for(let[a,j]of e.entries())if(a<e.length-1)j in i||(i[j]={}),i=i[j];else{let a=b[g],k=i[j]=null===a?null:h.mapFromDriverValue(a);if(c&&cL(f,cM)&&2===e.length){let a=e[0];a in d?"string"==typeof d[a]&&d[a]!==f.table[cN]&&(d[a]=!1):d[a]=null===k&&f.table[cN]}}return a},{});if(c&&Object.keys(d).length>0)for(let[a,b]of Object.entries(d))"string"!=typeof b||c[b]||(e[a]=null);return e}function d0(a,b){return Object.entries(a).reduce((a,[c,d])=>{if("string"!=typeof c)return a;let e=b?[...b,c]:[c];return cL(d,cM)||cL(d,dn)||cL(d,dn.Aliased)||cL(d,dg)?a.push({path:e,field:d}):cL(d,cW)?a.push(...d0(d[cW.Symbol.Columns],e)):a.push(...d0(d,e)),a},[])}function d1(a,b){let c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(let[a,b]of c.entries())if(b!==d[a])return!1;return!0}function d2(a,b){let c=Object.entries(b).filter(([,a])=>void 0!==a).map(([b,c])=>cL(c,dn)||cL(c,cM)?[b,c]:[b,new ds(c,a[cW.Symbol.Columns][b])]);if(0===c.length)throw Error("No values to set");return Object.fromEntries(c)}function d3(a){return cL(a,dg)?a._.alias:cL(a,dz)?a[dj].name:cL(a,dn)?void 0:a[cW.Symbol.IsAlias]?a[cW.Symbol.Name]:a[cW.Symbol.BaseName]}function d4(a,b){return{name:"string"==typeof a&&a.length>0?a:"",config:"object"==typeof a?a:b}}let d5="undefined"==typeof TextDecoder?null:new TextDecoder;class d6 extends c5{static [cK]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"always",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"byDefault",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}class d7 extends d6{static [cK]="PgBigInt53Builder";constructor(a){super(a,"number","PgBigInt53")}build(a){return new d8(a,this.config)}}class d8 extends c6{static [cK]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class d9 extends d6{static [cK]="PgBigInt64Builder";constructor(a){super(a,"bigint","PgBigInt64")}build(a){return new ea(a,this.config)}}class ea extends c6{static [cK]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(a){return BigInt(a)}}class eb extends c5{static [cK]="PgBigSerial53Builder";constructor(a){super(a,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new ec(a,this.config)}}class ec extends c6{static [cK]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class ed extends c5{static [cK]="PgBigSerial64Builder";constructor(a){super(a,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(a){return new ee(a,this.config)}}class ee extends c6{static [cK]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(a){return BigInt(a)}}class ef extends c5{static [cK]="PgBooleanBuilder";constructor(a){super(a,"boolean","PgBoolean")}build(a){return new eg(a,this.config)}}class eg extends c6{static [cK]="PgBoolean";getSQLType(){return"boolean"}}class eh extends c5{static [cK]="PgCharBuilder";constructor(a,b){super(a,"string","PgChar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new ei(a,this.config)}}class ei extends c6{static [cK]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}class ej extends c5{static [cK]="PgCidrBuilder";constructor(a){super(a,"string","PgCidr")}build(a){return new ek(a,this.config)}}class ek extends c6{static [cK]="PgCidr";getSQLType(){return"cidr"}}class el extends c5{static [cK]="PgCustomColumnBuilder";constructor(a,b,c){super(a,"custom","PgCustomColumn"),this.config.fieldConfig=b,this.config.customTypeParams=c}build(a){return new em(a,this.config)}}class em extends c6{static [cK]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(a,b){super(a,b),this.sqlName=b.customTypeParams.dataType(b.fieldConfig),this.mapTo=b.customTypeParams.toDriver,this.mapFrom=b.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(a){return"function"==typeof this.mapFrom?this.mapFrom(a):a}mapToDriverValue(a){return"function"==typeof this.mapTo?this.mapTo(a):a}}class en extends c5{static [cK]="PgDateColumnBaseBuilder";defaultNow(){return this.default(dt`now()`)}}class eo extends en{static [cK]="PgDateBuilder";constructor(a){super(a,"date","PgDate")}build(a){return new ep(a,this.config)}}class ep extends c6{static [cK]="PgDate";getSQLType(){return"date"}mapFromDriverValue(a){return"string"==typeof a?new Date(a):a}mapToDriverValue(a){return a.toISOString()}}class eq extends en{static [cK]="PgDateStringBuilder";constructor(a){super(a,"string","PgDateString")}build(a){return new er(a,this.config)}}class er extends c6{static [cK]="PgDateString";getSQLType(){return"date"}mapFromDriverValue(a){return"string"==typeof a?a:a.toISOString().slice(0,-14)}}class es extends c5{static [cK]="PgDoublePrecisionBuilder";constructor(a){super(a,"number","PgDoublePrecision")}build(a){return new et(a,this.config)}}class et extends c6{static [cK]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(a){return"string"==typeof a?Number.parseFloat(a):a}}class eu extends c5{static [cK]="PgInetBuilder";constructor(a){super(a,"string","PgInet")}build(a){return new ev(a,this.config)}}class ev extends c6{static [cK]="PgInet";getSQLType(){return"inet"}}class ew extends d6{static [cK]="PgIntegerBuilder";constructor(a){super(a,"number","PgInteger")}build(a){return new ex(a,this.config)}}class ex extends c6{static [cK]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(a){return"string"==typeof a?Number.parseInt(a):a}}class ey extends c5{static [cK]="PgIntervalBuilder";constructor(a,b){super(a,"string","PgInterval"),this.config.intervalConfig=b}build(a){return new ez(a,this.config)}}class ez extends c6{static [cK]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let a=this.fields?` ${this.fields}`:"",b=this.precision?`(${this.precision})`:"";return`interval${a}${b}`}}class eA extends c5{static [cK]="PgJsonBuilder";constructor(a){super(a,"json","PgJson")}build(a){return new eB(a,this.config)}}class eB extends c6{static [cK]="PgJson";constructor(a,b){super(a,b)}getSQLType(){return"json"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}class eC extends c5{static [cK]="PgJsonbBuilder";constructor(a){super(a,"json","PgJsonb")}build(a){return new eD(a,this.config)}}class eD extends c6{static [cK]="PgJsonb";constructor(a,b){super(a,b)}getSQLType(){return"jsonb"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}class eE extends c5{static [cK]="PgLineBuilder";constructor(a){super(a,"array","PgLine")}build(a){return new eF(a,this.config)}}class eF extends c6{static [cK]="PgLine";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c),Number.parseFloat(d)]}mapToDriverValue(a){return`{${a[0]},${a[1]},${a[2]}}`}}class eG extends c5{static [cK]="PgLineABCBuilder";constructor(a){super(a,"json","PgLineABC")}build(a){return new eH(a,this.config)}}class eH extends c6{static [cK]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return{a:Number.parseFloat(b),b:Number.parseFloat(c),c:Number.parseFloat(d)}}mapToDriverValue(a){return`{${a.a},${a.b},${a.c}}`}}class eI extends c5{static [cK]="PgMacaddrBuilder";constructor(a){super(a,"string","PgMacaddr")}build(a){return new eJ(a,this.config)}}class eJ extends c6{static [cK]="PgMacaddr";getSQLType(){return"macaddr"}}class eK extends c5{static [cK]="PgMacaddr8Builder";constructor(a){super(a,"string","PgMacaddr8")}build(a){return new eL(a,this.config)}}class eL extends c6{static [cK]="PgMacaddr8";getSQLType(){return"macaddr8"}}class eM extends c5{static [cK]="PgNumericBuilder";constructor(a,b,c){super(a,"string","PgNumeric"),this.config.precision=b,this.config.scale=c}build(a){return new eN(a,this.config)}}class eN extends c6{static [cK]="PgNumeric";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"string"==typeof a?a:String(a)}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class eO extends c5{static [cK]="PgNumericNumberBuilder";constructor(a,b,c){super(a,"number","PgNumericNumber"),this.config.precision=b,this.config.scale=c}build(a){return new eP(a,this.config)}}class eP extends c6{static [cK]="PgNumericNumber";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class eQ extends c5{static [cK]="PgNumericBigIntBuilder";constructor(a,b,c){super(a,"bigint","PgNumericBigInt"),this.config.precision=b,this.config.scale=c}build(a){return new eR(a,this.config)}}class eR extends c6{static [cK]="PgNumericBigInt";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class eS extends c5{static [cK]="PgPointTupleBuilder";constructor(a){super(a,"array","PgPointTuple")}build(a){return new eT(a,this.config)}}class eT extends c6{static [cK]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c)]}return[a.x,a.y]}mapToDriverValue(a){return`(${a[0]},${a[1]})`}}class eU extends c5{static [cK]="PgPointObjectBuilder";constructor(a){super(a,"json","PgPointObject")}build(a){return new eV(a,this.config)}}class eV extends c6{static [cK]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return{x:Number.parseFloat(b),y:Number.parseFloat(c)}}return a}mapToDriverValue(a){return`(${a.x},${a.y})`}}function eW(a,b){let c=new DataView(new ArrayBuffer(8));for(let d=0;d<8;d++)c.setUint8(d,a[b+d]);return c.getFloat64(0,!0)}function eX(a){let b=function(a){let b=[];for(let c=0;c<a.length;c+=2)b.push(Number.parseInt(a.slice(c,c+2),16));return new Uint8Array(b)}(a),c=0,d=b[0];c+=1;let e=new DataView(b.buffer),f=e.getUint32(c,1===d);if(c+=4,0x20000000&f&&(e.getUint32(c,1===d),c+=4),(65535&f)==1){let a=eW(b,c),d=eW(b,c+=8);return c+=8,[a,d]}throw Error("Unsupported geometry type")}class eY extends c5{static [cK]="PgGeometryBuilder";constructor(a){super(a,"array","PgGeometry")}build(a){return new eZ(a,this.config)}}class eZ extends c6{static [cK]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){return eX(a)}mapToDriverValue(a){return`point(${a[0]} ${a[1]})`}}class e$ extends c5{static [cK]="PgGeometryObjectBuilder";constructor(a){super(a,"json","PgGeometryObject")}build(a){return new e_(a,this.config)}}class e_ extends c6{static [cK]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){let b=eX(a);return{x:b[0],y:b[1]}}mapToDriverValue(a){return`point(${a.x} ${a.y})`}}class e0 extends c5{static [cK]="PgRealBuilder";constructor(a,b){super(a,"number","PgReal"),this.config.length=b}build(a){return new e1(a,this.config)}}class e1 extends c6{static [cK]="PgReal";constructor(a,b){super(a,b)}getSQLType(){return"real"}mapFromDriverValue=a=>"string"==typeof a?Number.parseFloat(a):a}class e2 extends c5{static [cK]="PgSerialBuilder";constructor(a){super(a,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new e3(a,this.config)}}class e3 extends c6{static [cK]="PgSerial";getSQLType(){return"serial"}}class e4 extends d6{static [cK]="PgSmallIntBuilder";constructor(a){super(a,"number","PgSmallInt")}build(a){return new e5(a,this.config)}}class e5 extends c6{static [cK]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=a=>"string"==typeof a?Number(a):a}class e6 extends c5{static [cK]="PgSmallSerialBuilder";constructor(a){super(a,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new e7(a,this.config)}}class e7 extends c6{static [cK]="PgSmallSerial";getSQLType(){return"smallserial"}}class e8 extends c5{static [cK]="PgTextBuilder";constructor(a,b){super(a,"string","PgText"),this.config.enumValues=b.enum}build(a){return new e9(a,this.config)}}class e9 extends c6{static [cK]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}class fa extends en{constructor(a,b,c){super(a,"string","PgTime"),this.withTimezone=b,this.precision=c,this.config.withTimezone=b,this.config.precision=c}static [cK]="PgTimeBuilder";build(a){return new fb(a,this.config)}}class fb extends c6{static [cK]="PgTime";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`time${a}${this.withTimezone?" with time zone":""}`}}class fc extends en{static [cK]="PgTimestampBuilder";constructor(a,b,c){super(a,"date","PgTimestamp"),this.config.withTimezone=b,this.config.precision=c}build(a){return new fd(a,this.config)}}class fd extends c6{static [cK]="PgTimestamp";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":` (${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(a){return"string"==typeof a?new Date(this.withTimezone?a:a+"+0000"):a}mapToDriverValue=a=>a.toISOString()}class fe extends en{static [cK]="PgTimestampStringBuilder";constructor(a,b,c){super(a,"string","PgTimestampString"),this.config.withTimezone=b,this.config.precision=c}build(a){return new ff(a,this.config)}}class ff extends c6{static [cK]="PgTimestampString";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue(a){if("string"==typeof a)return a;let b=a.toISOString().slice(0,-1).replace("T"," ");if(this.withTimezone){let c=a.getTimezoneOffset();return`${b}${c<=0?"+":"-"}${Math.floor(Math.abs(c)/60).toString().padStart(2,"0")}`}return b}}class fg extends c5{static [cK]="PgUUIDBuilder";constructor(a){super(a,"string","PgUUID")}defaultRandom(){return this.default(dt`gen_random_uuid()`)}build(a){return new fh(a,this.config)}}class fh extends c6{static [cK]="PgUUID";getSQLType(){return"uuid"}}class fi extends c5{static [cK]="PgVarcharBuilder";constructor(a,b){super(a,"string","PgVarchar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new fj(a,this.config)}}class fj extends c6{static [cK]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}class fk extends c5{static [cK]="PgBinaryVectorBuilder";constructor(a,b){super(a,"string","PgBinaryVector"),this.config.dimensions=b.dimensions}build(a){return new fl(a,this.config)}}class fl extends c6{static [cK]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}class fm extends c5{static [cK]="PgHalfVectorBuilder";constructor(a,b){super(a,"array","PgHalfVector"),this.config.dimensions=b.dimensions}build(a){return new fn(a,this.config)}}class fn extends c6{static [cK]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}class fo extends c5{static [cK]="PgSparseVectorBuilder";constructor(a,b){super(a,"string","PgSparseVector"),this.config.dimensions=b.dimensions}build(a){return new fp(a,this.config)}}class fp extends c6{static [cK]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}class fq extends c5{static [cK]="PgVectorBuilder";constructor(a,b){super(a,"array","PgVector"),this.config.dimensions=b.dimensions}build(a){return new fr(a,this.config)}}class fr extends c6{static [cK]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}let fs=Symbol.for("drizzle:PgInlineForeignKeys"),ft=Symbol.for("drizzle:EnableRLS");class fu extends cW{static [cK]="PgTable";static Symbol=Object.assign({},cW.Symbol,{InlineForeignKeys:fs,EnableRLS:ft});[fs]=[];[ft]=!1;[cW.Symbol.ExtraConfigBuilder]=void 0;[cW.Symbol.ExtraConfigColumns]={}}class fv{static [cK]="PgPrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new fw(a,this.columns,this.name)}}class fw{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [cK]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[fu.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}class fx{constructor(a,b,c){this.sourceTable=a,this.referencedTable=b,this.relationName=c,this.referencedTableName=b[cW.Symbol.Name]}static [cK]="Relation";referencedTableName;fieldName}class fy{constructor(a,b){this.table=a,this.config=b}static [cK]="Relations"}class fz extends fx{constructor(a,b,c,d){super(a,b,c?.relationName),this.config=c,this.isNullable=d}static [cK]="One";withFieldName(a){let b=new fz(this.sourceTable,this.referencedTable,this.config,this.isNullable);return b.fieldName=a,b}}class fA extends fx{constructor(a,b,c){super(a,b,c?.relationName),this.config=c}static [cK]="Many";withFieldName(a){let b=new fA(this.sourceTable,this.referencedTable,this.config);return b.fieldName=a,b}}function fB(a,b){1===Object.keys(a).length&&"default"in a&&!cL(a.default,cW)&&(a=a.default);let c={},d={},e={};for(let[f,g]of Object.entries(a))if(cL(g,cW)){let a=cX(g),b=d[a];for(let d of(c[a]=f,e[f]={tsName:f,dbName:g[cW.Symbol.Name],schema:g[cW.Symbol.Schema],columns:g[cW.Symbol.Columns],relations:b?.relations??{},primaryKey:b?.primaryKey??[]},Object.values(g[cW.Symbol.Columns])))d.primary&&e[f].primaryKey.push(d);let h=g[cW.Symbol.ExtraConfigBuilder]?.(g[cW.Symbol.ExtraConfigColumns]);if(h)for(let a of Object.values(h))cL(a,fv)&&e[f].primaryKey.push(...a.columns)}else if(cL(g,fy)){let a,f=cX(g.table),h=c[f];for(let[c,i]of Object.entries(g.config(b(g.table))))if(h){let b=e[h];b.relations[c]=i,a&&b.primaryKey.push(...a)}else f in d||(d[f]={relations:{},primaryKey:a}),d[f].relations[c]=i}return{tables:e,tableNamesMap:c}}function fC(a){return{one:function(b,c){return new fz(a,b,c,c?.fields.reduce((a,b)=>a&&b.notNull,!0)??!1)},many:function(b,c){return new fA(a,b,c)}}}class fD{constructor(a){this.table=a}static [cK]="ColumnAliasProxyHandler";get(a,b){return"table"===b?this.table:a[b]}}class fE{constructor(a,b){this.alias=a,this.replaceOriginalName=b}static [cK]="TableAliasProxyHandler";get(a,b){if(b===cW.Symbol.IsAlias)return!0;if(b===cW.Symbol.Name||this.replaceOriginalName&&b===cW.Symbol.OriginalName)return this.alias;if(b===dj)return{...a[dj],name:this.alias,isAlias:!0};if(b===cW.Symbol.Columns){let b=a[cW.Symbol.Columns];if(!b)return b;let c={};return Object.keys(b).map(d=>{c[d]=new Proxy(b[d],new fD(new Proxy(a,this)))}),c}let c=a[b];return cL(c,cM)?new Proxy(c,new fD(new Proxy(a,this))):c}}class fF{constructor(a){this.alias=a}static [cK]="RelationTableAliasProxyHandler";get(a,b){return"sourceTable"===b?fG(a.sourceTable,this.alias):a[b]}}function fG(a,b){return new Proxy(a,new fE(b,!1))}function fH(a,b){return new Proxy(a,new fD(new Proxy(a.table,new fE(b,!1))))}function fI(a,b){return new dn.Aliased(fJ(a.sql,b),a.fieldAlias)}function fJ(a,b){return dt.join(a.queryChunks.map(a=>cL(a,cM)?fH(a,b):cL(a,dn)?fJ(a,b):cL(a,dn.Aliased)?fI(a,b):a))}class fK{static [cK]="SelectionProxyHandler";config;constructor(a){this.config={...a}}get(a,b){if("_"===b)return{...a._,selectedFields:new Proxy(a._.selectedFields,this)};if(b===dj)return{...a[dj],selectedFields:new Proxy(a[dj].selectedFields,this)};if("symbol"==typeof b)return a[b];let c=(cL(a,dg)?a._.selectedFields:cL(a,dz)?a[dj].selectedFields:a)[b];if(cL(c,dn.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!c.isSelectionField)return c.sql;let a=c.clone();return a.isSelectionField=!0,a}if(cL(c,dn)){if("sql"===this.config.sqlBehavior)return c;throw Error(`You tried to reference "${b}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return cL(c,cM)?this.config.alias?new Proxy(c,new fD(new Proxy(c.table,new fE(this.config.alias,this.config.replaceOriginalName??!1)))):c:"object"!=typeof c||null===c?c:new Proxy(c,new fK(this.config))}}function fL(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(a=>a.toLowerCase()).join("_")}function fM(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((a,b,c)=>a+(0===c?b.toLowerCase():`${b[0].toUpperCase()}${b.slice(1)}`),"")}function fN(a){return a}class fO{static [cK]="CasingCache";cache={};cachedTables={};convert;constructor(a){this.convert="snake_case"===a?fL:"camelCase"===a?fM:fN}getColumnCasing(a){if(!a.keyAsName)return a.name;let b=a.table[cW.Symbol.Schema]??"public",c=a.table[cW.Symbol.OriginalName],d=`${b}.${c}.${a.name}`;return this.cache[d]||this.cacheTable(a.table),this.cache[d]}cacheTable(a){let b=a[cW.Symbol.Schema]??"public",c=a[cW.Symbol.OriginalName],d=`${b}.${c}`;if(!this.cachedTables[d]){for(let b of Object.values(a[cW.Symbol.Columns])){let a=`${d}.${b.name}`;this.cache[a]=this.convert(b.name)}this.cachedTables[d]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class fP extends Error{static [cK]="DrizzleError";constructor({message:a,cause:b}){super(a),this.name="DrizzleError",this.cause=b}}class fQ extends Error{constructor(a,b,c){super(`Failed query: ${a}
params: ${b}`),this.query=a,this.params=b,this.cause=c,Error.captureStackTrace(this,fQ),c&&(this.cause=c)}}class fR extends fP{static [cK]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}class fS{static [cK]="SQLiteForeignKeyBuilder";reference;_onUpdate;_onDelete;constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=a,this}onDelete(a){return this._onDelete=a,this}build(a){return new fT(a,this)}}class fT{constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [cK]="SQLiteForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),e=c.map(a=>a.name),f=[this.table[cN],...d,c[0].table[cN],...e];return a??`${f.join("_")}_fk`}}function fU(a,b){return`${a[cN]}_${b.join("_")}_unique`}class fV{constructor(a,b){this.name=b,this.columns=a}static [cK]="SQLiteUniqueConstraintBuilder";columns;build(a){return new fX(a,this.columns,this.name)}}class fW{static [cK]="SQLiteUniqueOnConstraintBuilder";name;constructor(a){this.name=a}on(...a){return new fV(a,this.name)}}class fX{constructor(a,b,c){this.table=a,this.columns=b,this.name=c??fU(this.table,this.columns.map(a=>a.name))}static [cK]="SQLiteUniqueConstraint";columns;name;getName(){return this.name}}class fY extends cY{static [cK]="SQLiteColumnBuilder";foreignKeyConfigs=[];references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a){return this.config.isUnique=!0,this.config.uniqueName=a,this}generatedAlwaysAs(a,b){return this.config.generated={as:a,type:"always",mode:b?.mode??"virtual"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>{let e;return e=new fS(()=>({columns:[a],foreignColumns:[c()]})),d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)})}}class fZ extends cM{constructor(a,b){b.uniqueName||(b.uniqueName=fU(a,[b.name])),super(a,b),this.table=a}static [cK]="SQLiteColumn"}class f$ extends fY{static [cK]="SQLiteBigIntBuilder";constructor(a){super(a,"bigint","SQLiteBigInt")}build(a){return new f_(a,this.config)}}class f_ extends fZ{static [cK]="SQLiteBigInt";getSQLType(){return"blob"}mapFromDriverValue(a){return"undefined"!=typeof Buffer&&Buffer.from?BigInt((Buffer.isBuffer(a)?a:a instanceof ArrayBuffer?Buffer.from(a):a.buffer?Buffer.from(a.buffer,a.byteOffset,a.byteLength):Buffer.from(a)).toString("utf8")):BigInt(d5.decode(a))}mapToDriverValue(a){return Buffer.from(a.toString())}}class f0 extends fY{static [cK]="SQLiteBlobJsonBuilder";constructor(a){super(a,"json","SQLiteBlobJson")}build(a){return new f1(a,this.config)}}class f1 extends fZ{static [cK]="SQLiteBlobJson";getSQLType(){return"blob"}mapFromDriverValue(a){return"undefined"!=typeof Buffer&&Buffer.from?JSON.parse((Buffer.isBuffer(a)?a:a instanceof ArrayBuffer?Buffer.from(a):a.buffer?Buffer.from(a.buffer,a.byteOffset,a.byteLength):Buffer.from(a)).toString("utf8")):JSON.parse(d5.decode(a))}mapToDriverValue(a){return Buffer.from(JSON.stringify(a))}}class f2 extends fY{static [cK]="SQLiteBlobBufferBuilder";constructor(a){super(a,"buffer","SQLiteBlobBuffer")}build(a){return new f3(a,this.config)}}class f3 extends fZ{static [cK]="SQLiteBlobBuffer";mapFromDriverValue(a){return Buffer.isBuffer(a)?a:Buffer.from(a)}getSQLType(){return"blob"}}function f4(a,b){let{name:c,config:d}=d4(a,b);return d?.mode==="json"?new f0(c):d?.mode==="bigint"?new f$(c):new f2(c)}class f5 extends fY{static [cK]="SQLiteCustomColumnBuilder";constructor(a,b,c){super(a,"custom","SQLiteCustomColumn"),this.config.fieldConfig=b,this.config.customTypeParams=c}build(a){return new f6(a,this.config)}}class f6 extends fZ{static [cK]="SQLiteCustomColumn";sqlName;mapTo;mapFrom;constructor(a,b){super(a,b),this.sqlName=b.customTypeParams.dataType(b.fieldConfig),this.mapTo=b.customTypeParams.toDriver,this.mapFrom=b.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(a){return"function"==typeof this.mapFrom?this.mapFrom(a):a}mapToDriverValue(a){return"function"==typeof this.mapTo?this.mapTo(a):a}}function f7(a){return(b,c)=>{let{name:d,config:e}=d4(b,c);return new f5(d,e,a)}}class f8 extends fY{static [cK]="SQLiteBaseIntegerBuilder";constructor(a,b,c){super(a,b,c),this.config.autoIncrement=!1}primaryKey(a){return a?.autoIncrement&&(this.config.autoIncrement=!0),this.config.hasDefault=!0,super.primaryKey()}}class f9 extends fZ{static [cK]="SQLiteBaseInteger";autoIncrement=this.config.autoIncrement;getSQLType(){return"integer"}}class ga extends f8{static [cK]="SQLiteIntegerBuilder";constructor(a){super(a,"number","SQLiteInteger")}build(a){return new gb(a,this.config)}}class gb extends f9{static [cK]="SQLiteInteger"}class gc extends f8{static [cK]="SQLiteTimestampBuilder";constructor(a,b){super(a,"date","SQLiteTimestamp"),this.config.mode=b}defaultNow(){return this.default(dt`(cast((julianday('now') - 2440587.5)*86400000 as integer))`)}build(a){return new gd(a,this.config)}}class gd extends f9{static [cK]="SQLiteTimestamp";mode=this.config.mode;mapFromDriverValue(a){return new Date("timestamp"===this.config.mode?1e3*a:a)}mapToDriverValue(a){let b=a.getTime();return"timestamp"===this.config.mode?Math.floor(b/1e3):b}}class ge extends f8{static [cK]="SQLiteBooleanBuilder";constructor(a,b){super(a,"boolean","SQLiteBoolean"),this.config.mode=b}build(a){return new gf(a,this.config)}}class gf extends f9{static [cK]="SQLiteBoolean";mode=this.config.mode;mapFromDriverValue(a){return 1===Number(a)}mapToDriverValue(a){return+!!a}}function gg(a,b){let{name:c,config:d}=d4(a,b);return d?.mode==="timestamp"||d?.mode==="timestamp_ms"?new gc(c,d.mode):d?.mode==="boolean"?new ge(c,d.mode):new ga(c)}class gh extends fY{static [cK]="SQLiteNumericBuilder";constructor(a){super(a,"string","SQLiteNumeric")}build(a){return new gi(a,this.config)}}class gi extends fZ{static [cK]="SQLiteNumeric";mapFromDriverValue(a){return"string"==typeof a?a:String(a)}getSQLType(){return"numeric"}}class gj extends fY{static [cK]="SQLiteNumericNumberBuilder";constructor(a){super(a,"number","SQLiteNumericNumber")}build(a){return new gk(a,this.config)}}class gk extends fZ{static [cK]="SQLiteNumericNumber";mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}mapToDriverValue=String;getSQLType(){return"numeric"}}class gl extends fY{static [cK]="SQLiteNumericBigIntBuilder";constructor(a){super(a,"bigint","SQLiteNumericBigInt")}build(a){return new gm(a,this.config)}}class gm extends fZ{static [cK]="SQLiteNumericBigInt";mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return"numeric"}}function gn(a,b){let{name:c,config:d}=d4(a,b),e=d?.mode;return"number"===e?new gj(c):"bigint"===e?new gl(c):new gh(c)}class go extends fY{static [cK]="SQLiteRealBuilder";constructor(a){super(a,"number","SQLiteReal")}build(a){return new gp(a,this.config)}}class gp extends fZ{static [cK]="SQLiteReal";getSQLType(){return"real"}}function gq(a){return new go(a??"")}class gr extends fY{static [cK]="SQLiteTextBuilder";constructor(a,b){super(a,"string","SQLiteText"),this.config.enumValues=b.enum,this.config.length=b.length}build(a){return new gs(a,this.config)}}class gs extends fZ{static [cK]="SQLiteText";enumValues=this.config.enumValues;length=this.config.length;constructor(a,b){super(a,b)}getSQLType(){return`text${this.config.length?`(${this.config.length})`:""}`}}class gt extends fY{static [cK]="SQLiteTextJsonBuilder";constructor(a){super(a,"json","SQLiteTextJson")}build(a){return new gu(a,this.config)}}class gu extends fZ{static [cK]="SQLiteTextJson";getSQLType(){return"text"}mapFromDriverValue(a){return JSON.parse(a)}mapToDriverValue(a){return JSON.stringify(a)}}function gv(a,b={}){let{name:c,config:d}=d4(a,b);return"json"===d.mode?new gt(c):new gr(c,d)}let gw=Symbol.for("drizzle:SQLiteInlineForeignKeys");class gx extends cW{static [cK]="SQLiteTable";static Symbol=Object.assign({},cW.Symbol,{InlineForeignKeys:gw});[cW.Symbol.Columns];[gw]=[];[cW.Symbol.ExtraConfigBuilder]=void 0}let gy=(a,b,c)=>(function(a,b,c,d,e=a){let f=new gx(a,void 0,e),g=Object.fromEntries(Object.entries("function"==typeof b?b({blob:f4,customType:f7,integer:gg,numeric:gn,real:gq,text:gv}):b).map(([a,b])=>{b.setName(a);let c=b.build(f);return f[gw].push(...b.buildForeignKeys(c,f)),[a,c]})),h=Object.assign(f,g);return h[cW.Symbol.Columns]=g,h[cW.Symbol.ExtraConfigColumns]=g,c&&(h[gx.Symbol.ExtraConfigBuilder]=c),h})(a,b,c);class gz extends dz{static [cK]="SQLiteViewBase"}class gA{static [cK]="SQLiteDialect";casing;constructor(a){this.casing=new fO(a?.casing)}escapeName(a){return`"${a}"`}escapeParam(a){return"?"}escapeString(a){return`'${a.replace(/'/g,"''")}'`}buildWithCTE(a){if(!a?.length)return;let b=[dt`with `];for(let[c,d]of a.entries())b.push(dt`${dt.identifier(d._.alias)} as (${d._.sql})`),c<a.length-1&&b.push(dt`, `);return b.push(dt` `),dt.join(b)}buildDeleteQuery({table:a,where:b,returning:c,withList:d,limit:e,orderBy:f}){let g=this.buildWithCTE(d),h=c?dt` returning ${this.buildSelection(c,{isSingleTable:!0})}`:void 0,i=b?dt` where ${b}`:void 0,j=this.buildOrderBy(f),k=this.buildLimit(e);return dt`${g}delete from ${a}${i}${h}${j}${k}`}buildUpdateSet(a,b){let c=a[cW.Symbol.Columns],d=Object.keys(c).filter(a=>void 0!==b[a]||c[a]?.onUpdateFn!==void 0),e=d.length;return dt.join(d.flatMap((a,d)=>{let f=c[a],g=f.onUpdateFn?.(),h=b[a]??(cL(g,dn)?g:dt.param(g,f)),i=dt`${dt.identifier(this.casing.getColumnCasing(f))} = ${h}`;return d<e-1?[i,dt.raw(", ")]:[i]}))}buildUpdateQuery({table:a,set:b,where:c,returning:d,withList:e,joins:f,from:g,limit:h,orderBy:i}){let j=this.buildWithCTE(e),k=this.buildUpdateSet(a,b),l=g&&dt.join([dt.raw(" from "),this.buildFromTable(g)]),m=this.buildJoins(f),n=d?dt` returning ${this.buildSelection(d,{isSingleTable:!0})}`:void 0,o=c?dt` where ${c}`:void 0,p=this.buildOrderBy(i),q=this.buildLimit(h);return dt`${j}update ${a} set ${k}${l}${m}${o}${n}${p}${q}`}buildSelection(a,{isSingleTable:b=!1}={}){let c=a.length,d=a.flatMap(({field:a},d)=>{let e=[];if(cL(a,dn.Aliased)&&a.isSelectionField)e.push(dt.identifier(a.fieldAlias));else if(cL(a,dn.Aliased)||cL(a,dn)){let c=cL(a,dn.Aliased)?a.sql:a;b?e.push(new dn(c.queryChunks.map(a=>cL(a,cM)?dt.identifier(this.casing.getColumnCasing(a)):a))):e.push(c),cL(a,dn.Aliased)&&e.push(dt` as ${dt.identifier(a.fieldAlias)}`)}else if(cL(a,cM)){let c=a.table[cW.Symbol.Name];"SQLiteNumericBigInt"===a.columnType?b?e.push(dt`cast(${dt.identifier(this.casing.getColumnCasing(a))} as text)`):e.push(dt`cast(${dt.identifier(c)}.${dt.identifier(this.casing.getColumnCasing(a))} as text)`):b?e.push(dt.identifier(this.casing.getColumnCasing(a))):e.push(dt`${dt.identifier(c)}.${dt.identifier(this.casing.getColumnCasing(a))}`)}else if(cL(a,dg)){let b=Object.entries(a._.selectedFields);if(1===b.length){let c=b[0][1],d=cL(c,dn)?c.decoder:cL(c,cM)?{mapFromDriverValue:a=>c.mapFromDriverValue(a)}:c.sql.decoder;d&&(a._.sql.decoder=d)}e.push(a)}return d<c-1&&e.push(dt`, `),e});return dt.join(d)}buildJoins(a){if(!a||0===a.length)return;let b=[];if(a)for(let[c,d]of a.entries()){0===c&&b.push(dt` `);let e=d.table,f=d.on?dt` on ${d.on}`:void 0;if(cL(e,gx)){let a=e[gx.Symbol.Name],c=e[gx.Symbol.Schema],g=e[gx.Symbol.OriginalName],h=a===g?void 0:d.alias;b.push(dt`${dt.raw(d.joinType)} join ${c?dt`${dt.identifier(c)}.`:void 0}${dt.identifier(g)}${h&&dt` ${dt.identifier(h)}`}${f}`)}else b.push(dt`${dt.raw(d.joinType)} join ${e}${f}`);c<a.length-1&&b.push(dt` `)}return dt.join(b)}buildLimit(a){return"object"==typeof a||"number"==typeof a&&a>=0?dt` limit ${a}`:void 0}buildOrderBy(a){let b=[];if(a)for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push(dt`, `);return b.length>0?dt` order by ${dt.join(b)}`:void 0}buildFromTable(a){return cL(a,cW)&&a[cW.Symbol.IsAlias]?dt`${dt`${dt.identifier(a[cW.Symbol.Schema]??"")}.`.if(a[cW.Symbol.Schema])}${dt.identifier(a[cW.Symbol.OriginalName])} ${dt.identifier(a[cW.Symbol.Name])}`:a}buildSelectQuery({withList:a,fields:b,fieldsFlat:c,where:d,having:e,table:f,joins:g,orderBy:h,groupBy:i,limit:j,offset:k,distinct:l,setOperators:m}){let n=c??d0(b);for(let a of n){let b;if(cL(a.field,cM)&&a.field.table[cN]!==(cL(f,dg)?f._.alias:cL(f,gz)?f[dj].name:cL(f,dn)?void 0:f[cN])&&(b=a.field.table,!g?.some(({alias:a})=>a===(b[cW.Symbol.IsAlias]?b[cN]:b[cW.Symbol.BaseName])))){let b=a.field.table[cN];throw Error(`Your "${a.path.join("->")}" field references a column "${b}"."${a.field.name}", but the table "${b}" is not part of the query! Did you forget to join it?`)}}let o=!g||0===g.length,p=this.buildWithCTE(a),q=l?dt` distinct`:void 0,r=this.buildSelection(n,{isSingleTable:o}),s=this.buildFromTable(f),t=this.buildJoins(g),u=d?dt` where ${d}`:void 0,v=e?dt` having ${e}`:void 0,w=[];if(i)for(let[a,b]of i.entries())w.push(b),a<i.length-1&&w.push(dt`, `);let x=w.length>0?dt` group by ${dt.join(w)}`:void 0,y=this.buildOrderBy(h),z=this.buildLimit(j),A=k?dt` offset ${k}`:void 0,B=dt`${p}select${q} ${r} from ${s}${t}${u}${x}${v}${y}${z}${A}`;return m.length>0?this.buildSetOperations(B,m):B}buildSetOperations(a,b){let[c,...d]=b;if(!c)throw Error("Cannot pass undefined values to any set operator");return 0===d.length?this.buildSetOperationQuery({leftSelect:a,setOperator:c}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:a,setOperator:c}),d)}buildSetOperationQuery({leftSelect:a,setOperator:{type:b,isAll:c,rightSelect:d,limit:e,orderBy:f,offset:g}}){let h,i=dt`${a.getSQL()} `,j=dt`${d.getSQL()}`;if(f&&f.length>0){let a=[];for(let b of f)if(cL(b,fZ))a.push(dt.identifier(b.name));else if(cL(b,dn)){for(let a=0;a<b.queryChunks.length;a++){let c=b.queryChunks[a];cL(c,fZ)&&(b.queryChunks[a]=dt.identifier(this.casing.getColumnCasing(c)))}a.push(dt`${b}`)}else a.push(dt`${b}`);h=dt` order by ${dt.join(a,dt`, `)}`}let k="object"==typeof e||"number"==typeof e&&e>=0?dt` limit ${e}`:void 0,l=dt.raw(`${b} ${c?"all ":""}`),m=g?dt` offset ${g}`:void 0;return dt`${i}${l}${j}${h}${k}${m}`}buildInsertQuery({table:a,values:b,onConflict:c,returning:d,withList:e,select:f}){let g=[],h=Object.entries(a[cW.Symbol.Columns]).filter(([a,b])=>!b.shouldDisableInsert()),i=h.map(([,a])=>dt.identifier(this.casing.getColumnCasing(a)));if(f)cL(b,dn)?g.push(b):g.push(b.getSQL());else for(let[a,c]of(g.push(dt.raw("values ")),b.entries())){let d=[];for(let[a,b]of h){let e=c[a];if(void 0===e||cL(e,ds)&&void 0===e.value){let a;if(null!==b.default&&void 0!==b.default)a=cL(b.default,dn)?b.default:dt.param(b.default,b);else if(void 0!==b.defaultFn){let c=b.defaultFn();a=cL(c,dn)?c:dt.param(c,b)}else if(b.default||void 0===b.onUpdateFn)a=dt`null`;else{let c=b.onUpdateFn();a=cL(c,dn)?c:dt.param(c,b)}d.push(a)}else d.push(e)}g.push(d),a<b.length-1&&g.push(dt`, `)}let j=this.buildWithCTE(e),k=dt.join(g),l=d?dt` returning ${this.buildSelection(d,{isSingleTable:!0})}`:void 0,m=c?.length?dt.join(c):void 0;return dt`${j}insert into ${a} ${i} ${k}${m}${l}`}sqlToQuery(a,b){return a.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,invokeSource:b})}buildRelationalQuery({fullSchema:a,schema:b,tableNamesMap:c,table:d,tableConfig:e,queryConfig:f,tableAlias:g,nestedQueryRelation:h,joinOn:i}){let j,k=[],l,m,n=[],o,p=[];if(!0===f)k=Object.entries(e.columns).map(([a,b])=>({dbKey:b.name,tsKey:a,field:fH(b,g),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let d=Object.fromEntries(Object.entries(e.columns).map(([a,b])=>[a,fH(b,g)]));if(f.where){let a="function"==typeof f.where?f.where(d,{and:dD,between:dQ,eq:dB,exists:dO,gt:dG,gte:dH,ilike:dU,inArray:dK,isNull:dM,isNotNull:dN,like:dS,lt:dI,lte:dJ,ne:dC,not:dF,notBetween:dR,notExists:dP,notLike:dT,notIlike:dV,notInArray:dL,or:dE,sql:dt}):f.where;o=a&&fJ(a,g)}let h=[],i=[];if(f.columns){let a=!1;for(let[b,c]of Object.entries(f.columns))void 0!==c&&b in e.columns&&(a||!0!==c||(a=!0),i.push(b));i.length>0&&(i=a?i.filter(a=>f.columns?.[a]===!0):Object.keys(e.columns).filter(a=>!i.includes(a)))}else i=Object.keys(e.columns);for(let a of i){let b=e.columns[a];h.push({tsKey:a,value:b})}let j=[];if(f.with&&(j=Object.entries(f.with).filter(a=>!!a[1]).map(([a,b])=>({tsKey:a,queryConfig:b,relation:e.relations[a]}))),f.extras)for(let[a,b]of Object.entries("function"==typeof f.extras?f.extras(d,{sql:dt}):f.extras))h.push({tsKey:a,value:fI(b,g)});for(let{tsKey:a,value:b}of h)k.push({dbKey:cL(b,dn.Aliased)?b.fieldAlias:e.columns[a].name,tsKey:a,field:cL(b,cM)?fH(b,g):b,relationTableTsKey:void 0,isJson:!1,selection:[]});let p="function"==typeof f.orderBy?f.orderBy(d,{sql:dt,asc:dW,desc:dX}):f.orderBy??[];for(let{tsKey:d,queryConfig:e,relation:h}of(Array.isArray(p)||(p=[p]),n=p.map(a=>cL(a,cM)?fH(a,g):fJ(a,g)),l=f.limit,m=f.offset,j)){let f=function(a,b,c){if(cL(c,fz)&&c.config)return{fields:c.config.fields,references:c.config.references};let d=b[cX(c.referencedTable)];if(!d)throw Error(`Table "${c.referencedTable[cW.Symbol.Name]}" not found in schema`);let e=a[d];if(!e)throw Error(`Table "${d}" not found in schema`);let f=c.sourceTable,g=b[cX(f)];if(!g)throw Error(`Table "${f[cW.Symbol.Name]}" not found in schema`);let h=[];for(let a of Object.values(e.relations))(c.relationName&&c!==a&&a.relationName===c.relationName||!c.relationName&&a.referencedTable===c.sourceTable)&&h.push(a);if(h.length>1)throw c.relationName?Error(`There are multiple relations with name "${c.relationName}" in table "${d}"`):Error(`There are multiple relations between "${d}" and "${c.sourceTable[cW.Symbol.Name]}". Please specify relation name`);if(h[0]&&cL(h[0],fz)&&h[0].config)return{fields:h[0].config.references,references:h[0].config.fields};throw Error(`There is not enough information to infer relation "${g}.${c.fieldName}"`)}(b,c,h),i=c[cX(h.referencedTable)],j=`${g}_${d}`,l=dD(...f.fields.map((a,b)=>dB(fH(f.references[b],j),fH(a,g)))),m=this.buildRelationalQuery({fullSchema:a,schema:b,tableNamesMap:c,table:a[i],tableConfig:b[i],queryConfig:cL(h,fz)?!0===e?{limit:1}:{...e,limit:1}:e,tableAlias:j,joinOn:l,nestedQueryRelation:h}),n=dt`(${m.sql})`.as(d);k.push({dbKey:d,tsKey:d,field:n,relationTableTsKey:i,isJson:!0,selection:m.selection})}}if(0===k.length)throw new fP({message:`No fields selected for table "${e.tsName}" ("${g}"). You need to have at least one item in "columns", "with" or "extras". If you need to select all columns, omit the "columns" key or set it to undefined.`});if(o=dD(i,o),h){let a=dt`json_array(${dt.join(k.map(({field:a})=>cL(a,fZ)?dt.identifier(this.casing.getColumnCasing(a)):cL(a,dn.Aliased)?a.sql:a),dt`, `)})`;cL(h,fA)&&(a=dt`coalesce(json_group_array(${a}), json_array())`);let b=[{dbKey:"data",tsKey:"data",field:a.as("data"),isJson:!0,relationTableTsKey:e.tsName,selection:k}];void 0!==l||void 0!==m||n.length>0?(j=this.buildSelectQuery({table:fG(d,g),fields:{},fieldsFlat:[{path:[],field:dt.raw("*")}],where:o,limit:l,offset:m,orderBy:n,setOperators:[]}),o=void 0,l=void 0,m=void 0,n=void 0):j=fG(d,g),j=this.buildSelectQuery({table:cL(j,gx)?j:new dg(j,{},g),fields:{},fieldsFlat:b.map(({field:a})=>({path:[],field:cL(a,cM)?fH(a,g):a})),joins:p,where:o,limit:l,offset:m,orderBy:n,setOperators:[]})}else j=this.buildSelectQuery({table:fG(d,g),fields:{},fieldsFlat:k.map(({field:a})=>({path:[],field:cL(a,cM)?fH(a,g):a})),joins:p,where:o,limit:l,offset:m,orderBy:n,setOperators:[]});return{tableTsKey:e.tsName,sql:j,selection:k}}}class gB extends gA{static [cK]="SQLiteSyncDialect";migrate(a,b,c){let d=void 0===c||"string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e=dt`
			CREATE TABLE IF NOT EXISTS ${dt.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;b.run(e);let f=b.values(dt`SELECT id, hash, created_at FROM ${dt.identifier(d)} ORDER BY created_at DESC LIMIT 1`)[0]??void 0;b.run(dt`BEGIN`);try{for(let c of a)if(!f||Number(f[2])<c.folderMillis){for(let a of c.sql)b.run(dt.raw(a));b.run(dt`INSERT INTO ${dt.identifier(d)} ("hash", "created_at") VALUES(${c.hash}, ${c.folderMillis})`)}b.run(dt`COMMIT`)}catch(a){throw b.run(dt`ROLLBACK`),a}}}class gC extends gA{static [cK]="SQLiteAsyncDialect";async migrate(a,b,c){let d=void 0===c||"string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e=dt`
			CREATE TABLE IF NOT EXISTS ${dt.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at numeric
			)
		`;await b.run(e);let f=(await b.values(dt`SELECT id, hash, created_at FROM ${dt.identifier(d)} ORDER BY created_at DESC LIMIT 1`))[0]??void 0;await b.transaction(async b=>{for(let c of a)if(!f||Number(f[2])<c.folderMillis){for(let a of c.sql)await b.run(dt.raw(a));await b.run(dt`INSERT INTO ${dt.identifier(d)} ("hash", "created_at") VALUES(${c.hash}, ${c.folderMillis})`)}})}}class gD{static [cK]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class gE{static [cK]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}then(a,b){return this.execute().then(a,b)}}class gF{constructor(a,b){this.name=a,this.value=b}static [cK]="SQLiteCheckBuilder";brand;build(a){return new gG(a,this)}}class gG{constructor(a,b){this.table=a,this.name=b.name,this.value=b.value}static [cK]="SQLiteCheck";name;value}class gH{constructor(a,b){this.name=a,this.unique=b}static [cK]="SQLiteIndexBuilderOn";on(...a){return new gI(this.name,a,this.unique)}}class gI{static [cK]="SQLiteIndexBuilder";config;constructor(a,b,c){this.config={name:a,columns:b,unique:c,where:void 0}}where(a){return this.config.where=a,this}build(a){return new gJ(this.config,a)}}class gJ{static [cK]="SQLiteIndex";config;constructor(a,b){this.config={...a,table:b}}}class gK{static [cK]="SQLitePrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new gL(a,this.columns,this.name)}}class gL{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [cK]="SQLitePrimaryKey";columns;name;getName(){return this.name??`${this.table[gx.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}function gM(a){return cL(a,gx)?[`${a[cW.Symbol.BaseName]}`]:cL(a,dg)?a._.usedTables??[]:cL(a,dn)?a.usedTables??[]:[]}class gN{static [cK]="SQLiteSelectBuilder";fields;session;dialect;withList;distinct;constructor(a){this.fields=a.fields,this.session=a.session,this.dialect=a.dialect,this.withList=a.withList,this.distinct=a.distinct}from(a){let b,c=!!this.fields;return b=this.fields?this.fields:cL(a,dg)?Object.fromEntries(Object.keys(a._.selectedFields).map(b=>[b,a[b]])):cL(a,gz)?a[dj].selectedFields:cL(a,dn)?{}:a[cW.Symbol.Columns],new gP({table:a,fields:b,isPartialSelect:c,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct})}}class gO extends gD{static [cK]="SQLiteSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:a,fields:b,isPartialSelect:c,session:d,dialect:e,withList:f,distinct:g}){for(const h of(super(),this.config={withList:f,table:a,fields:{...b},distinct:g,setOperators:[]},this.isPartialSelect=c,this.session=d,this.dialect=e,this._={selectedFields:b,config:this.config},this.tableName=d3(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},gM(a)))this.usedTables.add(h)}getUsedTables(){return[...this.usedTables]}createJoin(a){return(b,c)=>{let d=this.tableName,e=d3(b);for(let a of gM(b))this.usedTables.add(a);if("string"==typeof e&&this.config.joins?.some(a=>a.alias===e))throw Error(`Alias "${e}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof d&&(this.config.fields={[d]:this.config.fields}),"string"==typeof e&&!cL(b,dn))){let a=cL(b,dg)?b._.selectedFields:cL(b,dz)?b[dj].selectedFields:b[cW.Symbol.Columns];this.config.fields[e]=a}if("function"==typeof c&&(c=c(new Proxy(this.config.fields,new fK({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:c,table:b,joinType:a,alias:e}),"string"==typeof e)switch(a){case"left":this.joinsNotNullableMap[e]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[e]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[e]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[e]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");crossJoin=this.createJoin("cross");createSetOperator(a,b){return c=>{let d="function"==typeof c?c(gR()):c;if(!d1(this.getSelectedFields(),d.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:a,isAll:b,rightSelect:d}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);except=this.createSetOperator("except",!1);addSetOperators(a){return this.config.setOperators.push(...a),this}where(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new fK({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=a,this}having(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new fK({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=a,this}groupBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new fK({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(b)?b:[b]}else this.config.groupBy=a;return this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new fK({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=c:this.config.orderBy=c}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=a:this.config.orderBy=a;return this}limit(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=a:this.config.limit=a,this}offset(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=a:this.config.offset=a,this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}as(a){let b=[];if(b.push(...gM(this.config.table)),this.config.joins)for(let a of this.config.joins)b.push(...gM(a.table));return new Proxy(new dg(this.getSQL(),this.config.fields,a,!1,[...new Set(b)]),new fK({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new fK({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class gP extends gO{static [cK]="SQLiteSelect";_prepare(a=!0){if(!this.session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let b=d0(this.config.fields),c=this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),b,"all",!0,void 0,{type:"select",tables:[...this.usedTables]},this.cacheConfig);return c.joinsNotNullableMap=this.joinsNotNullableMap,c}$withCache(a){return this.cacheConfig=void 0===a?{config:{},enable:!0,autoInvalidate:!0}:!1===a?{enable:!1}:{enable:!0,autoInvalidate:!0,...a},this}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.all()}}for(let a of[gE])for(let b of Object.getOwnPropertyNames(a.prototype))"constructor"!==b&&Object.defineProperty(gP.prototype,b,Object.getOwnPropertyDescriptor(a.prototype,b)||Object.create(null));function gQ(a,b){return(c,d,...e)=>{let f=[d,...e].map(c=>({type:a,isAll:b,rightSelect:c}));for(let a of f)if(!d1(c.getSelectedFields(),a.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return c.addSetOperators(f)}}let gR=()=>({union:gS,unionAll:gT,intersect:gU,except:gV}),gS=gQ("union",!1),gT=gQ("union",!0),gU=gQ("intersect",!1),gV=gQ("except",!1);class gW{static [cK]="SQLiteQueryBuilder";dialect;dialectConfig;constructor(a){this.dialect=cL(a,gA)?a:void 0,this.dialectConfig=cL(a,gA)?void 0:a}$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(c)),new Proxy(new dh(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new fK({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...a){let b=this;return{select:function(c){return new gN({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a})},selectDistinct:function(c){return new gN({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a,distinct:!0})}}}select(a){return new gN({fields:a??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(a){return new gN({fields:a??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}getDialect(){return this.dialect||(this.dialect=new gB(this.dialectConfig)),this.dialect}}class gX extends gE{constructor(a,b,c,d){super(),this.table=a,this.session=b,this.dialect=c,this.config={table:a,withList:d}}static [cK]="SQLiteDelete";config;where(a){return this.config.where=a,this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.table[cW.Symbol.Columns],new fK({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.orderBy=c}else this.config.orderBy=a;return this}limit(a){return this.config.limit=a,this}returning(a=this.table[gx.Symbol.Columns]){return this.config.returning=d0(a),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"delete",tables:gM(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(a){return this._prepare().execute(a)}$dynamic(){return this}}class gY{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [cK]="SQLiteInsertBuilder";values(a){if(0===(a=Array.isArray(a)?a:[a]).length)throw Error("values() must be called with at least one value");let b=a.map(a=>{let b={},c=this.table[cW.Symbol.Columns];for(let d of Object.keys(a)){let e=a[d];b[d]=cL(e,dn)?e:new ds(e,c[d])}return b});return new gZ(this.table,b,this.session,this.dialect,this.withList)}select(a){let b="function"==typeof a?a(new gW):a;if(!cL(b,dn)&&!d1(this.table[cP],b._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new gZ(this.table,b,this.session,this.dialect,this.withList,!0)}}class gZ extends gE{constructor(a,b,c,d,e,f){super(),this.session=c,this.dialect=d,this.config={table:a,values:b,withList:e,select:f}}static [cK]="SQLiteInsert";config;returning(a=this.config.table[gx.Symbol.Columns]){return this.config.returning=d0(a),this}onConflictDoNothing(a={}){if(this.config.onConflict||(this.config.onConflict=[]),void 0===a.target)this.config.onConflict.push(dt` on conflict do nothing`);else{let b=Array.isArray(a.target)?dt`${a.target}`:dt`${[a.target]}`,c=a.where?dt` where ${a.where}`:dt``;this.config.onConflict.push(dt` on conflict ${b} do nothing${c}`)}return this}onConflictDoUpdate(a){if(a.where&&(a.targetWhere||a.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');this.config.onConflict||(this.config.onConflict=[]);let b=a.where?dt` where ${a.where}`:void 0,c=a.targetWhere?dt` where ${a.targetWhere}`:void 0,d=a.setWhere?dt` where ${a.setWhere}`:void 0,e=Array.isArray(a.target)?dt`${a.target}`:dt`${[a.target]}`,f=this.dialect.buildUpdateSet(this.config.table,d2(this.config.table,a.set));return this.config.onConflict.push(dt` on conflict ${e}${c} do update set ${f}${b}${d}`),this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:gM(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class g${constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [cK]="SQLiteUpdateBuilder";set(a){return new g_(this.table,d2(this.table,a),this.session,this.dialect,this.withList)}}class g_ extends gE{constructor(a,b,c,d,e){super(),this.session=c,this.dialect=d,this.config={set:b,table:a,withList:e,joins:[]}}static [cK]="SQLiteUpdate";config;from(a){return this.config.from=a,this}createJoin(a){return(b,c)=>{let d=d3(b);if("string"==typeof d&&this.config.joins.some(a=>a.alias===d))throw Error(`Alias "${d}" is already used in this query`);if("function"==typeof c){let a=this.config.from?cL(b,gx)?b[cW.Symbol.Columns]:cL(b,dg)?b._.selectedFields:cL(b,gz)?b[dj].selectedFields:void 0:void 0;c=c(new Proxy(this.config.table[cW.Symbol.Columns],new fK({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new fK({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}return this.config.joins.push({on:c,table:b,joinType:a,alias:d}),this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(a){return this.config.where=a,this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.table[cW.Symbol.Columns],new fK({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.orderBy=c}else this.config.orderBy=a;return this}limit(a){return this.config.limit=a,this}returning(a=this.config.table[gx.Symbol.Columns]){return this.config.returning=d0(a),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a=!0){return this.session[a?"prepareOneTimeQuery":"prepareQuery"](this.dialect.sqlToQuery(this.getSQL()),this.config.returning,this.config.returning?"all":"run",!0,void 0,{type:"insert",tables:gM(this.config.table)})}prepare(){return this._prepare(!1)}run=a=>this._prepare().run(a);all=a=>this._prepare().all(a);get=a=>this._prepare().get(a);values=a=>this._prepare().values(a);async execute(){return this.config.returning?this.all():this.run()}$dynamic(){return this}}class g0 extends dn{constructor(a){super(g0.buildEmbeddedCount(a.source,a.filters).queryChunks),this.params=a,this.session=a.session,this.sql=g0.buildCount(a.source,a.filters)}sql;static [cK]="SQLiteCountBuilderAsync";[Symbol.toStringTag]="SQLiteCountBuilderAsync";session;static buildEmbeddedCount(a,b){return dt`(select count(*) from ${a}${dt.raw(" where ").if(b)}${b})`}static buildCount(a,b){return dt`select count(*) from ${a}${dt.raw(" where ").if(b)}${b}`}then(a,b){return Promise.resolve(this.session.count(this.sql)).then(a,b)}catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}}class g1{constructor(a,b,c,d,e,f,g,h){this.mode=a,this.fullSchema=b,this.schema=c,this.tableNamesMap=d,this.table=e,this.tableConfig=f,this.dialect=g,this.session=h}static [cK]="SQLiteAsyncRelationalQueryBuilder";findMany(a){return"sync"===this.mode?new g3(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many"):new g2(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many")}findFirst(a){return"sync"===this.mode?new g3(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first"):new g2(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first")}}class g2 extends gE{constructor(a,b,c,d,e,f,g,h,i){super(),this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g,this.config=h,this.mode=i}static [cK]="SQLiteAsyncRelationalQuery";mode;getSQL(){return this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}).sql}_prepare(a=!1){let{query:b,builtQuery:c}=this._toSQL();return this.session[a?"prepareOneTimeQuery":"prepareQuery"](c,void 0,"first"===this.mode?"get":"all",!0,(a,c)=>{let d=a.map(a=>(function a(b,c,d,e,f=a=>a){let g={};for(let[h,i]of e.entries())if(i.isJson){let e=c.relations[i.tsKey],j=d[h],k="string"==typeof j?JSON.parse(j):j;g[i.tsKey]=cL(e,fz)?k&&a(b,b[i.relationTableTsKey],k,i.selection,f):k.map(c=>a(b,b[i.relationTableTsKey],c,i.selection,f))}else{let a,b=f(d[h]),c=i.field;a=cL(c,cM)?c:cL(c,dn)?c.decoder:c.sql.decoder,g[i.tsKey]=null===b?null:a.mapFromDriverValue(b)}return g})(this.schema,this.tableConfig,a,b.selection,c));return"first"===this.mode?d[0]:d})}prepare(){return this._prepare(!1)}_toSQL(){let a=this.dialect.buildRelationalQuery({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName}),b=this.dialect.sqlToQuery(a.sql);return{query:a,builtQuery:b}}toSQL(){return this._toSQL().builtQuery}executeRaw(){return"first"===this.mode?this._prepare(!1).get():this._prepare(!1).all()}async execute(){return this.executeRaw()}}class g3 extends g2{static [cK]="SQLiteSyncRelationalQuery";sync(){return this.executeRaw()}}class g4 extends gE{constructor(a,b,c,d,e){super(),this.execute=a,this.getSQL=b,this.dialect=d,this.mapBatchResult=e,this.config={action:c}}static [cK]="SQLiteRaw";config;getQuery(){return{...this.dialect.sqlToQuery(this.getSQL()),method:this.config.action}}mapResult(a,b){return b?this.mapBatchResult(a):a}_prepare(){return this}isResponseInArrayMode(){return!1}}class g5{constructor(a,b,c,d){this.resultKind=a,this.dialect=b,this.session=c,this._=d?{schema:d.schema,fullSchema:d.fullSchema,tableNamesMap:d.tableNamesMap}:{schema:void 0,fullSchema:{},tableNamesMap:{}},this.query={};const e=this.query;if(this._.schema)for(const[f,g]of Object.entries(this._.schema))e[f]=new g1(a,d.fullSchema,this._.schema,this._.tableNamesMap,d.fullSchema[f],g,b,c);this.$cache={invalidate:async a=>{}}}static [cK]="BaseSQLiteDatabase";query;$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(new gW(c.dialect))),new Proxy(new dh(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new fK({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(a,b){return new g0({source:a,filters:b,session:this.session})}with(...a){let b=this;return{select:function(c){return new gN({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a})},selectDistinct:function(c){return new gN({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:!0})},update:function(c){return new g$(c,b.session,b.dialect,a)},insert:function(c){return new gY(c,b.session,b.dialect,a)},delete:function(c){return new gX(c,b.session,b.dialect,a)}}}select(a){return new gN({fields:a??void 0,session:this.session,dialect:this.dialect})}selectDistinct(a){return new gN({fields:a??void 0,session:this.session,dialect:this.dialect,distinct:!0})}update(a){return new g$(a,this.session,this.dialect)}$cache;insert(a){return new gY(a,this.session,this.dialect)}delete(a){return new gX(a,this.session,this.dialect)}run(a){let b="string"==typeof a?dt.raw(a):a.getSQL();return"async"===this.resultKind?new g4(async()=>this.session.run(b),()=>b,"run",this.dialect,this.session.extractRawRunValueFromBatchResult.bind(this.session)):this.session.run(b)}all(a){let b="string"==typeof a?dt.raw(a):a.getSQL();return"async"===this.resultKind?new g4(async()=>this.session.all(b),()=>b,"all",this.dialect,this.session.extractRawAllValueFromBatchResult.bind(this.session)):this.session.all(b)}get(a){let b="string"==typeof a?dt.raw(a):a.getSQL();return"async"===this.resultKind?new g4(async()=>this.session.get(b),()=>b,"get",this.dialect,this.session.extractRawGetValueFromBatchResult.bind(this.session)):this.session.get(b)}values(a){let b="string"==typeof a?dt.raw(a):a.getSQL();return"async"===this.resultKind?new g4(async()=>this.session.values(b),()=>b,"values",this.dialect,this.session.extractRawValuesValueFromBatchResult.bind(this.session)):this.session.values(b)}transaction(a,b){return this.session.transaction(a,b)}}class g6{static [cK]="Cache"}class g7 extends g6{strategy(){return"all"}static [cK]="NoopCache";async get(a){}async put(a,b,c,d){}async onMutate(a){}}async function g8(a,b){let c=`${a}-${JSON.stringify(b)}`,d=new TextEncoder().encode(c);return[...new Uint8Array(await crypto.subtle.digest("SHA-256",d))].map(a=>a.toString(16).padStart(2,"0")).join("")}class g9 extends gE{constructor(a){super(),this.resultCb=a}static [cK]="ExecuteResultSync";async execute(){return this.resultCb()}sync(){return this.resultCb()}}class ha{constructor(a,b,c,d,e,f){this.mode=a,this.executeMethod=b,this.query=c,this.cache=d,this.queryMetadata=e,this.cacheConfig=f,d&&"all"===d.strategy()&&void 0===f&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}static [cK]="PreparedQuery";joinsNotNullableMap;async queryWithCache(a,b,c){if(void 0===this.cache||cL(this.cache,g7)||void 0===this.queryMetadata||this.cacheConfig&&!this.cacheConfig.enable)try{return await c()}catch(c){throw new fQ(a,b,c)}if(("insert"===this.queryMetadata.type||"update"===this.queryMetadata.type||"delete"===this.queryMetadata.type)&&this.queryMetadata.tables.length>0)try{let[a]=await Promise.all([c(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return a}catch(c){throw new fQ(a,b,c)}if(!this.cacheConfig)try{return await c()}catch(c){throw new fQ(a,b,c)}if("select"===this.queryMetadata.type){let d=await this.cache.get(this.cacheConfig.tag??await g8(a,b),this.queryMetadata.tables,void 0!==this.cacheConfig.tag,this.cacheConfig.autoInvalidate);if(void 0===d){let d;try{d=await c()}catch(c){throw new fQ(a,b,c)}return await this.cache.put(this.cacheConfig.tag??await g8(a,b),d,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],void 0!==this.cacheConfig.tag,this.cacheConfig.config),d}return d}try{return await c()}catch(c){throw new fQ(a,b,c)}}getQuery(){return this.query}mapRunResult(a,b){return a}mapAllResult(a,b){throw Error("Not implemented")}mapGetResult(a,b){throw Error("Not implemented")}execute(a){return"async"===this.mode?this[this.executeMethod](a):new g9(()=>this[this.executeMethod](a))}mapResult(a,b){switch(this.executeMethod){case"run":return this.mapRunResult(a,b);case"all":return this.mapAllResult(a,b);case"get":return this.mapGetResult(a,b)}}}class hb{constructor(a){this.dialect=a}static [cK]="SQLiteSession";prepareOneTimeQuery(a,b,c,d,e,f,g){return this.prepareQuery(a,b,c,d,e,f,g)}run(a){let b=this.dialect.sqlToQuery(a);try{return this.prepareOneTimeQuery(b,void 0,"run",!1).run()}catch(a){throw new fP({cause:a,message:`Failed to run the query '${b.sql}'`})}}extractRawRunValueFromBatchResult(a){return a}all(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).all()}extractRawAllValueFromBatchResult(a){throw Error("Not implemented")}get(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).get()}extractRawGetValueFromBatchResult(a){throw Error("Not implemented")}values(a){return this.prepareOneTimeQuery(this.dialect.sqlToQuery(a),void 0,"run",!1).values()}async count(a){return(await this.values(a))[0][0]}extractRawValuesValueFromBatchResult(a){throw Error("Not implemented")}}class hc extends g5{constructor(a,b,c,d,e=0){super(a,b,c,d),this.schema=d,this.nestedIndex=e}static [cK]="SQLiteTransaction";rollback(){throw new fR}}class hd extends hb{constructor(a,b,c,d={}){super(b),this.client=a,this.schema=c,this.options=d,this.logger=d.logger??new d$,this.cache=d.cache??new g7}static [cK]="SQLiteD1Session";logger;cache;prepareQuery(a,b,c,d,e,f,g){return new hg(this.client.prepare(a.sql),a,this.logger,this.cache,f,g,b,c,d,e)}async batch(a){let b=[],c=[];for(let d of a){let a=d._prepare(),e=a.getQuery();if(b.push(a),e.params.length>0)c.push(a.stmt.bind(...e.params));else{let b=a.getQuery();c.push(this.client.prepare(b.sql).bind(...b.params))}}return(await this.client.batch(c)).map((a,c)=>b[c].mapResult(a,!0))}extractRawAllValueFromBatchResult(a){return a.results}extractRawGetValueFromBatchResult(a){return a.results[0]}extractRawValuesValueFromBatchResult(a){return hf(a.results)}async transaction(a,b){let c=new he("async",this.dialect,this,this.schema);await this.run(dt.raw(`begin${b?.behavior?" "+b.behavior:""}`));try{let b=await a(c);return await this.run(dt`commit`),b}catch(a){throw await this.run(dt`rollback`),a}}}class he extends hc{static [cK]="D1Transaction";async transaction(a){let b=`sp${this.nestedIndex}`,c=new he("async",this.dialect,this.session,this.schema,this.nestedIndex+1);await this.session.run(dt.raw(`savepoint ${b}`));try{let d=await a(c);return await this.session.run(dt.raw(`release savepoint ${b}`)),d}catch(a){throw await this.session.run(dt.raw(`rollback to savepoint ${b}`)),a}}}function hf(a){let b=[];for(let c of a){let a=Object.keys(c).map(a=>c[a]);b.push(a)}return b}class hg extends ha{constructor(a,b,c,d,e,f,g,h,i,j){super("async",h,b,d,e,f),this.logger=c,this._isResponseInArrayMode=i,this.customResultMapper=j,this.fields=g,this.stmt=a}static [cK]="D1PreparedQuery";customResultMapper;fields;stmt;async run(a){let b=dx(this.query.params,a??{});return this.logger.logQuery(this.query.sql,b),await this.queryWithCache(this.query.sql,b,async()=>this.stmt.bind(...b).run())}async all(a){let{fields:b,query:c,logger:d,stmt:e,customResultMapper:f}=this;if(!b&&!f){let b=dx(c.params,a??{});return d.logQuery(c.sql,b),await this.queryWithCache(c.sql,b,async()=>e.bind(...b).all().then(({results:a})=>this.mapAllResult(a)))}let g=await this.values(a);return this.mapAllResult(g)}mapAllResult(a,b){return(b&&(a=hf(a.results)),this.fields||this.customResultMapper)?this.customResultMapper?this.customResultMapper(a):a.map(a=>d_(this.fields,a,this.joinsNotNullableMap)):a}async get(a){let{fields:b,joinsNotNullableMap:c,query:d,logger:e,stmt:f,customResultMapper:g}=this;if(!b&&!g){let b=dx(d.params,a??{});return e.logQuery(d.sql,b),await this.queryWithCache(d.sql,b,async()=>f.bind(...b).all().then(({results:a})=>a[0]))}let h=await this.values(a);if(h[0])return g?g(h):d_(b,h[0],c)}mapGetResult(a,b){return(b&&(a=hf(a.results)[0]),this.fields||this.customResultMapper)?this.customResultMapper?this.customResultMapper([a]):d_(this.fields,a,this.joinsNotNullableMap):a}async values(a){let b=dx(this.query.params,a??{});return this.logger.logQuery(this.query.sql,b),await this.queryWithCache(this.query.sql,b,async()=>this.stmt.bind(...b).raw())}isResponseInArrayMode(){return this._isResponseInArrayMode}}class hh extends g5{static [cK]="D1Database";async batch(a){return this.session.batch(a)}}var hi=a.i(25372);class hj extends hb{constructor(a,b,c,d={}){super(b),this.client=a,this.schema=c,this.logger=d.logger??new d$,this.cache=d.cache??new g7}static [cK]="BetterSQLiteSession";logger;cache;prepareQuery(a,b,c,d,e,f,g){return new hl(this.client.prepare(a.sql),a,this.logger,this.cache,f,g,b,c,d,e)}transaction(a,b={}){let c=new hk("sync",this.dialect,this,this.schema);return this.client.transaction(a)[b.behavior??"deferred"](c)}}class hk extends hc{static [cK]="BetterSQLiteTransaction";transaction(a){let b=`sp${this.nestedIndex}`,c=new hk("sync",this.dialect,this.session,this.schema,this.nestedIndex+1);this.session.run(dt.raw(`savepoint ${b}`));try{let d=a(c);return this.session.run(dt.raw(`release savepoint ${b}`)),d}catch(a){throw this.session.run(dt.raw(`rollback to savepoint ${b}`)),a}}}class hl extends ha{constructor(a,b,c,d,e,f,g,h,i,j){super("sync",h,b,d,e,f),this.stmt=a,this.logger=c,this.fields=g,this._isResponseInArrayMode=i,this.customResultMapper=j}static [cK]="BetterSQLitePreparedQuery";run(a){let b=dx(this.query.params,a??{});return this.logger.logQuery(this.query.sql,b),this.stmt.run(...b)}all(a){let{fields:b,joinsNotNullableMap:c,query:d,logger:e,stmt:f,customResultMapper:g}=this;if(!b&&!g){let b=dx(d.params,a??{});return e.logQuery(d.sql,b),f.all(...b)}let h=this.values(a);return g?g(h):h.map(a=>d_(b,a,c))}get(a){let b=dx(this.query.params,a??{});this.logger.logQuery(this.query.sql,b);let{fields:c,stmt:d,joinsNotNullableMap:e,customResultMapper:f}=this;if(!c&&!f)return d.get(...b);let g=d.raw().get(...b);if(g)return f?f([g]):d_(c,g,e)}values(a){let b=dx(this.query.params,a??{});return this.logger.logQuery(this.query.sql,b),this.stmt.raw().all(...b)}isResponseInArrayMode(){return this._isResponseInArrayMode}}class hm extends g5{static [cK]="BetterSQLite3Database"}function hn(a,b={}){let c,d,e=new gB({casing:b.casing});if(!0===b.logger?c=new dZ:!1!==b.logger&&(c=b.logger),b.schema){let a=fB(b.schema,fC);d={fullSchema:b.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let f=new hj(a,e,d,{logger:c}),g=new hm("sync",e,f,d);return g.$client=a,g}function ho(...a){if(void 0===a[0]||"string"==typeof a[0])return hn(void 0===a[0]?new hi.default:new hi.default(a[0]),a[1]);if(function(a){if("object"!=typeof a||null===a||"Object"!==a.constructor.name)return!1;if("logger"in a){let b=typeof a.logger;return"boolean"===b||"object"===b&&"function"==typeof a.logger.logQuery||"undefined"===b}if("schema"in a){let b=typeof a.schema;return"object"===b||"undefined"===b}if("casing"in a){let b=typeof a.casing;return"string"===b||"undefined"===b}if("mode"in a)return"default"===a.mode&&"planetscale"===a.mode&&void 0===a.mode;if("connection"in a){let b=typeof a.connection;return"string"===b||"object"===b||"undefined"===b}if("client"in a){let b=typeof a.client;return"object"===b||"function"===b||"undefined"===b}return 0===Object.keys(a).length}(a[0])){let{connection:b,client:c,...d}=a[0];if(c)return hn(c,d);if("object"==typeof b){let{source:a,...c}=b;return hn(new hi.default(a,c),d)}return hn(new hi.default(b),d)}return hn(a[0],a[1])}(ho||(ho={})).mock=function(a){return hn({},a)};let hp=gy("user",{id:gv("id").primaryKey(),name:gv("name").notNull(),email:gv("email").notNull().unique(),emailVerified:gg("email_verified",{mode:"boolean"}).notNull(),image:gv("image"),createdAt:gg("created_at",{mode:"timestamp"}).notNull(),updatedAt:gg("updated_at",{mode:"timestamp"}).notNull()}),hq=gy("session",{id:gv("id").primaryKey(),expiresAt:gg("expires_at",{mode:"timestamp"}).notNull(),token:gv("token").notNull().unique(),createdAt:gg("created_at",{mode:"timestamp"}).notNull(),updatedAt:gg("updated_at",{mode:"timestamp"}).notNull(),ipAddress:gv("ip_address"),userAgent:gv("user_agent"),userId:gv("user_id").notNull().references(()=>hp.id)}),hr=gy("account",{id:gv("id").primaryKey(),accountId:gv("account_id").notNull(),providerId:gv("provider_id").notNull(),userId:gv("user_id").notNull().references(()=>hp.id),accessToken:gv("access_token"),refreshToken:gv("refresh_token"),idToken:gv("id_token"),accessTokenExpiresAt:gg("access_token_expires_at",{mode:"timestamp"}),refreshTokenExpiresAt:gg("refresh_token_expires_at",{mode:"timestamp"}),scope:gv("scope"),password:gv("password"),createdAt:gg("created_at",{mode:"timestamp"}).notNull(),updatedAt:gg("updated_at",{mode:"timestamp"}).notNull()}),hs=gy("verification",{id:gv("id").primaryKey(),identifier:gv("identifier").notNull(),value:gv("value").notNull(),expiresAt:gg("expires_at",{mode:"timestamp"}).notNull(),createdAt:gg("created_at",{mode:"timestamp"}),updatedAt:gg("updated_at",{mode:"timestamp"})}),ht=gy("category",{id:gv("id").primaryKey(),name:gv("name").notNull(),color:gv("color").default("blue").notNull(),userId:gv("user_id").notNull().references(()=>hp.id,{onDelete:"cascade"}),createdAt:gg("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:gg("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)}),hu=gy("tag",{id:gv("id").primaryKey(),name:gv("name").notNull(),color:gv("color"),categoryId:gv("category_id").notNull().references(()=>ht.id,{onDelete:"cascade"}),userId:gv("user_id").notNull().references(()=>hp.id,{onDelete:"cascade"}),createdAt:gg("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:gg("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)}),hv=gy("trade",{id:gv("id").primaryKey(),date:gv("date").notNull(),ticker:gv("ticker").notNull(),type:gv("type").notNull(),entryPrice:gq("entry_price").notNull(),exitPrice:gq("exit_price").notNull(),quantity:gq("quantity").notNull(),pnl:gq("pnl").notNull(),status:gv("status").default("Closed").notNull(),notes:gv("notes"),contracts:gq("contracts"),points:gq("points"),ticks:gq("ticks"),rating:gg("rating"),profitTarget:gq("profit_target"),stopLoss:gq("stop_loss"),plannedRR:gq("planned_rr"),realizedRR:gq("realized_rr"),userId:gv("user_id").notNull().references(()=>hp.id,{onDelete:"cascade"}),createdAt:gg("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:gg("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)}),hw=gy("trade_tag",{tradeId:gv("trade_id").notNull().references(()=>hv.id,{onDelete:"cascade"}),tagId:gv("tag_id").notNull().references(()=>hu.id,{onDelete:"cascade"})}),hx=gy("section",{id:gv("id").primaryKey(),name:gv("name").notNull(),userId:gv("user_id").notNull().references(()=>hp.id,{onDelete:"cascade"}),createdAt:gg("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:gg("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)}),hy=gy("note",{id:gv("id").primaryKey(),title:gv("title").notNull(),content:gv("content").notNull(),date:gv("date").notNull(),sectionId:gv("section_id").notNull().references(()=>hx.id,{onDelete:"cascade"}),userId:gv("user_id").notNull().references(()=>hp.id,{onDelete:"cascade"}),createdAt:gg("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:gg("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)}),hz=gy("note_tag",{noteId:gv("note_id").notNull().references(()=>hy.id,{onDelete:"cascade"}),tagId:gv("tag_id").notNull().references(()=>hu.id,{onDelete:"cascade"})}),hA=gy("template",{id:gv("id").primaryKey(),name:gv("name").notNull(),content:gv("content").notNull(),userId:gv("user_id").notNull().references(()=>hp.id,{onDelete:"cascade"}),createdAt:gg("created_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date),updatedAt:gg("updated_at",{mode:"timestamp"}).notNull().$defaultFn(()=>new Date)});a.s(["account",0,hr,"categories",0,ht,"noteTags",0,hz,"notes",0,hy,"sections",0,hx,"session",0,hq,"tags",0,hu,"templates",0,hA,"tradeTags",0,hw,"trades",0,hv,"user",0,hp,"verification",0,hs],15545);var hB=a.i(15545),hC=a.i(22734),hD=a.i(14747);let hE=a=>{if(a)return function(a,b={}){let c,d,e=new gC({casing:b.casing});if(!0===b.logger?c=new dZ:!1!==b.logger&&(c=b.logger),b.schema){let a=fB(b.schema,fC);d={fullSchema:b.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let f=new hd(a,e,d,{logger:c,cache:b.cache}),g=new hh("async",e,f,d);return g.$client=a,g.$cache=b.cache,g.$cache&&(g.$cache.invalidate=b.cache?.onMutate),g}(a,{schema:hB});let b=hD.default.resolve(process.cwd(),".wrangler/state/v3/d1/miniflare-D1DatabaseObject");if(hC.default.existsSync(b)){let a=hC.default.readdirSync(b).find(a=>a.endsWith(".sqlite"));if(a){let c=hD.default.join(b,a),d=new hi.default(c);return ho(d,{schema:hB})}}throw Error("Database connection failed. Ensure local dev is set up or D1 binding is provided.")};a.s(["getDb",0,hE],66879);let hF=((a,b)=>{let c=b(a),{api:d}=cb(c,a);return{handler:async b=>{let d=await c,e=d.options.basePath||"/api/auth";if(!d.options.baseURL){let a=V(void 0,e,b,void 0,d.options.advanced?.trustedProxyHeaders);if(a)d.baseURL=a,d.options.baseURL=W(d.baseURL)||void 0;else throw new K.BetterAuthError("Could not get base URL from request. Please provide a valid base URL.")}d.trustedOrigins=[...a.trustedOrigins?Array.isArray(a.trustedOrigins)?a.trustedOrigins:await a.trustedOrigins(b):[],d.options.baseURL];let{handler:f}=((a,b)=>{let{api:c,middlewares:d}=cb(a,b),e=new URL(a.baseURL).pathname;return(0,r.createRouter)(c,{routerContext:a,openapi:{disabled:!0},basePath:e,routerMiddleware:[{path:"/**",middleware:bD},...d],allowedMediaTypes:["application/json"],async onRequest(b){let c=a.options.disabledPaths||[],d=new URL(b.url).pathname.replace(e,"");if(c.includes(d))return new Response("Not Found",{status:404});for(let c of a.options.plugins||[])if(c.onRequest){let d=await c.onRequest(b,a);if(d&&"response"in d)return d.response;if(d&&"request"in d){let b=await bG(d.request,a);if(b)return b;return d.request}}return bG(b,a)},async onResponse(b){for(let c of a.options.plugins||[])if(c.onResponse){let d=await c.onResponse(b,a);if(d)return d.response}return b},onError(c){if(c instanceof r.APIError&&"FOUND"===c.status)return;if(b.onAPIError?.throw)throw c;if(b.onAPIError?.onError)return void b.onAPIError.onError(c,a);let d=b.logger?.level,e="error"===d||"warn"===d||"debug"===d?J.logger:void 0;if(b.logger?.disabled!==!0){if(c&&"object"==typeof c&&"message"in c&&"string"==typeof c.message&&(c.message.includes("no column")||c.message.includes("column")||c.message.includes("relation")||c.message.includes("table")||c.message.includes("does not exist")))return void a.logger?.error(c.message);c instanceof r.APIError?("INTERNAL_SERVER_ERROR"===c.status&&a.logger.error(c.status,c),e?.error(c.message)):a.logger?.error(c&&"object"==typeof c&&"name"in c?c.name:"",c)}}})})(d,a);return(0,cd.r)(d.adapter,()=>f(b))},api:d,options:a,$context:c,$ERROR_CODES:{...a.plugins?.reduce((a,b)=>b.$ERROR_CODES?{...a,...b.$ERROR_CODES}:a,{}),...as.n}}})({database:(m=hE(),n={provider:"sqlite",schema:hB},h=null,i=a=>({getFieldName:b,options:c})=>{function d(b){let c=n.schema||a._.fullSchema;if(!c)throw new K.BetterAuthError("Drizzle adapter failed to initialize. Schema not found. Please provide a schema object in the adapter options object.");let d=c[b];if(!d)throw new K.BetterAuthError(`[# Drizzle Adapter]: The model "${b}" was not found in the schema object. Please pass the schema directly to the adapter options.`);return d}let e=async(b,c,e,g)=>{if("mysql"!==n.provider)return(await c.returning())[0];await c.execute();let h=d(b),i=c.config?.values;if(g?.length){let c=f(g.map(a=>void 0!==e[a.field]?{...a,value:e[a.field]}:a),b);return(await a.select().from(h).where(...c))[0]}if(i&&i[0]?.id?.value){let b=i[0]?.id?.value;return b||(b=(await a.select({id:dt`LAST_INSERT_ID()`}).from(h).orderBy(dX(h.id)).limit(1))[0].id),(await a.select().from(h).where(dB(h.id,b)).limit(1).execute())[0]}if(e.id)return(await a.select().from(h).where(dB(h.id,e.id)).limit(1).execute())[0];if(!("id"in h))throw new K.BetterAuthError(`The model "${b}" does not have an "id" field. Please use the "id" field as your primary key.`);return(await a.select().from(h).orderBy(dX(h.id)).limit(1).execute())[0]};function f(a,c){let e=d(c);if(!a)return[];if(1===a.length){let d=a[0];if(!d)return[];let f=b({model:c,field:d.field});if(!e[f])throw new K.BetterAuthError(`The field "${d.field}" does not exist in the schema for the model "${c}". Please update your schema.`);if("in"===d.operator){if(!Array.isArray(d.value))throw new K.BetterAuthError(`The value for the field "${d.field}" must be an array when using the "in" operator.`);return[dK(e[f],d.value)]}if("not_in"===d.operator){if(!Array.isArray(d.value))throw new K.BetterAuthError(`The value for the field "${d.field}" must be an array when using the "not_in" operator.`);return[dL(e[f],d.value)]}return"contains"===d.operator?[dS(e[f],`%${d.value}%`)]:"starts_with"===d.operator?[dS(e[f],`${d.value}%`)]:"ends_with"===d.operator?[dS(e[f],`%${d.value}`)]:"lt"===d.operator?[dI(e[f],d.value)]:"lte"===d.operator?[dJ(e[f],d.value)]:"ne"===d.operator?[dC(e[f],d.value)]:"gt"===d.operator?[dG(e[f],d.value)]:"gte"===d.operator?[dH(e[f],d.value)]:[dB(e[f],d.value)]}let f=a.filter(a=>"AND"===a.connector||!a.connector),g=a.filter(a=>"OR"===a.connector),h=dD(...f.map(a=>{let d=b({model:c,field:a.field});if("in"===a.operator){if(!Array.isArray(a.value))throw new K.BetterAuthError(`The value for the field "${a.field}" must be an array when using the "in" operator.`);return dK(e[d],a.value)}if("not_in"===a.operator){if(!Array.isArray(a.value))throw new K.BetterAuthError(`The value for the field "${a.field}" must be an array when using the "not_in" operator.`);return dL(e[d],a.value)}return"contains"===a.operator?dS(e[d],`%${a.value}%`):"starts_with"===a.operator?dS(e[d],`${a.value}%`):"ends_with"===a.operator?dS(e[d],`%${a.value}`):"lt"===a.operator?dI(e[d],a.value):"lte"===a.operator?dJ(e[d],a.value):"gt"===a.operator?dG(e[d],a.value):"gte"===a.operator?dH(e[d],a.value):"ne"===a.operator?dC(e[d],a.value):dB(e[d],a.value)})),i=dE(...g.map(a=>{let d=b({model:c,field:a.field});if("in"===a.operator){if(!Array.isArray(a.value))throw new K.BetterAuthError(`The value for the field "${a.field}" must be an array when using the "in" operator.`);return dK(e[d],a.value)}if("not_in"===a.operator){if(!Array.isArray(a.value))throw new K.BetterAuthError(`The value for the field "${a.field}" must be an array when using the "not_in" operator.`);return dL(e[d],a.value)}return"contains"===a.operator?dS(e[d],`%${a.value}%`):"starts_with"===a.operator?dS(e[d],`${a.value}%`):"ends_with"===a.operator?dS(e[d],`%${a.value}`):"lt"===a.operator?dI(e[d],a.value):"lte"===a.operator?dJ(e[d],a.value):"gt"===a.operator?dG(e[d],a.value):"gte"===a.operator?dH(e[d],a.value):"ne"===a.operator?dC(e[d],a.value):dB(e[d],a.value)})),j=[];return f.length&&j.push(h),g.length&&j.push(i),j}return{async create({model:b,data:c}){let f=d(b);if(!f)throw new K.BetterAuthError("Drizzle adapter failed to initialize. Drizzle Schema not found. Please provide a schema object in the adapter options object.");for(let a in c)if(!f[a])throw new K.BetterAuthError(`The field "${a}" does not exist in the "${b}" Drizzle schema. Please update your drizzle schema or re-generate using "npx @better-auth/cli@latest generate".`);return await e(b,a.insert(f).values(c),c)},async findOne({model:b,where:e,join:g}){let h=d(b),i=f(e,b);if(c.experimental?.joins)if(a.query&&a.query[b]){let d,e=[];if(g)for(let[a,b]of(d={},Object.entries(g))){let f=b.limit??c.advanced?.database?.defaultFindManyLimit??100,g="one-to-one"===b.relation,h=g||n.usePlural?"":"s";d[`${a}${h}`]=!!g||{limit:f},g||e.push(`${a}${h}`)}let f=await a.query[b].findFirst({where:i[0],with:d});if(f)for(let a of e){let b=n.usePlural?a:a.slice(0,-1);f[b]=f[a],a!==b&&delete f[a]}return f}else J.logger.error(`[# Drizzle Adapter]: The model "${b}" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using "npx @better-auth/cli@latest generate".`),J.logger.info("Falling back to regular query");let j=await a.select().from(h).where(...i);return j.length?j[0]:null},async findMany({model:e,where:g,sortBy:h,limit:i,offset:j,join:k}){let l=d(e),m=g?f(g,e):[],o=h?.direction==="desc"?dX:dW;if(c.experimental?.joins)if(a.query[e]){let d,f,g=[];if(k)for(let[a,b]of(d={},Object.entries(k))){let e="one-to-one"===b.relation,f=b.limit??c.advanced?.database?.defaultFindManyLimit??100,h=e||n.usePlural?"":"s";d[`${a}${h}`]=!!e||{limit:f},e||g.push(`${a}${h}`)}h?.field&&(f=[o(l[b({model:e,field:h?.field})])]);let p=await a.query[e].findMany({where:m[0],with:d,limit:i??100,offset:j??0,orderBy:f});if(p)for(let a of p)for(let b of g){let c=n.usePlural?b:b.slice(0,-1);c!==b&&(a[c]=a[b],delete a[b])}return p}else J.logger.error(`[# Drizzle Adapter]: The model "${e}" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using "npx @better-auth/cli@latest generate".`),J.logger.info("Falling back to regular query");let p=a.select().from(l);return void 0!==i&&(p=p.limit(i)),void 0!==j&&(p=p.offset(j)),h?.field&&(p=p.orderBy(o(l[b({model:e,field:h?.field})]))),await p.where(...m)},async count({model:b,where:c}){let e=d(b),g=c?f(c,b):[];return(await a.select({count:dt`count(${dt.raw("*")})`.mapWith(Number)}).from(e).where(...g))[0].count},async update({model:b,where:c,update:g}){let h=d(b),i=f(c,b);return await e(b,a.update(h).set(g).where(...i),g,c)},async updateMany({model:b,where:c,update:e}){let g=d(b),h=f(c,b);return await a.update(g).set(e).where(...h)},async delete({model:b,where:c}){let e=d(b),g=f(c,b);return await a.delete(e).where(...g)},async deleteMany({model:b,where:c}){let e=d(b),g=f(c,b),h=await a.delete(e).where(...g),i=0;return h&&"rowCount"in h?i=h.rowCount:Array.isArray(h)?i=h.length:h&&("affectedRows"in h||"rowsAffected"in h||"changes"in h)&&(i=h.affectedRows??h.rowsAffected??h.changes),"number"!=typeof i&&J.logger.error("[Drizzle Adapter] The result of the deleteMany operation is not a number. This is likely a bug in the adapter. Please report this issue to the Better Auth team.",{res:h,model:b,where:c}),i},options:n}},j=null,j={config:{adapterId:"drizzle",adapterName:"Drizzle Adapter",usePlural:n.usePlural??!1,debugLogs:n.debugLogs??!1,supportsUUIDs:"pg"===n.provider,transaction:!!n.transaction&&(a=>m.transaction(b=>a((0,cJ.t)({config:j.config,adapter:i(b)})(h))))},adapter:i(m)},k=(0,cJ.t)(j),a=>(h=a,k(a))),emailAndPassword:{enabled:!0}},cH);a.s(["auth",0,hF],9223)},63681,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={RequestCookies:function(){return f.RequestCookies},ResponseCookies:function(){return f.ResponseCookies},stringifyCookie:function(){return f.stringifyCookie}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(36226)},51409,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ReflectAdapter",{enumerable:!0,get:function(){return d}});class d{static get(a,b,c){let d=Reflect.get(a,b,c);return"function"==typeof d?d.bind(a):d}static set(a,b,c,d){return Reflect.set(a,b,c,d)}static has(a,b){return Reflect.has(a,b)}static deleteProperty(a,b){return Reflect.deleteProperty(a,b)}}},14896,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={MutableRequestCookiesAdapter:function(){return n},ReadonlyRequestCookiesError:function(){return i},RequestCookiesAdapter:function(){return j},appendMutableCookies:function(){return m},areCookiesMutableInCurrentPhase:function(){return p},createCookiesWithMutableAccessCheck:function(){return o},getModifiedCookieValues:function(){return l},responseCookiesToRequestCookies:function(){return r}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(63681),g=a.r(51409),h=a.r(56704);class i extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#options")}static callable(){throw new i}}class j{static seal(a){return new Proxy(a,{get(a,b,c){switch(b){case"clear":case"delete":case"set":return i.callable;default:return g.ReflectAdapter.get(a,b,c)}}})}}let k=Symbol.for("next.mutated.cookies");function l(a){let b=a[k];return b&&Array.isArray(b)&&0!==b.length?b:[]}function m(a,b){let c=l(b);if(0===c.length)return!1;let d=new f.ResponseCookies(a),e=d.getAll();for(let a of c)d.set(a);for(let a of e)d.set(a);return!0}class n{static wrap(a,b){let c=new f.ResponseCookies(new Headers);for(let b of a.getAll())c.set(b);let d=[],e=new Set,i=()=>{let a=h.workAsyncStorage.getStore();if(a&&(a.pathWasRevalidated=!0),d=c.getAll().filter(a=>e.has(a.name)),b){let a=[];for(let b of d){let c=new f.ResponseCookies(new Headers);c.set(b),a.push(c.toString())}b(a)}},j=new Proxy(c,{get(a,b,c){switch(b){case k:return d;case"delete":return function(...b){e.add("string"==typeof b[0]?b[0]:b[0].name);try{return a.delete(...b),j}finally{i()}};case"set":return function(...b){e.add("string"==typeof b[0]?b[0]:b[0].name);try{return a.set(...b),j}finally{i()}};default:return g.ReflectAdapter.get(a,b,c)}}});return j}}function o(a){let b=new Proxy(a.mutableCookies,{get(c,d,e){switch(d){case"delete":return function(...d){return q(a,"cookies().delete"),c.delete(...d),b};case"set":return function(...d){return q(a,"cookies().set"),c.set(...d),b};default:return g.ReflectAdapter.get(c,d,e)}}});return b}function p(a){return"action"===a.phase}function q(a,b){if(!p(a))throw new i}function r(a){let b=new f.RequestCookies(new Headers);for(let c of a.getAll())b.set(c);return b}},96556,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={DynamicServerError:function(){return g},isDynamicServerError:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="DYNAMIC_SERVER_USAGE";class g extends Error{constructor(a){super(`Dynamic server usage: ${a}`),this.description=a,this.digest=f}}function h(a){return"object"==typeof a&&null!==a&&"digest"in a&&"string"==typeof a.digest&&a.digest===f}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},60312,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={StaticGenBailoutError:function(){return g},isStaticGenBailoutError:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="NEXT_STATIC_GEN_BAILOUT";class g extends Error{constructor(...a){super(...a),this.code=f}}function h(a){return"object"==typeof a&&null!==a&&"code"in a&&a.code===f}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},13091,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={isHangingPromiseRejectionError:function(){return f},makeDevtoolsIOAwarePromise:function(){return l},makeHangingPromise:function(){return j}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(a){return"object"==typeof a&&null!==a&&"digest"in a&&a.digest===g}let g="HANGING_PROMISE_REJECTION";class h extends Error{constructor(a,b){super(`During prerendering, ${b} rejects when the prerender is complete. Typically these errors are handled by React but if you move ${b} to a different context by using \`setTimeout\`, \`after\`, or similar functions you may observe this error and you should handle it in that context. This occurred at route "${a}".`),this.route=a,this.expression=b,this.digest=g}}let i=new WeakMap;function j(a,b,c){if(a.aborted)return Promise.reject(new h(b,c));{let d=new Promise((d,e)=>{let f=e.bind(null,new h(b,c)),g=i.get(a);if(g)g.push(f);else{let b=[f];i.set(a,b),a.addEventListener("abort",()=>{for(let a=0;a<b.length;a++)b[a]()},{once:!0})}});return d.catch(k),d}}function k(){}function l(a,b,c){return b.stagedRendering?b.stagedRendering.delayUntilStage(c,void 0,a):new Promise(b=>{setTimeout(()=>{b(a)},0)})}},17491,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={METADATA_BOUNDARY_NAME:function(){return f},OUTLET_BOUNDARY_NAME:function(){return h},ROOT_LAYOUT_BOUNDARY_NAME:function(){return i},VIEWPORT_BOUNDARY_NAME:function(){return g}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="__next_metadata_boundary__",g="__next_viewport_boundary__",h="__next_outlet_boundary__",i="__next_root_layout_boundary__"},61933,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={atLeastOneTask:function(){return h},scheduleImmediate:function(){return g},scheduleOnNextTick:function(){return f},waitAtLeastOneReactRenderTask:function(){return i}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a=>{Promise.resolve().then(()=>{process.nextTick(a)})},g=a=>{setImmediate(a)};function h(){return new Promise(a=>g(a))}function i(){return new Promise(a=>setImmediate(a))}},49640,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={BailoutToCSRError:function(){return g},isBailoutToCSRError:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="BAILOUT_TO_CLIENT_SIDE_RENDERING";class g extends Error{constructor(a){super(`Bail out to client-side rendering: ${a}`),this.reason=a,this.digest=f}}function h(a){return"object"==typeof a&&null!==a&&"digest"in a&&a.digest===f}},50640,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"InvariantError",{enumerable:!0,get:function(){return d}});class d extends Error{constructor(a,b){super(`Invariant: ${a.endsWith(".")?a:a+"."} This is a bug in Next.js.`,b),this.name="InvariantError"}}},28340,(a,b,c)=>{"use strict";function d(){let a,b,c=new Promise((c,d)=>{a=c,b=d});return{resolve:a,reject:b,promise:c}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"createPromiseWithResolvers",{enumerable:!0,get:function(){return d}})},31382,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e={RenderStage:function(){return i},StagedRenderingController:function(){return j}};for(var f in e)Object.defineProperty(c,f,{enumerable:!0,get:e[f]});let g=a.r(50640),h=a.r(28340);var i=((d={})[d.Static=1]="Static",d[d.Runtime=2]="Runtime",d[d.Dynamic=3]="Dynamic",d);class j{constructor(a=null){this.abortSignal=a,this.currentStage=1,this.runtimeStagePromise=(0,h.createPromiseWithResolvers)(),this.dynamicStagePromise=(0,h.createPromiseWithResolvers)(),a&&a.addEventListener("abort",()=>{let{reason:b}=a;this.currentStage<2&&(this.runtimeStagePromise.promise.catch(k),this.runtimeStagePromise.reject(b)),this.currentStage<3&&(this.dynamicStagePromise.promise.catch(k),this.dynamicStagePromise.reject(b))},{once:!0})}advanceStage(a){!(this.currentStage>=a)&&(this.currentStage=a,a>=2&&this.runtimeStagePromise.resolve(),a>=3&&this.dynamicStagePromise.resolve())}getStagePromise(a){switch(a){case 2:return this.runtimeStagePromise.promise;case 3:return this.dynamicStagePromise.promise;default:throw Object.defineProperty(new g.InvariantError(`Invalid render stage: ${a}`),"__NEXT_ERROR_CODE",{value:"E881",enumerable:!1,configurable:!0})}}waitForStage(a){return this.getStagePromise(a)}delayUntilStage(a,b,c){var d,e,f;let g,h=(d=this.getStagePromise(a),e=b,f=c,g=new Promise((a,b)=>{d.then(a.bind(null,f),b)}),void 0!==e&&(g.displayName=e),g);return this.abortSignal&&h.catch(k),h}}function k(){}},60384,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e,f={Postpone:function(){return D},PreludeState:function(){return Z},abortAndThrowOnSynchronousRequestDataAccess:function(){return C},abortOnSynchronousPlatformIOAccess:function(){return A},accessedDynamicData:function(){return L},annotateDynamicAccess:function(){return Q},consumeDynamicAccess:function(){return M},createDynamicTrackingState:function(){return t},createDynamicValidationState:function(){return u},createHangingInputAbortSignal:function(){return P},createRenderInBrowserAbortSignal:function(){return O},delayUntilRuntimeStage:function(){return aa},formatDynamicAPIAccesses:function(){return N},getFirstDynamicReason:function(){return v},isDynamicPostpone:function(){return G},isPrerenderInterruptedError:function(){return K},logDisallowedDynamicError:function(){return $},markCurrentScopeAsDynamic:function(){return w},postponeWithTracking:function(){return E},throwIfDisallowedDynamic:function(){return _},throwToInterruptStaticGeneration:function(){return x},trackAllowedDynamicAccess:function(){return Y},trackDynamicDataInDynamicRender:function(){return y},trackSynchronousPlatformIOAccessInDev:function(){return B},useDynamicRouteParams:function(){return R},useDynamicSearchParams:function(){return S}};for(var g in f)Object.defineProperty(c,g,{enumerable:!0,get:f[g]});let h=(d=a.r(717))&&d.__esModule?d:{default:d},i=a.r(96556),j=a.r(60312),k=a.r(32319),l=a.r(56704),m=a.r(13091),n=a.r(17491),o=a.r(61933),p=a.r(49640),q=a.r(50640),r=a.r(31382),s="function"==typeof h.default.unstable_postpone;function t(a){return{isDebugDynamicAccesses:a,dynamicAccesses:[],syncDynamicErrorWithStack:null}}function u(){return{hasSuspenseAboveBody:!1,hasDynamicMetadata:!1,hasDynamicViewport:!1,hasAllowedDynamic:!1,dynamicErrors:[]}}function v(a){var b;return null==(b=a.dynamicAccesses[0])?void 0:b.expression}function w(a,b,c){if(b)switch(b.type){case"cache":case"unstable-cache":case"private-cache":return}if(!a.forceDynamic&&!a.forceStatic){if(a.dynamicShouldError)throw Object.defineProperty(new j.StaticGenBailoutError(`Route ${a.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`${c}\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E553",enumerable:!1,configurable:!0});if(b)switch(b.type){case"prerender-ppr":return E(a.route,c,b.dynamicTracking);case"prerender-legacy":b.revalidate=0;let d=Object.defineProperty(new i.DynamicServerError(`Route ${a.route} couldn't be rendered statically because it used ${c}. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E550",enumerable:!1,configurable:!0});throw a.dynamicUsageDescription=c,a.dynamicUsageStack=d.stack,d}}}function x(a,b,c){let d=Object.defineProperty(new i.DynamicServerError(`Route ${b.route} couldn't be rendered statically because it used \`${a}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E558",enumerable:!1,configurable:!0});throw c.revalidate=0,b.dynamicUsageDescription=a,b.dynamicUsageStack=d.stack,d}function y(a){switch(a.type){case"cache":case"unstable-cache":case"private-cache":return}}function z(a,b,c){let d=J(`Route ${a} needs to bail out of prerendering at this point because it used ${b}.`);c.controller.abort(d);let e=c.dynamicTracking;e&&e.dynamicAccesses.push({stack:e.isDebugDynamicAccesses?Error().stack:void 0,expression:b})}function A(a,b,c,d){let e=d.dynamicTracking;z(a,b,d),e&&null===e.syncDynamicErrorWithStack&&(e.syncDynamicErrorWithStack=c)}function B(a){a.stagedRendering&&a.stagedRendering.advanceStage(r.RenderStage.Dynamic)}function C(a,b,c,d){if(!1===d.controller.signal.aborted){z(a,b,d);let e=d.dynamicTracking;e&&null===e.syncDynamicErrorWithStack&&(e.syncDynamicErrorWithStack=c)}throw J(`Route ${a} needs to bail out of prerendering at this point because it used ${b}.`)}function D({reason:a,route:b}){let c=k.workUnitAsyncStorage.getStore();E(b,a,c&&"prerender-ppr"===c.type?c.dynamicTracking:null)}function E(a,b,c){(function(){if(!s)throw Object.defineProperty(Error("Invariant: React.unstable_postpone is not defined. This suggests the wrong version of React was loaded. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E224",enumerable:!1,configurable:!0})})(),c&&c.dynamicAccesses.push({stack:c.isDebugDynamicAccesses?Error().stack:void 0,expression:b}),h.default.unstable_postpone(F(a,b))}function F(a,b){return`Route ${a} needs to bail out of prerendering at this point because it used ${b}. React throws this special object to indicate where. It should not be caught by your own try/catch. Learn more: https://nextjs.org/docs/messages/ppr-caught-error`}function G(a){return"object"==typeof a&&null!==a&&"string"==typeof a.message&&H(a.message)}function H(a){return a.includes("needs to bail out of prerendering at this point because it used")&&a.includes("Learn more: https://nextjs.org/docs/messages/ppr-caught-error")}if(!1===H(F("%%%","^^^")))throw Object.defineProperty(Error("Invariant: isDynamicPostpone misidentified a postpone reason. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E296",enumerable:!1,configurable:!0});let I="NEXT_PRERENDER_INTERRUPTED";function J(a){let b=Object.defineProperty(Error(a),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return b.digest=I,b}function K(a){return"object"==typeof a&&null!==a&&a.digest===I&&"name"in a&&"message"in a&&a instanceof Error}function L(a){return a.length>0}function M(a,b){return a.dynamicAccesses.push(...b.dynamicAccesses),a.dynamicAccesses}function N(a){return a.filter(a=>"string"==typeof a.stack&&a.stack.length>0).map(({expression:a,stack:b})=>(b=b.split("\n").slice(4).filter(a=>!(a.includes("node_modules/next/")||a.includes(" (<anonymous>)")||a.includes(" (node:"))).join("\n"),`Dynamic API Usage Debug - ${a}:
${b}`))}function O(){let a=new AbortController;return a.abort(Object.defineProperty(new p.BailoutToCSRError("Render in Browser"),"__NEXT_ERROR_CODE",{value:"E721",enumerable:!1,configurable:!0})),a.signal}function P(a){switch(a.type){case"prerender":case"prerender-runtime":let b=new AbortController;if(a.cacheSignal)a.cacheSignal.inputReady().then(()=>{b.abort()});else{let c=(0,k.getRuntimeStagePromise)(a);c?c.then(()=>(0,o.scheduleOnNextTick)(()=>b.abort())):(0,o.scheduleOnNextTick)(()=>b.abort())}return b.signal;case"prerender-client":case"prerender-ppr":case"prerender-legacy":case"request":case"cache":case"private-cache":case"unstable-cache":return}}function Q(a,b){let c=b.dynamicTracking;c&&c.dynamicAccesses.push({stack:c.isDebugDynamicAccesses?Error().stack:void 0,expression:a})}function R(a){let b=l.workAsyncStorage.getStore(),c=k.workUnitAsyncStorage.getStore();if(b&&c)switch(c.type){case"prerender-client":case"prerender":{let d=c.fallbackRouteParams;d&&d.size>0&&h.default.use((0,m.makeHangingPromise)(c.renderSignal,b.route,a));break}case"prerender-ppr":{let d=c.fallbackRouteParams;if(d&&d.size>0)return E(b.route,a,c.dynamicTracking);break}case"prerender-runtime":throw Object.defineProperty(new q.InvariantError(`\`${a}\` was called during a runtime prerender. Next.js should be preventing ${a} from being included in server components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E771",enumerable:!1,configurable:!0});case"cache":case"private-cache":throw Object.defineProperty(new q.InvariantError(`\`${a}\` was called inside a cache scope. Next.js should be preventing ${a} from being included in server components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E745",enumerable:!1,configurable:!0})}}function S(a){let b=l.workAsyncStorage.getStore(),c=k.workUnitAsyncStorage.getStore();if(b)switch(!c&&(0,k.throwForMissingRequestStore)(a),c.type){case"prerender-client":h.default.use((0,m.makeHangingPromise)(c.renderSignal,b.route,a));break;case"prerender-legacy":case"prerender-ppr":if(b.forceStatic)return;throw Object.defineProperty(new p.BailoutToCSRError(a),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});case"prerender":case"prerender-runtime":throw Object.defineProperty(new q.InvariantError(`\`${a}\` was called from a Server Component. Next.js should be preventing ${a} from being included in server components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E795",enumerable:!1,configurable:!0});case"cache":case"unstable-cache":case"private-cache":throw Object.defineProperty(new q.InvariantError(`\`${a}\` was called inside a cache scope. Next.js should be preventing ${a} from being included in server components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E745",enumerable:!1,configurable:!0});case"request":return}}let T=/\n\s+at Suspense \(<anonymous>\)/,U=RegExp(`\\n\\s+at Suspense \\(<anonymous>\\)(?:(?!\\n\\s+at (?:body|div|main|section|article|aside|header|footer|nav|form|p|span|h1|h2|h3|h4|h5|h6) \\(<anonymous>\\))[\\s\\S])*?\\n\\s+at ${n.ROOT_LAYOUT_BOUNDARY_NAME} \\([^\\n]*\\)`),V=RegExp(`\\n\\s+at ${n.METADATA_BOUNDARY_NAME}[\\n\\s]`),W=RegExp(`\\n\\s+at ${n.VIEWPORT_BOUNDARY_NAME}[\\n\\s]`),X=RegExp(`\\n\\s+at ${n.OUTLET_BOUNDARY_NAME}[\\n\\s]`);function Y(a,b,c,d){if(!X.test(b)){if(V.test(b)){c.hasDynamicMetadata=!0;return}if(W.test(b)){c.hasDynamicViewport=!0;return}if(U.test(b)){c.hasAllowedDynamic=!0,c.hasSuspenseAboveBody=!0;return}else if(T.test(b)){c.hasAllowedDynamic=!0;return}else{var e,f;let g;if(d.syncDynamicErrorWithStack)return void c.dynamicErrors.push(d.syncDynamicErrorWithStack);let h=(e=`Route "${a.route}": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route`,f=b,(g=Object.defineProperty(Error(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})).stack=g.name+": "+e+f,g);return void c.dynamicErrors.push(h)}}}var Z=((e={})[e.Full=0]="Full",e[e.Empty=1]="Empty",e[e.Errored=2]="Errored",e);function $(a,b){console.error(b),a.dev||(a.hasReadableErrorStacks?console.error(`To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \`next dev\`, then open "${a.route}" in your browser to investigate the error.`):console.error(`To get a more detailed stack trace and pinpoint the issue, try one of the following:
  - Start the app in development mode by running \`next dev\`, then open "${a.route}" in your browser to investigate the error.
  - Rerun the production build with \`next build --debug-prerender\` to generate better stack traces.`))}function _(a,b,c,d){if(d.syncDynamicErrorWithStack)throw $(a,d.syncDynamicErrorWithStack),new j.StaticGenBailoutError;if(0!==b){if(c.hasSuspenseAboveBody)return;let d=c.dynamicErrors;if(d.length>0){for(let b=0;b<d.length;b++)$(a,d[b]);throw new j.StaticGenBailoutError}if(c.hasDynamicViewport)throw console.error(`Route "${a.route}" has a \`generateViewport\` that depends on Request data (\`cookies()\`, etc...) or uncached external data (\`fetch(...)\`, etc...) without explicitly allowing fully dynamic rendering. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-viewport`),new j.StaticGenBailoutError;if(1===b)throw console.error(`Route "${a.route}" did not produce a static shell and Next.js was unable to determine a reason. This is a bug in Next.js.`),new j.StaticGenBailoutError}else if(!1===c.hasAllowedDynamic&&c.hasDynamicMetadata)throw console.error(`Route "${a.route}" has a \`generateMetadata\` that depends on Request data (\`cookies()\`, etc...) or uncached external data (\`fetch(...)\`, etc...) when the rest of the route does not. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-metadata`),new j.StaticGenBailoutError}function aa(a,b){return a.runtimeStagePromise?a.runtimeStagePromise.then(()=>b):b}},8018,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return i}});let d=function(a,b){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=e(void 0);if(c&&c.has(a))return c.get(a);var d={__proto__:null},f=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var g in a)if("default"!==g&&Object.prototype.hasOwnProperty.call(a,g)){var h=f?Object.getOwnPropertyDescriptor(a,g):null;h&&(h.get||h.set)?Object.defineProperty(d,g,h):d[g]=a[g]}return d.default=a,c&&c.set(a,d),d}(a.r(717));function e(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(e=function(a){return a?c:b})(a)}let f={current:null},g="function"==typeof d.cache?d.cache:a=>a,h=console.warn;function i(a){return function(...b){h(a(...b))}}g(a=>{try{h(f.current)}finally{f.current=null}})},86309,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={isRequestAPICallableInsideAfter:function(){return j},throwForSearchParamsAccessInUseCache:function(){return i},throwWithStaticGenerationBailoutErrorWithDynamicError:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(60312),g=a.r(24725);function h(a,b){throw Object.defineProperty(new f.StaticGenBailoutError(`Route ${a} with \`dynamic = "error"\` couldn't be rendered statically because it used ${b}. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E543",enumerable:!1,configurable:!0})}function i(a,b){let c=Object.defineProperty(Error(`Route ${a.route} used \`searchParams\` inside "use cache". Accessing dynamic request data inside a cache scope is not supported. If you need some search params inside a cached function await \`searchParams\` outside of the cached function and pass only the required search params as arguments to the cached function. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E842",enumerable:!1,configurable:!0});throw Error.captureStackTrace(c,b),a.invalidDynamicUsageError??=c,c}function j(){let a=g.afterTaskAsyncStorage.getStore();return(null==a?void 0:a.rootTaskSpawnPhase)==="action"}},81740,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"cookies",{enumerable:!0,get:function(){return n}});let d=a.r(14896),e=a.r(63681),f=a.r(56704),g=a.r(32319),h=a.r(60384),i=a.r(60312),j=a.r(13091),k=a.r(8018),l=a.r(86309),m=a.r(50640);function n(){let a="cookies",b=f.workAsyncStorage.getStore(),c=g.workUnitAsyncStorage.getStore();if(b){if(c&&"after"===c.phase&&!(0,l.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${b.route} used \`cookies()\` inside \`after()\`. This is not supported. If you need this data inside an \`after()\` callback, use \`cookies()\` outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E843",enumerable:!1,configurable:!0});if(b.forceStatic)return p(d.RequestCookiesAdapter.seal(new e.RequestCookies(new Headers({}))));if(b.dynamicShouldError)throw Object.defineProperty(new i.StaticGenBailoutError(`Route ${b.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`cookies()\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E849",enumerable:!1,configurable:!0});if(c)switch(c.type){case"cache":let f=Object.defineProperty(Error(`Route ${b.route} used \`cookies()\` inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`cookies()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E831",enumerable:!1,configurable:!0});throw Error.captureStackTrace(f,n),b.invalidDynamicUsageError??=f,f;case"unstable-cache":throw Object.defineProperty(Error(`Route ${b.route} used \`cookies()\` inside a function cached with \`unstable_cache()\`. Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`cookies()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E846",enumerable:!1,configurable:!0});case"prerender":var k=b,q=c;let g=o.get(q);if(g)return g;let r=(0,j.makeHangingPromise)(q.renderSignal,k.route,"`cookies()`");return o.set(q,r),r;case"prerender-client":let s="`cookies`";throw Object.defineProperty(new m.InvariantError(`${s} must not be used within a Client Component. Next.js should be preventing ${s} from being included in Client Components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E832",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,h.postponeWithTracking)(b.route,a,c.dynamicTracking);case"prerender-legacy":return(0,h.throwToInterruptStaticGeneration)(a,b,c);case"prerender-runtime":return(0,h.delayUntilRuntimeStage)(c,p(c.cookies));case"private-cache":return p(c.cookies);case"request":return(0,h.trackDynamicDataInDynamicRender)(c),p((0,d.areCookiesMutableInCurrentPhase)(c)?c.userspaceMutableCookies:c.cookies)}}(0,g.throwForMissingRequestStore)(a)}a.r(31382);let o=new WeakMap;function p(a){let b=o.get(a);if(b)return b;let c=Promise.resolve(a);return o.set(a,c),c}(0,k.createDedupedByCallsiteServerErrorLoggerDev)(function(a,b){let c=a?`Route "${a}" `:"This route ";return Object.defineProperty(Error(`${c}used ${b}. \`cookies()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E830",enumerable:!1,configurable:!0})})},29927,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={HeadersAdapter:function(){return h},ReadonlyHeadersError:function(){return g}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(51409);class g extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new g}}class h extends Headers{constructor(a){super(),this.headers=new Proxy(a,{get(b,c,d){if("symbol"==typeof c)return f.ReflectAdapter.get(b,c,d);let e=c.toLowerCase(),g=Object.keys(a).find(a=>a.toLowerCase()===e);if(void 0!==g)return f.ReflectAdapter.get(b,g,d)},set(b,c,d,e){if("symbol"==typeof c)return f.ReflectAdapter.set(b,c,d,e);let g=c.toLowerCase(),h=Object.keys(a).find(a=>a.toLowerCase()===g);return f.ReflectAdapter.set(b,h??c,d,e)},has(b,c){if("symbol"==typeof c)return f.ReflectAdapter.has(b,c);let d=c.toLowerCase(),e=Object.keys(a).find(a=>a.toLowerCase()===d);return void 0!==e&&f.ReflectAdapter.has(b,e)},deleteProperty(b,c){if("symbol"==typeof c)return f.ReflectAdapter.deleteProperty(b,c);let d=c.toLowerCase(),e=Object.keys(a).find(a=>a.toLowerCase()===d);return void 0===e||f.ReflectAdapter.deleteProperty(b,e)}})}static seal(a){return new Proxy(a,{get(a,b,c){switch(b){case"append":case"delete":case"set":return g.callable;default:return f.ReflectAdapter.get(a,b,c)}}})}merge(a){return Array.isArray(a)?a.join(", "):a}static from(a){return a instanceof Headers?a:new h(a)}append(a,b){let c=this.headers[a];"string"==typeof c?this.headers[a]=[c,b]:Array.isArray(c)?c.push(b):this.headers[a]=b}delete(a){delete this.headers[a]}get(a){let b=this.headers[a];return void 0!==b?this.merge(b):null}has(a){return void 0!==this.headers[a]}set(a,b){this.headers[a]=b}forEach(a,b){for(let[c,d]of this.entries())a.call(b,d,c,this)}*entries(){for(let a of Object.keys(this.headers)){let b=a.toLowerCase(),c=this.get(b);yield[b,c]}}*keys(){for(let a of Object.keys(this.headers)){let b=a.toLowerCase();yield b}}*values(){for(let a of Object.keys(this.headers)){let b=this.get(a);yield b}}[Symbol.iterator](){return this.entries()}}},35754,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"headers",{enumerable:!0,get:function(){return m}});let d=a.r(29927),e=a.r(56704),f=a.r(32319),g=a.r(60384),h=a.r(60312),i=a.r(13091),j=a.r(8018),k=a.r(86309),l=a.r(50640);function m(){let a="headers",b=e.workAsyncStorage.getStore(),c=f.workUnitAsyncStorage.getStore();if(b){if(c&&"after"===c.phase&&!(0,k.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${b.route} used \`headers()\` inside \`after()\`. This is not supported. If you need this data inside an \`after()\` callback, use \`headers()\` outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E839",enumerable:!1,configurable:!0});if(b.forceStatic)return o(d.HeadersAdapter.seal(new Headers({})));if(c)switch(c.type){case"cache":{let a=Object.defineProperty(Error(`Route ${b.route} used \`headers()\` inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`headers()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E833",enumerable:!1,configurable:!0});throw Error.captureStackTrace(a,m),b.invalidDynamicUsageError??=a,a}case"unstable-cache":throw Object.defineProperty(Error(`Route ${b.route} used \`headers()\` inside a function cached with \`unstable_cache()\`. Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use \`headers()\` outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E838",enumerable:!1,configurable:!0})}if(b.dynamicShouldError)throw Object.defineProperty(new h.StaticGenBailoutError(`Route ${b.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`headers()\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E828",enumerable:!1,configurable:!0});if(c)switch(c.type){case"prerender":var j=b,p=c;let e=n.get(p);if(e)return e;let f=(0,i.makeHangingPromise)(p.renderSignal,j.route,"`headers()`");return n.set(p,f),f;case"prerender-client":let q="`headers`";throw Object.defineProperty(new l.InvariantError(`${q} must not be used within a client component. Next.js should be preventing ${q} from being included in client components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E693",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,g.postponeWithTracking)(b.route,a,c.dynamicTracking);case"prerender-legacy":return(0,g.throwToInterruptStaticGeneration)(a,b,c);case"prerender-runtime":return(0,g.delayUntilRuntimeStage)(c,o(c.headers));case"private-cache":return o(c.headers);case"request":return(0,g.trackDynamicDataInDynamicRender)(c),o(c.headers)}}(0,f.throwForMissingRequestStore)(a)}a.r(31382);let n=new WeakMap;function o(a){let b=n.get(a);if(b)return b;let c=Promise.resolve(a);return n.set(a,c),c}(0,j.createDedupedByCallsiteServerErrorLoggerDev)(function(a,b){let c=a?`Route "${a}" `:"This route ";return Object.defineProperty(Error(`${c}used ${b}. \`headers()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E836",enumerable:!1,configurable:!0})})},51125,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"draftMode",{enumerable:!0,get:function(){return k}});let d=a.r(32319),e=a.r(56704),f=a.r(60384),g=a.r(8018),h=a.r(60312),i=a.r(96556),j=a.r(50640);function k(){let a=e.workAsyncStorage.getStore(),b=d.workUnitAsyncStorage.getStore();switch((!a||!b)&&(0,d.throwForMissingRequestStore)("draftMode"),b.type){case"prerender-runtime":return(0,f.delayUntilRuntimeStage)(b,l(b.draftMode,a));case"request":return l(b.draftMode,a);case"cache":case"private-cache":case"unstable-cache":let c=(0,d.getDraftModeProviderForCacheScope)(a,b);if(c)return l(c,a);case"prerender":case"prerender-client":case"prerender-ppr":case"prerender-legacy":return l(null,a);default:return b}}function l(a,b){let c=n.get(a??m);return c||Promise.resolve(new o(a))}a.r(51409);let m={},n=new WeakMap;class o{constructor(a){this._provider=a}get isEnabled(){return null!==this._provider&&this._provider.isEnabled}enable(){p("draftMode().enable()",this.enable),null!==this._provider&&this._provider.enable()}disable(){p("draftMode().disable()",this.disable),null!==this._provider&&this._provider.disable()}}function p(a,b){let c=e.workAsyncStorage.getStore(),g=d.workUnitAsyncStorage.getStore();if(c){if((null==g?void 0:g.phase)==="after")throw Object.defineProperty(Error(`Route ${c.route} used "${a}" inside \`after()\`. The enabled status of \`draftMode()\` can be read inside \`after()\` but you cannot enable or disable \`draftMode()\`. See more info here: https://nextjs.org/docs/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E845",enumerable:!1,configurable:!0});if(c.dynamicShouldError)throw Object.defineProperty(new h.StaticGenBailoutError(`Route ${c.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`${a}\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E553",enumerable:!1,configurable:!0});if(g)switch(g.type){case"cache":case"private-cache":{let d=Object.defineProperty(Error(`Route ${c.route} used "${a}" inside "use cache". The enabled status of \`draftMode()\` can be read in caches but you must not enable or disable \`draftMode()\` inside a cache. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E829",enumerable:!1,configurable:!0});throw Error.captureStackTrace(d,b),c.invalidDynamicUsageError??=d,d}case"unstable-cache":throw Object.defineProperty(Error(`Route ${c.route} used "${a}" inside a function cached with \`unstable_cache()\`. The enabled status of \`draftMode()\` can be read in caches but you must not enable or disable \`draftMode()\` inside a cache. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E844",enumerable:!1,configurable:!0});case"prerender":case"prerender-runtime":{let b=Object.defineProperty(Error(`Route ${c.route} used ${a} without first calling \`await connection()\`. See more info here: https://nextjs.org/docs/messages/next-prerender-sync-headers`),"__NEXT_ERROR_CODE",{value:"E126",enumerable:!1,configurable:!0});return(0,f.abortAndThrowOnSynchronousRequestDataAccess)(c.route,a,b,g)}case"prerender-client":let d="`draftMode`";throw Object.defineProperty(new j.InvariantError(`${d} must not be used within a Client Component. Next.js should be preventing ${d} from being included in Client Components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E832",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,f.postponeWithTracking)(c.route,a,g.dynamicTracking);case"prerender-legacy":g.revalidate=0;let e=Object.defineProperty(new i.DynamicServerError(`Route ${c.route} couldn't be rendered statically because it used \`${a}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E558",enumerable:!1,configurable:!0});throw c.dynamicUsageDescription=a,c.dynamicUsageStack=e.stack,e;case"request":(0,f.trackDynamicDataInDynamicRender)(g)}}}(0,g.createDedupedByCallsiteServerErrorLoggerDev)(function(a,b){let c=a?`Route "${a}" `:"This route ";return Object.defineProperty(Error(`${c}used ${b}. \`draftMode()\` returns a Promise and must be unwrapped with \`await\` or \`React.use()\` before accessing its properties. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E835",enumerable:!1,configurable:!0})})},5246,(a,b,c)=>{b.exports.cookies=a.r(81740).cookies,b.exports.headers=a.r(35754).headers,b.exports.draftMode=a.r(51125).draftMode},99870,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={ACTION_SUFFIX:function(){return r},APP_DIR_ALIAS:function(){return N},CACHE_ONE_YEAR:function(){return D},DOT_NEXT_ALIAS:function(){return L},ESLINT_DEFAULT_DIRS:function(){return af},GSP_NO_RETURNED_VALUE:function(){return _},GSSP_COMPONENT_MEMBER_ERROR:function(){return ac},GSSP_NO_RETURNED_VALUE:function(){return aa},HTML_CONTENT_TYPE_HEADER:function(){return g},INFINITE_CACHE:function(){return E},INSTRUMENTATION_HOOK_FILENAME:function(){return J},JSON_CONTENT_TYPE_HEADER:function(){return h},MATCHED_PATH_HEADER:function(){return k},MIDDLEWARE_FILENAME:function(){return F},MIDDLEWARE_LOCATION_REGEXP:function(){return G},NEXT_BODY_SUFFIX:function(){return u},NEXT_CACHE_IMPLICIT_TAG_ID:function(){return C},NEXT_CACHE_REVALIDATED_TAGS_HEADER:function(){return w},NEXT_CACHE_REVALIDATE_TAG_TOKEN_HEADER:function(){return x},NEXT_CACHE_SOFT_TAG_MAX_LENGTH:function(){return B},NEXT_CACHE_TAGS_HEADER:function(){return v},NEXT_CACHE_TAG_MAX_ITEMS:function(){return z},NEXT_CACHE_TAG_MAX_LENGTH:function(){return A},NEXT_DATA_SUFFIX:function(){return s},NEXT_INTERCEPTION_MARKER_PREFIX:function(){return j},NEXT_META_SUFFIX:function(){return t},NEXT_QUERY_PARAM_PREFIX:function(){return i},NEXT_RESUME_HEADER:function(){return y},NON_STANDARD_NODE_ENV:function(){return ad},PAGES_DIR_ALIAS:function(){return K},PRERENDER_REVALIDATE_HEADER:function(){return l},PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER:function(){return m},PROXY_FILENAME:function(){return H},PROXY_LOCATION_REGEXP:function(){return I},PUBLIC_DIR_MIDDLEWARE_CONFLICT:function(){return V},ROOT_DIR_ALIAS:function(){return M},RSC_ACTION_CLIENT_WRAPPER_ALIAS:function(){return U},RSC_ACTION_ENCRYPTION_ALIAS:function(){return T},RSC_ACTION_PROXY_ALIAS:function(){return Q},RSC_ACTION_VALIDATE_ALIAS:function(){return P},RSC_CACHE_WRAPPER_ALIAS:function(){return R},RSC_DYNAMIC_IMPORT_WRAPPER_ALIAS:function(){return S},RSC_MOD_REF_PROXY_ALIAS:function(){return O},RSC_PREFETCH_SUFFIX:function(){return n},RSC_SEGMENTS_DIR_SUFFIX:function(){return o},RSC_SEGMENT_SUFFIX:function(){return p},RSC_SUFFIX:function(){return q},SERVER_PROPS_EXPORT_ERROR:function(){return $},SERVER_PROPS_GET_INIT_PROPS_CONFLICT:function(){return X},SERVER_PROPS_SSG_CONFLICT:function(){return Y},SERVER_RUNTIME:function(){return ag},SSG_FALLBACK_EXPORT_ERROR:function(){return ae},SSG_GET_INITIAL_PROPS_CONFLICT:function(){return W},STATIC_STATUS_PAGE_GET_INITIAL_PROPS_ERROR:function(){return Z},TEXT_PLAIN_CONTENT_TYPE_HEADER:function(){return f},UNSTABLE_REVALIDATE_RENAME_ERROR:function(){return ab},WEBPACK_LAYERS:function(){return aj},WEBPACK_RESOURCE_QUERIES:function(){return ak},WEB_SOCKET_MAX_RECONNECTIONS:function(){return ah}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="text/plain",g="text/html; charset=utf-8",h="application/json; charset=utf-8",i="nxtP",j="nxtI",k="x-matched-path",l="x-prerender-revalidate",m="x-prerender-revalidate-if-generated",n=".prefetch.rsc",o=".segments",p=".segment.rsc",q=".rsc",r=".action",s=".json",t=".meta",u=".body",v="x-next-cache-tags",w="x-next-revalidated-tags",x="x-next-revalidate-tag-token",y="next-resume",z=128,A=256,B=1024,C="_N_T_",D=31536e3,E=0xfffffffe,F="middleware",G=`(?:src/)?${F}`,H="proxy",I=`(?:src/)?${H}`,J="instrumentation",K="private-next-pages",L="private-dot-next",M="private-next-root-dir",N="private-next-app-dir",O="private-next-rsc-mod-ref-proxy",P="private-next-rsc-action-validate",Q="private-next-rsc-server-reference",R="private-next-rsc-cache-wrapper",S="private-next-rsc-track-dynamic-import",T="private-next-rsc-action-encryption",U="private-next-rsc-action-client-wrapper",V="You can not have a '_next' folder inside of your public folder. This conflicts with the internal '/_next' route. https://nextjs.org/docs/messages/public-next-folder-conflict",W="You can not use getInitialProps with getStaticProps. To use SSG, please remove your getInitialProps",X="You can not use getInitialProps with getServerSideProps. Please remove getInitialProps.",Y="You can not use getStaticProps or getStaticPaths with getServerSideProps. To use SSG, please remove getServerSideProps",Z="can not have getInitialProps/getServerSideProps, https://nextjs.org/docs/messages/404-get-initial-props",$="pages with `getServerSideProps` can not be exported. See more info here: https://nextjs.org/docs/messages/gssp-export",_="Your `getStaticProps` function did not return an object. Did you forget to add a `return`?",aa="Your `getServerSideProps` function did not return an object. Did you forget to add a `return`?",ab="The `unstable_revalidate` property is available for general use.\nPlease use `revalidate` instead.",ac="can not be attached to a page's component and must be exported from the page. See more info here: https://nextjs.org/docs/messages/gssp-component-member",ad='You are using a non-standard "NODE_ENV" value in your environment. This creates inconsistencies in the project and is strongly advised against. Read more: https://nextjs.org/docs/messages/non-standard-node-env',ae="Pages with `fallback` enabled in `getStaticPaths` can not be exported. See more info here: https://nextjs.org/docs/messages/ssg-fallback-true-export",af=["app","pages","components","lib","src"],ag={edge:"edge",experimentalEdge:"experimental-edge",nodejs:"nodejs"},ah=12,ai={shared:"shared",reactServerComponents:"rsc",serverSideRendering:"ssr",actionBrowser:"action-browser",apiNode:"api-node",apiEdge:"api-edge",middleware:"middleware",instrument:"instrument",edgeAsset:"edge-asset",appPagesBrowser:"app-pages-browser",pagesDirBrowser:"pages-dir-browser",pagesDirEdge:"pages-dir-edge",pagesDirNode:"pages-dir-node"},aj={...ai,GROUP:{builtinReact:[ai.reactServerComponents,ai.actionBrowser],serverOnly:[ai.reactServerComponents,ai.actionBrowser,ai.instrument,ai.middleware],neutralTarget:[ai.apiNode,ai.apiEdge],clientOnly:[ai.serverSideRendering,ai.appPagesBrowser],bundled:[ai.reactServerComponents,ai.actionBrowser,ai.serverSideRendering,ai.appPagesBrowser,ai.shared,ai.instrument,ai.middleware],appPages:[ai.reactServerComponents,ai.serverSideRendering,ai.appPagesBrowser,ai.actionBrowser]}},ak={edgeSSREntry:"__next_edge_ssr_entry__",metadata:"__next_metadata__",metadataRoute:"__next_metadata_route__",metadataImageMeta:"__next_metadata_image_meta__"}},76391,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e,f,g,h,i,j,k,l,m,n,o,p={AppRenderSpan:function(){return x},AppRouteRouteHandlersSpan:function(){return A},BaseServerSpan:function(){return r},LoadComponentsSpan:function(){return s},LogSpanAllowList:function(){return E},MiddlewareSpan:function(){return C},NextNodeServerSpan:function(){return u},NextServerSpan:function(){return t},NextVanillaSpanAllowlist:function(){return D},NodeSpan:function(){return z},RenderSpan:function(){return w},ResolveMetadataSpan:function(){return B},RouterSpan:function(){return y},StartServerSpan:function(){return v}};for(var q in p)Object.defineProperty(c,q,{enumerable:!0,get:p[q]});var r=((d=r||{}).handleRequest="BaseServer.handleRequest",d.run="BaseServer.run",d.pipe="BaseServer.pipe",d.getStaticHTML="BaseServer.getStaticHTML",d.render="BaseServer.render",d.renderToResponseWithComponents="BaseServer.renderToResponseWithComponents",d.renderToResponse="BaseServer.renderToResponse",d.renderToHTML="BaseServer.renderToHTML",d.renderError="BaseServer.renderError",d.renderErrorToResponse="BaseServer.renderErrorToResponse",d.renderErrorToHTML="BaseServer.renderErrorToHTML",d.render404="BaseServer.render404",d),s=((e=s||{}).loadDefaultErrorComponents="LoadComponents.loadDefaultErrorComponents",e.loadComponents="LoadComponents.loadComponents",e),t=((f=t||{}).getRequestHandler="NextServer.getRequestHandler",f.getRequestHandlerWithMetadata="NextServer.getRequestHandlerWithMetadata",f.getServer="NextServer.getServer",f.getServerRequestHandler="NextServer.getServerRequestHandler",f.createServer="createServer.createServer",f),u=((g=u||{}).compression="NextNodeServer.compression",g.getBuildId="NextNodeServer.getBuildId",g.createComponentTree="NextNodeServer.createComponentTree",g.clientComponentLoading="NextNodeServer.clientComponentLoading",g.getLayoutOrPageModule="NextNodeServer.getLayoutOrPageModule",g.generateStaticRoutes="NextNodeServer.generateStaticRoutes",g.generateFsStaticRoutes="NextNodeServer.generateFsStaticRoutes",g.generatePublicRoutes="NextNodeServer.generatePublicRoutes",g.generateImageRoutes="NextNodeServer.generateImageRoutes.route",g.sendRenderResult="NextNodeServer.sendRenderResult",g.proxyRequest="NextNodeServer.proxyRequest",g.runApi="NextNodeServer.runApi",g.render="NextNodeServer.render",g.renderHTML="NextNodeServer.renderHTML",g.imageOptimizer="NextNodeServer.imageOptimizer",g.getPagePath="NextNodeServer.getPagePath",g.getRoutesManifest="NextNodeServer.getRoutesManifest",g.findPageComponents="NextNodeServer.findPageComponents",g.getFontManifest="NextNodeServer.getFontManifest",g.getServerComponentManifest="NextNodeServer.getServerComponentManifest",g.getRequestHandler="NextNodeServer.getRequestHandler",g.renderToHTML="NextNodeServer.renderToHTML",g.renderError="NextNodeServer.renderError",g.renderErrorToHTML="NextNodeServer.renderErrorToHTML",g.render404="NextNodeServer.render404",g.startResponse="NextNodeServer.startResponse",g.route="route",g.onProxyReq="onProxyReq",g.apiResolver="apiResolver",g.internalFetch="internalFetch",g),v=((h=v||{}).startServer="startServer.startServer",h),w=((i=w||{}).getServerSideProps="Render.getServerSideProps",i.getStaticProps="Render.getStaticProps",i.renderToString="Render.renderToString",i.renderDocument="Render.renderDocument",i.createBodyResult="Render.createBodyResult",i),x=((j=x||{}).renderToString="AppRender.renderToString",j.renderToReadableStream="AppRender.renderToReadableStream",j.getBodyResult="AppRender.getBodyResult",j.fetch="AppRender.fetch",j),y=((k=y||{}).executeRoute="Router.executeRoute",k),z=((l=z||{}).runHandler="Node.runHandler",l),A=((m=A||{}).runHandler="AppRouteRouteHandlers.runHandler",m),B=((n=B||{}).generateMetadata="ResolveMetadata.generateMetadata",n.generateViewport="ResolveMetadata.generateViewport",n),C=((o=C||{}).execute="Middleware.execute",o);let D=new Set(["Middleware.execute","BaseServer.handleRequest","Render.getServerSideProps","Render.getStaticProps","AppRender.fetch","AppRender.getBodyResult","Render.renderDocument","Node.runHandler","AppRouteRouteHandlers.runHandler","ResolveMetadata.generateMetadata","ResolveMetadata.generateViewport","NextNodeServer.createComponentTree","NextNodeServer.findPageComponents","NextNodeServer.getLayoutOrPageModule","NextNodeServer.startResponse","NextNodeServer.clientComponentLoading"]),E=new Set(["NextNodeServer.findPageComponents","NextNodeServer.createComponentTree","NextNodeServer.clientComponentLoading"])},22981,(a,b,c)=>{"use strict";function d(a){return null!==a&&"object"==typeof a&&"then"in a&&"function"==typeof a.then}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"isThenable",{enumerable:!0,get:function(){return d}})},35842,(a,b,c)=>{"use strict";let d,e;Object.defineProperty(c,"__esModule",{value:!0});var f={BubbledError:function(){return q},SpanKind:function(){return o},SpanStatusCode:function(){return n},getTracer:function(){return x},isBubbledError:function(){return r}};for(var g in f)Object.defineProperty(c,g,{enumerable:!0,get:f[g]});let h=a.r(76391),i=a.r(22981),j=process.env.NEXT_OTEL_PERFORMANCE_PREFIX;try{d=a.r(70406)}catch(b){d=a.r(62562)}let{context:k,propagation:l,trace:m,SpanStatusCode:n,SpanKind:o,ROOT_CONTEXT:p}=d;class q extends Error{constructor(a,b){super(),this.bubble=a,this.result=b}}function r(a){return"object"==typeof a&&null!==a&&a instanceof q}let s=(a,b)=>{r(b)&&b.bubble?a.setAttribute("next.bubble",!0):(b&&(a.recordException(b),a.setAttribute("error.type",b.name)),a.setStatus({code:n.ERROR,message:null==b?void 0:b.message})),a.end()},t=new Map,u=d.createContextKey("next.rootSpanId"),v=0,w={set(a,b,c){a.push({key:b,value:c})}},x=(e=new class a{getTracerInstance(){return m.getTracer("next.js","0.0.1")}getContext(){return k}getTracePropagationData(){let a=k.active(),b=[];return l.inject(a,b,w),b}getActiveScopeSpan(){return m.getSpan(null==k?void 0:k.active())}withPropagatedContext(a,b,c){let d=k.active();if(m.getSpanContext(d))return b();let e=l.extract(d,a,c);return k.with(e,b)}trace(...a){let[b,c,d]=a,{fn:e,options:f}="function"==typeof c?{fn:c,options:{}}:{fn:d,options:{...c}},g=f.spanName??b;if(!h.NextVanillaSpanAllowlist.has(b)&&"1"!==process.env.NEXT_OTEL_VERBOSE||f.hideSpan)return e();let l=this.getSpanContext((null==f?void 0:f.parentSpan)??this.getActiveScopeSpan());l||(l=(null==k?void 0:k.active())??p);let m=l.getValue(u),n="number"!=typeof m||!t.has(m),o=v++;return f.attributes={"next.span_name":g,"next.span_type":b,...f.attributes},k.with(l.setValue(u,o),()=>this.getTracerInstance().startActiveSpan(g,f,a=>{let c;j&&b&&h.LogSpanAllowList.has(b)&&(c="performance"in globalThis&&"measure"in performance?globalThis.performance.now():void 0);let d=!1,g=()=>{!d&&(d=!0,t.delete(o),c&&performance.measure(`${j}:next-${(b.split(".").pop()||"").replace(/[A-Z]/g,a=>"-"+a.toLowerCase())}`,{start:c,end:performance.now()}))};if(n&&t.set(o,new Map(Object.entries(f.attributes??{}))),e.length>1)try{return e(a,b=>s(a,b))}catch(b){throw s(a,b),b}finally{g()}try{let b=e(a);if((0,i.isThenable)(b))return b.then(b=>(a.end(),b)).catch(b=>{throw s(a,b),b}).finally(g);return a.end(),g(),b}catch(b){throw s(a,b),g(),b}}))}wrap(...a){let b=this,[c,d,e]=3===a.length?a:[a[0],{},a[1]];return h.NextVanillaSpanAllowlist.has(c)||"1"===process.env.NEXT_OTEL_VERBOSE?function(){let a=d;"function"==typeof a&&"function"==typeof e&&(a=a.apply(this,arguments));let f=arguments.length-1,g=arguments[f];if("function"!=typeof g)return b.trace(c,a,()=>e.apply(this,arguments));{let d=b.getContext().bind(k.active(),g);return b.trace(c,a,(a,b)=>(arguments[f]=function(a){return null==b||b(a),d.apply(this,arguments)},e.apply(this,arguments)))}}:e}startSpan(...a){let[b,c]=a,d=this.getSpanContext((null==c?void 0:c.parentSpan)??this.getActiveScopeSpan());return this.getTracerInstance().startSpan(b,c,d)}getSpanContext(a){return a?m.setSpan(k.active(),a):void 0}getRootSpanAttributes(){let a=k.active().getValue(u);return t.get(a)}setRootSpanAttribute(a,b){let c=k.active().getValue(u),d=t.get(c);d&&!d.has(a)&&d.set(a,b)}},()=>e)},5723,(a,b,c)=>{"use strict";let d;Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"cloneResponse",{enumerable:!0,get:function(){return f}});let e=()=>{};function f(a){if(!a.body)return[a,a];let[b,c]=a.body.tee(),e=new Response(b,{status:a.status,statusText:a.statusText,headers:a.headers});Object.defineProperty(e,"url",{value:a.url,configurable:!0,enumerable:!0,writable:!1}),d&&e.body&&d.register(e,new WeakRef(e.body));let f=new Response(c,{status:a.status,statusText:a.statusText,headers:a.headers});return Object.defineProperty(f,"url",{value:a.url,configurable:!0,enumerable:!0,writable:!1}),[e,f]}globalThis.FinalizationRegistry&&(d=new FinalizationRegistry(a=>{let b=a.deref();b&&!b.locked&&b.cancel("Response object has been garbage collected").then(e)}))},1786,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"createDedupeFetch",{enumerable:!0,get:function(){return i}});let d=function(a,b){if(a&&a.__esModule)return a;if(null===a||"object"!=typeof a&&"function"!=typeof a)return{default:a};var c=g(void 0);if(c&&c.has(a))return c.get(a);var d={__proto__:null},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!==f&&Object.prototype.hasOwnProperty.call(a,f)){var h=e?Object.getOwnPropertyDescriptor(a,f):null;h&&(h.get||h.set)?Object.defineProperty(d,f,h):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}(a.r(717)),e=a.r(5723),f=a.r(50640);function g(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(g=function(a){return a?c:b})(a)}let h=new Set(["traceparent","tracestate"]);function i(a){let b=d.cache(a=>[]);return function(c,d){let g,i;if(d&&d.signal)return a(c,d);if("string"!=typeof c||d){let b,e="string"==typeof c||c instanceof URL?new Request(c,d):c;if("GET"!==e.method&&"HEAD"!==e.method||e.keepalive)return a(c,d);b=Array.from(e.headers.entries()).filter(([a])=>!h.has(a.toLowerCase())),i=JSON.stringify([e.method,b,e.mode,e.redirect,e.credentials,e.referrer,e.referrerPolicy,e.integrity]),g=e.url}else i='["GET",[],null,"follow",null,null,null,null]',g=c;let j=b(g);for(let a=0,b=j.length;a<b;a+=1){let[b,c]=j[a];if(b===i)return c.then(()=>{let b=j[a][2];if(!b)throw Object.defineProperty(new f.InvariantError("No cached response"),"__NEXT_ERROR_CODE",{value:"E579",enumerable:!1,configurable:!0});let[c,d]=(0,e.cloneResponse)(b);return j[a][2]=d,c})}let k=a(c,d),l=[i,k,null];return j.push(l),k.then(a=>{let[b,c]=(0,e.cloneResponse)(a);return l[2]=c,b})}}},41733,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e,f={CachedRouteKind:function(){return h},IncrementalCacheKind:function(){return i}};for(var g in f)Object.defineProperty(c,g,{enumerable:!0,get:f[g]});var h=((d={}).APP_PAGE="APP_PAGE",d.APP_ROUTE="APP_ROUTE",d.PAGES="PAGES",d.FETCH="FETCH",d.REDIRECT="REDIRECT",d.IMAGE="IMAGE",d),i=((e={}).APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.PAGES="PAGES",e.FETCH="FETCH",e.IMAGE="IMAGE",e)},96194,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"DetachedPromise",{enumerable:!0,get:function(){return d}});class d{constructor(){let a,b;this.promise=new Promise((c,d)=>{a=c,b=d}),this.resolve=a,this.reject=b}}},88690,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"Batcher",{enumerable:!0,get:function(){return e}});let d=a.r(96194);class e{constructor(a,b=a=>a()){this.cacheKeyFn=a,this.schedulerFn=b,this.pending=new Map}static create(a){return new e(null==a?void 0:a.cacheKeyFn,null==a?void 0:a.schedulerFn)}async batch(a,b){let c=this.cacheKeyFn?await this.cacheKeyFn(a):a;if(null===c)return b({resolve:a=>Promise.resolve(a),key:a});let e=this.pending.get(c);if(e)return e;let{promise:f,resolve:g,reject:h}=new d.DetachedPromise;return this.pending.set(c,f),this.schedulerFn(async()=>{try{let c=await b({resolve:g,key:a});g(c)}catch(a){h(a)}finally{this.pending.delete(c)}}),f}}},96109,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ENCODED_TAGS",{enumerable:!0,get:function(){return d}});let d={OPENING:{HTML:new Uint8Array([60,104,116,109,108]),BODY:new Uint8Array([60,98,111,100,121])},CLOSED:{HEAD:new Uint8Array([60,47,104,101,97,100,62]),BODY:new Uint8Array([60,47,98,111,100,121,62]),HTML:new Uint8Array([60,47,104,116,109,108,62]),BODY_AND_HTML:new Uint8Array([60,47,98,111,100,121,62,60,47,104,116,109,108,62])},META:{ICON_MARK:new Uint8Array([60,109,101,116,97,32,110,97,109,101,61,34,194,171,110,120,116,45,105,99,111,110,194,187,34])}}},68794,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={indexOfUint8Array:function(){return f},isEquivalentUint8Arrays:function(){return g},removeFromUint8Array:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(a,b){if(0===b.length)return 0;if(0===a.length||b.length>a.length)return -1;for(let c=0;c<=a.length-b.length;c++){let d=!0;for(let e=0;e<b.length;e++)if(a[c+e]!==b[e]){d=!1;break}if(d)return c}return -1}function g(a,b){if(a.length!==b.length)return!1;for(let c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}function h(a,b){let c=f(a,b);if(0===c)return a.subarray(b.length);if(!(c>-1))return a;{let d=new Uint8Array(a.length-b.length);return d.set(a.slice(0,c)),d.set(a.slice(c+b.length),c),d}}},68370,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"MISSING_ROOT_TAGS_ERROR",{enumerable:!0,get:function(){return d}});let d="NEXT_MISSING_ROOT_TAGS";("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},42327,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={DOC_PREFETCH_RANGE_HEADER_VALUE:function(){return g},doesExportedHtmlMatchBuildId:function(){return j},insertBuildIdComment:function(){return i}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="<!DOCTYPE html>",g="bytes=0-63";function h(a){return a.slice(0,24).replace(/-/g,"_")}function i(a,b){return b.includes("-->")||!a.startsWith(f)?a:a.replace(f,f+"<!--"+h(b)+"-->")}function j(a,b){return a.startsWith(f+"<!--"+h(b)+"-->")}},24774,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={ACTION_HEADER:function(){return g},FLIGHT_HEADERS:function(){return o},NEXT_ACTION_NOT_FOUND_HEADER:function(){return v},NEXT_DID_POSTPONE_HEADER:function(){return r},NEXT_HMR_REFRESH_HASH_COOKIE:function(){return l},NEXT_HMR_REFRESH_HEADER:function(){return k},NEXT_HTML_REQUEST_ID_HEADER:function(){return x},NEXT_IS_PRERENDER_HEADER:function(){return u},NEXT_REQUEST_ID_HEADER:function(){return w},NEXT_REWRITTEN_PATH_HEADER:function(){return s},NEXT_REWRITTEN_QUERY_HEADER:function(){return t},NEXT_ROUTER_PREFETCH_HEADER:function(){return i},NEXT_ROUTER_SEGMENT_PREFETCH_HEADER:function(){return j},NEXT_ROUTER_STALE_TIME_HEADER:function(){return q},NEXT_ROUTER_STATE_TREE_HEADER:function(){return h},NEXT_RSC_UNION_QUERY:function(){return p},NEXT_URL:function(){return m},RSC_CONTENT_TYPE_HEADER:function(){return n},RSC_HEADER:function(){return f}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="rsc",g="next-action",h="next-router-state-tree",i="next-router-prefetch",j="next-router-segment-prefetch",k="next-hmr-refresh",l="__next_hmr_refresh_hash__",m="next-url",n="text/x-component",o=[f,h,i,k,j],p="_rsc",q="x-nextjs-stale-time",r="x-nextjs-postponed",s="x-nextjs-rewritten-path",t="x-nextjs-rewritten-query",u="x-nextjs-prerender",v="x-nextjs-action-not-found",w="x-nextjs-request-id",x="x-nextjs-html-request-id";("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},37211,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={djb2Hash:function(){return f},hexHash:function(){return g}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(a){let b=5381;for(let c=0;c<a.length;c++)b=(b<<5)+b+a.charCodeAt(c)|0;return b>>>0}function g(a){return f(a).toString(36).slice(0,5)}},50094,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"computeCacheBustingSearchParam",{enumerable:!0,get:function(){return e}});let d=a.r(37211);function e(a,b,c,e){return(void 0===a||"0"===a)&&void 0===b&&void 0===c&&void 0===e?"":(0,d.hexHash)([a||"0",b||"0",c||"0",e||"0"].join(","))}},75406,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={chainStreams:function(){return r},continueDynamicHTMLResume:function(){return J},continueDynamicPrerender:function(){return G},continueFizzStream:function(){return F},continueStaticFallbackPrerender:function(){return I},continueStaticPrerender:function(){return H},createBufferedTransformStream:function(){return w},createDocumentClosingStream:function(){return K},createRootLayoutValidatorStream:function(){return E},renderToInitialFizzStream:function(){return y},streamFromBuffer:function(){return t},streamFromString:function(){return s},streamToBuffer:function(){return u},streamToString:function(){return v}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(35842),g=a.r(76391),h=a.r(96194),i=a.r(61933),j=a.r(96109),k=a.r(68794),l=a.r(68370),m=a.r(42327),n=a.r(24774),o=a.r(50094);function p(){}let q=new TextEncoder;function r(...a){if(0===a.length)return new ReadableStream({start(a){a.close()}});if(1===a.length)return a[0];let{readable:b,writable:c}=new TransformStream,d=a[0].pipeTo(c,{preventClose:!0}),e=1;for(;e<a.length-1;e++){let b=a[e];d=d.then(()=>b.pipeTo(c,{preventClose:!0}))}let f=a[e];return(d=d.then(()=>f.pipeTo(c))).catch(p),b}function s(a){return new ReadableStream({start(b){b.enqueue(q.encode(a)),b.close()}})}function t(a){return new ReadableStream({start(b){b.enqueue(a),b.close()}})}async function u(a){let b=a.getReader(),c=[];for(;;){let{done:a,value:d}=await b.read();if(a)break;c.push(d)}return Buffer.concat(c)}async function v(a,b){let c=new TextDecoder("utf-8",{fatal:!0}),d="";for await(let e of a){if(null==b?void 0:b.aborted)return d;d+=c.decode(e,{stream:!0})}return d+c.decode()}function w(a={}){let b,{maxBufferByteLength:c=1/0}=a,d=[],e=0,f=a=>{try{if(0===d.length)return;let b=new Uint8Array(e),c=0;for(let a=0;a<d.length;a++){let e=d[a];b.set(e,c),c+=e.byteLength}d.length=0,e=0,a.enqueue(b)}catch{}};return new TransformStream({transform(a,g){d.push(a),(e+=a.byteLength)>=c?f(g):(a=>{if(b)return;let c=new h.DetachedPromise;b=c,(0,i.scheduleImmediate)(()=>{try{f(a)}finally{b=void 0,c.resolve()}})})(g)},flush:()=>null==b?void 0:b.promise})}function x(a,b){let c=!1;return new TransformStream({transform(d,e){if(a&&!c){c=!0;let a=new TextDecoder("utf-8",{fatal:!0}).decode(d,{stream:!0}),f=(0,m.insertBuildIdComment)(a,b);e.enqueue(q.encode(f));return}e.enqueue(d)}})}function y({ReactDOMServer:a,element:b,streamOptions:c}){return(0,f.getTracer)().trace(g.AppRenderSpan.renderToReadableStream,async()=>a.renderToReadableStream(b,c))}function z(a){let b=-1,c=!1;return new TransformStream({async transform(d,e){let f=-1,g=-1;if(b++,c)return void e.enqueue(d);let h=0;if(-1===f){if(-1===(f=(0,k.indexOfUint8Array)(d,j.ENCODED_TAGS.META.ICON_MARK)))return void e.enqueue(d);47===d[f+(h=j.ENCODED_TAGS.META.ICON_MARK.length)]?h+=2:h++}if(0===b){if(g=(0,k.indexOfUint8Array)(d,j.ENCODED_TAGS.CLOSED.HEAD),-1!==f){if(f<g){let a=new Uint8Array(d.length-h);a.set(d.subarray(0,f)),a.set(d.subarray(f+h),f),d=a}else{let b=await a(),c=q.encode(b),e=c.length,g=new Uint8Array(d.length-h+e);g.set(d.subarray(0,f)),g.set(c,f),g.set(d.subarray(f+h),f+e),d=g}c=!0}}else{let b=await a(),e=q.encode(b),g=e.length,i=new Uint8Array(d.length-h+g);i.set(d.subarray(0,f)),i.set(e,f),i.set(d.subarray(f+h),f+g),d=i,c=!0}e.enqueue(d)}})}function A(a){let b=!1,c=!1;return new TransformStream({async transform(d,e){c=!0;let f=await a();if(b){if(f){let a=q.encode(f);e.enqueue(a)}e.enqueue(d)}else{let a=(0,k.indexOfUint8Array)(d,j.ENCODED_TAGS.CLOSED.HEAD);if(-1!==a){if(f){let b=q.encode(f),c=new Uint8Array(d.length+b.length);c.set(d.slice(0,a)),c.set(b,a),c.set(d.slice(a),a+b.length),e.enqueue(c)}else e.enqueue(d);b=!0}else f&&e.enqueue(q.encode(f)),e.enqueue(d),b=!0}},async flush(b){if(c){let c=await a();c&&b.enqueue(q.encode(c))}}})}function B(a,b){let c=!1,d=null,e=!1;function f(a){return d||(d=g(a)),d}async function g(d){let f=a.getReader();b&&await (0,i.atLeastOneTask)();try{for(;;){let{done:a,value:g}=await f.read();if(a){e=!0;return}b||c||await (0,i.atLeastOneTask)(),d.enqueue(g)}}catch(a){d.error(a)}}return new TransformStream({start(a){b||f(a)},transform(a,c){c.enqueue(a),b&&f(c)},flush(a){if(c=!0,!e)return f(a)}})}let C="</body></html>";function D(){let a=!1;return new TransformStream({transform(b,c){if(a)return c.enqueue(b);let d=(0,k.indexOfUint8Array)(b,j.ENCODED_TAGS.CLOSED.BODY_AND_HTML);if(d>-1){if(a=!0,b.length===j.ENCODED_TAGS.CLOSED.BODY_AND_HTML.length)return;let e=b.slice(0,d);if(c.enqueue(e),b.length>j.ENCODED_TAGS.CLOSED.BODY_AND_HTML.length+d){let a=b.slice(d+j.ENCODED_TAGS.CLOSED.BODY_AND_HTML.length);c.enqueue(a)}}else c.enqueue(b)},flush(a){a.enqueue(j.ENCODED_TAGS.CLOSED.BODY_AND_HTML)}})}function E(){let a=!1,b=!1;return new TransformStream({async transform(c,d){!a&&(0,k.indexOfUint8Array)(c,j.ENCODED_TAGS.OPENING.HTML)>-1&&(a=!0),!b&&(0,k.indexOfUint8Array)(c,j.ENCODED_TAGS.OPENING.BODY)>-1&&(b=!0),d.enqueue(c)},flush(c){let d=[];a||d.push("html"),b||d.push("body"),d.length&&c.enqueue(q.encode(`<html id="__next_error__">
            <template
              data-next-error-message="Missing ${d.map(a=>`<${a}>`).join(d.length>1?" and ":"")} tags in the root layout.
Read more at https://nextjs.org/docs/messages/missing-root-layout-tags"
              data-next-error-digest="${l.MISSING_ROOT_TAGS_ERROR}"
              data-next-error-stack=""
            ></template>
          `))}})}async function F(a,{suffix:b,inlinedDataStream:c,isStaticGeneration:d,isBuildTimePrerendering:e,buildId:f,getServerInsertedHTML:g,getServerInsertedMetadata:j,validateRootLayout:k}){let l,m,n=b?b.split(C,1)[0]:null;d&&await a.allReady;var o=[w(),x(e,f),z(j),null!=n&&n.length>0?(m=!1,new TransformStream({transform(a,b){if(b.enqueue(a),!m){let a;m=!0,l=a=new h.DetachedPromise,(0,i.scheduleImmediate)(()=>{try{b.enqueue(q.encode(n))}catch{}finally{l=void 0,a.resolve()}})}},flush(a){if(l)return l.promise;m||a.enqueue(q.encode(n))}})):null,c?B(c,!0):null,k?E():null,D(),A(g)];let p=a;for(let a of o)a&&(p=p.pipeThrough(a));return p}async function G(a,{getServerInsertedHTML:b,getServerInsertedMetadata:c}){return a.pipeThrough(w()).pipeThrough(new TransformStream({transform(a,b){(0,k.isEquivalentUint8Arrays)(a,j.ENCODED_TAGS.CLOSED.BODY_AND_HTML)||(0,k.isEquivalentUint8Arrays)(a,j.ENCODED_TAGS.CLOSED.BODY)||(0,k.isEquivalentUint8Arrays)(a,j.ENCODED_TAGS.CLOSED.HTML)||(a=(0,k.removeFromUint8Array)(a,j.ENCODED_TAGS.CLOSED.BODY),a=(0,k.removeFromUint8Array)(a,j.ENCODED_TAGS.CLOSED.HTML),b.enqueue(a))}})).pipeThrough(A(b)).pipeThrough(z(c))}async function H(a,{inlinedDataStream:b,getServerInsertedHTML:c,getServerInsertedMetadata:d,isBuildTimePrerendering:e,buildId:f}){return a.pipeThrough(w()).pipeThrough(x(e,f)).pipeThrough(A(c)).pipeThrough(z(d)).pipeThrough(B(b,!0)).pipeThrough(D())}async function I(a,{inlinedDataStream:b,getServerInsertedHTML:c,getServerInsertedMetadata:d,isBuildTimePrerendering:e,buildId:f}){let g,h,i,l;return a.pipeThrough(w()).pipeThrough(x(e,f)).pipeThrough(A(c)).pipeThrough((g=(0,o.computeCacheBustingSearchParam)("1","/_full",void 0,void 0),h=`${n.NEXT_RSC_UNION_QUERY}=${g}`,i=`<script>__NEXT_CLIENT_RESUME=fetch(location.pathname+'?${h}',{credentials:'same-origin',headers:{'${n.RSC_HEADER}': '1','${n.NEXT_ROUTER_PREFETCH_HEADER}': '1','${n.NEXT_ROUTER_SEGMENT_PREFETCH_HEADER}': '/_full'}})</script>`,l=!1,new TransformStream({transform(a,b){if(l)return void b.enqueue(a);let c=(0,k.indexOfUint8Array)(a,j.ENCODED_TAGS.CLOSED.HEAD);if(-1===c)return void b.enqueue(a);let d=q.encode(i),e=new Uint8Array(a.length+d.length);e.set(a.slice(0,c)),e.set(d,c),e.set(a.slice(c),c+d.length),b.enqueue(e),l=!0}}))).pipeThrough(z(d)).pipeThrough(B(b,!0)).pipeThrough(D())}async function J(a,{delayDataUntilFirstHtmlChunk:b,inlinedDataStream:c,getServerInsertedHTML:d,getServerInsertedMetadata:e}){return a.pipeThrough(w()).pipeThrough(A(d)).pipeThrough(z(e)).pipeThrough(B(c,b)).pipeThrough(D())}function K(){return s(C)}},49697,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={NEXT_REQUEST_META:function(){return f},addRequestMeta:function(){return i},getRequestMeta:function(){return g},removeRequestMeta:function(){return j},setRequestMeta:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=Symbol.for("NextInternalRequestMeta");function g(a,b){let c=a[f]||{};return"string"==typeof b?c[b]:c}function h(a,b){return a[f]=b,b}function i(a,b,c){let d=g(a);return d[b]=c,h(a,d)}function j(a,b){let c=g(a);return delete c[b],h(a,c)}},92273,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={fromNodeOutgoingHttpHeaders:function(){return g},normalizeNextQueryParam:function(){return k},splitCookiesString:function(){return h},toNodeOutgoingHttpHeaders:function(){return i},validateURL:function(){return j}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(99870);function g(a){let b=new Headers;for(let[c,d]of Object.entries(a))for(let a of Array.isArray(d)?d:[d])void 0!==a&&("number"==typeof a&&(a=a.toString()),b.append(c,a));return b}function h(a){var b,c,d,e,f,g=[],h=0;function i(){for(;h<a.length&&/\s/.test(a.charAt(h));)h+=1;return h<a.length}for(;h<a.length;){for(b=h,f=!1;i();)if(","===(c=a.charAt(h))){for(d=h,h+=1,i(),e=h;h<a.length&&"="!==(c=a.charAt(h))&&";"!==c&&","!==c;)h+=1;h<a.length&&"="===a.charAt(h)?(f=!0,h=e,g.push(a.substring(b,d)),b=h):h=d+1}else h+=1;(!f||h>=a.length)&&g.push(a.substring(b,a.length))}return g}function i(a){let b={},c=[];if(a)for(let[d,e]of a.entries())"set-cookie"===d.toLowerCase()?(c.push(...h(e)),b[d]=1===c.length?c[0]:c):b[d]=e;return b}function j(a){try{return String(new URL(String(a)))}catch(b){throw Object.defineProperty(Error(`URL is malformed "${String(a)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:b}),"__NEXT_ERROR_CODE",{value:"E61",enumerable:!1,configurable:!0})}}function k(a){for(let b of[f.NEXT_QUERY_PARAM_PREFIX,f.NEXT_INTERCEPTION_MARKER_PREFIX])if(a!==b&&a.startsWith(b))return a.substring(b.length);return null}},92603,(a,b,c)=>{"use strict";function d(a,b,c){if(a){for(let d of(c&&(c=c.toLowerCase()),a))if(b===d.domain?.split(":",1)[0].toLowerCase()||c===d.defaultLocale.toLowerCase()||d.locales?.some(a=>a.toLowerCase()===c))return d}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"detectDomainLocale",{enumerable:!0,get:function(){return d}})},74993,(a,b,c)=>{"use strict";function d(a){return a.replace(/\/$/,"")||"/"}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"removeTrailingSlash",{enumerable:!0,get:function(){return d}})},71442,(a,b,c)=>{"use strict";function d(a){let b=a.indexOf("#"),c=a.indexOf("?"),d=c>-1&&(b<0||c<b);return d||b>-1?{pathname:a.substring(0,d?c:b),query:d?a.substring(c,b>-1?b:void 0):"",hash:b>-1?a.slice(b):""}:{pathname:a,query:"",hash:""}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"parsePath",{enumerable:!0,get:function(){return d}})},91150,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"addPathPrefix",{enumerable:!0,get:function(){return e}});let d=a.r(71442);function e(a,b){if(!a.startsWith("/")||!b)return a;let{pathname:c,query:e,hash:f}=(0,d.parsePath)(a);return`${b}${c}${e}${f}`}},47074,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"addPathSuffix",{enumerable:!0,get:function(){return e}});let d=a.r(71442);function e(a,b){if(!a.startsWith("/")||!b)return a;let{pathname:c,query:e,hash:f}=(0,d.parsePath)(a);return`${c}${b}${e}${f}`}},39481,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"pathHasPrefix",{enumerable:!0,get:function(){return e}});let d=a.r(71442);function e(a,b){if("string"!=typeof a)return!1;let{pathname:c}=(0,d.parsePath)(a);return c===b||c.startsWith(b+"/")}},7700,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"addLocale",{enumerable:!0,get:function(){return f}});let d=a.r(91150),e=a.r(39481);function f(a,b,c,f){if(!b||b===c)return a;let g=a.toLowerCase();return!f&&((0,e.pathHasPrefix)(g,"/api")||(0,e.pathHasPrefix)(g,`/${b.toLowerCase()}`))?a:(0,d.addPathPrefix)(a,`/${b}`)}},97642,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"formatNextPathnameInfo",{enumerable:!0,get:function(){return h}});let d=a.r(74993),e=a.r(91150),f=a.r(47074),g=a.r(7700);function h(a){let b=(0,g.addLocale)(a.pathname,a.locale,a.buildId?void 0:a.defaultLocale,a.ignorePrefix);return(a.buildId||!a.trailingSlash)&&(b=(0,d.removeTrailingSlash)(b)),a.buildId&&(b=(0,f.addPathSuffix)((0,e.addPathPrefix)(b,`/_next/data/${a.buildId}`),"/"===a.pathname?"index.json":".json")),b=(0,e.addPathPrefix)(b,a.basePath),!a.buildId&&a.trailingSlash?b.endsWith("/")?b:(0,f.addPathSuffix)(b,"/"):(0,d.removeTrailingSlash)(b)}},64239,(a,b,c)=>{"use strict";function d(a,b){let c;if(b?.host&&!Array.isArray(b.host))c=b.host.toString().split(":",1)[0];else{if(!a.hostname)return;c=a.hostname}return c.toLowerCase()}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"getHostname",{enumerable:!0,get:function(){return d}})},3885,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"normalizeLocalePath",{enumerable:!0,get:function(){return e}});let d=new WeakMap;function e(a,b){let c;if(!b)return{pathname:a};let e=d.get(b);e||(e=b.map(a=>a.toLowerCase()),d.set(b,e));let f=a.split("/",2);if(!f[1])return{pathname:a};let g=f[1].toLowerCase(),h=e.indexOf(g);return h<0?{pathname:a}:(c=b[h],{pathname:a=a.slice(c.length+1)||"/",detectedLocale:c})}},61601,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"removePathPrefix",{enumerable:!0,get:function(){return e}});let d=a.r(39481);function e(a,b){if(!(0,d.pathHasPrefix)(a,b))return a;let c=a.slice(b.length);return c.startsWith("/")?c:`/${c}`}},94971,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"getNextPathnameInfo",{enumerable:!0,get:function(){return g}});let d=a.r(3885),e=a.r(61601),f=a.r(39481);function g(a,b){let{basePath:c,i18n:g,trailingSlash:h}=b.nextConfig??{},i={pathname:a,trailingSlash:"/"!==a?a.endsWith("/"):h};c&&(0,f.pathHasPrefix)(i.pathname,c)&&(i.pathname=(0,e.removePathPrefix)(i.pathname,c),i.basePath=c);let j=i.pathname;if(i.pathname.startsWith("/_next/data/")&&i.pathname.endsWith(".json")){let a=i.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/");i.buildId=a[0],j="index"!==a[1]?`/${a.slice(1).join("/")}`:"/",!0===b.parseData&&(i.pathname=j)}if(g){let a=b.i18nProvider?b.i18nProvider.analyze(i.pathname):(0,d.normalizeLocalePath)(i.pathname,g.locales);i.locale=a.detectedLocale,i.pathname=a.pathname??i.pathname,!a.detectedLocale&&i.buildId&&(a=b.i18nProvider?b.i18nProvider.analyze(j):(0,d.normalizeLocalePath)(j,g.locales)).detectedLocale&&(i.locale=a.detectedLocale)}return i}},22670,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"NextURL",{enumerable:!0,get:function(){return k}});let d=a.r(92603),e=a.r(97642),f=a.r(64239),g=a.r(94971),h=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\[::1\]|localhost)/;function i(a,b){return new URL(String(a).replace(h,"localhost"),b&&String(b).replace(h,"localhost"))}let j=Symbol("NextURLInternal");class k{constructor(a,b,c){let d,e;"object"==typeof b&&"pathname"in b||"string"==typeof b?(d=b,e=c||{}):e=c||b||{},this[j]={url:i(a,d??e.base),options:e,basePath:""},this.analyze()}analyze(){var a,b,c,e,h;let i=(0,g.getNextPathnameInfo)(this[j].url.pathname,{nextConfig:this[j].options.nextConfig,parseData:!0,i18nProvider:this[j].options.i18nProvider}),k=(0,f.getHostname)(this[j].url,this[j].options.headers);this[j].domainLocale=this[j].options.i18nProvider?this[j].options.i18nProvider.detectDomainLocale(k):(0,d.detectDomainLocale)(null==(b=this[j].options.nextConfig)||null==(a=b.i18n)?void 0:a.domains,k);let l=(null==(c=this[j].domainLocale)?void 0:c.defaultLocale)||(null==(h=this[j].options.nextConfig)||null==(e=h.i18n)?void 0:e.defaultLocale);this[j].url.pathname=i.pathname,this[j].defaultLocale=l,this[j].basePath=i.basePath??"",this[j].buildId=i.buildId,this[j].locale=i.locale??l,this[j].trailingSlash=i.trailingSlash}formatPathname(){return(0,e.formatNextPathnameInfo)({basePath:this[j].basePath,buildId:this[j].buildId,defaultLocale:this[j].options.forceLocale?void 0:this[j].defaultLocale,locale:this[j].locale,pathname:this[j].url.pathname,trailingSlash:this[j].trailingSlash})}formatSearch(){return this[j].url.search}get buildId(){return this[j].buildId}set buildId(a){this[j].buildId=a}get locale(){return this[j].locale??""}set locale(a){var b,c;if(!this[j].locale||!(null==(c=this[j].options.nextConfig)||null==(b=c.i18n)?void 0:b.locales.includes(a)))throw Object.defineProperty(TypeError(`The NextURL configuration includes no locale "${a}"`),"__NEXT_ERROR_CODE",{value:"E597",enumerable:!1,configurable:!0});this[j].locale=a}get defaultLocale(){return this[j].defaultLocale}get domainLocale(){return this[j].domainLocale}get searchParams(){return this[j].url.searchParams}get host(){return this[j].url.host}set host(a){this[j].url.host=a}get hostname(){return this[j].url.hostname}set hostname(a){this[j].url.hostname=a}get port(){return this[j].url.port}set port(a){this[j].url.port=a}get protocol(){return this[j].url.protocol}set protocol(a){this[j].url.protocol=a}get href(){let a=this.formatPathname(),b=this.formatSearch();return`${this.protocol}//${this.host}${a}${b}${this.hash}`}set href(a){this[j].url=i(a),this.analyze()}get origin(){return this[j].url.origin}get pathname(){return this[j].url.pathname}set pathname(a){this[j].url.pathname=a}get hash(){return this[j].url.hash}set hash(a){this[j].url.hash=a}get search(){return this[j].url.search}set search(a){this[j].url.search=a}get password(){return this[j].url.password}set password(a){this[j].url.password=a}get username(){return this[j].url.username}set username(a){this[j].url.username=a}get basePath(){return this[j].basePath}set basePath(a){this[j].basePath=a.startsWith("/")?a:`/${a}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new k(String(this),this[j].options)}}},89753,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={PageSignatureError:function(){return f},RemovedPageError:function(){return g},RemovedUAError:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});class f extends Error{constructor({page:a}){super(`The middleware "${a}" accepts an async API directly with the form:
  
  export function middleware(request, event) {
    return NextResponse.redirect('/new-location')
  }
  
  Read more: https://nextjs.org/docs/messages/middleware-new-signature
  `)}}class g extends Error{constructor(){super(`The request.page has been deprecated in favour of \`URLPattern\`.
  Read more: https://nextjs.org/docs/messages/middleware-request-page
  `)}}class h extends Error{constructor(){super(`The request.ua has been removed in favour of \`userAgent\` function.
  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent
  `)}}},88491,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={INTERNALS:function(){return j},NextRequest:function(){return k}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(22670),g=a.r(92273),h=a.r(89753),i=a.r(63681),j=Symbol("internal request");class k extends Request{constructor(a,b={}){const c="string"!=typeof a&&"url"in a?a.url:String(a);(0,g.validateURL)(c),b.body&&"half"!==b.duplex&&(b.duplex="half"),a instanceof Request?super(a,b):super(c,b);const d=new f.NextURL(c,{headers:(0,g.toNodeOutgoingHttpHeaders)(this.headers),nextConfig:b.nextConfig});this[j]={cookies:new i.RequestCookies(this.headers),nextUrl:d,url:d.toString()}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,nextUrl:this.nextUrl,url:this.url,bodyUsed:this.bodyUsed,cache:this.cache,credentials:this.credentials,destination:this.destination,headers:Object.fromEntries(this.headers),integrity:this.integrity,keepalive:this.keepalive,method:this.method,mode:this.mode,redirect:this.redirect,referrer:this.referrer,referrerPolicy:this.referrerPolicy,signal:this.signal}}get cookies(){return this[j].cookies}get nextUrl(){return this[j].nextUrl}get page(){throw new h.RemovedPageError}get ua(){throw new h.RemovedUAError}get url(){return this[j].url}}},50965,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={isNodeNextRequest:function(){return h},isNodeNextResponse:function(){return i},isWebNextRequest:function(){return f},isWebNextResponse:function(){return g}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a=>!1,g=a=>!1,h=a=>!0,i=a=>!0},17498,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={NextRequestAdapter:function(){return n},ResponseAborted:function(){return k},ResponseAbortedName:function(){return j},createAbortController:function(){return l},signalFromNodeResponse:function(){return m}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(49697),g=a.r(92273),h=a.r(88491),i=a.r(50965),j="ResponseAborted";class k extends Error{constructor(...a){super(...a),this.name=j}}function l(a){let b=new AbortController;return a.once("close",()=>{a.writableFinished||b.abort(new k)}),b}function m(a){let{errored:b,destroyed:c}=a;if(b||c)return AbortSignal.abort(b??new k);let{signal:d}=l(a);return d}class n{static fromBaseNextRequest(a,b){if((0,i.isNodeNextRequest)(a))return n.fromNodeNextRequest(a,b);throw Object.defineProperty(Error("Invariant: Unsupported NextRequest type"),"__NEXT_ERROR_CODE",{value:"E345",enumerable:!1,configurable:!0})}static fromNodeNextRequest(a,b){let c,d=null;if("GET"!==a.method&&"HEAD"!==a.method&&a.body&&(d=a.body),a.url.startsWith("http"))c=new URL(a.url);else{let b=(0,f.getRequestMeta)(a,"initURL");c=b&&b.startsWith("http")?new URL(a.url,b):new URL(a.url,"http://n")}return new h.NextRequest(c,{method:a.method,headers:(0,g.fromNodeOutgoingHttpHeaders)(a.headers),duplex:"half",signal:b,...b.aborted?{}:{body:d}})}static fromWebNextRequest(a){let b=null;return"GET"!==a.method&&"HEAD"!==a.method&&(b=a.body),new h.NextRequest(a.url,{method:a.method,headers:(0,g.fromNodeOutgoingHttpHeaders)(a.headers),duplex:"half",signal:a.request.signal,...a.request.signal.aborted?{}:{body:b}})}}},86131,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={getClientComponentLoaderMetrics:function(){return j},wrapClientComponentLoader:function(){return i}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=0,g=0,h=0;function i(a){return"performance"in globalThis?{require:(...b)=>{let c=performance.now();0===f&&(f=c);try{return h+=1,a.__next_app__.require(...b)}finally{g+=performance.now()-c}},loadChunk:(...b)=>{let c=performance.now(),d=a.__next_app__.loadChunk(...b);return d.finally(()=>{g+=performance.now()-c}),d}}:a.__next_app__}function j(a={}){let b=0===f?void 0:{clientComponentLoadStart:f,clientComponentLoadTimes:g,clientComponentLoadCount:h};return a.reset&&(f=0,g=0,h=0),b}},76178,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={isAbortError:function(){return k},pipeToNodeResponse:function(){return l}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(17498),g=a.r(96194),h=a.r(35842),i=a.r(76391),j=a.r(86131);function k(a){return(null==a?void 0:a.name)==="AbortError"||(null==a?void 0:a.name)===f.ResponseAbortedName}async function l(a,b,c){try{let{errored:d,destroyed:e}=b;if(d||e)return;let k=(0,f.createAbortController)(b),l=function(a,b){let c=!1,d=new g.DetachedPromise;function e(){d.resolve()}a.on("drain",e),a.once("close",()=>{a.off("drain",e),d.resolve()});let f=new g.DetachedPromise;return a.once("finish",()=>{f.resolve()}),new WritableStream({write:async b=>{if(!c){if(c=!0,"performance"in globalThis&&process.env.NEXT_OTEL_PERFORMANCE_PREFIX){let a=(0,j.getClientComponentLoaderMetrics)();a&&performance.measure(`${process.env.NEXT_OTEL_PERFORMANCE_PREFIX}:next-client-component-loading`,{start:a.clientComponentLoadStart,end:a.clientComponentLoadStart+a.clientComponentLoadTimes})}a.flushHeaders(),(0,h.getTracer)().trace(i.NextNodeServerSpan.startResponse,{spanName:"start response"},()=>void 0)}try{let c=a.write(b);"flush"in a&&"function"==typeof a.flush&&a.flush(),c||(await d.promise,d=new g.DetachedPromise)}catch(b){throw a.end(),Object.defineProperty(Error("failed to write chunk to response",{cause:b}),"__NEXT_ERROR_CODE",{value:"E321",enumerable:!1,configurable:!0})}},abort:b=>{a.writableFinished||a.destroy(b)},close:async()=>{if(b&&await b,!a.writableFinished)return a.end(),f.promise}})}(b,c);await a.pipeTo(l,{signal:k.signal})}catch(a){if(k(a))return;throw Object.defineProperty(Error("failed to pipe response",{cause:a}),"__NEXT_ERROR_CODE",{value:"E180",enumerable:!1,configurable:!0})}}},25393,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return g}});let d=a.r(75406),e=a.r(76178),f=a.r(50640);class g{static #m=this.EMPTY=new g(null,{metadata:{},contentType:null});static fromStatic(a,b){return new g(a,{metadata:{},contentType:b})}constructor(a,{contentType:b,waitUntil:c,metadata:d}){this.response=a,this.contentType=b,this.metadata=d,this.waitUntil=c}assignMetadata(a){Object.assign(this.metadata,a)}get isNull(){return null===this.response}get isDynamic(){return"string"!=typeof this.response}toUnchunkedString(a=!1){if(null===this.response)return"";if("string"!=typeof this.response){if(!a)throw Object.defineProperty(new f.InvariantError("dynamic responses cannot be unchunked. This is a bug in Next.js"),"__NEXT_ERROR_CODE",{value:"E732",enumerable:!1,configurable:!0});return(0,d.streamToString)(this.readable)}return this.response}get readable(){return null===this.response?new ReadableStream({start(a){a.close()}}):"string"==typeof this.response?(0,d.streamFromString)(this.response):Buffer.isBuffer(this.response)?(0,d.streamFromBuffer)(this.response):Array.isArray(this.response)?(0,d.chainStreams)(...this.response):this.response}coerce(){return null===this.response?[]:"string"==typeof this.response?[(0,d.streamFromString)(this.response)]:Array.isArray(this.response)?this.response:Buffer.isBuffer(this.response)?[(0,d.streamFromBuffer)(this.response)]:[this.response]}unshift(a){this.response=this.coerce(),this.response.unshift(a)}push(a){this.response=this.coerce(),this.response.push(a)}async pipeTo(a){try{await this.readable.pipeTo(a,{preventClose:!0}),this.waitUntil&&await this.waitUntil,await a.close()}catch(b){if((0,e.isAbortError)(b))return void await a.abort(b);throw b}}async pipeToNodeResponse(a){await (0,e.pipeToNodeResponse)(this.readable,a,this.waitUntil)}}},29756,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"RouteKind",{enumerable:!0,get:function(){return e}});var d,e=((d={}).PAGES="PAGES",d.PAGES_API="PAGES_API",d.APP_PAGE="APP_PAGE",d.APP_ROUTE="APP_ROUTE",d.IMAGE="IMAGE",d)},41333,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d,e={fromResponseCacheEntry:function(){return k},routeKindToIncrementalCacheKind:function(){return m},toResponseCacheEntry:function(){return l}};for(var f in e)Object.defineProperty(c,f,{enumerable:!0,get:e[f]});let g=a.r(41733),h=(d=a.r(25393))&&d.__esModule?d:{default:d},i=a.r(29756),j=a.r(99870);async function k(a){var b,c;return{...a,value:(null==(b=a.value)?void 0:b.kind)===g.CachedRouteKind.PAGES?{kind:g.CachedRouteKind.PAGES,html:await a.value.html.toUnchunkedString(!0),pageData:a.value.pageData,headers:a.value.headers,status:a.value.status}:(null==(c=a.value)?void 0:c.kind)===g.CachedRouteKind.APP_PAGE?{kind:g.CachedRouteKind.APP_PAGE,html:await a.value.html.toUnchunkedString(!0),postponed:a.value.postponed,rscData:a.value.rscData,headers:a.value.headers,status:a.value.status,segmentData:a.value.segmentData}:a.value}}async function l(a){var b,c;return a?{isMiss:a.isMiss,isStale:a.isStale,cacheControl:a.cacheControl,value:(null==(b=a.value)?void 0:b.kind)===g.CachedRouteKind.PAGES?{kind:g.CachedRouteKind.PAGES,html:h.default.fromStatic(a.value.html,j.HTML_CONTENT_TYPE_HEADER),pageData:a.value.pageData,headers:a.value.headers,status:a.value.status}:(null==(c=a.value)?void 0:c.kind)===g.CachedRouteKind.APP_PAGE?{kind:g.CachedRouteKind.APP_PAGE,html:h.default.fromStatic(a.value.html,j.HTML_CONTENT_TYPE_HEADER),rscData:a.value.rscData,headers:a.value.headers,status:a.value.status,postponed:a.value.postponed,segmentData:a.value.segmentData}:a.value}:null}function m(a){switch(a){case i.RouteKind.PAGES:return g.IncrementalCacheKind.PAGES;case i.RouteKind.APP_PAGE:return g.IncrementalCacheKind.APP_PAGE;case i.RouteKind.IMAGE:return g.IncrementalCacheKind.IMAGE;case i.RouteKind.APP_ROUTE:return g.IncrementalCacheKind.APP_ROUTE;case i.RouteKind.PAGES_API:throw Object.defineProperty(Error(`Unexpected route kind ${a}`),"__NEXT_ERROR_CODE",{value:"E64",enumerable:!1,configurable:!0});default:return a}}},24653,(a,b,c)=>{"use strict";var d,e;Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return i}});let f=a.r(88690),g=a.r(61933),h=a.r(41333);d=a.r(41733),e=c,Object.keys(d).forEach(function(a){"default"===a||Object.prototype.hasOwnProperty.call(e,a)||Object.defineProperty(e,a,{enumerable:!0,get:function(){return d[a]}})});class i{constructor(a){this.getBatcher=f.Batcher.create({cacheKeyFn:({key:a,isOnDemandRevalidate:b})=>`${a}-${b?"1":"0"}`,schedulerFn:g.scheduleOnNextTick}),this.revalidateBatcher=f.Batcher.create({schedulerFn:g.scheduleOnNextTick}),this.minimal_mode=a}async get(a,b,c){var d;if(!a)return b({hasResolved:!1,previousCacheEntry:null});if(this.minimal_mode&&(null==(d=this.previousCacheItem)?void 0:d.key)===a&&this.previousCacheItem.expiresAt>Date.now())return(0,h.toResponseCacheEntry)(this.previousCacheItem.entry);let{incrementalCache:e,isOnDemandRevalidate:f=!1,isFallback:g=!1,isRoutePPREnabled:i=!1,isPrefetch:j=!1,waitUntil:k,routeKind:l}=c,m=await this.getBatcher.batch({key:a,isOnDemandRevalidate:f},({resolve:c})=>{let d=this.handleGet(a,b,{incrementalCache:e,isOnDemandRevalidate:f,isFallback:g,isRoutePPREnabled:i,isPrefetch:j,routeKind:l},c);return k&&k(d),d});return(0,h.toResponseCacheEntry)(m)}async handleGet(a,b,c,d){let e=null,f=!1;try{if((e=this.minimal_mode?null:await c.incrementalCache.get(a,{kind:(0,h.routeKindToIncrementalCacheKind)(c.routeKind),isRoutePPREnabled:c.isRoutePPREnabled,isFallback:c.isFallback}))&&!c.isOnDemandRevalidate&&(d(e),f=!0,!e.isStale||c.isPrefetch))return e;let g=await this.revalidate(a,c.incrementalCache,c.isRoutePPREnabled,c.isFallback,b,e,null!==e&&!c.isOnDemandRevalidate);if(!g)return this.minimal_mode&&(this.previousCacheItem=void 0),null;return c.isOnDemandRevalidate,g}catch(a){if(f)return console.error(a),null;throw a}}async revalidate(a,b,c,d,e,f,g,h){return this.revalidateBatcher.batch(a,()=>{let i=this.handleRevalidate(a,b,c,d,e,f,g);return h&&h(i),i})}async handleRevalidate(a,b,c,d,e,f,g){try{let i=await e({hasResolved:g,previousCacheEntry:f,isRevalidating:!0});if(!i)return null;let j=await (0,h.fromResponseCacheEntry)({...i,isMiss:!f});return j.cacheControl&&(this.minimal_mode?this.previousCacheItem={key:a,entry:j,expiresAt:Date.now()+1e3}:await b.set(a,j.value,{cacheControl:j.cacheControl,isRoutePPREnabled:c,isFallback:d})),j}catch(e){if(null==f?void 0:f.cacheControl){let e=Math.min(Math.max(f.cacheControl.revalidate||3,3),30),g=void 0===f.cacheControl.expire?void 0:Math.max(e+3,f.cacheControl.expire);await b.set(a,f.value,{cacheControl:{revalidate:e,expire:g},isRoutePPREnabled:c,isFallback:d})}throw e}}}},26095,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={NEXT_PATCH_SYMBOL:function(){return o},createPatchedFetcher:function(){return u},patchFetch:function(){return v},validateRevalidate:function(){return p},validateTags:function(){return q}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(76391),g=a.r(35842),h=a.r(99870),i=a.r(60384),j=a.r(13091),k=a.r(1786),l=a.r(32319),m=a.r(24653),n=a.r(5723);a.r(31382);let o=Symbol.for("next-patch");function p(a,b){try{let c;if(!1===a)c=h.INFINITE_CACHE;else if("number"==typeof a&&!isNaN(a)&&a>-1)c=a;else if(void 0!==a)throw Object.defineProperty(Error(`Invalid revalidate value "${a}" on "${b}", must be a non-negative number or false`),"__NEXT_ERROR_CODE",{value:"E179",enumerable:!1,configurable:!0});return c}catch(a){if(a instanceof Error&&a.message.includes("Invalid revalidate"))throw a;return}}function q(a,b){let c=[],d=[];for(let e=0;e<a.length;e++){let f=a[e];if("string"!=typeof f?d.push({tag:f,reason:"invalid type, must be a string"}):f.length>h.NEXT_CACHE_TAG_MAX_LENGTH?d.push({tag:f,reason:`exceeded max length of ${h.NEXT_CACHE_TAG_MAX_LENGTH}`}):c.push(f),c.length>h.NEXT_CACHE_TAG_MAX_ITEMS){console.warn(`Warning: exceeded max tag count for ${b}, dropped tags:`,a.slice(e).join(", "));break}}if(d.length>0)for(let{tag:a,reason:c}of(console.warn(`Warning: invalid tags passed to ${b}: `),d))console.log(`tag: "${a}" ${c}`);return c}function r(a,b){a.shouldTrackFetchMetrics&&(a.fetchMetrics??=[],a.fetchMetrics.push({...b,end:performance.timeOrigin+performance.now(),idx:a.nextFetchId||0}))}async function s(a,b,c,d,e,f){let g=await a.arrayBuffer(),h={headers:Object.fromEntries(a.headers.entries()),body:Buffer.from(g).toString("base64"),status:a.status,url:a.url};return c&&await d.set(b,{kind:m.CachedRouteKind.FETCH,data:h,revalidate:e},c),await f(),new Response(g,{headers:a.headers,status:a.status,statusText:a.statusText})}async function t(a,b,c,d,e,f,g,h,i){let[j,k]=(0,n.cloneResponse)(b),l=j.arrayBuffer().then(async a=>{let b=Buffer.from(a),h={headers:Object.fromEntries(j.headers.entries()),body:b.toString("base64"),status:j.status,url:j.url};null==f||f.set(c,h),d&&await e.set(c,{kind:m.CachedRouteKind.FETCH,data:h,revalidate:g},d)}).catch(a=>console.warn("Failed to set fetch cache",h,a)).finally(i),o=`cache-set-${c}`;return a.pendingRevalidates??={},o in a.pendingRevalidates&&await a.pendingRevalidates[o],a.pendingRevalidates[o]=l.finally(()=>{var b;(null==(b=a.pendingRevalidates)?void 0:b[o])&&delete a.pendingRevalidates[o]}),k}function u(a,{workAsyncStorage:b,workUnitAsyncStorage:c}){let d=async function(d,e){var k,o;let u;try{(u=new URL(d instanceof Request?d.url:d)).username="",u.password=""}catch{u=void 0}let v=(null==u?void 0:u.href)??"",x=(null==e||null==(k=e.method)?void 0:k.toUpperCase())||"GET",y=(null==e||null==(o=e.next)?void 0:o.internal)===!0,z="1"===process.env.NEXT_OTEL_FETCH_DISABLED,A=y?void 0:performance.timeOrigin+performance.now(),B=b.getStore(),C=c.getStore(),D=C?(0,l.getCacheSignal)(C):null;D&&D.beginRead();let E=(0,g.getTracer)().trace(y?f.NextNodeServerSpan.internalFetch:f.AppRenderSpan.fetch,{hideSpan:z,kind:g.SpanKind.CLIENT,spanName:["fetch",x,v].filter(Boolean).join(" "),attributes:{"http.url":v,"http.method":x,"net.peer.name":null==u?void 0:u.hostname,"net.peer.port":(null==u?void 0:u.port)||void 0}},async()=>{var b;let c,f,g,k,l,o;if(y||!B||B.isDraftMode)return a(d,e);let u=d&&"object"==typeof d&&"string"==typeof d.method,x=a=>(null==e?void 0:e[a])||(u?d[a]:null),z=a=>{var b,c,f;return void 0!==(null==e||null==(b=e.next)?void 0:b[a])?null==e||null==(c=e.next)?void 0:c[a]:u?null==(f=d.next)?void 0:f[a]:void 0},E=z("revalidate"),F=E,G=q(z("tags")||[],`fetch ${d.toString()}`);if(C)switch(C.type){case"prerender":case"prerender-runtime":case"prerender-client":case"prerender-ppr":case"prerender-legacy":case"cache":case"private-cache":c=C}if(c&&Array.isArray(G)){let a=c.tags??(c.tags=[]);for(let b of G)a.includes(b)||a.push(b)}let H=null==C?void 0:C.implicitTags,I=B.fetchCache;C&&"unstable-cache"===C.type&&(I="force-no-store");let J=!!B.isUnstableNoStore,K=x("cache"),L="";"string"==typeof K&&void 0!==F&&("force-cache"===K&&0===F||"no-store"===K&&(F>0||!1===F))&&(f=`Specified "cache: ${K}" and "revalidate: ${F}", only one should be specified.`,K=void 0,F=void 0);let M="no-cache"===K||"no-store"===K||"force-no-store"===I||"only-no-store"===I,N=!I&&!K&&!F&&B.forceDynamic;"force-cache"===K&&void 0===F?F=!1:(M||N)&&(F=0),("no-cache"===K||"no-store"===K)&&(L=`cache: ${K}`),o=p(F,B.route);let O=x("headers"),P="function"==typeof(null==O?void 0:O.get)?O:new Headers(O||{}),Q=P.get("authorization")||P.get("cookie"),R=!["get","head"].includes((null==(b=x("method"))?void 0:b.toLowerCase())||"get"),S=void 0==I&&(void 0==K||"default"===K)&&void 0==F,T=!!((Q||R)&&(null==c?void 0:c.revalidate)===0),U=!1;if(!T&&S&&(B.isBuildTimePrerendering?U=!0:T=!0),S&&void 0!==C)switch(C.type){case"prerender":case"prerender-runtime":case"prerender-client":return D&&(D.endRead(),D=null),(0,j.makeHangingPromise)(C.renderSignal,B.route,"fetch()")}switch(I){case"force-no-store":L="fetchCache = force-no-store";break;case"only-no-store":if("force-cache"===K||void 0!==o&&o>0)throw Object.defineProperty(Error(`cache: 'force-cache' used on fetch for ${v} with 'export const fetchCache = 'only-no-store'`),"__NEXT_ERROR_CODE",{value:"E448",enumerable:!1,configurable:!0});L="fetchCache = only-no-store";break;case"only-cache":if("no-store"===K)throw Object.defineProperty(Error(`cache: 'no-store' used on fetch for ${v} with 'export const fetchCache = 'only-cache'`),"__NEXT_ERROR_CODE",{value:"E521",enumerable:!1,configurable:!0});break;case"force-cache":(void 0===F||0===F)&&(L="fetchCache = force-cache",o=h.INFINITE_CACHE)}if(void 0===o?"default-cache"!==I||J?"default-no-store"===I?(o=0,L="fetchCache = default-no-store"):J?(o=0,L="noStore call"):T?(o=0,L="auto no cache"):(L="auto cache",o=c?c.revalidate:h.INFINITE_CACHE):(o=h.INFINITE_CACHE,L="fetchCache = default-cache"):L||(L=`revalidate: ${o}`),!(B.forceStatic&&0===o)&&!T&&c&&o<c.revalidate){if(0===o){if(C)switch(C.type){case"prerender":case"prerender-client":case"prerender-runtime":return D&&(D.endRead(),D=null),(0,j.makeHangingPromise)(C.renderSignal,B.route,"fetch()")}(0,i.markCurrentScopeAsDynamic)(B,C,`revalidate: 0 fetch ${d} ${B.route}`)}c&&E===o&&(c.revalidate=o)}let V="number"==typeof o&&o>0,{incrementalCache:W}=B,X=!1;if(C)switch(C.type){case"request":case"cache":case"private-cache":X=C.isHmrRefresh??!1,k=C.serverComponentsHmrCache}if(W&&(V||k))try{g=await W.generateCacheKey(v,u?d:e)}catch(a){console.error("Failed to generate cache key for",d)}let Y=B.nextFetchId??1;B.nextFetchId=Y+1;let Z=()=>{},$=async(b,c)=>{let i=["cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","window","duplex",...b?[]:["signal"]];if(u){let a=d,b={body:a._ogBody||a.body};for(let c of i)b[c]=a[c];d=new Request(a.url,b)}else if(e){let{_ogBody:a,body:c,signal:d,...f}=e;e={...f,body:a||c,signal:b?void 0:d}}let j={...e,next:{...null==e?void 0:e.next,fetchType:"origin",fetchIdx:Y}};return a(d,j).then(async a=>{if(!b&&A&&r(B,{start:A,url:v,cacheReason:c||L,cacheStatus:0===o||c?"skip":"miss",cacheWarning:f,status:a.status,method:j.method||"GET"}),200===a.status&&W&&g&&(V||k)){let b=o>=h.INFINITE_CACHE?h.CACHE_ONE_YEAR:o,c=V?{fetchCache:!0,fetchUrl:v,fetchIdx:Y,tags:G,isImplicitBuildTimeCache:U}:void 0;switch(null==C?void 0:C.type){case"prerender":case"prerender-client":case"prerender-runtime":return s(a,g,c,W,b,Z);case"request":case"prerender-ppr":case"prerender-legacy":case"cache":case"private-cache":case"unstable-cache":case void 0:return t(B,a,g,c,W,k,b,d,Z)}}return await Z(),a}).catch(a=>{throw Z(),a})},_=!1,aa=!1;if(g&&W){let a;if(X&&k&&(a=k.get(g),aa=!0),V&&!a){Z=await W.lock(g);let b=B.isOnDemandRevalidate?null:await W.get(g,{kind:m.IncrementalCacheKind.FETCH,revalidate:o,fetchUrl:v,fetchIdx:Y,tags:G,softTags:null==H?void 0:H.tags});if(S&&C)switch(C.type){case"prerender":case"prerender-client":case"prerender-runtime":await (w||(w=new Promise(a=>{setTimeout(()=>{w=null,a()},0)})),w)}if(b?await Z():l="cache-control: no-cache (hard refresh)",(null==b?void 0:b.value)&&b.value.kind===m.CachedRouteKind.FETCH)if(B.isStaticGeneration&&b.isStale)_=!0;else{if(b.isStale&&(B.pendingRevalidates??={},!B.pendingRevalidates[g])){let a=$(!0).then(async a=>({body:await a.arrayBuffer(),headers:a.headers,status:a.status,statusText:a.statusText})).finally(()=>{B.pendingRevalidates??={},delete B.pendingRevalidates[g||""]});a.catch(console.error),B.pendingRevalidates[g]=a}a=b.value.data}}if(a){A&&r(B,{start:A,url:v,cacheReason:L,cacheStatus:aa?"hmr":"hit",cacheWarning:f,status:a.status||200,method:(null==e?void 0:e.method)||"GET"});let b=new Response(Buffer.from(a.body,"base64"),{headers:a.headers,status:a.status});return Object.defineProperty(b,"url",{value:a.url}),b}}if(B.isStaticGeneration&&e&&"object"==typeof e){let{cache:a}=e;if("no-store"===a){if(C)switch(C.type){case"prerender":case"prerender-client":case"prerender-runtime":return D&&(D.endRead(),D=null),(0,j.makeHangingPromise)(C.renderSignal,B.route,"fetch()")}(0,i.markCurrentScopeAsDynamic)(B,C,`no-store fetch ${d} ${B.route}`)}let b="next"in e,{next:f={}}=e;if("number"==typeof f.revalidate&&c&&f.revalidate<c.revalidate){if(0===f.revalidate){if(C)switch(C.type){case"prerender":case"prerender-client":case"prerender-runtime":return(0,j.makeHangingPromise)(C.renderSignal,B.route,"fetch()")}(0,i.markCurrentScopeAsDynamic)(B,C,`revalidate: 0 fetch ${d} ${B.route}`)}B.forceStatic&&0===f.revalidate||(c.revalidate=f.revalidate)}b&&delete e.next}if(!g||!_)return $(!1,l);{let a=g;B.pendingRevalidates??={};let b=B.pendingRevalidates[a];if(b){let a=await b;return new Response(a.body,{headers:a.headers,status:a.status,statusText:a.statusText})}let c=$(!0,l).then(n.cloneResponse);return(b=c.then(async a=>{let b=a[0];return{body:await b.arrayBuffer(),headers:b.headers,status:b.status,statusText:b.statusText}}).finally(()=>{var b;(null==(b=B.pendingRevalidates)?void 0:b[a])&&delete B.pendingRevalidates[a]})).catch(()=>{}),B.pendingRevalidates[a]=b,c.then(a=>a[1])}});if(D)try{return await E}finally{D&&D.endRead()}return E};return d.__nextPatched=!0,d.__nextGetStaticStore=()=>b,d._nextOriginalFetch=a,globalThis[o]=!0,Object.defineProperty(d,"name",{value:"fetch",writable:!1}),d}function v(a){if(!0===globalThis[o])return;let b=(0,k.createDedupeFetch)(globalThis.fetch);globalThis.fetch=u(b,a)}let w=null},71632,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"unstable_cache",{enumerable:!0,get:function(){return k}});let d=a.r(99870),e=a.r(26095),f=a.r(56704),g=a.r(32319),h=a.r(24653),i=0;async function j(a,b,c,e,f,g,i){await b.set(c,{kind:h.CachedRouteKind.FETCH,data:{headers:{},body:JSON.stringify(a),status:200,url:""},revalidate:"number"!=typeof f?d.CACHE_ONE_YEAR:f},{fetchCache:!0,tags:e,fetchIdx:g,fetchUrl:i})}function k(a,b,c={}){if(0===c.revalidate)throw Object.defineProperty(Error(`Invariant revalidate: 0 can not be passed to unstable_cache(), must be "false" or "> 0" ${a.toString()}`),"__NEXT_ERROR_CODE",{value:"E57",enumerable:!1,configurable:!0});let d=c.tags?(0,e.validateTags)(c.tags,`unstable_cache ${a.toString()}`):[];(0,e.validateRevalidate)(c.revalidate,`unstable_cache ${a.name||a.toString()}`);let l=`${a.toString()}-${Array.isArray(b)&&b.join(",")}`;return async(...b)=>{let e=f.workAsyncStorage.getStore(),k=g.workUnitAsyncStorage.getStore(),m=(null==e?void 0:e.incrementalCache)||globalThis.__incrementalCache;if(!m)throw Object.defineProperty(Error(`Invariant: incrementalCache missing in unstable_cache ${a.toString()}`),"__NEXT_ERROR_CODE",{value:"E469",enumerable:!1,configurable:!0});let n=k?(0,g.getCacheSignal)(k):null;n&&n.beginRead();try{let f=e&&k?function(a,b){switch(b.type){case"request":let c=b.url.pathname,d=new URLSearchParams(b.url.search),e=[...d.keys()].sort((a,b)=>a.localeCompare(b)).map(a=>`${a}=${d.get(a)}`).join("&");return`${c}${e.length?"?":""}${e}`;case"prerender":case"prerender-client":case"prerender-runtime":case"prerender-ppr":case"prerender-legacy":case"cache":case"private-cache":case"unstable-cache":return a.route;default:return b}}(e,k):"",n=`${l}-${JSON.stringify(b)}`,o=await m.generateCacheKey(n),p=`unstable_cache ${f} ${a.name?` ${a.name}`:o}`,q=(e?e.nextFetchId:i)??1,r=null==k?void 0:k.implicitTags,s={type:"unstable-cache",phase:"render",implicitTags:r,draftMode:k&&e&&(0,g.getDraftModeProviderForCacheScope)(e,k)};if(e){e.nextFetchId=q+1;let f=!1;if(k)switch(k.type){case"cache":case"private-cache":case"prerender":case"prerender-runtime":case"prerender-ppr":case"prerender-legacy":"number"==typeof c.revalidate&&(k.revalidate<c.revalidate||(k.revalidate=c.revalidate));let i=k.tags;if(null===i)k.tags=d.slice();else for(let a of d)i.includes(a)||i.push(a);break;case"unstable-cache":f=!0}if(!f&&"force-no-store"!==e.fetchCache&&!e.isOnDemandRevalidate&&!m.isOnDemandRevalidate&&!e.isDraftMode){let f=await m.get(o,{kind:h.IncrementalCacheKind.FETCH,revalidate:c.revalidate,tags:d,softTags:null==r?void 0:r.tags,fetchIdx:q,fetchUrl:p});if(f&&f.value)if(f.value.kind!==h.CachedRouteKind.FETCH)console.error(`Invariant invalid cacheEntry returned for ${n}`);else{let h=void 0!==f.value.data.body?JSON.parse(f.value.data.body):void 0;if(f.isStale){if(e.pendingRevalidates||(e.pendingRevalidates={}),!e.pendingRevalidates[n]){let f=g.workUnitAsyncStorage.run(s,a,...b).then(async a=>(await j(a,m,o,d,c.revalidate,q,p),a)).catch(a=>(console.error(`revalidating cache with key: ${n}`,a),h));e.isStaticGeneration&&f.catch(()=>{}),e.pendingRevalidates[n]=f}if(e.isStaticGeneration)return e.pendingRevalidates[n]}return h}}let l=await g.workUnitAsyncStorage.run(s,a,...b);return e.isDraftMode||(e.pendingRevalidates||(e.pendingRevalidates={}),e.pendingRevalidates[n]=j(l,m,o,d,c.revalidate,q,p)),l}{if(i+=1,!m.isOnDemandRevalidate){let a=await m.get(o,{kind:h.IncrementalCacheKind.FETCH,revalidate:c.revalidate,tags:d,fetchIdx:q,fetchUrl:p,softTags:null==r?void 0:r.tags});if(a&&a.value){if(a.value.kind!==h.CachedRouteKind.FETCH)console.error(`Invariant invalid cacheEntry returned for ${n}`);else if(!a.isStale)return void 0!==a.value.data.body?JSON.parse(a.value.data.body):void 0}}let e=await g.workUnitAsyncStorage.run(s,a,...b);return await j(e,m,o,d,c.revalidate,q,p),e}}finally{n&&n.endRead()}}}},46043,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={getSortedRouteObjects:function(){return h},getSortedRoutes:function(){return g}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});class f{insert(a){this._insert(a.split("/").filter(Boolean),[],!1)}smoosh(){return this._smoosh()}_smoosh(a="/"){let b=[...this.children.keys()].sort();null!==this.slugName&&b.splice(b.indexOf("[]"),1),null!==this.restSlugName&&b.splice(b.indexOf("[...]"),1),null!==this.optionalRestSlugName&&b.splice(b.indexOf("[[...]]"),1);let c=b.map(b=>this.children.get(b)._smoosh(`${a}${b}/`)).reduce((a,b)=>[...a,...b],[]);if(null!==this.slugName&&c.push(...this.children.get("[]")._smoosh(`${a}[${this.slugName}]/`)),!this.placeholder){let b="/"===a?"/":a.slice(0,-1);if(null!=this.optionalRestSlugName)throw Object.defineProperty(Error(`You cannot define a route with the same specificity as a optional catch-all route ("${b}" and "${b}[[...${this.optionalRestSlugName}]]").`),"__NEXT_ERROR_CODE",{value:"E458",enumerable:!1,configurable:!0});c.unshift(b)}return null!==this.restSlugName&&c.push(...this.children.get("[...]")._smoosh(`${a}[...${this.restSlugName}]/`)),null!==this.optionalRestSlugName&&c.push(...this.children.get("[[...]]")._smoosh(`${a}[[...${this.optionalRestSlugName}]]/`)),c}_insert(a,b,c){if(0===a.length){this.placeholder=!1;return}if(c)throw Object.defineProperty(Error("Catch-all must be the last part of the URL."),"__NEXT_ERROR_CODE",{value:"E392",enumerable:!1,configurable:!0});let d=a[0];if(d.startsWith("[")&&d.endsWith("]")){let f=d.slice(1,-1),g=!1;if(f.startsWith("[")&&f.endsWith("]")&&(f=f.slice(1,-1),g=!0),f.startsWith(""))throw Object.defineProperty(Error(`Detected a three-dot character ('') at ('${f}'). Did you mean ('...')?`),"__NEXT_ERROR_CODE",{value:"E147",enumerable:!1,configurable:!0});if(f.startsWith("...")&&(f=f.substring(3),c=!0),f.startsWith("[")||f.endsWith("]"))throw Object.defineProperty(Error(`Segment names may not start or end with extra brackets ('${f}').`),"__NEXT_ERROR_CODE",{value:"E421",enumerable:!1,configurable:!0});if(f.startsWith("."))throw Object.defineProperty(Error(`Segment names may not start with erroneous periods ('${f}').`),"__NEXT_ERROR_CODE",{value:"E288",enumerable:!1,configurable:!0});function e(a,c){if(null!==a&&a!==c)throw Object.defineProperty(Error(`You cannot use different slug names for the same dynamic path ('${a}' !== '${c}').`),"__NEXT_ERROR_CODE",{value:"E337",enumerable:!1,configurable:!0});b.forEach(a=>{if(a===c)throw Object.defineProperty(Error(`You cannot have the same slug name "${c}" repeat within a single dynamic path`),"__NEXT_ERROR_CODE",{value:"E247",enumerable:!1,configurable:!0});if(a.replace(/\W/g,"")===d.replace(/\W/g,""))throw Object.defineProperty(Error(`You cannot have the slug names "${a}" and "${c}" differ only by non-word symbols within a single dynamic path`),"__NEXT_ERROR_CODE",{value:"E499",enumerable:!1,configurable:!0})}),b.push(c)}if(c)if(g){if(null!=this.restSlugName)throw Object.defineProperty(Error(`You cannot use both an required and optional catch-all route at the same level ("[...${this.restSlugName}]" and "${a[0]}" ).`),"__NEXT_ERROR_CODE",{value:"E299",enumerable:!1,configurable:!0});e(this.optionalRestSlugName,f),this.optionalRestSlugName=f,d="[[...]]"}else{if(null!=this.optionalRestSlugName)throw Object.defineProperty(Error(`You cannot use both an optional and required catch-all route at the same level ("[[...${this.optionalRestSlugName}]]" and "${a[0]}").`),"__NEXT_ERROR_CODE",{value:"E300",enumerable:!1,configurable:!0});e(this.restSlugName,f),this.restSlugName=f,d="[...]"}else{if(g)throw Object.defineProperty(Error(`Optional route parameters are not yet supported ("${a[0]}").`),"__NEXT_ERROR_CODE",{value:"E435",enumerable:!1,configurable:!0});e(this.slugName,f),this.slugName=f,d="[]"}}this.children.has(d)||this.children.set(d,new f),this.children.get(d)._insert(a.slice(1),b,c)}constructor(){this.placeholder=!0,this.children=new Map,this.slugName=null,this.restSlugName=null,this.optionalRestSlugName=null}}function g(a){let b=new f;return a.forEach(a=>b.insert(a)),b.smoosh()}function h(a,b){let c={},d=[];for(let e=0;e<a.length;e++){let f=b(a[e]);c[f]=e,d[e]=f}return g(d).map(b=>a[c[b]])}},73576,(a,b,c)=>{"use strict";function d(a){return a.startsWith("/")?a:`/${a}`}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureLeadingSlash",{enumerable:!0,get:function(){return d}})},98698,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={DEFAULT_SEGMENT_KEY:function(){return l},PAGE_SEGMENT_KEY:function(){return k},addSearchParamsIfPageSegment:function(){return i},computeSelectedLayoutSegment:function(){return j},getSegmentValue:function(){return f},getSelectedLayoutSegmentPath:function(){return function a(b,c,d=!0,e=[]){let g;if(d)g=b[1][c];else{let a=b[1];g=a.children??Object.values(a)[0]}if(!g)return e;let h=f(g[0]);return!h||h.startsWith(k)?e:(e.push(h),a(g,c,!1,e))}},isGroupSegment:function(){return g},isParallelRouteSegment:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(a){return Array.isArray(a)?a[1]:a}function g(a){return"("===a[0]&&a.endsWith(")")}function h(a){return a.startsWith("@")&&"@children"!==a}function i(a,b){if(a.includes(k)){let a=JSON.stringify(b);return"{}"!==a?k+"?"+a:k}return a}function j(a,b){if(!a||0===a.length)return null;let c="children"===b?a[0]:a[a.length-1];return c===l?null:c}let k="__PAGE__",l="__DEFAULT__"},5847,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={normalizeAppPath:function(){return h},normalizeRscURL:function(){return i}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(73576),g=a.r(98698);function h(a){return(0,f.ensureLeadingSlash)(a.split("/").reduce((a,b,c,d)=>!b||(0,g.isGroupSegment)(b)||"@"===b[0]||("page"===b||"route"===b)&&c===d.length-1?a:`${a}/${b}`,""))}function i(a){return a.replace(/\.rsc($|\?)/,"$1")}},97908,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={INTERCEPTION_ROUTE_MARKERS:function(){return g},extractInterceptionRouteInformation:function(){return i},isInterceptionRouteAppPath:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(5847),g=["(..)(..)","(.)","(..)","(...)"];function h(a){return void 0!==a.split("/").find(a=>g.find(b=>a.startsWith(b)))}function i(a){let b,c,d;for(let e of a.split("/"))if(c=g.find(a=>e.startsWith(a))){[b,d]=a.split(c,2);break}if(!b||!c||!d)throw Object.defineProperty(Error(`Invalid interception route: ${a}. Must be in the format /<intercepting route>/(..|...|..)(..)/<intercepted route>`),"__NEXT_ERROR_CODE",{value:"E269",enumerable:!1,configurable:!0});switch(b=(0,f.normalizeAppPath)(b),c){case"(.)":d="/"===b?`/${d}`:b+"/"+d;break;case"(..)":if("/"===b)throw Object.defineProperty(Error(`Invalid interception route: ${a}. Cannot use (..) marker at the root level, use (.) instead.`),"__NEXT_ERROR_CODE",{value:"E207",enumerable:!1,configurable:!0});d=b.split("/").slice(0,-1).concat(d).join("/");break;case"(...)":d="/"+d;break;case"(..)(..)":let e=b.split("/");if(e.length<=2)throw Object.defineProperty(Error(`Invalid interception route: ${a}. Cannot use (..)(..) marker at the root level or one level up.`),"__NEXT_ERROR_CODE",{value:"E486",enumerable:!1,configurable:!0});d=e.slice(0,-2).concat(d).join("/");break;default:throw Object.defineProperty(Error("Invariant: unexpected marker"),"__NEXT_ERROR_CODE",{value:"E112",enumerable:!1,configurable:!0})}return{interceptingRoute:b,interceptedRoute:d}}},82966,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"isDynamicRoute",{enumerable:!0,get:function(){return g}});let d=a.r(97908),e=/\/[^/]*\[[^/]+\][^/]*(?=\/|$)/,f=/\/\[[^/]+\](?=\/|$)/;function g(a,b=!0){return((0,d.isInterceptionRouteAppPath)(a)&&(a=(0,d.extractInterceptionRouteInformation)(a).interceptedRoute),b)?f.test(a):e.test(a)}},19228,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={getSortedRouteObjects:function(){return f.getSortedRouteObjects},getSortedRoutes:function(){return f.getSortedRoutes},isDynamicRoute:function(){return g.isDynamicRoute}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(46043),g=a.r(82966)},65819,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={refresh:function(){return o},revalidatePath:function(){return p},revalidateTag:function(){return m},updateTag:function(){return n}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(60384),g=a.r(19228),h=a.r(99870),i=a.r(56704),j=a.r(32319),k=a.r(96556),l=a.r(50640);function m(a,b){return b||console.warn('"revalidateTag" without the second argument is now deprecated, add second argument of "max" or use "updateTag". See more info here: https://nextjs.org/docs/messages/revalidate-tag-single-arg'),q([a],`revalidateTag ${a}`,b)}function n(a){let b=i.workAsyncStorage.getStore();if(!b||b.page.endsWith("/route"))throw Object.defineProperty(Error("updateTag can only be called from within a Server Action. To invalidate cache tags in Route Handlers or other contexts, use revalidateTag instead. See more info here: https://nextjs.org/docs/app/api-reference/functions/updateTag"),"__NEXT_ERROR_CODE",{value:"E872",enumerable:!1,configurable:!0});return q([a],`updateTag ${a}`,void 0)}function o(){let a=i.workAsyncStorage.getStore(),b=j.workUnitAsyncStorage.getStore();if(!a||a.page.endsWith("/route")||(null==b?void 0:b.phase)!=="action")throw Object.defineProperty(Error("refresh can only be called from within a Server Action. See more info here: https://nextjs.org/docs/app/api-reference/functions/refresh"),"__NEXT_ERROR_CODE",{value:"E870",enumerable:!1,configurable:!0});a&&(a.pathWasRevalidated=!0)}function p(a,b){if(a.length>h.NEXT_CACHE_SOFT_TAG_MAX_LENGTH)return void console.warn(`Warning: revalidatePath received "${a}" which exceeded max length of ${h.NEXT_CACHE_SOFT_TAG_MAX_LENGTH}. See more info here https://nextjs.org/docs/app/api-reference/functions/revalidatePath`);let c=`${h.NEXT_CACHE_IMPLICIT_TAG_ID}${a||"/"}`;b?c+=`${c.endsWith("/")?"":"/"}${b}`:(0,g.isDynamicRoute)(a)&&console.warn(`Warning: a dynamic page path "${a}" was passed to "revalidatePath", but the "type" parameter is missing. This has no effect by default, see more info here https://nextjs.org/docs/app/api-reference/functions/revalidatePath`);let d=[c];return c===`${h.NEXT_CACHE_IMPLICIT_TAG_ID}/`?d.push(`${h.NEXT_CACHE_IMPLICIT_TAG_ID}/index`):c===`${h.NEXT_CACHE_IMPLICIT_TAG_ID}/index`&&d.push(`${h.NEXT_CACHE_IMPLICIT_TAG_ID}/`),q(d,`revalidatePath ${a}`)}function q(a,b,c){var d;let e=i.workAsyncStorage.getStore();if(!e||!e.incrementalCache)throw Object.defineProperty(Error(`Invariant: static generation store missing in ${b}`),"__NEXT_ERROR_CODE",{value:"E263",enumerable:!1,configurable:!0});let g=j.workUnitAsyncStorage.getStore();if(g){if("render"===g.phase)throw Object.defineProperty(Error(`Route ${e.route} used "${b}" during render which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E7",enumerable:!1,configurable:!0});switch(g.type){case"cache":case"private-cache":throw Object.defineProperty(Error(`Route ${e.route} used "${b}" inside a "use cache" which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E181",enumerable:!1,configurable:!0});case"unstable-cache":throw Object.defineProperty(Error(`Route ${e.route} used "${b}" inside a function cached with "unstable_cache(...)" which is unsupported. To ensure revalidation is performed consistently it must always happen outside of renders and cached functions. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E306",enumerable:!1,configurable:!0});case"prerender":case"prerender-runtime":let a=Object.defineProperty(Error(`Route ${e.route} used ${b} without first calling \`await connection()\`.`),"__NEXT_ERROR_CODE",{value:"E406",enumerable:!1,configurable:!0});return(0,f.abortAndThrowOnSynchronousRequestDataAccess)(e.route,b,a,g);case"prerender-client":throw Object.defineProperty(new l.InvariantError(`${b} must not be used within a client component. Next.js should be preventing ${b} from being included in client components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E693",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,f.postponeWithTracking)(e.route,b,g.dynamicTracking);case"prerender-legacy":g.revalidate=0;let c=Object.defineProperty(new k.DynamicServerError(`Route ${e.route} couldn't be rendered statically because it used \`${b}\`. See more info here: https://nextjs.org/docs/messages/dynamic-server-error`),"__NEXT_ERROR_CODE",{value:"E558",enumerable:!1,configurable:!0});throw e.dynamicUsageDescription=b,e.dynamicUsageStack=c.stack,c}}for(let b of(e.pendingRevalidatedTags||(e.pendingRevalidatedTags=[]),a))-1===e.pendingRevalidatedTags.findIndex(a=>a.tag===b&&("string"==typeof a.profile&&"string"==typeof c?a.profile===c:"object"==typeof a.profile&&"object"==typeof c?JSON.stringify(a.profile)===JSON.stringify(c):a.profile===c))&&e.pendingRevalidatedTags.push({tag:b,profile:c});let h=c&&"object"==typeof c?c:c&&"string"==typeof c&&(null==e||null==(d=e.cacheLifeProfiles)?void 0:d[c])?e.cacheLifeProfiles[c]:void 0;c&&(null==h?void 0:h.expire)!==0||(e.pathWasRevalidated=!0)}},1247,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"unstable_noStore",{enumerable:!0,get:function(){return g}});let d=a.r(56704),e=a.r(32319),f=a.r(60384);function g(){let a=d.workAsyncStorage.getStore(),b=e.workUnitAsyncStorage.getStore();if(a){if(!a.forceStatic){if(a.isUnstableNoStore=!0,b)switch(b.type){case"prerender":case"prerender-client":case"prerender-runtime":return}(0,f.markCurrentScopeAsDynamic)(a,b,"unstable_noStore()")}}}},32621,(a,b,c)=>{"use strict";function d(a){throw Object.defineProperty(Error("`cacheLife()` is only available with the `cacheComponents` config."),"__NEXT_ERROR_CODE",{value:"E887",enumerable:!1,configurable:!0})}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"cacheLife",{enumerable:!0,get:function(){return d}}),a.r(50640),a.r(56704),a.r(32319)},72835,(a,b,c)=>{"use strict";function d(){throw Object.defineProperty(Error("`cacheTag()` is only available with the `cacheComponents` config."),"__NEXT_ERROR_CODE",{value:"E886",enumerable:!1,configurable:!0})}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"cacheTag",{enumerable:!0,get:function(){return d}}),a.r(32319),a.r(26095)},18558,(a,b,c)=>{let d={unstable_cache:a.r(71632).unstable_cache,updateTag:a.r(65819).updateTag,revalidateTag:a.r(65819).revalidateTag,revalidatePath:a.r(65819).revalidatePath,refresh:a.r(65819).refresh,unstable_noStore:a.r(1247).unstable_noStore,cacheLife:a.r(32621).cacheLife,cacheTag:a.r(72835).cacheTag},e=!1,f=!1;d.unstable_cacheLife=function(){return e||(e=!0,console.error(Error("`unstable_cacheLife` was recently stabilized and should be imported as `cacheLife`. The `unstable` prefixed form will be removed in a future version of Next.js."))),d.cacheLife.apply(this,arguments)},d.unstable_cacheTag=function(){return f||(f=!0,console.error(Error("`unstable_cacheTag` was recently stabilized and should be imported as `cacheTag`. The `unstable` prefixed form will be removed in a future version of Next.js."))),d.cacheTag.apply(this,arguments)},b.exports=d,c.unstable_cache=d.unstable_cache,c.revalidatePath=d.revalidatePath,c.revalidateTag=d.revalidateTag,c.updateTag=d.updateTag,c.unstable_noStore=d.unstable_noStore,c.cacheLife=d.cacheLife,c.unstable_cacheLife=d.unstable_cacheLife,c.cacheTag=d.cacheTag,c.unstable_cacheTag=d.unstable_cacheTag,c.refresh=d.refresh},13095,(a,b,c)=>{"use strict";function d(a){for(let b=0;b<a.length;b++){let c=a[b];if("function"!=typeof c)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof c}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"ensureServerEntryExports",{enumerable:!0,get:function(){return d}})}];

//# sourceMappingURL=_6271d1f1._.js.map