module.exports=[36063,a=>{"use strict";var b=a.i(17638);a.i(89973),a.i(97649),a.i(54003),a.i(15192),a.i(83043);var c=a.i(18973),d=a.i(19560);let e=(a,b)=>{let e=null,f=a=>({getFieldName:c,schema:e,getDefaultFieldName:f,getDefaultModelName:g,getFieldAttributes:h,getModelName:i})=>{let j=a=>{let b=[],c=[];if(a)for(let[f,h]of Object.entries(a)){let a=e[g(f)]?.fields,[h,i]=f.includes(".")?f.split("."):[void 0,f];if(a)for(let[e,g]of(a.id={type:"string"},Object.entries(a)))b.push(d.sql`${d.sql.ref(`join_${i}`)}.${d.sql.ref(g.fieldName||e)} as ${d.sql.ref(`_joined_${i}_${g.fieldName||e}`)}`),c.push({joinModel:f,joinModelRef:i,fieldName:g.fieldName||e})}return{allSelectsStr:c,allSelects:b}},k=async(d,e,f,g)=>{if(b?.type==="mysql"){await e.execute();let b=d.id?"id":g.length>0&&g[0]?.field?g[0].field:"id";if(!d.id&&0===g.length)return await a.selectFrom(f).selectAll().orderBy(c({model:f,field:b}),"desc").limit(1).executeTakeFirst();let h=d[b]||g[0]?.value;return await a.selectFrom(f).selectAll().orderBy(c({model:f,field:b}),"desc").where(c({model:f,field:b}),"=",h).limit(1).executeTakeFirst()}return b?.type==="mssql"?await e.outputAll("inserted").executeTakeFirst():await e.returningAll().executeTakeFirst()};function l(a,b){if(!b)return{and:null,or:null};let d=[],e=[];return b.forEach(b=>{let{field:f,value:g,operator:h="=",connector:i="AND"}=b,j=c({model:a,field:f}),k=b=>{let c=`${a}.${j}`;return"in"===h.toLowerCase()?b(c,"in",Array.isArray(g)?g:[g]):"not_in"===h.toLowerCase()?b(c,"not in",Array.isArray(g)?g:[g]):"contains"===h?b(c,"like",`%${g}%`):"starts_with"===h?b(c,"like",`${g}%`):"ends_with"===h?b(c,"like",`%${g}`):b(c,"eq"===h?"=":"ne"===h?"<>":"gt"===h?">":"gte"===h?">=":"lt"===h?"<":"lte"===h?"<=":h,g)};"OR"===i?e.push(k):d.push(k)}),{and:d.length?d:null,or:e.length?e:null}}function m(a,b,d){if(!b||!a.length)return a;let e=new Map;for(let f of a){let a={},g={};for(let[a]of Object.entries(b))g[i(a)]={};for(let[b,e]of Object.entries(f)){let f=String(b),h=!1;for(let{joinModel:a,fieldName:b,joinModelRef:j}of d)if(f===`_joined_${j}_${b}`){g[i(a)][c({model:a,field:b})]=e,h=!0;break}h||(a[b]=e)}let h=a.id;if(!h)continue;if(!e.has(h)){let c={...a};for(let[a,d]of Object.entries(b))c[i(a)]="one-to-one"===d.relation?null:[];e.set(h,c)}let j=e.get(h);for(let[a,d]of Object.entries(b)){let b="one-to-one"===d.relation,e=d.limit??100,f=g[i(a)],h=f&&Object.keys(f).length>0&&Object.values(f).some(a=>null!=a);if(b)j[i(a)]=h?f:null;else{let b=i(a);if(Array.isArray(j[b])&&h){if(j[b].length>=e)continue;let d=c({model:a,field:"id"}),g=f[d];g?!j[b].some(a=>a[d]===g)&&j[b].length<e&&j[b].push(f):j[b].length<e&&j[b].push(f)}}}}let f=Array.from(e.values());for(let a of f)for(let[c,d]of Object.entries(b))if("one-to-one"!==d.relation){let b=i(c);if(Array.isArray(a[b])){let c=d.limit??100;a[b].length>c&&(a[b]=a[b].slice(0,c))}}return f}return{create:async({data:b,model:c})=>await k(b,a.insertInto(c).values(b),c,[]),async findOne({model:b,where:c,select:d,join:e}){let{and:f,or:g}=l(b,c),h=a.selectFrom(a=>{let c=a.selectFrom(b);return f&&(c=c.where(a=>a.and(f.map(b=>b(a))))),g&&(c=c.where(a=>a.or(g.map(b=>b(a))))),c.selectAll().as("primary")}).selectAll("primary");if(e)for(let[a,b]of Object.entries(e)){let[c,d]=a.includes(".")?a.split("."):[void 0,a];h=h.leftJoin(`${a} as join_${d}`,a=>a.onRef(`join_${d}.${b.on.to}`,"=",`primary.${b.on.from}`))}let{allSelectsStr:i,allSelects:k}=j(e);h=h.select(k);let n=await h.execute();if(!n||!Array.isArray(n)||0===n.length)return null;let o=n[0];return e?m(n,e,i)[0]:o},async findMany({model:d,where:e,limit:f,offset:g,sortBy:h,join:i}){let{and:k,or:n}=l(d,e),o=a.selectFrom(a=>{let e=a.selectFrom(d);return b?.type==="mssql"?void 0!==g?(h||(e=e.orderBy(c({model:d,field:"id"}))),e=e.offset(g).fetch(f||100)):void 0!==f&&(e=e.top(f)):(void 0!==f&&(e=e.limit(f)),void 0!==g&&(e=e.offset(g))),h?.field&&(e=e.orderBy(`${c({model:d,field:h.field})}`,h.direction)),k&&(e=e.where(a=>a.and(k.map(b=>b(a))))),n&&(e=e.where(a=>a.or(n.map(b=>b(a))))),e.selectAll().as("primary")}).selectAll("primary");if(i)for(let[a,b]of Object.entries(i)){let[c,d]=a.includes(".")?a.split("."):[void 0,a];o=o.leftJoin(`${a} as join_${d}`,a=>a.onRef(`join_${d}.${b.on.to}`,"=",`primary.${b.on.from}`))}let{allSelectsStr:p,allSelects:q}=j(i);o=o.select(q),h?.field&&(o=o.orderBy(`${c({model:d,field:h.field})}`,h.direction));let r=await o.execute();return r?i?m(r,i,p):r:[]},async update({model:b,where:c,update:d}){let{and:e,or:f}=l(b,c),g=a.updateTable(b).set(d);return e&&(g=g.where(a=>a.and(e.map(b=>b(a))))),f&&(g=g.where(a=>a.or(f.map(b=>b(a))))),await k(d,g,b,c)},async updateMany({model:b,where:c,update:d}){let{and:e,or:f}=l(b,c),g=a.updateTable(b).set(d);return e&&(g=g.where(a=>a.and(e.map(b=>b(a))))),f&&(g=g.where(a=>a.or(f.map(b=>b(a))))),(await g.execute()).length},async count({model:b,where:c}){let{and:d,or:e}=l(b,c),f=a.selectFrom(b).select(a.fn.count("id").as("count"));d&&(f=f.where(a=>a.and(d.map(b=>b(a))))),e&&(f=f.where(a=>a.or(e.map(b=>b(a)))));let g=await f.execute();return"number"==typeof g[0].count?g[0].count:"bigint"==typeof g[0].count?Number(g[0].count):parseInt(g[0].count)},async delete({model:b,where:c}){let{and:d,or:e}=l(b,c),f=a.deleteFrom(b);d&&(f=f.where(a=>a.and(d.map(b=>b(a))))),e&&(f=f.where(a=>a.or(e.map(b=>b(a))))),await f.execute()},async deleteMany({model:b,where:c}){let{and:d,or:e}=l(b,c),f=a.deleteFrom(b);return d&&(f=f.where(a=>a.and(d.map(b=>b(a))))),e&&(f=f.where(a=>a.or(e.map(b=>b(a))))),(await f.execute()).length},options:b}},g=null;g={config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:b?.usePlural,debugLogs:b?.debugLogs,supportsBooleans:b?.type!=="sqlite"&&b?.type!=="mssql"&&b?.type!=="mysql"&&!!b?.type,supportsDates:b?.type!=="sqlite"&&b?.type!=="mssql"&&!!b?.type,supportsJSON:!1,supportsUUIDs:b?.type==="postgres",transaction:!!b?.transaction&&(b=>a.transaction().execute(a=>b((0,c.t)({config:g.config,adapter:f(a)})(e))))},adapter:f(a)};let h=(0,c.t)(g);return a=>(e=a,h(a))};a.s(["kyselyAdapter",()=>e],32540),a.i(32540),a.s(["createKyselyAdapter",()=>b.t,"getKyselyDatabaseType",()=>b.n,"kyselyAdapter",()=>e],36063)}];

//# sourceMappingURL=node_modules_better-auth_dist_adapters_kysely-adapter_index_mjs_0abbd964._.js.map