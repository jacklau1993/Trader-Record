module.exports=[17638,a=>{"use strict";var b=a.i(52460);let c=(0,b.freeze)({is:a=>"AlterTableNode"===a.kind,create:a=>(0,b.freeze)({kind:"AlterTableNode",table:a}),cloneWithTableProps:(a,c)=>(0,b.freeze)({...a,...c}),cloneWithColumnAlteration:(a,c)=>(0,b.freeze)({...a,columnAlterations:a.columnAlterations?[...a.columnAlterations,c]:[c]})});var d=a.i(20860);let e=(0,b.freeze)({is:a=>"CreateIndexNode"===a.kind,create:a=>(0,b.freeze)({kind:"CreateIndexNode",name:d.IdentifierNode.create(a)}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c}),cloneWithColumns:(a,c)=>(0,b.freeze)({...a,columns:[...a.columns||[],...c]})}),f=(0,b.freeze)({is:a=>"CreateSchemaNode"===a.kind,create:(a,c)=>(0,b.freeze)({kind:"CreateSchemaNode",schema:d.IdentifierNode.create(a),...c}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})});var g=a.i(19945),h=a.i(8896);let i=(0,b.freeze)({is:a=>"DropIndexNode"===a.kind,create:(a,c)=>(0,b.freeze)({kind:"DropIndexNode",name:h.SchemableIdentifierNode.create(a),...c}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})}),j=(0,b.freeze)({is:a=>"DropSchemaNode"===a.kind,create:(a,c)=>(0,b.freeze)({kind:"DropSchemaNode",schema:d.IdentifierNode.create(a),...c}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})}),k=(0,b.freeze)({is:a=>"DropTableNode"===a.kind,create:(a,c)=>(0,b.freeze)({kind:"DropTableNode",table:a,...c}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})});var l=a.i(66101);let m=(0,b.freeze)({is:a=>"AddColumnNode"===a.kind,create:a=>(0,b.freeze)({kind:"AddColumnNode",column:a})});var n=a.i(40672);let o=(0,b.freeze)({is:a=>"ColumnDefinitionNode"===a.kind,create:(a,c)=>(0,b.freeze)({kind:"ColumnDefinitionNode",column:n.ColumnNode.create(a),dataType:c}),cloneWithFrontModifier:(a,c)=>(0,b.freeze)({...a,frontModifiers:a.frontModifiers?(0,b.freeze)([...a.frontModifiers,c]):[c]}),cloneWithEndModifier:(a,c)=>(0,b.freeze)({...a,endModifiers:a.endModifiers?(0,b.freeze)([...a.endModifiers,c]):[c]}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})}),p=(0,b.freeze)({is:a=>"DropColumnNode"===a.kind,create:a=>(0,b.freeze)({kind:"DropColumnNode",column:n.ColumnNode.create(a)})}),q=(0,b.freeze)({is:a=>"RenameColumnNode"===a.kind,create:(a,c)=>(0,b.freeze)({kind:"RenameColumnNode",column:n.ColumnNode.create(a),renameTo:n.ColumnNode.create(c)})}),r=(0,b.freeze)({is:a=>"CheckConstraintNode"===a.kind,create:(a,c)=>(0,b.freeze)({kind:"CheckConstraintNode",expression:a,name:c?d.IdentifierNode.create(c):void 0})}),s=["no action","restrict","cascade","set null","set default"],t=(0,b.freeze)({is:a=>"ReferencesNode"===a.kind,create:(a,c)=>(0,b.freeze)({kind:"ReferencesNode",table:a,columns:(0,b.freeze)([...c])}),cloneWithOnDelete:(a,c)=>(0,b.freeze)({...a,onDelete:c}),cloneWithOnUpdate:(a,c)=>(0,b.freeze)({...a,onUpdate:c})});var u=a.i(98722),v=a.i(89774),w=a.i(58758),x=a.i(20033);function y(a){return(0,w.isOperationNodeSource)(a)?a.toOperationNode():x.ValueNode.createImmediate(a)}let z=(0,b.freeze)({is:a=>"GeneratedNode"===a.kind,create:a=>(0,b.freeze)({kind:"GeneratedNode",...a}),createWithExpression:a=>(0,b.freeze)({kind:"GeneratedNode",always:!0,expression:a}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})}),A=(0,b.freeze)({is:a=>"DefaultValueNode"===a.kind,create:a=>(0,b.freeze)({kind:"DefaultValueNode",defaultValue:a})});function B(a){if(s.includes(a))return a;throw Error(`invalid OnModifyForeignAction ${a}`)}class C{#a;constructor(a){this.#a=a}autoIncrement(){return new C(o.cloneWith(this.#a,{autoIncrement:!0}))}identity(){return new C(o.cloneWith(this.#a,{identity:!0}))}primaryKey(){return new C(o.cloneWith(this.#a,{primaryKey:!0}))}references(a){let b=(0,v.parseStringReference)(a);if(!b.table||u.SelectAllNode.is(b.column))throw Error(`invalid call references('${a}'). The reference must have format table.column or schema.table.column`);return new C(o.cloneWith(this.#a,{references:t.create(b.table,[b.column])}))}onDelete(a){if(!this.#a.references)throw Error("on delete constraint can only be added for foreign keys");return new C(o.cloneWith(this.#a,{references:t.cloneWithOnDelete(this.#a.references,B(a))}))}onUpdate(a){if(!this.#a.references)throw Error("on update constraint can only be added for foreign keys");return new C(o.cloneWith(this.#a,{references:t.cloneWithOnUpdate(this.#a.references,B(a))}))}unique(){return new C(o.cloneWith(this.#a,{unique:!0}))}notNull(){return new C(o.cloneWith(this.#a,{notNull:!0}))}unsigned(){return new C(o.cloneWith(this.#a,{unsigned:!0}))}defaultTo(a){return new C(o.cloneWith(this.#a,{defaultTo:A.create(y(a))}))}check(a){return new C(o.cloneWith(this.#a,{check:r.create(a.toOperationNode())}))}generatedAlwaysAs(a){return new C(o.cloneWith(this.#a,{generated:z.createWithExpression(a.toOperationNode())}))}generatedAlwaysAsIdentity(){return new C(o.cloneWith(this.#a,{generated:z.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new C(o.cloneWith(this.#a,{generated:z.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#a.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new C(o.cloneWith(this.#a,{generated:z.cloneWith(this.#a.generated,{stored:!0})}))}modifyFront(a){return new C(o.cloneWithFrontModifier(this.#a,a.toOperationNode()))}nullsNotDistinct(){return new C(o.cloneWith(this.#a,{nullsNotDistinct:!0}))}ifNotExists(){return new C(o.cloneWith(this.#a,{ifNotExists:!0}))}modifyEnd(a){return new C(o.cloneWithEndModifier(this.#a,a.toOperationNode()))}$call(a){return a(this)}toOperationNode(){return this.#a}}let D=(0,b.freeze)({is:a=>"ModifyColumnNode"===a.kind,create:a=>(0,b.freeze)({kind:"ModifyColumnNode",column:a})});var E=a.i(9582);let F=(0,b.freeze)({is:a=>"ForeignKeyConstraintNode"===a.kind,create:(a,c,e,f)=>(0,b.freeze)({kind:"ForeignKeyConstraintNode",columns:a,references:t.create(c,e),name:f?d.IdentifierNode.create(f):void 0}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})});class G{#a;constructor(a){this.#a=a}onDelete(a){return new G(F.cloneWith(this.#a,{onDelete:B(a)}))}onUpdate(a){return new G(F.cloneWith(this.#a,{onUpdate:B(a)}))}deferrable(){return new G(F.cloneWith(this.#a,{deferrable:!0}))}notDeferrable(){return new G(F.cloneWith(this.#a,{deferrable:!1}))}initiallyDeferred(){return new G(F.cloneWith(this.#a,{initiallyDeferred:!0}))}initiallyImmediate(){return new G(F.cloneWith(this.#a,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#a}}let H=(0,b.freeze)({is:a=>"AddConstraintNode"===a.kind,create:a=>(0,b.freeze)({kind:"AddConstraintNode",constraint:a})}),I=(0,b.freeze)({is:a=>"UniqueConstraintNode"===a.kind,create:(a,c,e)=>(0,b.freeze)({kind:"UniqueConstraintNode",columns:(0,b.freeze)(a.map(n.ColumnNode.create)),name:c?d.IdentifierNode.create(c):void 0,nullsNotDistinct:e}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})}),J=(0,b.freeze)({is:a=>"DropConstraintNode"===a.kind,create:a=>(0,b.freeze)({kind:"DropConstraintNode",constraintName:d.IdentifierNode.create(a)}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})}),K=(0,b.freeze)({is:a=>"AlterColumnNode"===a.kind,create:(a,c,d)=>(0,b.freeze)({kind:"AlterColumnNode",column:n.ColumnNode.create(a),[c]:d})});class L{#b;constructor(a){this.#b=a}setDataType(a){return new M(K.create(this.#b,"dataType",(0,E.parseDataTypeExpression)(a)))}setDefault(a){return new M(K.create(this.#b,"setDefault",y(a)))}dropDefault(){return new M(K.create(this.#b,"dropDefault",!0))}setNotNull(){return new M(K.create(this.#b,"setNotNull",!0))}dropNotNull(){return new M(K.create(this.#b,"dropNotNull",!0))}$call(a){return a(this)}}class M{#c;constructor(a){this.#c=a}toOperationNode(){return this.#c}}class N{#d;constructor(a){this.#d=(0,b.freeze)(a)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class O{#d;constructor(a){this.#d=(0,b.freeze)(a)}onDelete(a){return new O({...this.#d,constraintBuilder:this.#d.constraintBuilder.onDelete(a)})}onUpdate(a){return new O({...this.#d,constraintBuilder:this.#d.constraintBuilder.onUpdate(a)})}deferrable(){return new O({...this.#d,constraintBuilder:this.#d.constraintBuilder.deferrable()})}notDeferrable(){return new O({...this.#d,constraintBuilder:this.#d.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new O({...this.#d,constraintBuilder:this.#d.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new O({...this.#d,constraintBuilder:this.#d.constraintBuilder.initiallyImmediate()})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(c.cloneWithTableProps(this.#d.node,{addConstraint:H.create(this.#d.constraintBuilder.toOperationNode())}),this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class P{#d;constructor(a){this.#d=(0,b.freeze)(a)}ifExists(){return new P({...this.#d,node:c.cloneWithTableProps(this.#d.node,{dropConstraint:J.cloneWith(this.#d.node.dropConstraint,{ifExists:!0})})})}cascade(){return new P({...this.#d,node:c.cloneWithTableProps(this.#d.node,{dropConstraint:J.cloneWith(this.#d.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new P({...this.#d,node:c.cloneWithTableProps(this.#d.node,{dropConstraint:J.cloneWith(this.#d.node.dropConstraint,{modifier:"restrict"})})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}let Q=(0,b.freeze)({is:a=>"PrimaryKeyConstraintNode"===a.kind,create:(a,c)=>(0,b.freeze)({kind:"PrimaryKeyConstraintNode",columns:(0,b.freeze)(a.map(n.ColumnNode.create)),name:c?d.IdentifierNode.create(c):void 0}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})}),R=(0,b.freeze)({is:a=>"AddIndexNode"===a.kind,create:a=>(0,b.freeze)({kind:"AddIndexNode",name:d.IdentifierNode.create(a)}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c}),cloneWithColumns:(a,c)=>(0,b.freeze)({...a,columns:[...a.columns||[],...c]})});var S=a.i(93807);class T{#d;constructor(a){this.#d=(0,b.freeze)(a)}unique(){return new T({...this.#d,node:c.cloneWithTableProps(this.#d.node,{addIndex:R.cloneWith(this.#d.node.addIndex,{unique:!0})})})}column(a){return new T({...this.#d,node:c.cloneWithTableProps(this.#d.node,{addIndex:R.cloneWithColumns(this.#d.node.addIndex,[(0,v.parseOrderedColumnName)(a)])})})}columns(a){return new T({...this.#d,node:c.cloneWithTableProps(this.#d.node,{addIndex:R.cloneWithColumns(this.#d.node.addIndex,a.map(v.parseOrderedColumnName))})})}expression(a){return new T({...this.#d,node:c.cloneWithTableProps(this.#d.node,{addIndex:R.cloneWithColumns(this.#d.node.addIndex,[a.toOperationNode()])})})}using(a){return new T({...this.#d,node:c.cloneWithTableProps(this.#d.node,{addIndex:R.cloneWith(this.#d.node.addIndex,{using:S.RawNode.createWithSql(a)})})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class U{#a;constructor(a){this.#a=a}nullsNotDistinct(){return new U(I.cloneWith(this.#a,{nullsNotDistinct:!0}))}deferrable(){return new U(I.cloneWith(this.#a,{deferrable:!0}))}notDeferrable(){return new U(I.cloneWith(this.#a,{deferrable:!1}))}initiallyDeferred(){return new U(I.cloneWith(this.#a,{initiallyDeferred:!0}))}initiallyImmediate(){return new U(I.cloneWith(this.#a,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#a}}class V{#a;constructor(a){this.#a=a}deferrable(){return new V(Q.cloneWith(this.#a,{deferrable:!0}))}notDeferrable(){return new V(Q.cloneWith(this.#a,{deferrable:!1}))}initiallyDeferred(){return new V(Q.cloneWith(this.#a,{initiallyDeferred:!0}))}initiallyImmediate(){return new V(Q.cloneWith(this.#a,{initiallyDeferred:!1}))}$call(a){return a(this)}toOperationNode(){return this.#a}}class W{#a;constructor(a){this.#a=a}$call(a){return a(this)}toOperationNode(){return this.#a}}let X=(0,b.freeze)({is:a=>"RenameConstraintNode"===a.kind,create:(a,c)=>(0,b.freeze)({kind:"RenameConstraintNode",oldName:d.IdentifierNode.create(a),newName:d.IdentifierNode.create(c)})});class Y{#d;constructor(a){this.#d=(0,b.freeze)(a)}renameTo(a){return new N({...this.#d,node:c.cloneWithTableProps(this.#d.node,{renameTo:(0,l.parseTable)(a)})})}setSchema(a){return new N({...this.#d,node:c.cloneWithTableProps(this.#d.node,{setSchema:d.IdentifierNode.create(a)})})}alterColumn(a,b){let d=b(new L(a));return new Z({...this.#d,node:c.cloneWithColumnAlteration(this.#d.node,d.toOperationNode())})}dropColumn(a){return new Z({...this.#d,node:c.cloneWithColumnAlteration(this.#d.node,p.create(a))})}renameColumn(a,b){return new Z({...this.#d,node:c.cloneWithColumnAlteration(this.#d.node,q.create(a,b))})}addColumn(a,d,e=b.noop){let f=e(new C(o.create(a,(0,E.parseDataTypeExpression)(d))));return new Z({...this.#d,node:c.cloneWithColumnAlteration(this.#d.node,m.create(f.toOperationNode()))})}modifyColumn(a,d,e=b.noop){let f=e(new C(o.create(a,(0,E.parseDataTypeExpression)(d))));return new Z({...this.#d,node:c.cloneWithColumnAlteration(this.#d.node,D.create(f.toOperationNode()))})}addUniqueConstraint(a,d,e=b.noop){let f=e(new U(I.create(d,a)));return new N({...this.#d,node:c.cloneWithTableProps(this.#d.node,{addConstraint:H.create(f.toOperationNode())})})}addCheckConstraint(a,d,e=b.noop){let f=e(new W(r.create(d.toOperationNode(),a)));return new N({...this.#d,node:c.cloneWithTableProps(this.#d.node,{addConstraint:H.create(f.toOperationNode())})})}addForeignKeyConstraint(a,c,d,e,f=b.noop){let g=f(new G(F.create(c.map(n.ColumnNode.create),(0,l.parseTable)(d),e.map(n.ColumnNode.create),a)));return new O({...this.#d,constraintBuilder:g})}addPrimaryKeyConstraint(a,d,e=b.noop){let f=e(new V(Q.create(d,a)));return new N({...this.#d,node:c.cloneWithTableProps(this.#d.node,{addConstraint:H.create(f.toOperationNode())})})}dropConstraint(a){return new P({...this.#d,node:c.cloneWithTableProps(this.#d.node,{dropConstraint:J.create(a)})})}renameConstraint(a,b){return new P({...this.#d,node:c.cloneWithTableProps(this.#d.node,{renameConstraint:X.create(a,b)})})}addIndex(a){return new T({...this.#d,node:c.cloneWithTableProps(this.#d.node,{addIndex:R.create(a)})})}dropIndex(a){return new N({...this.#d,node:c.cloneWithTableProps(this.#d.node,{dropIndex:i.create(a)})})}$call(a){return a(this)}}class Z{#d;constructor(a){this.#d=(0,b.freeze)(a)}alterColumn(a,b){let d=b(new L(a));return new Z({...this.#d,node:c.cloneWithColumnAlteration(this.#d.node,d.toOperationNode())})}dropColumn(a){return new Z({...this.#d,node:c.cloneWithColumnAlteration(this.#d.node,p.create(a))})}renameColumn(a,b){return new Z({...this.#d,node:c.cloneWithColumnAlteration(this.#d.node,q.create(a,b))})}addColumn(a,d,e=b.noop){let f=e(new C(o.create(a,(0,E.parseDataTypeExpression)(d))));return new Z({...this.#d,node:c.cloneWithColumnAlteration(this.#d.node,m.create(f.toOperationNode()))})}modifyColumn(a,d,e=b.noop){let f=e(new C(o.create(a,(0,E.parseDataTypeExpression)(d))));return new Z({...this.#d,node:c.cloneWithColumnAlteration(this.#d.node,D.create(f.toOperationNode()))})}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}var $=a.i(45228),_=a.i(39399),aa=a.i(97365),ab=a.i(72590);class ac extends aa.OperationNodeTransformer{transformPrimitiveValueList(a){return ab.ValueListNode.create(a.values.map(x.ValueNode.createImmediate))}transformValue(a){return x.ValueNode.createImmediate(a.value)}}class ad{#d;constructor(a){this.#d=(0,b.freeze)(a)}ifNotExists(){return new ad({...this.#d,node:e.cloneWith(this.#d.node,{ifNotExists:!0})})}unique(){return new ad({...this.#d,node:e.cloneWith(this.#d.node,{unique:!0})})}nullsNotDistinct(){return new ad({...this.#d,node:e.cloneWith(this.#d.node,{nullsNotDistinct:!0})})}on(a){return new ad({...this.#d,node:e.cloneWith(this.#d.node,{table:(0,l.parseTable)(a)})})}column(a){return new ad({...this.#d,node:e.cloneWithColumns(this.#d.node,[(0,v.parseOrderedColumnName)(a)])})}columns(a){return new ad({...this.#d,node:e.cloneWithColumns(this.#d.node,a.map(v.parseOrderedColumnName))})}expression(a){return new ad({...this.#d,node:e.cloneWithColumns(this.#d.node,[a.toOperationNode()])})}using(a){return new ad({...this.#d,node:e.cloneWith(this.#d.node,{using:S.RawNode.createWithSql(a)})})}where(...a){let b=new ac;return new ad({...this.#d,node:_.QueryNode.cloneWithWhere(this.#d.node,b.transformNode((0,$.parseValueBinaryOperationOrExpression)(a),this.#d.queryId))})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class ae{#d;constructor(a){this.#d=(0,b.freeze)(a)}ifNotExists(){return new ae({...this.#d,node:f.cloneWith(this.#d.node,{ifNotExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}var af=a.i(4789);class ag{#d;constructor(a){this.#d=(0,b.freeze)(a)}temporary(){return new ag({...this.#d,node:g.CreateTableNode.cloneWith(this.#d.node,{temporary:!0})})}onCommit(a){return new ag({...this.#d,node:g.CreateTableNode.cloneWith(this.#d.node,{onCommit:function(a){if(g.ON_COMMIT_ACTIONS.includes(a))return a;throw Error(`invalid OnCommitAction ${a}`)}(a)})})}ifNotExists(){return new ag({...this.#d,node:g.CreateTableNode.cloneWith(this.#d.node,{ifNotExists:!0})})}addColumn(a,c,d=b.noop){let e=d(new C(o.create(a,(0,E.parseDataTypeExpression)(c))));return new ag({...this.#d,node:g.CreateTableNode.cloneWithColumn(this.#d.node,e.toOperationNode())})}addPrimaryKeyConstraint(a,c,d=b.noop){let e=d(new V(Q.create(c,a)));return new ag({...this.#d,node:g.CreateTableNode.cloneWithConstraint(this.#d.node,e.toOperationNode())})}addUniqueConstraint(a,c,d=b.noop){let e=d(new U(I.create(c,a)));return new ag({...this.#d,node:g.CreateTableNode.cloneWithConstraint(this.#d.node,e.toOperationNode())})}addCheckConstraint(a,c,d=b.noop){let e=d(new W(r.create(c.toOperationNode(),a)));return new ag({...this.#d,node:g.CreateTableNode.cloneWithConstraint(this.#d.node,e.toOperationNode())})}addForeignKeyConstraint(a,c,d,e,f=b.noop){let h=f(new G(F.create(c.map(n.ColumnNode.create),(0,l.parseTable)(d),e.map(n.ColumnNode.create),a)));return new ag({...this.#d,node:g.CreateTableNode.cloneWithConstraint(this.#d.node,h.toOperationNode())})}modifyFront(a){return new ag({...this.#d,node:g.CreateTableNode.cloneWithFrontModifier(this.#d.node,a.toOperationNode())})}modifyEnd(a){return new ag({...this.#d,node:g.CreateTableNode.cloneWithEndModifier(this.#d.node,a.toOperationNode())})}as(a){return new ag({...this.#d,node:g.CreateTableNode.cloneWith(this.#d.node,{selectQuery:(0,af.parseExpression)(a)})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class ah{#d;constructor(a){this.#d=(0,b.freeze)(a)}on(a){return new ah({...this.#d,node:i.cloneWith(this.#d.node,{table:(0,l.parseTable)(a)})})}ifExists(){return new ah({...this.#d,node:i.cloneWith(this.#d.node,{ifExists:!0})})}cascade(){return new ah({...this.#d,node:i.cloneWith(this.#d.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class ai{#d;constructor(a){this.#d=(0,b.freeze)(a)}ifExists(){return new ai({...this.#d,node:j.cloneWith(this.#d.node,{ifExists:!0})})}cascade(){return new ai({...this.#d,node:j.cloneWith(this.#d.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class aj{#d;constructor(a){this.#d=(0,b.freeze)(a)}ifExists(){return new aj({...this.#d,node:k.cloneWith(this.#d.node,{ifExists:!0})})}cascade(){return new aj({...this.#d,node:k.cloneWith(this.#d.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}var ak=a.i(13344),al=a.i(85545),am=a.i(12741);class an{#e=new ac;transformQuery(a){return this.#e.transformNode(a.node,a.queryId)}transformResult(a){return Promise.resolve(a.result)}}class ao{#d;constructor(a){this.#d=(0,b.freeze)(a)}temporary(){return new ao({...this.#d,node:am.CreateViewNode.cloneWith(this.#d.node,{temporary:!0})})}materialized(){return new ao({...this.#d,node:am.CreateViewNode.cloneWith(this.#d.node,{materialized:!0})})}ifNotExists(){return new ao({...this.#d,node:am.CreateViewNode.cloneWith(this.#d.node,{ifNotExists:!0})})}orReplace(){return new ao({...this.#d,node:am.CreateViewNode.cloneWith(this.#d.node,{orReplace:!0})})}columns(a){return new ao({...this.#d,node:am.CreateViewNode.cloneWith(this.#d.node,{columns:a.map(v.parseColumnName)})})}as(a){let b=a.withPlugin(new an).toOperationNode();return new ao({...this.#d,node:am.CreateViewNode.cloneWith(this.#d.node,{as:b})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}let ap=(0,b.freeze)({is:a=>"DropViewNode"===a.kind,create:a=>(0,b.freeze)({kind:"DropViewNode",name:h.SchemableIdentifierNode.create(a)}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})});class aq{#d;constructor(a){this.#d=(0,b.freeze)(a)}materialized(){return new aq({...this.#d,node:ap.cloneWith(this.#d.node,{materialized:!0})})}ifExists(){return new aq({...this.#d,node:ap.cloneWith(this.#d.node,{ifExists:!0})})}cascade(){return new aq({...this.#d,node:ap.cloneWith(this.#d.node,{cascade:!0})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}let ar=(0,b.freeze)({is:a=>"CreateTypeNode"===a.kind,create:a=>(0,b.freeze)({kind:"CreateTypeNode",name:a}),cloneWithEnum:(a,c)=>(0,b.freeze)({...a,enum:ab.ValueListNode.create(c.map(x.ValueNode.createImmediate))})});class as{#d;constructor(a){this.#d=(0,b.freeze)(a)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}asEnum(a){return new as({...this.#d,node:ar.cloneWithEnum(this.#d.node,a)})}$call(a){return a(this)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}let at=(0,b.freeze)({is:a=>"DropTypeNode"===a.kind,create:a=>(0,b.freeze)({kind:"DropTypeNode",name:a}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})});class au{#d;constructor(a){this.#d=(0,b.freeze)(a)}ifExists(){return new au({...this.#d,node:at.cloneWith(this.#d.node,{ifExists:!0})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}function av(a){if(!a.includes("."))return h.SchemableIdentifierNode.create(a);{let b=a.split(".").map(aw);if(2===b.length)return h.SchemableIdentifierNode.createWithSchema(b[0],b[1]);throw Error(`invalid schemable identifier ${a}`)}}function aw(a){return a.trim()}let ax=(0,b.freeze)({is:a=>"RefreshMaterializedViewNode"===a.kind,create:a=>(0,b.freeze)({kind:"RefreshMaterializedViewNode",name:h.SchemableIdentifierNode.create(a)}),cloneWith:(a,c)=>(0,b.freeze)({...a,...c})});class ay{#d;constructor(a){this.#d=(0,b.freeze)(a)}concurrently(){return new ay({...this.#d,node:ax.cloneWith(this.#d.node,{concurrently:!0,withNoData:!1})})}withData(){return new ay({...this.#d,node:ax.cloneWith(this.#d.node,{withNoData:!1})})}withNoData(){return new ay({...this.#d,node:ax.cloneWith(this.#d.node,{withNoData:!0,concurrently:!1})})}$call(a){return a(this)}toOperationNode(){return this.#d.executor.transformQuery(this.#d.node,this.#d.queryId)}compile(){return this.#d.executor.compileQuery(this.toOperationNode(),this.#d.queryId)}async execute(){await this.#d.executor.executeQuery(this.compile())}}class az{#f;constructor(a){this.#f=a}createTable(a){return new ag({queryId:(0,ak.createQueryId)(),executor:this.#f,node:g.CreateTableNode.create((0,l.parseTable)(a))})}dropTable(a){return new aj({queryId:(0,ak.createQueryId)(),executor:this.#f,node:k.create((0,l.parseTable)(a))})}createIndex(a){return new ad({queryId:(0,ak.createQueryId)(),executor:this.#f,node:e.create(a)})}dropIndex(a){return new ah({queryId:(0,ak.createQueryId)(),executor:this.#f,node:i.create(a)})}createSchema(a){return new ae({queryId:(0,ak.createQueryId)(),executor:this.#f,node:f.create(a)})}dropSchema(a){return new ai({queryId:(0,ak.createQueryId)(),executor:this.#f,node:j.create(a)})}alterTable(a){return new Y({queryId:(0,ak.createQueryId)(),executor:this.#f,node:c.create((0,l.parseTable)(a))})}createView(a){return new ao({queryId:(0,ak.createQueryId)(),executor:this.#f,node:am.CreateViewNode.create(a)})}refreshMaterializedView(a){return new ay({queryId:(0,ak.createQueryId)(),executor:this.#f,node:ax.create(a)})}dropView(a){return new aq({queryId:(0,ak.createQueryId)(),executor:this.#f,node:ap.create(a)})}createType(a){return new as({queryId:(0,ak.createQueryId)(),executor:this.#f,node:ar.create(av(a))})}dropType(a){return new au({queryId:(0,ak.createQueryId)(),executor:this.#f,node:at.create(av(a))})}withPlugin(a){return new az(this.#f.withPlugin(a))}withoutPlugins(){return new az(this.#f.withoutPlugins())}withSchema(a){return new az(this.#f.withPluginAtFront(new al.WithSchemaPlugin(a)))}}var aA=a.i(27675),aB=a.i(42769);class aC{ref(a){return new aA.DynamicReferenceBuilder(a)}table(a){return new aB.DynamicTableBuilder(a)}}class aD{#g;constructor(a){this.#g=a}async provideConnection(a){let b=await this.#g.acquireConnection();try{return await a(b)}finally{await this.#g.releaseConnection(b)}}}var aE=a.i(72839),aF=a.i(6271);class aG extends aF.QueryExecutorBase{#h;#i;#j;constructor(a,b,c,d=[]){super(d),this.#h=a,this.#i=b,this.#j=c}get adapter(){return this.#i}compileQuery(a,b){return this.#h.compileQuery(a,b)}provideConnection(a){return this.#j.provideConnection(a)}withPlugins(a){return new aG(this.#h,this.#i,this.#j,[...this.plugins,...a])}withPlugin(a){return new aG(this.#h,this.#i,this.#j,[...this.plugins,a])}withPluginAtFront(a){return new aG(this.#h,this.#i,this.#j,[a,...this.plugins])}withConnectionProvider(a){return new aG(this.#h,this.#i,a,[...this.plugins])}withoutPlugins(){return new aG(this.#h,this.#i,this.#j,[])}}function aH(){return"undefined"!=typeof performance&&(0,b.isFunction)(performance.now)?performance.now():Date.now()}class aI{#g;#k;#l;#m;#n;#o=new WeakSet;constructor(a,b){this.#m=!1,this.#g=a,this.#k=b}async init(){if(this.#n)throw Error("driver has already been destroyed");this.#l||(this.#l=this.#g.init().then(()=>{this.#m=!0}).catch(a=>(this.#l=void 0,Promise.reject(a)))),await this.#l}async acquireConnection(){if(this.#n)throw Error("driver has already been destroyed");this.#m||await this.init();let a=await this.#g.acquireConnection();return this.#o.has(a)||(this.#p()&&this.#q(a),this.#o.add(a)),a}async releaseConnection(a){await this.#g.releaseConnection(a)}beginTransaction(a,b){return this.#g.beginTransaction(a,b)}commitTransaction(a){return this.#g.commitTransaction(a)}rollbackTransaction(a){return this.#g.rollbackTransaction(a)}savepoint(a,b,c){if(this.#g.savepoint)return this.#g.savepoint(a,b,c);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(a,b,c){if(this.#g.rollbackToSavepoint)return this.#g.rollbackToSavepoint(a,b,c);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(a,b,c){if(this.#g.releaseSavepoint)return this.#g.releaseSavepoint(a,b,c);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#l&&(await this.#l,this.#n||(this.#n=this.#g.destroy().catch(a=>(this.#n=void 0,Promise.reject(a)))),await this.#n)}#p(){return this.#k.isLevelEnabled("query")||this.#k.isLevelEnabled("error")}#q(a){let b=a.executeQuery,c=a.streamQuery,d=this;a.executeQuery=async c=>{let e,f=aH();try{return await b.call(a,c)}catch(a){throw e=a,await d.#r(a,c,f),a}finally{e||await d.#s(c,f)}},a.streamQuery=async function*(b,e){let f,g=aH();try{for await(let d of c.call(a,b,e))yield d}catch(a){throw f=a,await d.#r(a,b,g),a}finally{f||await d.#s(b,g,!0)}}}async #r(a,b,c){await this.#k.error(()=>({level:"error",error:a,query:b,queryDurationMillis:this.#t(c)}))}async #s(a,b,c=!1){await this.#k.query(()=>({level:"query",isStream:c,query:a,queryDurationMillis:this.#t(b)}))}#t(a){return aH()-a}}let aJ=()=>{};class aK{#u;#v;constructor(a){this.#u=a}async provideConnection(a){for(;this.#v;)await this.#v.catch(aJ);return this.#v=this.#w(a).finally(()=>{this.#v=void 0}),this.#v}async #w(a){return await a(this.#u)}}let aL=["read only","read write"],aM=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function aN(a){if(a.accessMode&&!aL.includes(a.accessMode))throw Error(`invalid transaction access mode ${a.accessMode}`);if(a.isolationLevel&&!aM.includes(a.isolationLevel))throw Error(`invalid transaction isolation level ${a.isolationLevel}`)}var aO=a.i(37327);(0,b.freeze)(["query","error"]);class aP{#x;#y;constructor(a){(0,b.isFunction)(a)?(this.#y=a,this.#x=(0,b.freeze)({query:!0,error:!0})):(this.#y=aQ,this.#x=(0,b.freeze)({query:a.includes("query"),error:a.includes("error")}))}isLevelEnabled(a){return this.#x[a]}async query(a){this.#x.query&&await this.#y(a())}async error(a){this.#x.error&&await this.#y(a())}}function aQ(a){if("query"===a.level){let b=`kysely:query:${a.isStream?"stream:":""}`;console.log(`${b} ${a.query.sql}`),console.log(`${b} duration: ${a.queryDurationMillis.toFixed(1)}ms`)}else"error"===a.level&&(a.error instanceof Error?console.error(`kysely:error: ${a.error.stack??a.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:a.error,query:a.query.sql,queryDurationMillis:a.queryDurationMillis})}`))}var aR=a.i(52817),aS=a.i(73664),aT=a.i(85184),aU=a.i(28283);Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class aV extends aE.QueryCreator{#d;constructor(a){let c,d;if(function(a){return(0,b.isObject)(a)&&(0,b.isObject)(a.config)&&(0,b.isObject)(a.driver)&&(0,b.isObject)(a.executor)&&(0,b.isObject)(a.dialect)}(a))c={executor:a.executor},d={...a};else{const b=a.dialect,e=b.createDriver(),f=b.createQueryCompiler(),g=b.createAdapter(),h=new aI(e,new aP(a.log??[])),i=new aG(f,g,new aD(h),a.plugins??[]);c={executor:i},d={config:a,executor:i,dialect:b,driver:h}}super(c),this.#d=(0,b.freeze)(d)}get schema(){return new az(this.#d.executor)}get dynamic(){return new aC}get introspection(){return this.#d.dialect.createIntrospector(this.withoutPlugins())}case(a){return new aR.CaseBuilder({node:aS.CaseNode.create((0,b.isUndefined)(a)?void 0:(0,af.parseExpression)(a))})}get fn(){return(0,aO.createFunctionModule)()}transaction(){return new aY({...this.#d})}startTransaction(){return new aZ({...this.#d})}connection(){return new aX({...this.#d})}withPlugin(a){return new aV({...this.#d,executor:this.#d.executor.withPlugin(a)})}withoutPlugins(){return new aV({...this.#d,executor:this.#d.executor.withoutPlugins()})}withSchema(a){return new aV({...this.#d,executor:this.#d.executor.withPluginAtFront(new al.WithSchemaPlugin(a))})}withTables(){return new aV({...this.#d})}async destroy(){await this.#d.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#d.executor}executeQuery(a,c){void 0!==c&&(0,aU.logOnce)("Passing `queryId` in `db.executeQuery` is deprecated and will result in a compile-time error in the future.");let d=(0,b.isObject)(a)&&(0,b.isFunction)(a.compile)?a.compile():a;return this.getExecutor().executeQuery(d)}async [Symbol.asyncDispose](){await this.destroy()}}class aW extends aV{#d;constructor(a){super(a),this.#d=a}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(a){return new aW({...this.#d,executor:this.#d.executor.withPlugin(a)})}withoutPlugins(){return new aW({...this.#d,executor:this.#d.executor.withoutPlugins()})}withSchema(a){return new aW({...this.#d,executor:this.#d.executor.withPluginAtFront(new al.WithSchemaPlugin(a))})}withTables(){return new aW({...this.#d})}}class aX{#d;constructor(a){this.#d=(0,b.freeze)(a)}async execute(a){return this.#d.executor.provideConnection(async b=>{let c=this.#d.executor.withConnectionProvider(new aK(b)),d=new aV({...this.#d,executor:c});return await a(d)})}}class aY{#d;constructor(a){this.#d=(0,b.freeze)(a)}setAccessMode(a){return new aY({...this.#d,accessMode:a})}setIsolationLevel(a){return new aY({...this.#d,isolationLevel:a})}async execute(a){let{isolationLevel:b,accessMode:c,...d}=this.#d,e={isolationLevel:b,accessMode:c};return aN(e),this.#d.executor.provideConnection(async b=>{let c=this.#d.executor.withConnectionProvider(new aK(b)),f=new aW({...d,executor:c}),g=!1;try{await this.#d.driver.beginTransaction(b,e),g=!0;let c=await a(f);return await this.#d.driver.commitTransaction(b),c}catch(a){throw g&&await this.#d.driver.rollbackTransaction(b),a}})}}class aZ{#d;constructor(a){this.#d=(0,b.freeze)(a)}setAccessMode(a){return new aZ({...this.#d,accessMode:a})}setIsolationLevel(a){return new aZ({...this.#d,isolationLevel:a})}async execute(){let{isolationLevel:a,accessMode:b,...c}=this.#d,d={isolationLevel:a,accessMode:b};aN(d);let e=await (0,aT.provideControlledConnection)(this.#d.executor);return await this.#d.driver.beginTransaction(e.connection,d),new a$({...c,connection:e,executor:this.#d.executor.withConnectionProvider(new aK(e.connection))})}}class a$ extends aW{#d;#z;#A;constructor(a){const c={isCommitted:!1,isRolledBack:!1},{connection:d,...e}=a={...a,executor:new a1(a.executor,c)};super(e),this.#d=(0,b.freeze)(a),this.#A=c;const f=(0,ak.createQueryId)();this.#z=b=>a.executor.compileQuery(b,f)}get isCommitted(){return this.#A.isCommitted}get isRolledBack(){return this.#A.isRolledBack}commit(){return a0(this.#A),new a_(async()=>{await this.#d.driver.commitTransaction(this.#d.connection.connection),this.#A.isCommitted=!0,this.#d.connection.release()})}rollback(){return a0(this.#A),new a_(async()=>{await this.#d.driver.rollbackTransaction(this.#d.connection.connection),this.#A.isRolledBack=!0,this.#d.connection.release()})}savepoint(a){return a0(this.#A),new a_(async()=>(await this.#d.driver.savepoint?.(this.#d.connection.connection,a,this.#z),new a$({...this.#d})))}rollbackToSavepoint(a){return a0(this.#A),new a_(async()=>(await this.#d.driver.rollbackToSavepoint?.(this.#d.connection.connection,a,this.#z),new a$({...this.#d})))}releaseSavepoint(a){return a0(this.#A),new a_(async()=>(await this.#d.driver.releaseSavepoint?.(this.#d.connection.connection,a,this.#z),new a$({...this.#d})))}withPlugin(a){return new a$({...this.#d,executor:this.#d.executor.withPlugin(a)})}withoutPlugins(){return new a$({...this.#d,executor:this.#d.executor.withoutPlugins()})}withSchema(a){return new a$({...this.#d,executor:this.#d.executor.withPluginAtFront(new al.WithSchemaPlugin(a))})}withTables(){return new a$({...this.#d})}}class a_{#B;constructor(a){this.#B=a}async execute(){return await this.#B()}}function a0(a){if(a.isCommitted)throw Error("Transaction is already committed");if(a.isRolledBack)throw Error("Transaction is already rolled back")}class a1{#f;#A;constructor(a,b){a instanceof a1?this.#f=a.#f:this.#f=a,this.#A=b}get adapter(){return this.#f.adapter}get plugins(){return this.#f.plugins}transformQuery(a,b){return this.#f.transformQuery(a,b)}compileQuery(a,b){return this.#f.compileQuery(a,b)}provideConnection(a){return this.#f.provideConnection(a)}executeQuery(a){return a0(this.#A),this.#f.executeQuery(a)}stream(a,b){return a0(this.#A),this.#f.stream(a,b)}withConnectionProvider(a){return new a1(this.#f.withConnectionProvider(a),this.#A)}withPlugin(a){return new a1(this.#f.withPlugin(a),this.#A)}withPlugins(a){return new a1(this.#f.withPlugins(a),this.#A)}withPluginAtFront(a){return new a1(this.#f.withPluginAtFront(a),this.#A)}withoutPlugins(){return new a1(this.#f.withoutPlugins(),this.#A)}}var a2=a.i(54132),a3=a.i(19560);class a4{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}class a5 extends a4{get supportsCreateIfNotExists(){return!1}get supportsTransactionalDdl(){return!0}get supportsOutput(){return!0}async acquireMigrationLock(a){await a3.sql`exec sp_getapplock @DbPrincipal = ${a3.sql.lit("dbo")}, @Resource = ${a3.sql.lit(a2.DEFAULT_MIGRATION_TABLE)}, @LockMode = ${a3.sql.lit("Exclusive")}`.execute(a)}async releaseMigrationLock(){}}var a6=a.i(4781);function a7(a,c){var d;if(d=a,(0,b.isObject)(d)&&(0,b.isString)(d.stack)&&c.stack){let b=c.stack.split("\n").slice(1).join("\n");a.stack+=`
${b}`}return a}var a8=a.i(52779),a9=a.i(70557);let ba=Symbol(),bb=Symbol(),bc=Symbol();class bd{#C;#D;constructor(a){this.#C=(0,b.freeze)({...a});const{tarn:c,tedious:d,validateConnections:e}=this.#C,{validateConnections:f,...g}=c.options;this.#D=new c.Pool({...g,create:async()=>{let a=await d.connectionFactory();return await new be(a,d).connect()},destroy:async a=>{await a[bb]()},validate:!1===e||!1===f?void 0:a=>a[bc]()})}async init(){}async acquireConnection(){return await this.#D.acquire().promise}async beginTransaction(a,b){await a.beginTransaction(b)}async commitTransaction(a){await a.commitTransaction()}async rollbackTransaction(a){await a.rollbackTransaction()}async savepoint(a,b){await a.savepoint(b)}async rollbackToSavepoint(a,b){await a.rollbackTransaction(b)}async releaseConnection(a){(this.#C.resetConnectionsOnRelease||this.#C.tedious.resetConnectionOnRelease)&&await a[ba](),this.#D.release(a)}async destroy(){await this.#D.destroy()}}class be{#u;#E;#F;constructor(a,b){this.#u=a,this.#E=!1,this.#F=b}async beginTransaction(a){let{isolationLevel:b}=a;await new Promise((a,c)=>this.#u.beginTransaction(b=>{b?c(b):a(void 0)},b?(0,a8.randomString)(8):void 0,b?this.#G(b):void 0))}async commitTransaction(){await new Promise((a,b)=>this.#u.commitTransaction(c=>{c?b(c):a(void 0)}))}async connect(){let{promise:a,reject:b,resolve:c}=new a9.Deferred;function d(){b(Error("The connection ended without ever completing the connection"))}return this.#u.connect(a=>{if(a)return b(a);c()}),this.#u.on("error",a=>{a instanceof Error&&"code"in a&&"ESOCKET"===a.code&&(this.#E=!0),console.error(a),b(a)}),this.#u.once("end",d),await a,this.#u.off("end",d),this}async executeQuery(a){try{let b=new a9.Deferred,c=new bf({compiledQuery:a,tedious:this.#F,onDone:b});this.#u.execSql(c.request);let{rowCount:d,rows:e}=await b.promise;return{numAffectedRows:void 0!==d?BigInt(d):void 0,rows:e}}catch(a){throw a7(a,Error())}}async rollbackTransaction(a){await new Promise((b,c)=>this.#u.rollbackTransaction(a=>{a?c(a):b(void 0)},a))}async savepoint(a){await new Promise((b,c)=>this.#u.saveTransaction(a=>{a?c(a):b(void 0)},a))}async *streamQuery(a,b){if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=new bf({compiledQuery:a,streamChunkSize:b,tedious:this.#F});this.#u.execSql(c.request);try{for(;;){let a=await c.readChunk();if(0===a.length||(yield{rows:a},a.length<b))break}}finally{await this.#H(c)}}#G(a){let{ISOLATION_LEVEL:b}=this.#F,c={"read committed":b.READ_COMMITTED,"read uncommitted":b.READ_UNCOMMITTED,"repeatable read":b.REPEATABLE_READ,serializable:b.SERIALIZABLE,snapshot:b.SNAPSHOT}[a];if(void 0===c)throw Error(`Unknown isolation level: ${a}`);return c}#H(a){return new Promise(b=>{a.request.once("requestCompleted",b),this.#u.cancel()||(a.request.off("requestCompleted",b),b())})}[bb](){return"closed"in this.#u&&this.#u.closed?Promise.resolve():new Promise(a=>{this.#u.once("end",a),this.#u.close()})}async [ba](){await new Promise((a,b)=>{this.#u.reset(c=>{if(c)return b(c);a()})})}async [bc](){if(this.#E||this.#I())return!1;try{let a=new a9.Deferred,b=new bf({compiledQuery:a6.CompiledQuery.raw("select 1"),onDone:a,tedious:this.#F});return this.#u.execSql(b.request),await a.promise,!0}catch{return!1}}#I(){return"closed"in this.#u&&!!this.#u.closed}}class bf{#J;#K;#L;#M;#F;#N;constructor(a){const{compiledQuery:b,onDone:c,streamChunkSize:d,tedious:e}=a;if(this.#K=[],this.#L=d,this.#M={},this.#F=e,c){const a="onDone";this.#M[a]=(b,d)=>{if("chunkReady"!==b){if(delete this.#M[a],"error"===b)return c.reject(d);c.resolve({rowCount:this.#N,rows:this.#K})}}}this.#J=new this.#F.Request(b.sql,(a,b)=>{if(a)return Object.values(this.#M).forEach(b=>b("error",a instanceof AggregateError?a.errors:a));this.#N=b}),this.#O(b.parameters),this.#P()}get request(){return this.#J}readChunk(){let a=this.readChunk.name;return new Promise((b,c)=>{this.#M[a]=(d,e)=>{if(delete this.#M[a],"error"===d)return c(e);b(this.#K.splice(0,this.#L))},this.#J.resume()})}#O(a){for(let b=0;b<a.length;b++){let c=a[b];this.#J.addParameter(String(b+1),this.#Q(c),c)}}#P(){let a=this.#L?()=>{this.#L<=this.#K.length&&(this.#J.pause(),Object.values(this.#M).forEach(a=>a("chunkReady")))}:()=>{},b=b=>{let c={};for(let a of b)c[a.metadata.colName]=a.value;this.#K.push(c),a()};this.#J.on("row",b),this.#J.once("requestCompleted",()=>{Object.values(this.#M).forEach(a=>a("completed")),this.#J.off("row",b)})}#Q(a){if((0,b.isNull)(a)||(0,b.isUndefined)(a)||(0,b.isString)(a))return this.#F.TYPES.NVarChar;if((0,b.isBigInt)(a)||(0,b.isNumber)(a)&&a%1==0)if(a<-0x80000000||a>0x7fffffff)return this.#F.TYPES.BigInt;else return this.#F.TYPES.Int;return(0,b.isNumber)(a)?this.#F.TYPES.Float:(0,b.isBoolean)(a)?this.#F.TYPES.Bit:(0,b.isDate)(a)?this.#F.TYPES.DateTime:(0,b.isBuffer)(a)?this.#F.TYPES.VarBinary:this.#F.TYPES.NVarChar}}class bg{#R;constructor(a){this.#R=a}async getSchemas(){return await this.#R.selectFrom("sys.schemas").select("name").execute()}async getTables(a={withInternalKyselyTables:!1}){let c=await this.#R.selectFrom("sys.tables as tables").leftJoin("sys.schemas as table_schemas","table_schemas.schema_id","tables.schema_id").innerJoin("sys.columns as columns","columns.object_id","tables.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",a=>a.onRef("comments.major_id","=","tables.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).$if(!a.withInternalKyselyTables,a=>a.where("tables.name","!=",a2.DEFAULT_MIGRATION_TABLE).where("tables.name","!=",a2.DEFAULT_MIGRATION_LOCK_TABLE)).select(["tables.name as table_name",a=>a.ref("tables.type").$castTo().as("table_type"),"table_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"]).unionAll(this.#R.selectFrom("sys.views as views").leftJoin("sys.schemas as view_schemas","view_schemas.schema_id","views.schema_id").innerJoin("sys.columns as columns","columns.object_id","views.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",a=>a.onRef("comments.major_id","=","views.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).select(["views.name as table_name","views.type as table_type","view_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"])).orderBy("table_schema_name").orderBy("table_name").orderBy("column_name").execute(),d={};for(let a of c){let c=`${a.table_schema_name}.${a.table_name}`;(d[c]=d[c]||(0,b.freeze)({columns:[],isView:"V "===a.table_type,name:a.table_name,schema:a.table_schema_name??void 0})).columns.push((0,b.freeze)({dataType:a.type_name,dataTypeSchema:a.type_schema_name??void 0,hasDefaultValue:a.column_default_object_id>0||"NOT_APPLICABLE"!==a.column_generated_always_type||a.column_is_identity||a.column_is_computed||a.column_is_rowguidcol,isAutoIncrementing:a.column_is_identity,isNullable:a.column_is_nullable&&a.type_is_nullable,name:a.column_name,comment:a.column_comment??void 0}))}return Object.values(d)}async getMetadata(a){return{tables:await this.getTables(a)}}}var bh=a.i(76452);let bi=/^[a-z0-9_]$/i;class bj extends bh.DefaultQueryCompiler{getCurrentParameterPlaceholder(){return`@${this.numParameters}`}visitOffset(a){super.visitOffset(a),this.append(" rows")}compileColumnAlterations(a){let b={};for(let c of a)b[c.kind]||(b[c.kind]=[]),b[c.kind].push(c);let c=!0;b.AddColumnNode&&(this.append("add "),this.compileList(b.AddColumnNode),c=!1),b.AlterColumnNode&&(c||this.append(", "),this.compileList(b.AlterColumnNode)),b.DropColumnNode&&(c||this.append(", "),this.append("drop column "),this.compileList(b.DropColumnNode)),b.ModifyColumnNode&&(c||this.append(", "),this.compileList(b.ModifyColumnNode)),b.RenameColumnNode&&(c||this.append(", "),this.compileList(b.RenameColumnNode))}visitAddColumn(a){this.visitNode(a.column)}visitDropColumn(a){this.visitNode(a.column)}visitMergeQuery(a){super.visitMergeQuery(a),this.append(";")}visitCollate(a){this.append("collate ");let{name:b}=a.collation;for(let a of b)if(!bi.test(a))throw Error(`Invalid collation: ${b}`);this.append(b)}announcesNewColumnDataType(){return!1}}class bk{#C;constructor(a){this.#C=a}createDriver(){return new bd(this.#C)}createQueryCompiler(){return new bj}createAdapter(){return new a5}createIntrospector(a){return new bg(a)}}function bl(a,b){return S.RawNode.createWithChildren([S.RawNode.createWithSql(`${a} `),d.IdentifierNode.create(b)])}let bm=Symbol();class bn{#C;#o=new WeakMap;#D;constructor(a){this.#C=(0,b.freeze)({...a})}async init(){this.#D=(0,b.isFunction)(this.#C.pool)?await this.#C.pool():this.#C.pool}async acquireConnection(){let a=await this.#S(),b=this.#o.get(a);return!b&&(b=new bo(a),this.#o.set(a,b),this.#C?.onCreateConnection&&await this.#C.onCreateConnection(b)),this.#C?.onReserveConnection&&await this.#C.onReserveConnection(b),b}async #S(){return new Promise((a,b)=>{this.#D.getConnection(async(c,d)=>{c?b(c):a(d)})})}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c=[];b.isolationLevel&&c.push(`isolation level ${b.isolationLevel}`),b.accessMode&&c.push(b.accessMode);let d=`set transaction ${c.join(", ")}`;await a.executeQuery(a6.CompiledQuery.raw(d))}await a.executeQuery(a6.CompiledQuery.raw("begin"))}async commitTransaction(a){await a.executeQuery(a6.CompiledQuery.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(a6.CompiledQuery.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(bl("savepoint",b),(0,ak.createQueryId)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(bl("rollback to",b),(0,ak.createQueryId)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(bl("release savepoint",b),(0,ak.createQueryId)()))}async releaseConnection(a){a[bm]()}async destroy(){return new Promise((a,b)=>{this.#D.end(c=>{c?b(c):a()})})}}class bo{#T;constructor(a){this.#T=a}async executeQuery(a){try{let c=await this.#U(a);if((0,b.isObject)(c)&&"insertId"in c&&"affectedRows"in c){let{insertId:a,affectedRows:b,changedRows:d}=c;return{insertId:null!=a&&"0"!==a.toString()?BigInt(a):void 0,numAffectedRows:null!=b?BigInt(b):void 0,numChangedRows:null!=d?BigInt(d):void 0,rows:[]}}if(Array.isArray(c))return{rows:c};return{rows:[]}}catch(a){throw a7(a,Error())}}#U(a){return new Promise((b,c)=>{this.#T.query(a.sql,a.parameters,(a,d)=>{a?c(a):b(d)})})}async *streamQuery(a,b){let c=this.#T.query(a.sql,a.parameters).stream({objectMode:!0});try{for await(let a of c)yield{rows:[a]}}catch(a){if(a&&"object"==typeof a&&"code"in a&&"ERR_STREAM_PREMATURE_CLOSE"===a.code)return;throw a}}[bm](){this.#T.release()}}var bp=bh;let bq=/`/g;class br extends bp.DefaultQueryCompiler{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getExplainOptionAssignment(){return"="}getExplainOptionsDelimiter(){return" "}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}sanitizeIdentifier(a){return a.replace(bq,"``")}visitCreateIndex(a){this.append("create "),a.unique&&this.append("unique "),this.append("index "),a.ifNotExists&&this.append("if not exists "),this.visitNode(a.name),a.using&&(this.append(" using "),this.visitNode(a.using)),a.table&&(this.append(" on "),this.visitNode(a.table)),a.columns&&(this.append(" ("),this.compileList(a.columns),this.append(")")),a.where&&(this.append(" "),this.visitNode(a.where))}}class bs{#R;constructor(a){this.#R=a}async getSchemas(){return(await this.#R.selectFrom("information_schema.schemata").select("schema_name").$castTo().execute()).map(a=>({name:a.SCHEMA_NAME}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#R.selectFrom("information_schema.columns as columns").innerJoin("information_schema.tables as tables",a=>a.onRef("columns.TABLE_CATALOG","=","tables.TABLE_CATALOG").onRef("columns.TABLE_SCHEMA","=","tables.TABLE_SCHEMA").onRef("columns.TABLE_NAME","=","tables.TABLE_NAME")).select(["columns.COLUMN_NAME","columns.COLUMN_DEFAULT","columns.TABLE_NAME","columns.TABLE_SCHEMA","tables.TABLE_TYPE","columns.IS_NULLABLE","columns.DATA_TYPE","columns.EXTRA","columns.COLUMN_COMMENT"]).where("columns.TABLE_SCHEMA","=",a3.sql`database()`).orderBy("columns.TABLE_NAME").orderBy("columns.ORDINAL_POSITION").$castTo();a.withInternalKyselyTables||(b=b.where("columns.TABLE_NAME","!=",a2.DEFAULT_MIGRATION_TABLE).where("columns.TABLE_NAME","!=",a2.DEFAULT_MIGRATION_LOCK_TABLE));let c=await b.execute();return this.#V(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#V(a){return a.reduce((a,c)=>{let d=a.find(a=>a.name===c.TABLE_NAME);return d||(d=(0,b.freeze)({name:c.TABLE_NAME,isView:"VIEW"===c.TABLE_TYPE,schema:c.TABLE_SCHEMA,columns:[]}),a.push(d)),d.columns.push((0,b.freeze)({name:c.COLUMN_NAME,dataType:c.DATA_TYPE,isNullable:"YES"===c.IS_NULLABLE,isAutoIncrementing:c.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:null!==c.COLUMN_DEFAULT,comment:""===c.COLUMN_COMMENT?void 0:c.COLUMN_COMMENT})),a},[])}}let bt="ea586330-2c93-47c8-908d-981d9d270f9d";class bu extends a4{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(a,b){await a3.sql`select get_lock(${a3.sql.lit(bt)}, ${a3.sql.lit(3600)})`.execute(a)}async releaseMigrationLock(a,b){await a3.sql`select release_lock(${a3.sql.lit(bt)})`.execute(a)}}class bv{#C;constructor(a){this.#C=a}createDriver(){return new bn(this.#C)}createQueryCompiler(){return new br}createAdapter(){return new bu}createIntrospector(a){return new bs(a)}}let bw=Symbol();class bx{#C;#o=new WeakMap;#D;constructor(a){this.#C=(0,b.freeze)({...a})}async init(){this.#D=(0,b.isFunction)(this.#C.pool)?await this.#C.pool():this.#C.pool}async acquireConnection(){let a=await this.#D.connect(),b=this.#o.get(a);return!b&&(b=new by(a,{cursor:this.#C.cursor??null}),this.#o.set(a,b),this.#C.onCreateConnection&&await this.#C.onCreateConnection(b)),this.#C.onReserveConnection&&await this.#C.onReserveConnection(b),b}async beginTransaction(a,b){if(b.isolationLevel||b.accessMode){let c="start transaction";b.isolationLevel&&(c+=` isolation level ${b.isolationLevel}`),b.accessMode&&(c+=` ${b.accessMode}`),await a.executeQuery(a6.CompiledQuery.raw(c))}else await a.executeQuery(a6.CompiledQuery.raw("begin"))}async commitTransaction(a){await a.executeQuery(a6.CompiledQuery.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(a6.CompiledQuery.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(bl("savepoint",b),(0,ak.createQueryId)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(bl("rollback to",b),(0,ak.createQueryId)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(bl("release",b),(0,ak.createQueryId)()))}async releaseConnection(a){a[bw]()}async destroy(){if(this.#D){let a=this.#D;this.#D=void 0,await a.end()}}}class by{#W;#X;constructor(a,b){this.#W=a,this.#X=b}async executeQuery(a){try{let{command:b,rowCount:c,rows:d}=await this.#W.query(a.sql,[...a.parameters]);return{numAffectedRows:"INSERT"===b||"UPDATE"===b||"DELETE"===b||"MERGE"===b?BigInt(c):void 0,rows:d??[]}}catch(a){throw a7(a,Error())}}async *streamQuery(a,b){if(!this.#X.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(b)||b<=0)throw Error("chunkSize must be a positive integer");let c=this.#W.query(new this.#X.cursor(a.sql,a.parameters.slice()));try{for(;;){let a=await c.read(b);if(0===a.length)break;yield{rows:a}}}finally{await c.close()}}[bw](){this.#W.release()}}class bz{#R;constructor(a){this.#R=a}async getSchemas(){return(await this.#R.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(a=>({name:a.nspname}))}async getTables(a={withInternalKyselyTables:!1}){let b=this.#R.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",a3.sql`col_description(a.attrelid, a.attnum)`.as("column_description"),a3.sql`pg_get_serial_sequence(quote_ident(ns.nspname) || '.' || quote_ident(c.relname), a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("ns.nspname","!=","crdb_internal").where(a3.sql`has_schema_privilege(ns.nspname, 'USAGE')`).where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();a.withInternalKyselyTables||(b=b.where("c.relname","!=",a2.DEFAULT_MIGRATION_TABLE).where("c.relname","!=",a2.DEFAULT_MIGRATION_LOCK_TABLE));let c=await b.execute();return this.#V(c)}async getMetadata(a){return{tables:await this.getTables(a)}}#V(a){return a.reduce((a,c)=>{let d=a.find(a=>a.name===c.table&&a.schema===c.schema);return d||(d=(0,b.freeze)({name:c.table,isView:"v"===c.table_type,schema:c.schema,columns:[]}),a.push(d)),d.columns.push((0,b.freeze)({name:c.column,dataType:c.type,dataTypeSchema:c.type_schema,isNullable:!c.not_null,isAutoIncrementing:null!==c.auto_incrementing,hasDefaultValue:c.has_default,comment:c.column_description??void 0})),a},[])}}var bA=bh;let bB=/"/g;class bC extends bA.DefaultQueryCompiler{sanitizeIdentifier(a){return a.replace(bB,'""')}}let bD=BigInt("3853314791062309107");class bE extends a4{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(a,b){await a3.sql`select pg_advisory_xact_lock(${a3.sql.lit(bD)})`.execute(a)}async releaseMigrationLock(a,b){}}class bF{#C;constructor(a){this.#C=a}createDriver(){return new bx(this.#C)}createQueryCompiler(){return new bC}createAdapter(){return new bE}createIntrospector(a){return new bz(a)}}var bG=a.i(41595);class bH{#C;#Y=new bJ;#R;#u;constructor(a){this.#C=(0,b.freeze)({...a})}async init(){this.#R=(0,b.isFunction)(this.#C.database)?await this.#C.database():this.#C.database,this.#u=new bI(this.#R),this.#C.onCreateConnection&&await this.#C.onCreateConnection(this.#u)}async acquireConnection(){return await this.#Y.lock(),this.#u}async beginTransaction(a){await a.executeQuery(a6.CompiledQuery.raw("begin"))}async commitTransaction(a){await a.executeQuery(a6.CompiledQuery.raw("commit"))}async rollbackTransaction(a){await a.executeQuery(a6.CompiledQuery.raw("rollback"))}async savepoint(a,b,c){await a.executeQuery(c(bl("savepoint",b),(0,ak.createQueryId)()))}async rollbackToSavepoint(a,b,c){await a.executeQuery(c(bl("rollback to",b),(0,ak.createQueryId)()))}async releaseSavepoint(a,b,c){await a.executeQuery(c(bl("release",b),(0,ak.createQueryId)()))}async releaseConnection(){this.#Y.unlock()}async destroy(){this.#R?.close()}}class bI{#R;constructor(a){this.#R=a}executeQuery(a){let{sql:b,parameters:c}=a,d=this.#R.prepare(b);if(d.reader)return Promise.resolve({rows:d.all(c)});let{changes:e,lastInsertRowid:f}=d.run(c);return Promise.resolve({numAffectedRows:null!=e?BigInt(e):void 0,insertId:null!=f?BigInt(f):void 0,rows:[]})}async *streamQuery(a,b){let{sql:c,parameters:d,query:e}=a,f=this.#R.prepare(c);if(bG.SelectQueryNode.is(e))for(let a of f.iterate(d))yield{rows:[a]};else throw Error("Sqlite driver only supports streaming of select queries")}}class bJ{#Z;#$;async lock(){for(;this.#Z;)await this.#Z;this.#Z=new Promise(a=>{this.#$=a})}unlock(){let a=this.#$;this.#Z=void 0,this.#$=void 0,a?.()}}var bK=bh;let bL=/"/g;class bM extends bK.DefaultQueryCompiler{visitOrAction(a){this.append("or "),this.append(a.action)}getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(a){return a.replace(bL,'""')}visitDefaultInsertValue(a){this.append("null")}}class bN{#R;constructor(a){this.#R=a}async getSchemas(){return[]}async getTables(a={withInternalKyselyTables:!1}){return await this.#_(a)}async getMetadata(a){return{tables:await this.getTables(a)}}#aa(a,b){let c=a.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return b.withInternalKyselyTables||(c=c.where("name","!=",a2.DEFAULT_MIGRATION_TABLE).where("name","!=",a2.DEFAULT_MIGRATION_LOCK_TABLE)),c}async #_(a){let b=await this.#aa(this.#R,a).execute(),c=await this.#R.with("table_list",b=>this.#aa(b,a)).selectFrom(["table_list as tl",a3.sql`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy("tl.name").orderBy("p.cid").execute(),d={};for(let a of c)d[a.table]??=[],d[a.table].push(a);return b.map(({name:a,sql:b,type:c})=>{let e=b?.split(/[\(\),]/)?.find(a=>a.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),f=d[a]??[];if(!e){let a=f.filter(a=>a.pk>0);1===a.length&&"integer"===a[0].type.toLowerCase()&&(e=a[0].name)}return{name:a,isView:"view"===c,columns:f.map(a=>({name:a.name,dataType:a.type,isNullable:!a.notnull,isAutoIncrementing:a.name===e,hasDefaultValue:null!=a.dflt_value,comment:void 0}))}})}}class bO extends a4{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(a,b){}async releaseMigrationLock(a,b){}}class bP{#C;constructor(a){this.#C=(0,b.freeze)({...a})}createDriver(){return new bH(this.#C)}createQueryCompiler(){return new bM}createAdapter(){return new bO}createIntrospector(a){return new bN(a)}}function bQ(a){if(!a)return null;if("dialect"in a)return bQ(a.dialect);if("createDriver"in a){if(a instanceof bP)return"sqlite";if(a instanceof bv)return"mysql";if(a instanceof bF)return"postgres";if(a instanceof bk)return"mssql"}return"aggregate"in a?"sqlite":"getConnection"in a?"mysql":"connect"in a?"postgres":"fileControl"in a||"open"in a&&"close"in a&&"prepare"in a?"sqlite":null}let bR=async b=>{let c,d=b.database;if(!d)return{kysely:null,databaseType:null,transaction:void 0};if("db"in d)return{kysely:d.db,databaseType:d.type,transaction:d.transaction};if("dialect"in d)return{kysely:new aV({dialect:d.dialect}),databaseType:d.type,transaction:d.transaction};let e=bQ(d);if("createDriver"in d&&(c=d),"aggregate"in d&&!("createSession"in d)&&(c=new bP({database:d})),"getConnection"in d&&(c=new bv(d)),"connect"in d&&(c=new bF({pool:d})),"fileControl"in d){let{BunSqliteDialect:b}=await a.A(80487);c=new b({database:d})}if("createSession"in d){let b;try{({DatabaseSync:b}=await import("node:sqlite"))}catch(a){if(null!==a&&"object"==typeof a&&"code"in a&&"ERR_UNKNOWN_BUILTIN_MODULE"!==a.code)throw a}if(b&&d instanceof b){let{NodeSqliteDialect:b}=await a.A(97873);c=new b({database:d})}}return{kysely:c?new aV({dialect:c}):null,databaseType:e,transaction:void 0}};a.s(["n",()=>bQ,"t",()=>bR],17638)}];

//# sourceMappingURL=node_modules_better-auth_dist_dialect-D9ZUZA4J_mjs_dab08838._.js.map